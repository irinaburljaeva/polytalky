<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PolyTalky ‚Äî –ö–∞—Ç–∞–ª–æ–≥ –∫—É—Ä—Å–æ–≤</title>
  <meta name="description" content="–ö–∞—Ç–∞–ª–æ–≥ –∫—É—Ä—Å–æ–≤ PolyTalky: –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∏ PRO-–ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ –∏—Å–ø–∞–Ω—Å–∫–æ–º—É, –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É, –∏—Ç–∞–ª—å—è–Ω—Å–∫–æ–º—É, –Ω–µ–º–µ—Ü–∫–æ–º—É –∏ –¥—Ä—É–≥–∏–º —è–∑—ã–∫–∞–º. –§–∏–ª—å—Ç—Ä—ã, –ø–æ–∏—Å–∫ –∏ —É–¥–æ–±–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è." />
  <!-- –ï—Å–ª–∏ —Å–∞–π—Ç –∂–∏–≤—ë—Ç –ø–æ –∞–¥—Ä–µ—Å—É username.github.io/polytalky/ ‚Äî base –æ—Å—Ç–∞–≤–ª—è–µ–º. –ï—Å–ª–∏ –≤ –∫–æ—Ä–Ω–µ –¥–æ–º–µ–Ω–∞ ‚Äî —É–¥–∞–ª–∏ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ. -->
  <base href="/polytalky/">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --brand-yellow:#FFDE59; --brand-yellow-deep:#FFBA08; --brand-orange:#E85D04;
      --ink:#0F172A; --ink-2:#334155; --card:#FFFFFF; --bg:#FFF8D6;
    }
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--ink)}
    .shadow-soft{box-shadow:0 10px 30px rgba(0,0,0,.08)}
    .card{transition:transform .25s ease, box-shadow .25s ease}
    .card:hover{transform:translateY(-6px)}
    .badge-free{background:#e8ffe3;border:1px solid #a7f3d0;color:#065f46}
    .badge-pro{background:#fff0f0;border:1px solid #fecaca;color:#7f1d1d}
    .chip{border:1px solid #00000014;background:#fff;border-radius:999px;padding:.5rem .9rem;font-size:.9rem}
    .chip.active{background:var(--brand-yellow);border-color:#0000001f}
    .reveal{opacity:0;transform:translateY(12px);transition:.5s}
    .reveal.reveal--visible{opacity:1;transform:none}
    .soon-overlay{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(255,255,255,.6); backdrop-filter:blur(2px); border-radius:1.25rem;
      font-weight:800; color:#1a1a1a; letter-spacing:.3px;
    }
    .seasonal{
      position:relative;
      border:2px dashed #ffc107 !important;
      background:linear-gradient(180deg,#fff 0%,#fff8e1 100%);
      box-shadow:0 12px 40px rgba(255,193,7,.25);
    }
    .ribbon{
      position:absolute; top:10px; right:-8px; background:var(--brand-yellow);
      color:#1a1a1a; font-weight:700; padding:.35rem .6rem; border-radius:.5rem;
      border:1px solid #00000014; transform:rotate(3deg);
    }
    .ratio-square{ aspect-ratio: 1 / 1; }
  </style>
</head>
<body>

<!-- Header -->
<header class="sticky top-0 z-50 bg-[#fffef7]/80 backdrop-blur border-b border-black/10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
    <a href="/polytalky/" class="flex items-center gap-3 font-semibold text-lg">
      <img src="assets/logo.png" alt="PolyTalky" class="h-8 w-8 rounded-xl"> PolyTalky
    </a>
    <nav class="hidden md:flex items-center gap-6 text-sm text-[var(--ink-2)]">
      <a href="courses/" class="hover:opacity-80 font-semibold text-[var(--ink)]">–ö—É—Ä—Å—ã</a>
      <a href="shop/" class="hover:opacity-80">–ú–∞–≥–∞–∑–∏–Ω</a>
      <a href="student/" class="hover:opacity-80">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      <a href="courses/" class="inline-flex items-center gap-2 bg-[var(--brand-yellow)] hover:bg-[var(--brand-yellow-deep)] px-4 py-2 rounded-xl text-sm font-semibold text-[#1a1a1a] shadow-soft">–ù–∞—á–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</a>
    </nav>
    <button id="burger" class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-xl bg-white border border-black/10 shadow-soft" aria-label="–ú–µ–Ω—é">‚ò∞</button>
  </div>
  <div id="mnav" class="md:hidden hidden border-t border-black/10 bg-[#fffef7]">
    <div class="max-w-7xl mx-auto px-4 py-3 grid gap-2 text-[var(--ink-2)]">
      <a class="px-3 py-3 rounded-xl bg-white border border-black/10 shadow-soft" href="/polytalky/">–ì–ª–∞–≤–Ω–∞—è</a>
      <a class="px-3 py-3 rounded-xl bg-white border border-black/10 shadow-soft" href="shop/">–ú–∞–≥–∞–∑–∏–Ω</a>
      <a class="px-3 py-3 rounded-xl bg-white border border-black/10 shadow-soft" href="student/">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      <a class="px-3 py-3 rounded-xl bg-[var(--brand-yellow)] text-[#1a1a1a] font-semibold shadow-soft" href="courses/">–ù–∞—á–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</a>
    </div>
  </div>
</header>
<script>
  const b=document.getElementById('burger'), m=document.getElementById('mnav');
  if(b) b.addEventListener('click',()=>m.classList.toggle('hidden'));
</script>

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + —Å—á—ë—Ç—á–∏–∫ -->
  <div class="flex flex-wrap items-end justify-between gap-4">
    <div>
      <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight">–ö–∞—Ç–∞–ª–æ–≥ –∫—É—Ä—Å–æ–≤</h1>
      <p class="text-[var(--ink-2)] mt-1">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∏ PRO ‚Äî –Ω–∞–π–¥–∏—Ç–µ –∫—É—Ä—Å –ø–æ–¥ –≤–∞—à—É —Ü–µ–ª—å.</p>
    </div>
    <div class="text-sm text-[var(--ink-2)]"><span id="count">0</span> –∫—É—Ä—Å–æ–≤</div>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <section class="mt-6 p-4 sm:p-5 rounded-2xl bg-white border border-black/10 shadow-soft">
    <div class="grid gap-3 items-center lg:grid-cols-[1fr,auto,auto,auto,auto]">
      <!-- –ü–æ–∏—Å–∫ -->
      <label class="relative flex items-center">
        <input id="q" type="search" placeholder="–ü–æ–∏—Å–∫: —è–∑—ã–∫, –∫—É—Ä—Å, —Ç–µ–º–∞‚Ä¶"
               class="w-full rounded-xl border border-black/10 bg-white px-4 py-3 pr-10 outline-none focus:ring-2 focus:ring-[#ffd54a]">
        <span class="absolute right-3 text-[var(--ink-2)]">üîé</span>
      </label>

      <!-- –¢–∏–ø -->
      <div class="flex gap-2 justify-start flex-wrap">
        <button data-type="all" class="chip active" type="button">–í—Å–µ</button>
        <button data-type="free" class="chip" type="button">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ</button>
        <button data-type="pro"  class="chip" type="button">PRO</button>
      </div>

      <!-- –Ø–∑—ã–∫ -->
      <label class="flex">
        <select id="lang" class="rounded-xl border border-black/10 bg-white px-3 py-3 outline-none focus:ring-2 focus:ring-[#ffd54a]">
          <option value="">–Ø–∑—ã–∫: –ª—é–±–æ–π</option>
        </select>
      </label>

      <!-- –£—Ä–æ–≤–µ–Ω—å -->
      <div class="flex gap-2">
        <select id="level" class="rounded-xl border border-black/10 bg-white px-3 py-3 outline-none focus:ring-2 focus:ring-[#ffd54a]">
          <option value="">–£—Ä–æ–≤–µ–Ω—å: –ª—é–±–æ–π</option>
          <option>A0</option><option>A1</option><option>A2</option>
          <option>B1</option><option>B2</option><option>Intro</option><option>Starter</option>
        </select>
      </div>

      <!-- –°–µ–º—å—è + –†–µ–¥–∫–∏–µ -->
      <div class="flex gap-2 flex-wrap">
        <select id="family" class="rounded-xl border border-black/10 bg-white px-3 py-3 outline-none focus:ring-2 focus:ring-[#ffd54a]">
          <option value="">–°–µ–º—å—è: –ª—é–±–∞—è</option>
        </select>

        <button id="rare" class="chip" type="button" title="–õ–∏—Ç–æ–≤—Å–∫–∏–π, –ê—Ñ—Ä–∏–∫–∞–∞–Ω—Å, –†—É–º—ã–Ω—Å–∫–∏–π, –•–∏–Ω–¥–∏, –§–∏–Ω—Å–∫–∏–π, –®–≤–µ–¥—Å–∫–∏–π">
          –†–µ–¥–∫–∏–µ —è–∑—ã–∫–∏
        </button>
      </div>
    </div>
  </section>

  <!-- –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ–≥–∏ -->
  <div class="mt-3 flex flex-wrap gap-2 text-sm">
    <button class="chip" data-tag="travel" type="button">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</button>
    <button class="chip" data-tag="grammar" type="button">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</button>
    <button class="chip" data-tag="vocab" type="button">–°–ª–æ–≤–∞—Ä—å</button>
    <button class="chip" data-tag="challenge" type="button">–ß–µ–ª–ª–µ–Ω–¥–∂</button>
  </div>

  <!-- –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
  <section class="mt-6">
    <div id="grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
    <div id="empty" class="hidden mt-10 p-6 rounded-2xl bg-white border border-black/10 text-center text-[var(--ink-2)]">
      –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫.
    </div>
  </section>
</main>

<footer class="border-t border-black/10 py-8 text-sm text-[var(--ink-2)] bg-[#fffef7]">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
    <p>¬© <span id="y"></span> PolyTalky. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    <div class="flex gap-4">
      <a class="hover:opacity-80" href="/polytalky/">–ì–ª–∞–≤–Ω–∞—è</a>
      <a class="hover:opacity-80" href="shop/">–ú–∞–≥–∞–∑–∏–Ω</a>
      <a class="hover:opacity-80" href="student/">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
    </div>
  </div>
</footer>
<script>document.getElementById('y').textContent=new Date().getFullYear()</script>

<script>
/* ======= –î–ê–ù–ù–´–ï –ö–ê–¢–ê–õ–û–ì–ê ======= */
const courses = [
  // FREE
  {slug:'spanish-a0',      title:'–ò—Å–ø–∞–Ω—Å–∫–∏–π —Å –Ω—É–ª—è',            type:'free', lang:'es', flag:'üá™üá∏', level:'A0',    tags:['grammar','vocab'],       img:'spanish.jpg'},
  {slug:'italian-a0',      title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —Å –Ω—É–ª—è',          type:'free', lang:'it', flag:'üáÆüáπ', level:'A0',    tags:['vocab'],                 img:'italian.jpg'},
  {slug:'vamos-espana',    title:'¬°Vamos a Espa√±a! (–ê2‚ÄìB1)',    type:'free', lang:'es', flag:'üá™üá∏', level:'A2-B1', tags:['travel','dialog'],       img:'vamosaespana.jpg'},
  {slug:'english-intro',   title:'–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö',   type:'free', lang:'en', flag:'üá¨üáß', level:'Starter',tags:['challenge'],            img:'english.jpg'},
  {slug:'finnish-intro',   title:'–§–∏–Ω—Å–∫–∏–π —Å –Ω—É–ª—è',              type:'free', lang:'fi', flag:'üá´üáÆ', level:'Intro', tags:['vocab'],                 img:'finnish.jpg'},
  {slug:'german-intro',    title:'–ù–µ–º–µ—Ü–∫–∏–π —Å –Ω—É–ª—è',             type:'free', lang:'de', flag:'üá©üá™', level:'Intro', tags:['vocab'],                 img:'german.jpg'},
  {slug:'dutch-a0',        title:'–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—Å–∫–∏–π —Å –Ω—É–ª—è',        type:'free', lang:'nl', flag:'üá≥üá±', level:'A0',    tags:['vocab'],                 img:'nederlands.jpg'},
  {slug:'french-a0',       title:'–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π —Å –Ω—É–ª—è',          type:'free', lang:'fr', flag:'üá´üá∑', level:'A0',    tags:['vocab'],                 img:'french.jpg'},
  {slug:'japanese-a0',     title:'–Ø–ø–æ–Ω—Å–∫–∏–π —Å –Ω—É–ª—è',             type:'free', lang:'ja', flag:'üáØüáµ', level:'A0',    tags:['vocab'],                 img:'japanese.jpg'},
  {slug:'chinese-a0',      title:'–ö–∏—Ç–∞–π—Å–∫–∏–π —Å –Ω—É–ª—è',            type:'free', lang:'zh', flag:'üá®üá≥', level:'A0',    tags:['vocab'],                 img:'chinese.jpg'},
  {slug:'hindi-a0',        title:'–•–∏–Ω–¥–∏ —Å –Ω—É–ª—è',                type:'free', lang:'hi', flag:'üáÆüá≥', level:'A0',    tags:['vocab'],                 img:'hindi.jpg',    soon:true},
  {slug:'arabic-a0',       title:'–ê—Ä–∞–±—Å–∫–∏–π —Å –Ω—É–ª—è',             type:'free', lang:'ar', flag:'üá∏üá¶', level:'A0',    tags:['vocab'],                 img:'arabic.jpg',   soon:true},
  {slug:'turkish-a0',      title:'–¢—É—Ä–µ—Ü–∫–∏–π —Å –Ω—É–ª—è',             type:'free', lang:'tr', flag:'üáπüá∑', level:'A0',    tags:['vocab'],                 img:'turkish.jpg',  soon:true},
  {slug:'korean-a0',       title:'–ö–æ—Ä–µ–π—Å–∫–∏–π —Å –Ω—É–ª—è',            type:'free', lang:'ko', flag:'üá∞üá∑', level:'A0',    tags:['vocab'],                 img:'korean.jpg',   soon:true},

  // PRO
  {slug:'english-with-harry',  title:'English with Harry',                 type:'pro', lang:'en', flag:'ü™Ñ',  level:'A1-B1', tags:['reading','fun'],         img:'englishwithharry.jpg'},
  {slug:'visual-spanish',      title:'–í–∏–∑—É–∞–ª—å–Ω—ã–π –∏—Å–ø–∞–Ω—Å–∫–∏–π',               type:'pro', lang:'es', flag:'üñºÔ∏è',  level:'A1',    tags:['vocab','visual'],       img:'visualspanish.jpg'},
  {slug:'italian-songs',       title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –ø–æ –ø–µ—Å–Ω—è–º',              type:'pro', lang:'it', flag:'üéµ',  level:'A1',    tags:['listening','fun'],      img:'italiansongs.jpg'},
  {slug:'pro-espanol',         title:'Pro Espa√±ol (–æ—Ç –Ω–æ—Å–∏—Ç–µ–ª—è)',          type:'pro', lang:'es', flag:'üá™üá∏', level:'B1-B2', tags:['conversation'],          img:'proespanol.jpg'},
  {slug:'english-irregulars',  title:'–ß–µ–ª–ª–µ–Ω–¥–∂ –ø–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≥–ª–∞–≥–æ–ª–∞–º',  type:'pro', lang:'en', flag:'üá¨üáß', level:'A2',    tags:['grammar','challenge'],   img:'irregularverbs.jpg'},
  {slug:'30-days-english',     title:'30 days of English',                 type:'pro', lang:'en', flag:'üìÜ',  level:'A1',    tags:['challenge'],            img:'30daysofenglish.jpg'},
  {slug:'english-translators', title:'–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–æ–≤',        type:'pro', lang:'en', flag:'üìù',  level:'B2',    tags:['professional'],         img:'englishtranslate.jpg'},
  {slug:'polyglot-starter',    title:'PolyTalky Polyglot Pack. Starter',   type:'pro', lang:'multi', flag:'üåç', level:'A0-A1', tags:['vocab','visual'],    img:'polyglotpack.jpg'},
  {slug:'polyglot-cook',       title:'Polyglot Pack. Cook it!',            type:'pro', lang:'multi', flag:'üç≥', level:'A1',  tags:['vocab','fun'],          img:'cookit.jpg'},
  {slug:'polyglot-mchny',      title:'Polyglot Pack. MCHNY',               type:'pro', lang:'multi', flag:'üéÑ', level:'A1',  tags:['seasonal','fun'],       img:'mchny.jpg', seasonalStart:'25 –¥–µ–∫–∞–±—Ä—è', featured:true},
  {slug:'finnish-travel',      title:'–§–∏–Ω—Å–∫–∏–π –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π',            type:'pro', lang:'fi', flag:'üá´üáÆ', level:'A1',    tags:['travel'],               img:'finnishtravel.jpg'},
  {slug:'finnish-continue',    title:'–§–∏–Ω—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö (–ê2‚Äì–í1)',   type:'pro', lang:'fi', flag:'üá´üáÆ', level:'A2-B1', tags:['conversation'],          img:'finnisha2.jpg'},
  {slug:'german-continue',     title:'–ù–µ–º–µ—Ü–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö (–ê2‚Äì–í1)',  type:'pro', lang:'de', flag:'üá©üá™', level:'A2-B1', tags:['conversation'],          img:'germana2.jpg'},
  {slug:'italian-continue',    title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö',       type:'pro', lang:'it', flag:'üáÆüáπ', level:'A2',    tags:['conversation'],          img:'italiana2.jpg'},
  {slug:'afrikaans-a0',        title:'–ê—Ñ—Ä–∏–∫–∞–∞–Ω—Å —Å –Ω—É–ª—è',                    type:'pro', lang:'af', flag:'üáøüá¶', level:'A0',    tags:['vocab'],                 img:'afrikaans.jpg'},
  {slug:'swedish-a0',          title:'–®–≤–µ–¥—Å–∫–∏–π —Å –Ω—É–ª—è',                     type:'pro', lang:'sv', flag:'üá∏üá™', level:'A0',    tags:['vocab'],                 img:'swedish.jpg'},
  {slug:'lithuanian-a0',       title:'–õ–∏—Ç–æ–≤—Å–∫–∏–π —Å –Ω—É–ª—è',                    type:'pro', lang:'lt', flag:'üá±üáπ', level:'A0',    tags:['vocab'],                 img:'lithuanian.jpg'},
  {slug:'romanian-a0',         title:'–†—É–º—ã–Ω—Å–∫–∏–π —Å –Ω—É–ª—è',                    type:'pro', lang:'ro', flag:'üá∑üá¥', level:'A0',    tags:['vocab'],                 img:'romanian.jpg'},
  {slug:'norwegian-a0',        title:'–ù–æ—Ä–≤–µ–∂—Å–∫–∏–π —Å –Ω—É–ª—è',                   type:'pro', lang:'no', flag:'üá≥üá¥', level:'A0',    tags:['vocab'],                 img:'norwegian.jpg', soon:true}
];

/* ======= –ú–ê–ü–ü–ò–ù–ì ======= */
const langMap = {
  multi:'–ú–Ω–æ–≥–æ —è–∑—ã–∫–æ–≤', es:'–ò—Å–ø–∞–Ω—Å–∫–∏–π', en:'–ê–Ω–≥–ª–∏–π—Å–∫–∏–π', it:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π', de:'–ù–µ–º–µ—Ü–∫–∏–π', fi:'–§–∏–Ω—Å–∫–∏–π', nl:'–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—Å–∫–∏–π',
  fr:'–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π', ja:'–Ø–ø–æ–Ω—Å–∫–∏–π', zh:'–ö–∏—Ç–∞–π—Å–∫–∏–π', hi:'–•–∏–Ω–¥–∏', ar:'–ê—Ä–∞–±—Å–∫–∏–π', tr:'–¢—É—Ä–µ—Ü–∫–∏–π', ko:'–ö–æ—Ä–µ–π—Å–∫–∏–π',
  af:'–ê—Ñ—Ä–∏–∫–∞–∞–Ω—Å', sv:'–®–≤–µ–¥—Å–∫–∏–π', lt:'–õ–∏—Ç–æ–≤—Å–∫–∏–π', ro:'–†—É–º—ã–Ω—Å–∫–∏–π', no:'–ù–æ—Ä–≤–µ–∂—Å–∫–∏–π'
};
const familyByLang = {
  es:'romance', it:'romance', fr:'romance', ro:'romance',
  en:'germanic', de:'germanic', nl:'germanic', sv:'germanic', no:'germanic', af:'germanic',
  fi:'uralic', tr:'turkic', ar:'semitic', zh:'sinitic', hi:'indo-aryan', lt:'baltic', ko:'koreanic', ja:'japonic', multi:'multi'
};
const rareSet = new Set(['lt','af','ro','hi','fi','sv']);
const familyName = {
  romance:'–†–æ–º–∞–Ω—Å–∫–∏–µ', germanic:'–ì–µ—Ä–º–∞–Ω—Å–∫–∏–µ', uralic:'–£—Ä–∞–ª—å—Å–∫–∏–µ', turkic:'–¢—é—Ä–∫—Å–∫–∏–µ', semitic:'–°–µ–º–∏—Ç—Å–∫–∏–µ',
  sinitic:'–ö–∏—Ç–∞–π—Å–∫–æ-—Ç–∏–±–µ—Ç—Å–∫–∏–µ', 'indo-aryan':'–ò–Ω–¥–æ–∞—Ä–∏–π—Å–∫–∞—è', baltic:'–ë–∞–ª—Ç–∏–π—Å–∫–∏–µ', koreanic:'–ö–æ—Ä–µ–π—Å–∫–∞—è', japonic:'–Ø–ø–æ–Ω—Å–∫–∞—è', multi:'–ú—É–ª—å—Ç–∏'
};

/* ======= –†–ï–ù–î–ï–†/–§–ò–õ–¨–¢–†–´ ======= */
const grid    = document.getElementById('grid');
const empty   = document.getElementById('empty');
const count   = document.getElementById('count');
const q       = document.getElementById('q');
const level   = document.getElementById('level');
const chips   = document.querySelectorAll('.chip');
const typeChips = document.querySelectorAll('[data-type]');
const langSel = document.getElementById('lang');
const familySel = document.getElementById('family');
const rareBtn = document.getElementById('rare');

// —Å–µ–ª–µ–∫—Ç —è–∑—ã–∫–æ–≤
(function fillLang(){
  const langs = [...new Set(courses.map(c=>c.lang))].filter(Boolean);
  const byName = langs.sort((a,b)=>(langMap[a]||a).localeCompare(langMap[b]||b,'ru'));
  byName.forEach(k=>{
    const opt=document.createElement('option');
    opt.value=k; opt.textContent=langMap[k]||k;
    langSel.appendChild(opt);
  });
})();
// —Å–µ–ª–µ–∫—Ç —Å–µ–º–µ–π
(function fillFamilies(){
  const famsUsed = new Set(courses.map(c=>familyByLang[c.lang]||'').filter(Boolean));
  [...famsUsed].sort((a,b)=>(familyName[a]||a).localeCompare(familyName[b]||b,'ru'))
    .forEach(f=>{
      const opt=document.createElement('option');
      opt.value=f; opt.textContent=familyName[f]||f;
      familySel.appendChild(opt);
    });
})();

// —Å–æ—Å—Ç–æ—è–Ω–∏–µ
let state = { type:'all', lang:'', level:'', tag:'', q:'', sort:'pop', family:'', rare:false };

// –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
q.addEventListener('input',()=>{ state.q=q.value.trim().toLowerCase(); render(); });
level.addEventListener('change',()=>{ state.level=level.value; render(); });
langSel.addEventListener('change',()=>{ state.lang=langSel.value; render(); });
familySel.addEventListener('change',()=>{ state.family=familySel.value; render(); });
rareBtn.addEventListener('click',()=>{ rareBtn.classList.toggle('active'); state.rare = rareBtn.classList.contains('active'); render(); });

typeChips.forEach(b=>{
  b.addEventListener('click',()=>{
    typeChips.forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    state.type=b.dataset.type; render();
  });
});
chips.forEach(c=>{
  if(!c.dataset.tag) return;
  c.addEventListener('click',()=>{
    const on = c.classList.toggle('active');
    chips.forEach(x=>{ if(x!==c && x.dataset.tag) x.classList.remove('active'); });
    state.tag = on ? c.dataset.tag : '';
    render();
  });
});

// —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
function parseSeason(s){
  const months = ['—è–Ω–≤–∞—Ä—è','—Ñ–µ–≤—Ä–∞–ª—è','–º–∞—Ä—Ç–∞','–∞–ø—Ä–µ–ª—è','–º–∞—è','–∏—é–Ω—è','–∏—é–ª—è','–∞–≤–≥—É—Å—Ç–∞','—Å–µ–Ω—Ç—è–±—Ä—è','–æ–∫—Ç—è–±—Ä—è','–Ω–æ—è–±—Ä—è','–¥–µ–∫–∞–±—Ä—è'];
  const [d, m] = s.toLowerCase().split(' ');
  const day = parseInt(d,10);
  const month = months.indexOf(m);
  if (month < 0 || !day) return null;
  const now = new Date();
  let dt = new Date(now.getFullYear(), month, day);
  if (dt < now) dt = new Date(now.getFullYear()+1, month, day);
  return dt;
}

function applyFilters(list){
  return list.filter(c=>{
    if(state.type!=='all' && c.type!==state.type) return false;
    if(state.lang && c.lang!==state.lang) return false;
    if(state.level && !(c.level||'').toUpperCase().includes(state.level.toUpperCase())) return false;
    if(state.tag && !(c.tags||[]).includes(state.tag)) return false;
    if(state.family){
      const fam = familyByLang[c.lang] || '';
      if(fam !== state.family) return false;
    }
    if(state.rare && !rareSet.has(c.lang)) return false;
    if(state.q){
      const s=(c.title+' '+(langMap[c.lang]||'')+' '+(c.level||'')+' '+(c.type)).toLowerCase();
      if(!s.includes(state.q)) return false;
    }
    return true;
  }).sort((a,b)=>{
    // 1) Featured ‚Äî –ø–µ—Ä–≤—ã–º–∏
    if (!!a.featured !== !!b.featured) return a.featured ? -1 : 1;

    // 2) –°–µ–∑–æ–Ω–Ω—ã–µ –ø–æ –±–ª–∏–∂–∞–π—à–µ–π –¥–∞—Ç–µ
    const da = a.seasonalStart ? parseSeason(a.seasonalStart) : null;
    const db = b.seasonalStart ? parseSeason(b.seasonalStart) : null;
    if (da && db) return da - db;
    if (da && !db) return -1;
    if (!da && db) return 1;

    // 3) Free –≤—ã—à–µ Pro
    if (a.type !== b.type) return a.type === 'free' ? -1 : 1;

    // 4) –ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
    return a.title.localeCompare(b.title,'ru');
  });
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ (–∫–≤–∞–¥—Ä–∞—Ç–Ω–∞—è –æ–±–ª–æ–∂–∫–∞ + –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –ø—Ä–∏ 404) */
const PLACEHOLDER = 'assets/courses/placeholder.jpg';
function courseCard(c){
  const isSoon = !!c.soon;
  const isSeasonal = !!c.seasonalStart;

  const badge = c.type==='free'
    ? `<span class="px-2 py-1 text-[11px] rounded-lg badge-free">–ë–ï–°–ü–õ–ê–¢–ù–û</span>`
    : `<span class="px-2 py-1 text-[11px] rounded-lg badge-pro">PRO</span>`;

  const lang = langMap[c.lang]||'–Ø–∑—ã–∫';
  const lvl  = c.level?`<div class="text-xs text-[var(--ink-2)] mt-1">${c.level}</div>`:'';
  const href = `courses/${c.slug}/`;

  const imgHTML = `
    <div class="ratio-square rounded-2xl border border-black/10 overflow-hidden bg-[#f6f6f6]">
      <img src="assets/courses/${c.img}" alt="${c.title}"
           class="w-full h-full object-cover"
           onerror="this.onerror=null; this.src='${PLACEHOLDER}';">
    </div>
  `;

  const inner = `
    <div class="flex items-center gap-3">
      <span class="text-2xl">${c.flag||'üåç'}</span>
      <div class="grow">
        <div class="font-semibold leading-tight">${c.title}</div>
        <div class="text-xs text-[var(--ink-2)]">${lang}</div>
        ${lvl}
      </div>
      ${badge}
    </div>

    <div class="mt-3 relative">
      ${imgHTML}
    </div>

    <div class="mt-4">
      ${isSoon
        ? `<span class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-black/10 bg-white text-sm opacity-70 select-none">–°–∫–æ—Ä–æ</span>`
        : `<a href="${href}" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-black/10 bg-white hover:bg-[#fff3c6] text-sm">–û—Ç–∫—Ä—ã—Ç—å ‚Üí</a>`
      }
    </div>
  `;

  if(isSoon){
    return `
      <div class="relative p-5 rounded-2xl bg-white border border-black/10 shadow-soft card reveal">
        ${inner}
        <div class="soon-overlay rounded-2xl">–°–∫–æ—Ä–æ</div>
      </div>
    `;
  } else {
    const cls = `block p-5 rounded-2xl bg-white border border-black/10 shadow-soft card reveal ${isSeasonal?'seasonal':''}`;
    const ribbon = isSeasonal ? `<div class="ribbon">–°—Ç–∞—Ä—Ç ${c.seasonalStart}</div>` : '';
    return `
      <a href="${href}" class="${cls}">
        ${ribbon}
        ${inner}
      </a>
    `;
  }
}

function revealInit(){
  const obs=new IntersectionObserver((ents)=>{ents.forEach(e=>{if(e.isIntersecting)e.target.classList.add('reveal--visible');});},{threshold:.12});
  document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));
}

function render(){
  const list = applyFilters(courses);
  count.textContent = list.length;
  if(list.length===0){
    grid.innerHTML=''; empty.classList.remove('hidden'); return;
  }
  empty.classList.add('hidden');
  grid.innerHTML = list.map(courseCard).join('');
  revealInit();
}

// –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
render();
</script>

</body>
</html>
