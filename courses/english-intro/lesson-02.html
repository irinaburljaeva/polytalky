<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>English Intro ¬∑ –£—Ä–æ–∫ 2 ‚Äî C–æ–≥–ª–∞—Å–Ω—ã–µ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <base href="/">
  <link rel="icon" type="image/jpg" href="/assets/favicon.jpg">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase init (–∫–∞–∫ –≤ —É—Ä–æ–∫–µ 1) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBAU_uMTePpKwVNZNhqk2pss2PuSitGfQI",
      authDomain: "polytalky-70999.firebaseapp.com",
      projectId: "polytalky-70999",
      storageBucket: "polytalky-70999.firebasestorage.app",
      messagingSenderId: "62407152289",
      appId: "1:62407152289:web:b0c0efdb2472f12b10d6e0"
    };

    window.firebaseApp  = initializeApp(firebaseConfig);
    window.firebaseAuth = getAuth(window.firebaseApp);
    window.firebaseDb   = getFirestore(window.firebaseApp);
  </script>

  <style>
    :root{
      --bg-cream:#FFF8E5;
      --bg-cream-soft:#FFFDF4;
      --accent-yellow:#FFDE59;
      --accent-yellow-deep:#FFBA08;
      --accent-peach:#FFD4A8;
      --accent-coral:#FF8A5C;
      --accent-mint:#C4F1BE;
      --text-main:#111827;
      --text-muted:#6b7280;
      --border-soft:rgba(148,163,184,.35);
    }

    body{
      margin:0;
      min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text-main);
      background:
        radial-gradient(circle at 0 0, #FFF9D9 0, transparent 55%),
        radial-gradient(circle at 100% 0, #FFE3CC 0, transparent 55%),
        linear-gradient(to bottom,#FFFDF6,#FFF8E5);
      position:relative;
      overflow-x:hidden;
    }

    /* —Ñ–æ–Ω–æ–≤—ã–µ –±—É–∫–≤—ã */
    .bg-letter{
      position:fixed;
      font-weight:900;
      font-size:120px;
      color:rgba(255,255,255,0.55);
      mix-blend-mode:screen;
      pointer-events:none;
      z-index:-1;
    }
    .bg-letter.a{top:5%;left:5%;transform:rotate(-12deg);}
    .bg-letter.e{top:18%;right:2%;transform:rotate(9deg);}
    .bg-letter.i{bottom:18%;left:10%;transform:rotate(5deg);}
    .bg-letter.o{bottom:8%;right:8%;transform:rotate(-7deg);}
    .bg-letter.u{top:45%;left:45%;transform:rotate(15deg);opacity:0.4;}

    .center-gif-block{
      width:100%;
      display:flex;
      justify-content:center;
      margin:1.2rem 0;
    }
    .center-gif-block img{
      max-width:220px;
      width:100%;
      border-radius:12px;
    }

    /* –í–µ—Ä—Ö–Ω–∏–π –±–∞—Ä */
    .top-bar{
      backdrop-filter:blur(16px);
      background:linear-gradient(to right,rgba(255,255,255,.9),rgba(255,249,219,.9));
      border-bottom:1px solid rgba(0,0,0,.06);
    }

    .back-to-course-btn{
      font-size:0.85rem;
      padding:6px 14px;
      border-radius:8px;
      background:#fff9e6;
      border:1px solid #facc15;
      color:#92400e;
      text-decoration:none;
      transition:0.25s;
      white-space:nowrap;
    }
    .back-to-course-btn:hover{
      background:#fef3c7;
      border-color:#eab308;
      color:#78350f;
      box-shadow:0 4px 10px rgba(234,179,8,0.25);
    }

    .lesson-shell{
      max-width:980px;
      margin:0 auto;
      padding:1.5rem 1.25rem 3.2rem;
    }

    /* HERO */
    .hero-card{
      position:relative;
      border-radius:2rem;
      padding:1.6rem 1.7rem 1.7rem;
      background:
        radial-gradient(circle at 0 0,#FFFDF5,transparent 65%),
        radial-gradient(circle at 120% 10%,rgba(255,222,89,.55),transparent 55%),
        #FFFFFFE6;
      border:1px solid rgba(255,255,255,.6);
      box-shadow:0 20px 60px rgba(0,0,0,.16);
      overflow:hidden;
      display:flex;
      gap:1.6rem;
      align-items:stretch;
    }

    .hero-left{
      flex:1.3;
      min-width:0;
    }
    .hero-right{
      flex:1;
      min-width:220px;
      position:relative;
    }

    .hero-badge{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      font-size:.65rem;
      text-transform:uppercase;
      letter-spacing:.16em;
      padding:.35rem .9rem;
      border-radius:999px;
      border:1px solid rgba(156,163,175,.55);
      background:rgba(255,255,255,.85);
      color:var(--text-muted);
    }
    .hero-title{
      font-size:1.95rem;
      line-height:1.1;
      letter-spacing:-0.03em;
    }
    .hero-title .em{
      background:linear-gradient(90deg,#FF8A5C,#FFDE59);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }

    .hero-tagline{
      font-size:.8rem;
      color:var(--text-muted);
    }

    .hero-right-inner{
      position:relative;
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      padding-right:1.4rem;
    }

    .hero-bubbles-cluster{
      position:relative;
      width:170px;
      height:130px;
    }

    .hero-bubble{
      position:absolute;
      border-radius:1.1rem;
      padding:.45rem .8rem;
      font-size:.78rem;
      background:#fffdfa;
      border:1px solid rgba(148,163,184,.35);
      box-shadow:0 10px 28px rgba(15,23,42,.18);
    }

    .hero-bubble--hello{
      font-weight:700;
      font-size:.9rem;
      background:linear-gradient(135deg,#FFDE59,#FFB347);
      color:#78350f;
      box-shadow:0 12px 32px rgba(248,181,48,.65);
      top:0;
      right:8px;
    }
    .hero-bubble--morning{
      background:#fff7ed;
      top:46px;
      left:0;
    }
    .hero-bubble--hi{
      background:#FFFFFF;
      bottom:4px;
      right:26px;
    }

    .hero-bg-circle{
      position:absolute;
      width:280px;
      height:280px;
      border-radius:999px;
      background:radial-gradient(circle,#FFE9A6,#FFCE8A,#FFB48F);
      opacity:.65;
      right:-80px;
      top:-80px;
      filter:blur(10px);
    }

    /* –ù–ê–í–ò–ì–ê–¶–ò–Ø –®–ê–ì–û–í ‚Äî –º–∞—Ä—à—Ä—É—Ç */
    .step-nav{
      position:relative;
      display:flex;
      justify-content:center;
      gap:1.0rem;
      margin:1.8rem 0 1.4rem;
      flex-wrap:nowrap;
      padding:0 1rem;
    }
    .step-nav::before{
      content:"";
      position:absolute;
      left:8%;
      right:8%;
      top:20px;
      height:2px;
      background:linear-gradient(90deg,#fee2e2,#fde68a,#dcfce7);
      z-index:0;
    }

    .step-dot{
      position:relative;
      z-index:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:.25rem;
      font-size:.65rem;
      color:var(--text-muted);
      max-width:110px;
      text-align:center;
    }

    .step-dot-circle{
      width:32px;height:32px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(148,163,184,.7);
      background:rgba(255,255,255,.95);
      box-shadow:0 8px 18px rgba(0,0,0,.08);
      font-size:.8rem;
    }

    .step-dot-label{ line-height:1.3; white-space:nowrap;}
    @media (max-width: 786px) {
      .step-nav{
        flex-wrap:nowrap;
        overflow-x:auto;
      justify-content:flex-start;
        gap:1rem;
        padding:0 0.5rem;
        webkit-overflow-scrolling: touch; scrollbar-width:none;
        ms-overflow-style: none;
      }
      .step-nav: webkit-scrollbar { display: none;
                                  }
      
      .step-dot{
        flex:0 0 auto;
      }
    }

    .step-dot--active .step-dot-circle{
      background:linear-gradient(145deg,#FFDE59,#FFB347);
      border-color:#f97316;
      color:#78350f;
      box-shadow:0 0 0 2px rgba(255,237,213,.95),0 10px 28px rgba(249,115,22,.35);
      transform:translateY(-1px);
    }

    .step-dot--done .step-dot-circle{
      background:linear-gradient(145deg,#4ade80,#22c55e);
      border-color:#16a34a;
      color:#ecfdf5;
    }

    .step-dot--active .step-dot-label{
      color:#92400e;
      font-weight:600;
    }
    .step-dot--done .step-dot-label{
      color:#166534;
    }

    /* –ü–ê–ù–ï–õ–ò –®–ê–ì–û–í */
    .step-panel{
      display:none;
      border-radius:1.7rem;
      background:rgba(255,255,255,.98);
      border:1px solid rgba(148,163,184,.25);
      box-shadow:0 18px 52px rgba(15,23,42,.18);
      padding:1.25rem 1.4rem 1.4rem;
    }
    .step-panel--visible{ display:block; }

    .step-panel-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:.5rem;
      margin-bottom:.75rem;
    }

    .step-pill{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.26rem .7rem;
      border-radius:999px;
      font-size:.68rem;
      border:1px solid rgba(156,163,175,.65);
      background:#F9FAFB;
      color:var(--text-muted);
    }

    .step-icon{ font-size:1.4rem; opacity:.95; }

    .step-body-text{
      font-size:.88rem;
      line-height:1.5;
      color:#1f2937;
    }
    .step-body-text--lead{
      font-size:.96rem;
      font-weight:500;
    }
    .step-body-text--accent{
      font-size:.9rem;
      font-weight:600;
    }

    .highlight{
      background:linear-gradient(to right,rgba(255,222,89,.5),rgba(255,222,89,0));
      padding:0 .15rem;
      border-radius:.4rem;
    }

    .soft-note{
      font-size:.73rem;
      color:var(--text-muted);
    }

    .soft-block{
      border-radius:1.1rem;
      padding:.8rem .9rem;
      border:1px solid rgba(226,232,240,1);
      background:linear-gradient(135deg,#FFFCF7,#FFF8E5);
      font-size:.8rem;
    }

    .soft-block--blue{
      background:linear-gradient(135deg,#FFE4E6,#FFF1F2);
      border-color:#fecaca;
    }

    .soft-block--green{
      background:linear-gradient(135deg,#ecfdf5,#f0fdf4);
      border-color:#bbf7d0;
    }

    .soft-block--rose{
      background:linear-gradient(135deg,#fff1f2,#ffe4e6);
      border-color:#fecaca;
    }

    .input-main{
      width:100%;
      border-radius:.95rem;
      border:1px solid rgba(209,213,219,1);
      background:#FFFFFF;
      padding:.5rem .7rem;
      font-size:.84rem;
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }

    .input-main:focus{
      border-color:#f97316;
      box-shadow:0 0 0 1px rgba(249,115,22,.4);
    }

    textarea.input-main{
      resize:vertical;
      min-height:90px;
    }

    .btn-main{
      border-radius:999px;
      border:none;
      padding:.55rem 1.2rem;
      font-size:.8rem;
      font-weight:600;
      background:linear-gradient(135deg,#FF9F1C,#FFDE59);
      color:#78350f;
      cursor:pointer;
      box-shadow:0 12px 26px rgba(249,115,22,0.45);
      transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease;
    }
    .btn-main:active{
      transform:translateY(1px);
      box-shadow:0 6px 16px rgba(249,115,22,0.6);
    }
    .btn-main:disabled{
      opacity:.4;
      box-shadow:none;
      cursor:default;
      transform:none;
    }

    .btn-ghost{
      border-radius:999px;
      padding:.5rem 1rem;
      border:1px solid rgba(148,163,184,.5);
      background:rgba(255,255,255,.9);
      font-size:.78rem;
      color:var(--text-muted);
      cursor:pointer;
    }

    /* –¢–∞–±–ª–∏—Ü—ã –∑–≤—É–∫–æ–≤ */
    .sound-table-wrapper{
      margin-top:.6rem;
      border-radius:1rem;
      border:1px solid rgba(226,232,240,1);
      background:#ffffff;
      box-shadow:0 10px 28px rgba(15,23,42,.06);
      overflow:hidden;
    }

    .sound-table-scroll{ overflow-x:auto; }

    .sound-table{
      width:100%;
      border-collapse:collapse;
      font-size:.8rem;
      min-width:420px;
    }

    .sound-table thead{
      background:linear-gradient(90deg,#FFF8E5,#FFE6B3);
    }

    .sound-table th,
    .sound-table td{
      padding:.45rem .6rem;
      border-bottom:1px solid rgba(229,231,235,1);
      text-align:left;
    }

    .sound-table th{
      font-weight:700;
      font-size:.78rem;
      color:#78350f;
      white-space:nowrap;
    }

    .sound-table td:first-child{
      font-weight:600;
      white-space:nowrap;
    }

    .sound-table td:nth-child(2){
      font-family:"SF Mono",ui-monospace;
      white-space:nowrap;
    }

    .sound-table tr:nth-child(even) td{
      background:#FFFCF7;
    }

    /* tooltip + –æ–∑–≤—É—á–∫–∞ */
    .word-tip{
      position:relative;
      cursor:pointer;
      border-bottom:1px dashed rgba(156,163,175,.8);
    }
    .word-tip::after{
      content:attr(data-ru);
      position:absolute;
      left:50%;
      bottom:120%;
      transform:translateX(-50%) translateY(4px);
      font-size:.72rem;
      color:#111827;
      background:#fffefb;
      border-radius:.55rem;
      padding:.25rem .55rem;
      white-space:nowrap;
      box-shadow:0 10px 25px rgba(15,23,42,.30);
      opacity:0;
      pointer-events:none;
      transition:opacity .15s ease-out, transform .15s ease-out;
      z-index:20;
    }
    .word-tip::before{
      content:"";
      position:absolute;
      left:50%;
      bottom:110%;
      transform:translateX(-50%);
      border-width:6px 6px 0 6px;
      border-style:solid;
      border-color:#fffefb transparent transparent transparent;
      opacity:0;
      transition:opacity .15s ease-out;
      z-index:19;
    }
    .word-tip:hover::after,
    .word-tip:hover::before{
      opacity:1;
    }
    .word-tip:hover::after{
      transform:translateX(-50%) translateY(0);
    }

    .mini-toast{
      font-size:.75rem;
      color:#166534;
      background:#ecfdf5;
      border-radius:.9rem;
      padding:.45rem .7rem;
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      border:1px solid #bbf7d0;
    }

    .hidden{display:none;}

    /* --------- –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–¢–ö–ê --------- */
    @media (max-width: 768px) {

      .lesson-shell{
        padding: 1rem .9rem 2.2rem;
      }

      .top-bar .max-w-7xl{
        gap: .5rem;
        flex-wrap: wrap;
      }

      #user-status{
        font-size: 0.7rem;
        flex-basis: 100%;
        order: 2;
      }

      #logout-btn{
        font-size: 0.7rem;
        padding: .3rem .7rem;
      }

      .back-to-course-btn{
        order: 3;
        margin-right: 0;
      }

      .hero-card{
        flex-direction: column;
        padding: 1.3rem 1.1rem 1.4rem;
        gap: 1.1rem;
      }

      .hero-title{
        font-size: 1.5rem;
      }

      .hero-right{
        width: 100%;
        min-width: 0;
      }

      .hero-right-inner{
        justify-content: flex-end;
        padding-right: 0;
      }

      .hero-bg-circle{
        width: 210px;
        height: 210px;
        right: -50px;
        top: -60px;
      }

      .hero-bubbles-cluster{
        align-items: flex-end;
      }

      .hero-bubble{
        font-size: .8rem;
        padding: .4rem .7rem;
      }

      .step-nav{
        gap: 1rem;
        margin: 1.3rem 0 1.1rem;
      }

      .step-nav::before{
        left: 10%;
        right: 10%;
        top: 22px;
      }

      .step-dot{
        max-width: 80px;
        font-size: .6rem;
      }
    }
  </style>
</head>

<body>

  <!-- –§–æ–Ω–æ–≤—ã–µ –±—É–∫–≤—ã -->
  <div class="bg-letter a">A</div>
  <div class="bg-letter e">E</div>
  <div class="bg-letter i">I</div>
  <div class="bg-letter o">O</div>
  <div class="bg-letter u">U</div>

  <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <header class="top-bar sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <a href="/" class="flex items-center gap-2 font-semibold text-[0.9rem] text-[#374151]">
        <img src="/assets/logo.png" alt="PolyTalky" class="w-7 h-7">
        PolyTalky
      </a>
      <div class="flex items-center gap-3 text-[0.78rem] text-gray-600">
        <div id="user-status"></div>

        <a href="/student/feedback.html"
           id="feedback-link"
           class="hidden relative flex items-center justify-center w-9 h-9 rounded-full border border-gray-300 bg-white">
          üì©
          <span id="feedback-dot"
                class="hidden absolute -top-1 -right-1 w-3 h-3 rounded-full bg-red-500 ring-2 ring-white"></span>
        </a>

        <button id="login-btn"
                class="hidden border border-gray-300 rounded-full px-3 py-1.5 text-[0.75rem] text-gray-600 bg-white">
          –í–æ–π—Ç–∏
        </button>

        <a href="/courses/english-intro/" class="back-to-course-btn">–ù–∞–∑–∞–¥ –∫ –∫—É—Ä—Å—É</a>
      </div>
    </div>
  </header>

  <main class="lesson-shell">

    <!-- HERO -->
    <section class="hero-card mb-8">

      <div class="hero-left">
        <div class="hero-badge">English ¬∑ Lesson 2</div>
        <h1 class="hero-title mt-3">
          –û—Ç–∫—Ä—ã—Ç—ã–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–µ –≥–ª–∞—Å–Ω—ã–µ
          –∏ <span class="em">—Å–æ–≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è</span>
        </h1>

        <p class="hero-tagline mt-3">
          –†–∞–∑–±–∏—Ä–∞–µ–º—Å—è, –ø–æ—á–µ–º—É –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –±—É–∫–≤–∞ –∑–≤—É—á–∏—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É –∏ –∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å —Å–æ–≥–ª–∞—Å–Ω—ã–º–∏ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è–º–∏.
        </p>
      </div>

      <div class="hero-right">
        <div class="hero-right-inner">
          <div class="hero-bg-circle"></div>

          <div class="hero-bubbles-cluster">
            <div class="hero-bubble hero-bubble--morning">
              cake / cat
            </div>
            <div class= "hero-bubble hero-bubble--hello">
              open ‚Üî closed
            </div>
            <div class="hero-bubble hero-bubble--hi">
              Ch, Ph, Th‚Ä¶
            </div>
          </div>
        </div>
      </div>

    </section>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è —à–∞–≥–æ–≤ -->
    <div class="step-nav">
      <button class="step-dot step-dot--active" data-step="1">
        <div class="step-dot-circle">
          <span class="js-step-indicator">
            <img class="step-icon" src="/assets/lessons/vowels.png" alt="–ì–ª–∞—Å–Ω—ã–µ">
          </span>
        </div>
        <div class="step-dot-label">–ü–æ–ª–æ–∂–µ–Ω–∏–µ –≥–ª–∞—Å–Ω—ã—Ö</div>
      </button>

      <button class="step-dot" data-step="2">
        <div class="step-dot-circle">
          <span class="js-step-indicator">
            <img class="step-icon" src="/assets/lessons/practise.png" alt="–¢—Ä–µ–Ω–∞–∂—ë—Ä">
          </span>
        </div>
        <div class="step-dot-label">–¢—Ä–µ–Ω–∞–∂—ë—Ä</div>
      </button>

      <button class="step-dot" data-step="3">
        <div class="step-dot-circle">
          <span class="js-step-indicator">
            <img class="step-icon" src="/assets/lessons/consonants.png" alt="–°–æ–≥–ª–∞—Å–Ω—ã–µ">
          </span>
        </div>
        <div class="step-dot-label">–°–æ–≥–ª–∞—Å–Ω—ã–µ</div>
      </button>

      <button class="step-dot" data-step="4">
        <div class="step-dot-circle">
          <span class="js-step-indicator">
            <img class="step-icon" src="/assets/lessons/video.png" alt="–í–∏–¥–µ–æ">
          </span>
        </div>
        <div class="step-dot-label">–í–∏–¥–µ–æ</div>
      </button>

      <button class="step-dot" data-step="5">
        <div class="step-dot-circle">
          <span class="js-step-indicator">
            <img class="step-icon" src="/assets/lessons/task.png" alt="–†–∞—Å—Å–∫–∞–∑ –æ —Å–µ–±–µ">
          </span>
        </div>
        <div class="step-dot-label">–ó–∞–¥–∞–Ω–∏–µ</div>
      </button>
    
     <button class="step-dot" data-step="6">
        <div class="step-dot-circle">
          <span class="js-step-indicator">
            <img class="step-icon" src="/assets/lessons/finish.png" alt="–§–∏–Ω–∏—à">
          </span>
        </div>
        <div class="step-dot-label">–§–∏–Ω–∏—à</div>
      </button>
    </div>

    <!-- STEP PANELS -->

    <!-- STEP 1 ‚Äî –í–≤–µ–¥–µ–Ω–∏–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–µ –∏ –∑–∞–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ -->
    <section class="step-panel step-panel--visible" data-step="1" id="step-1">
      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 1 ¬∑ OPEN / CLOSED</span>
        <button class="step-icon step-icon--qa" type="button" data-open-qa>‚ùì</button>
      </div>

      <p class="step-body-text step-body-text--lead">
        –ß—Ç–æ–±—ã –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—å —Å–ª–æ–≤–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –≤–∞–∂–Ω–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—å -
        <span class="highlight">–æ—Ç–∫—Ä—ã—Ç–æ–µ –∏ –∑–∞–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ</span> –≥–ª–∞—Å–Ω—ã—Ö.
      </p>

      <p class="step-body-text mt-3">
        –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –≤ –∫–∞–∫–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ —Å—Ç–æ–∏—Ç –≥–ª–∞—Å–Ω–∞—è, –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –µ—ë –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ.
        –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –±—É–∫–≤–∞ <b>a</b> –≤ —Å–ª–æ–≤–∞—Ö
        <span class="word-tip" data-ru="—Ç–æ—Ä—Ç">cake</span> –∏
        <span class="word-tip" data-ru="–∫–æ—Ç">cat</span> –∑–≤—É—á–∏—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É.
      </p>

      <div class="soft-block soft-block--green mt-4">
        <p class="step-body-text text-[0.86rem]">
         –ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –≤ –∫–∞–∫–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ —Å—Ç–æ–∏—Ç –≥–ª–∞—Å–Ω–∞—è (–æ—Ç–∫—Ä—ã—Ç–æ–º –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–æ–º) –≤–∞–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ç–µ –±—É–∫–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—ë –æ–∫—Ä—É–∂–∞—é—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–æ cake - –∑–¥–µ—Å—å —É –Ω–∞—Å –æ—Ç–∫—Ä—ã—Ç—ã–π —Å–ª–æ–≥ —Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å —Å—Ç–æ–∏—Ç –≥–ª–∞—Å–Ω–∞—è + —Å–æ–≥–ª–∞—Å–Ω–∞—è + –≥–ª–∞—Å–Ω–∞—è. –°–ª–æ–≤–æ cat - "a" –∑–¥–µ—Å—å –∑–∞–∫—Ä—ã—Ç–∞—è, —Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –≥–ª–∞—Å–Ω–∞—è + —Å–æ–≥–ª–∞—Å–Ω–∞—è.
      –û—Ç–∫—Ä—ã—Ç—ã–π —Å–ª–æ–≥ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≥–ª–∞—Å–Ω—É—é, –æ–±—ã—á–Ω–æ –≤ –Ω–µ–º –≥–ª–∞—Å–Ω–∞—è —á–∏—Ç–∞–µ—Ç—Å—è "–∫–∞–∫ –≤ –∞–ª—Ñ–∞–≤–∏—Ç–µ". –ó–∞–∫—Ä—ã—Ç—ã–π —Å–ª–æ–≥ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–≥–ª–∞—Å–Ω—É—é, –≥–ª–∞—Å–Ω–∞—è –≤ –Ω–µ–º –∑–≤—É—á–∏—Ç –∫–æ—Ä–æ—Ç–∫–æ.
        </p>
       
      </div>

      <p class="soft-note mt-3">
        –°–µ–π—á–∞—Å –Ω–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ –≤—ã—É—á–∏—Ç—å –≤—Å–µ —Ç–µ—Ä–º–∏–Ω—ã –∏ —Ç–æ–Ω–∫–æ—Å—Ç–∏, –∞ –ø—Ä–æ—Å—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É ¬´–æ—Ç–∫—Ä—ã—Ç–æ–≥–æ¬ª –∏ ¬´–∑–∞–∫—Ä—ã—Ç–æ–≥–æ¬ª –∑–≤—É—á–∞–Ω–∏—è –≥–ª–∞—Å–Ω—ã—Ö –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ. –ò —Ç–∞–∫–∂–µ –æ–±—Ä–µ—Å—Ç–∏ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ, –ø–æ—á–µ–º—É –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –±—É–∫–≤—ã –º–æ–≥—É—Ç –∑–≤—É—á–∞—Ç—å —Ç–∞–∫ –ø–æ-—Ä–∞–∑–Ω–æ–º—É.
      </p>

      <button class="btn-main mt-5 next-step-btn" data-next="2">
        –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ç—Ä–µ–Ω–∞–∂—ë—Ä—É ‚Üí
      </button>
    </section>

    <!-- STEP 2 ‚Äî –ü–æ—è—Å–Ω–µ–Ω–∏–µ + —Ç—Ä–µ–Ω–∞–∂—ë—Ä -->
    <section class="step-panel" data-step="2" id="step-2">
      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 2 ¬∑ –¢–†–ï–ù–ê–ñ–Å–†</span>
        <button class="step-icon step-icon--qa" type="button" data-open-qa>‚ùì</button>
      </div>

      <p class="step-body-text">
        –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≥–ª–∞—Å–Ω–∞—è ‚Äî –∫–∞–∫ –¥–≤–µ—Ä—Ü–∞:
        –≤ <b>–æ—Ç–∫—Ä—ã—Ç–æ–º</b> —Å–ª–æ–≥–µ –æ–Ω–∞ ¬´—Å–º–æ—Ç—Ä–∏—Ç¬ª –≤ –∫–æ–Ω–µ—Ü —Å–ª–æ–≤–∞ –∏ —á–∞—Å—Ç–æ –∑–≤—É—á–∏—Ç ¬´–ø–æ-–∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º—É¬ª
        (–∫–∞–∫ –≤ <span class="word-tip" data-ru="–æ–∑–µ—Ä–æ">lake</span>,
        <span class="word-tip" data-ru="–≤–µ—Ä–µ–≤–∫–∞">rope</span>),
        –∞ –≤ <b>–∑–∞–∫—Ä—ã—Ç–æ–º</b> –µ—ë —Å–ª–æ–≤–Ω–æ ¬´–ø—Ä–∏–∂–∏–º–∞–µ—Ç¬ª —Å–æ–≥–ª–∞—Å–Ω–∞—è, –∏ –∑–≤—É–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–æ—Ä–æ—á–µ
        (–∫–∞–∫ –≤ <span class="word-tip" data-ru="–ø–∏—Ç–æ–º–µ—Ü">pet</span>,
        <span class="word-tip" data-ru="–∫–∞—Ä—Ç–∞">map</span>).
      </p>

      <p class="step-body-text mt-3 step-body-text--accent">
        –î–∞–≤–∞–π—Ç–µ –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–µ–º—Å—è: —É –Ω–∞—Å –µ—Å—Ç—å —Å–ª–æ–≤–∞-–ø–∞—Ä—ã. –ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å, –≥–¥–µ –≥–ª–∞—Å–Ω–∞—è —Å—Ç–æ–∏—Ç –≤ <b>–æ—Ç–∫—Ä—ã—Ç–æ–º</b>, –∞ –≥–¥–µ ‚Äî –≤ <b>–∑–∞–∫—Ä—ã—Ç–æ–º</b> –ø–æ–ª–æ–∂–µ–Ω–∏–∏.
      </p>

      <div id="trainer-block" class="soft-block soft-block--blue mt-4">
        <div id="trainer-question" class="text-[0.9rem] font-semibold mb-2">
          <!-- –í–æ–ø—Ä–æ—Å –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –∏–∑ JS -->
        </div>

        <div id="trainer-options" class="flex flex-col gap-2">
          <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã -->
        </div>

        <p id="trainer-feedback" class="soft-note mt-2"></p>

        <div class="flex justify-between items-center mt-3">
          <div class="soft-note">
            –í–æ–ø—Ä–æ—Å <span id="trainer-progress">1 / 1</span>
          </div>
          <button id="trainer-next"
                  class="btn-ghost text-[0.8rem] px-3 py-1.5"
                  disabled>
            –°–ª–µ–¥—É—é—â–∏–π ‚Üí
          </button>
        </div>
      </div>

      <p class="soft-note mt-3">
        –ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π—Ç–µ, –µ—Å–ª–∏ –ø—É—Ç–∞–µ—Ç–µ—Å—å. –ß–µ–º –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤—ã —É–≤–∏–¥–∏—Ç–µ –∏ –ø—Ä–æ–≥–æ–≤–æ—Ä–∏—Ç–µ, —Ç–µ–º –ª–µ–≥—á–µ —Å—Ç–∞–Ω–µ—Ç —É–≥–∞–¥—ã–≤–∞—Ç—å,
        –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ.
      </p>

      <button class="btn-main mt-5 next-step-btn" data-next="3">
        –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–æ–≥–ª–∞—Å–Ω—ã–º –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è–º ‚Üí
      </button>
    </section>

    <!-- STEP 3 ‚Äî –¢–∞–±–ª–∏—Ü–∞ —Å–æ–≥–ª–∞—Å–Ω—ã—Ö –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–π -->
    <section class="step-panel" data-step="3" id="step-3">
      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 3 ¬∑ CONSONANT BLENDS</span>
        <button class="step-icon step-icon--qa" type="button" data-open-qa>‚ùì</button>
      </div>

      <p class="step-body-text">
        –í–æ—Ç –º—ã –∏ –ø–æ–¥–æ—à–ª–∏ –∫ —Å–æ–≥–ª–∞—Å–Ω—ã–º! –í –ø–µ—Ä–≤–æ–º —É—Ä–æ–∫–µ –º—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è —Å –≥–ª–∞—Å–Ω—ã–º–∏. –ü—Ä–∏—à–ª–∞ –ø–æ—Ä–∞ –ø–æ–¥–∞—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç–æ–∫ —Å–ª–∞–≤—ã –∏ —Å–æ–≥–ª–∞—Å–Ω—ã–º —ç—Ç–æ–≥–æ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–≥–æ —è–∑—ã–∫–∞ üôÇ
      </p>

      <div class="soft-block soft-block--green mt-4">
        <p class="text-[0.78rem] mb-2">
          –ù–∏–∂–µ ‚Äî —Ç–∞–±–ª–∏—Ü–∞ <b>—Å–æ–≥–ª–∞—Å–Ω—ã—Ö –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–π</b>. –û–Ω–∏ —Ç–æ–∂–µ —Å–∏–ª—å–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å–ª–æ–≤–∞.
          –ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ —Å–ª–æ–≤–æ, —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ –∏ —É–≤–∏–¥–µ—Ç—å –ø–µ—Ä–µ–≤–æ–¥. –ß–∏—Ç–∞–π—Ç–µ —Å–ª–æ–≤–∞ –≤—Å–ª—É—Ö, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–µ–µ –∑–∞–ø–æ–º–Ω–∏–ª–æ—Å—å.
        </p>

        <div class="sound-table-wrapper">
          <div class="sound-table-scroll">
            <table class="sound-table">
              <thead>
                <tr>
                  <th>–ë—É–∫–≤—ã</th>
                  <th>–ó–≤—É–∫</th>
                  <th>–ü—Ä–∏–º–µ—Ä—ã</th>
                  <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Cc</td>
                  <td>[s] / [k]</td>
                  <td>
                    <span class="word-tip" data-ru="—Ü–µ–Ω—Ç—Ä">center</span>,
                    <span class="word-tip" data-ru="–∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä">cinema</span>,
                    <span class="word-tip" data-ru="—Ü–∏–ª–∏–Ω–¥—Ä">cylinder</span>,
                    <span class="word-tip" data-ru="–∫–æ–¥">code</span>,
                    <span class="word-tip" data-ru="–ª–µ—á–∏—Ç—å">cure</span>
                  </td>
                  <td class="text-[0.78rem]">
                    [—Å] –ø–µ—Ä–µ–¥ e, i, y ¬∑ [–∫] –ø–µ—Ä–µ–¥ a, o, u
                  </td>
                </tr>

                <tr>
                  <td>Gg</td>
                  <td>[d í] / [g] / [ í]</td>
                  <td>
                    <span class="word-tip" data-ru="–≥–µ—Ä—É–Ω–¥–∏–π">gerund</span>,
                    <span class="word-tip" data-ru="—Å–ø–æ—Ä—Ç–∑–∞–ª">gym</span>,
                    <span class="word-tip" data-ru="—Å–∞–¥">garden</span>,
                    <span class="word-tip" data-ru="–∑–µ–ª—ë–Ω—ã–π">green</span>,
                    <span class="word-tip" data-ru="–≥–∞—Ä–∞–∂">garage</span>
                  </td>
                  <td class="text-[0.78rem]">
                    [–¥–∂] –ø–µ—Ä–µ–¥ e, i, y ¬∑ 
                    [–∂] –≤ —Å–ª–æ–≤–∞—Ö –∏–∑ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–≥–æ
                    [–≥] –ø–µ—Ä–µ–¥ –∞, –æ, u
                    
                  </td>
                </tr>

                <tr>
                  <td>Ss</td>
                  <td>[s] / [z] / [ í]</td>
                  <td>
                    <span class="word-tip" data-ru="—Ä–∞–∑–º–µ—Ä">size</span>,
                    <span class="word-tip" data-ru="–º—É–¥—Ä—ã–π">wise</span>,
                    <span class="word-tip" data-ru="–ø–æ–∑–∏—Ä–æ–≤–∞—Ç—å">pose</span>,
                    <span class="word-tip" data-ru="—Å–æ—Ü–∏–∞–ª–∏–∑–º">socialism</span>,
                    <span class="word-tip" data-ru="—É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ">pleasure</span>
                  </td>
                  <td class="text-[0.78rem]">
                    [–∑] –º–µ–∂–¥—É –≥–ª–∞—Å–Ω—ã–º–∏ –∏ –ø–æ—Å–ª–µ –∑–≤–æ–Ω–∫–∏—Ö 
                    [—à] –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—á–µ—Ç–∞–Ω–∏—è—Ö -sure
                    [c] –≤–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
                  </td>
                </tr>

                <tr>
                  <td>Xx</td>
                  <td>[ks] / [gz]</td>
                  <td>
                    <span class="word-tip" data-ru="–∏–∑–≤–∏–Ω—è—Ç—å">excuse</span>,
                    <span class="word-tip" data-ru="–∫–æ—Ä–æ–±–∫–∞">box</span>,
                    <span class="word-tip" data-ru="–ø—Ä–∏–º–µ—Ä">example</span>,
                    <span class="word-tip" data-ru="—ç–∫–∑–∞–º–µ–Ω">exam</span>
                  </td>
                  <td class="text-[0.78rem]">
                    [–∫—Å] –≤ –∫–æ–Ω—Ü–µ –∏ –º–µ–∂–¥—É –≥–ª–∞—Å–Ω—ã–º–∏ ¬∑ [–≥–∑] –≤ –Ω–∞—á–∞–ª–µ –ø–µ—Ä–µ–¥ –≥–ª–∞—Å–Ω–æ–π
                  </td>
                </tr>

                <tr>
                  <td>Ck</td>
                  <td>[k]</td>
                  <td>
                    <span class="word-tip" data-ru="—á–∞—Å—ã">clock</span>,
                    <span class="word-tip" data-ru="—É–ø–∞–∫–æ–≤–∫–∞">pack</span>
                  </td>
                  <td class="text-[0.78rem]">
                    –ß–∞—â–µ –≤—Å–µ–≥–æ –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç —Ç–≤—ë—Ä–¥–æ–µ [k]
                  </td>
                </tr>

                <tr>
                  <td>Ch, tch</td>
                  <td>[t É] / [k]</td>
                  <td>
                    <span class="word-tip" data-ru="–ø—Ä–æ–≤–µ—Ä—è—Ç—å">check</span>,
                    <span class="word-tip" data-ru="–∫–∞–Ω–∞–≤–∞">ditch</span>,
                    <span class="word-tip" data-ru="—Ö–∏–º–∏—è">chemistry</span>
                  </td>
                  <td class="text-[0.78rem]">
                    [—á] –æ–±—ã—á–Ω–æ ¬∑ [–∫] –≤ —Å–ª–æ–≤–∞—Ö –≥—Ä–µ—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è
                  </td>
                </tr>

                <tr>
                  <td>Sh</td>
                  <td>[ É]</td>
                  <td>
                    <span class="word-tip" data-ru="–∫–æ—Ä–æ—Ç–∫–∏–π">short</span>,
                    <span class="word-tip" data-ru="—Å–∏—è—Ç—å">shine</span>
                  </td>
                  <td> [—à]</td>
                </tr>

                <tr>
                  <td>Th</td>
                  <td>[Œ∏] / [√∞]</td>
                  <td>
                    <span class="word-tip" data-ru="–Ω–∏—Ç—å">thread</span>,
                    <span class="word-tip" data-ru="—ç—Ç–æ—Ç">that</span>
                  </td>
                  <td class="text-[0.78rem]">
                    –ì–ª—É—Ö–æ–π –º–µ–∂–∑—É–±–Ω—ã–π [Œ∏] —á–∞—â–µ –≤ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö, –∑–≤–æ–Ω–∫–∏–π –º–µ–∂–∑—É–±–Ω—ã–π [√∞] ‚Äî –≤ –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è—Ö –∏ –∞—Ä—Ç–∏–∫–ª—è—Ö
                  </td>
                </tr>

                <tr>
                  <td>Ng</td>
                  <td>[≈ã]</td>
                  <td>
                    <span class="word-tip" data-ru="–ø–µ—Ç—å">sing</span>,
                    <span class="word-tip" data-ru="—è–∑—ã–∫">language</span>
                  </td>
                  <td class="text-[0.78rem]">
                    –í –∫–æ–Ω—Ü–µ –∏ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å–ª–æ–≤–∞ —á–∞—Å—Ç–æ [≈ã] - [–Ω–æ—Å–æ–≤–æ–π –Ω]
                  </td>
                </tr>

                <tr>
                  <td>Nk</td>
                  <td>[≈ãk]</td>
                  <td>
                    <span class="word-tip" data-ru="–±–∞–Ω–∫">bank</span>,
                    <span class="word-tip" data-ru="–¥—É–º–∞—Ç—å">think</span>
                  </td>
                  <td></td>
                </tr>

                <tr>
                  <td>Gh</td>
                  <td>[f] / ‚Äî</td>
                  <td>
                    <span class="word-tip" data-ru="–∫–∞—à–µ–ª—å">cough</span>,
                    <span class="word-tip" data-ru="–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ">enough</span>,
                    <span class="word-tip" data-ru="–≤—ã—Å–æ–∫–∏–π">high</span>
                  </td>
                  <td class="text-[0.78rem]">
                    –ß–∞—â–µ [—Ñ], –Ω–æ –≤ –∫–æ–Ω—Ü–µ —Å–ª–æ–≤–∞ –∏ –ø–µ—Ä–µ–¥ t —á–∞—Å—Ç–æ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è
                  </td>
                </tr>

                <tr>
                  <td>Wh</td>
                  <td>[w] / [h]</td>
                  <td>
                    <span class="word-tip" data-ru="—á–µ–π">whose</span>,
                    <span class="word-tip" data-ru="—Ü–µ–ª—ã–π">whole</span>,
                    <span class="word-tip" data-ru="–±–µ–ª—ã–π">white</span>
                  </td>
                  <td class="text-[0.78rem]">
                    –û–±—ã—á–Ω–æ [—É–∞], –Ω–æ –µ—Å—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–∞ <i>who, whole</i> –≥–¥–µ —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ [—Ö]
                  </td>
                </tr>

                <tr>
                  <td>Ph</td>
                  <td>[f]</td>
                  <td>
                    <span class="word-tip" data-ru="—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è">philosophy</span>
                  </td>
                  <td> [—Ñ]</td>
                </tr>

              </tbody>
            </table>
          </div>
        </div>

        <p class="soft-note mt-2">
          –û—Ç–ª–∏—á–Ω–æ! –ú—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏ –∫–∞–∫ –ø—Ä–æ–∏–∑–Ω–æ—Å—è—Ç—Å—è —Å–∞–º—ã–µ —á–∞—Å—Ç–Ω—ã–µ –≥–ª–∞—Å–Ω—ã–µ –∏ —Å–æ–≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è. –ê –∑–∞–ø–æ–º–Ω–∏—Ç—å –≤—Å–µ —ç—Ç–æ –ª–µ–≥—á–µ –≤—Å–µ–≥–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ!
        </p>
      </div>

      <div class="mt-5">
        <button class="btn-main next-step-btn" data-next="4">
          –°–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ ‚Üí
        </button>
      </div>
    </section>

    <!-- STEP 4 ‚Äî –í–∏–¥–µ–æ -->
    <section class="step-panel" data-step="4" id="step-4">
      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 4 ¬∑ VIDEO</span>
        <button class="step-icon step-icon--qa" type="button" data-open-qa>‚ùì</button>
      </div>

      <p class="step-body-text">
        –≠—Ç–æ –≤–∏–¥–µ–æ –ø–æ–º–æ–∂–µ—Ç –µ—â—ë —Ä–∞–∑ –ø–æ–ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è –≤ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–∏. –ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ —Å–ª–æ–≤–∞ –≤–º–µ—Å—Ç–µ —Å –Ω–∞–º–∏, —á—Ç–æ–±—ã –∑–≤—É—á–∞—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–µ–µ –∏ —á–∏—â–µ.
      </p>

      <div class="w-full flex justify-center my-4">
        <iframe
          width="560"
          height="315"
          src="https://kinescope.io/embed/pQPeoJ7mmPqqcSvnkcEfeQ"
          title="Video player"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen>
        </iframe>
      </div>

      <p class="soft-note mt-3">
        –ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, —á—Ç–æ —Ö–æ—á–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å ‚Äî —Å–º–µ–ª–æ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ. –ú–æ–∑–≥—É –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π,
        —á—Ç–æ–±—ã ¬´–ø—Ä–∏–∫–ª–µ–∏—Ç—å¬ª –Ω–æ–≤—ã–µ –∑–≤—É–∫–∏ –∫ –∑–Ω–∞–∫–æ–º—ã–º –±—É–∫–≤–∞–º.
      </p>

      <button class="btn-main mt-5 next-step-btn" data-next="5">
        –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–∞—Å—Å–∫–∞–∑—É –æ —Å–µ–±–µ ‚Üí
      </button>
    </section>

    <!-- STEP 5 ‚Äî –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: —Ä–∞—Å—Å–∫–∞–∑ –æ —Å–µ–±–µ -->
    <section class="step-panel" data-step="5" id="step-5">
      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 5 ¬∑ STORY</span>
        <button class="step-icon step-icon--qa" type="button" data-open-qa>‚ùì</button>
      </div>

      <p class="step-body-text">
        –ü–æ—Ä–∞ –ø–æ–ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è! <span class="highlight">–ù–∞–ø–∏—à–∏—Ç–µ –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞—Å—Å–∫–∞–∑ –æ —Å–µ–±–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º</span>.
        –ï—Å–ª–∏ –≤–∞–º –ø–æ–∫–∞ –µ—â—ë —Å–ª–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Ü–µ–ª—ã–µ —Ç–µ–∫—Å—Ç—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –º–æ–∂–Ω–æ –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ —Å–ª–æ–≤–∞—Ä—å –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫.
      </p>

      <p class="soft-note mt-3">
        –ù–æ –Ω–µ–±–æ–ª—å—à–æ–π —Å–µ–∫—Ä–µ—Ç: —á–µ–º –º–µ–Ω—å—à–µ –º—ã –∑–∞—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—à –º–æ–∑–≥ —Ä–∞–±–æ—Ç–∞—Ç—å, —Ç–µ–º –º–µ–¥–ª–µ–Ω–µ–µ –∏–¥–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è. –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã –≤–æ—Å–ø–æ–ª—å–∑—É–µ—Ç–µ—Å—å –ø–æ–º–æ—â—å—é –æ–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞ -
       —Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –≤–≤–æ–¥–∏—Ç—å –ø–æ –æ–¥–Ω–æ–º—É —Å–ª–æ–≤—É –∏–ª–∏ –º–∞–∫—Å–∏–º—É–º –ø–æ –ø–∞—Ä–µ-—Ç—Ä–æ–π–∫–µ —Å–ª–æ–≤ –∑–∞ —Ä–∞–∑ ‚Äî —Ç–∞–∫ –∑–∞–¥–∞–Ω–∏–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–µ –¥–ª—è –≥–∞–ª–æ—á–∫–∏, –∞ –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ø–æ–ª—å–∑—É üôÇ
      </p>

      <p class="step-body-text mt-3">
        –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—Å–∫–∞–∑ –Ω–µ —Ç–æ–ª—å–∫–æ –æ –≤–∞—Å, –Ω–æ –∏ –ø—Ä–æ –≤–∞—à –≥–æ—Ä–æ–¥, —Ö–æ–±–±–∏, –¥–æ–º–∞—à–Ω–µ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ ‚Äî –æ —á—ë–º —É–≥–æ–¥–Ω–æ.
        –ì–ª–∞–≤–Ω–æ–µ ‚Äî –ø–æ—Å—Ç–∞—Ä–∞—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <b>—Å–ª–æ–≤–∞ —Å –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è–º–∏</b>, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –≤–∏–¥–µ–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö.
      </p>

      <textarea id="task-story-input"
                class="input-main mt-4"
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: My name is Ashley. I live in London. I think English is very interesting, because‚Ä¶"></textarea>

      <p class="soft-note mt-2">
        –ù–∞ —Ç–∞—Ä–∏—Ñ–µ <b>PRO</b> –≤–∞—à —Ç–µ–∫—Å—Ç —É–π–¥—ë—Ç –∫—É—Ä–∞—Ç–æ—Ä—É ‚Äî –æ–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç –∏ –ø–æ–¥—Å–∫–∞–∂–µ—Ç, –≥–¥–µ –±—ã–ª–∏ –æ—à–∏–±–∫–∏, –∞ –≥–¥–µ –≤—ã —É–∂–µ –ø–∏—à–µ—Ç–µ –æ—á–µ–Ω—å –∫—Ä—É—Ç–æ üíõ
      </p>

      <div id="story-feedback" class="mini-toast mt-3 hidden">
        –í–∞—à —Ä–∞—Å—Å–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ ‚ú®
      </div>

      <div class="mt-5 flex flex-wrap gap-3 items-center">
        <button id="task-story-submit" class="btn-main">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å–∫–∞–∑ ‚Üí
        </button>
        
<div class="mt-5 flex flex-wrap gap-3 items-center">
        <button class="btn-ghost next-step-btn" data-next="6">
          –ó–∞–∫–æ–Ω—á–∏—Ç—å —É—Ä–æ–∫
        </button>
        </div>
    </section>
    <!-- STEP 6 ‚Äî –§–∏–Ω–∞–ª: —Å–ª–æ–≤–∞—Ä–∏–∫ + —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫ -->
    <section class="step-panel" data-step="6" id="step-6">
      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 6 ¬∑ DONE</span>
        <button class="step-icon step-icon--qa" type="button" data-open-qa>‚ùì</button>
      </div>

      <p class="step-body-text">
        –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –í—ã –ø—Ä–æ—à–ª–∏ –≤—Ç–æ—Ä–æ–π —É—Ä–æ–∫: –ø–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–ª–∏ –≥–ª–∞—Å–Ω—ã–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –∏ –∑–∞–∫—Ä—ã—Ç–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏,
        –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å —Å —Å–æ–≥–ª–∞—Å–Ω—ã–º–∏ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è–º–∏ –∏ –Ω–∞–ø–∏—Å–∞–ª–∏ —Å–≤–æ–π –Ω–µ–±–æ–ª—å—à–æ–π —Ç–µ–∫—Å—Ç.
      </p>

      <div class="soft-block soft-block--rose mt-4">
        <p class="step-body-text text-[0.86rem]">
          –í –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è —Å–ª–æ–≤–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤ –≤–∞—à —Å–ª–æ–≤–∞—Ä–∏–∫ ‚Äî —Ç–∞–∫ –æ–Ω–∏ –Ω–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è,
          –∏ –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—é.
        </p>
      </div>

      <div class="mt-5 flex flex-wrap gap-3">
        <button class="btn-main" id="open-vocab-btn">
          –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞ –∏–∑ —É—Ä–æ–∫–∞ –≤ —Å–ª–æ–≤–∞—Ä–∏–∫ ‚Üí
        </button>

        <a href="/courses/english-intro/lesson-03.html" class="btn-ghost">
          –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É ‚Üí
        </a>
      </div>
    </section>

    <!-- –ú–û–î–ê–õ–ö–ê Q&A -->
    <div id="qa-modal"
         class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
      <div class="bg-white max-w-lg w-full rounded-2xl shadow-xl relative overflow-hidden">
        <div class="absolute -top-8 -left-8 w-36 h-36 rounded-full bg-[#FFE8B3] blur-xl opacity-60"></div>
        <div class="absolute -bottom-10 -right-10 w-40 h-40 rounded-full bg-[#FFD6C4] blur-xl opacity-60"></div>

        <div class="relative p-6 space-y-4">
          <div class="flex justify-between items-start gap-4">
            <div>
              <h2 class="text-lg font-semibold text-gray-800">
                –í–æ–ø—Ä–æ—Å—ã –ø–æ —É—Ä–æ–∫—É
              </h2>
              <p class="text-sm text-gray-600 mt-1">
                –ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å ‚Äî –º—ã –æ—Ç–≤–µ—Ç–∏–º, –∏ –æ—Ç–≤–µ—Ç —É–≤–∏–¥—è—Ç –¥—Ä—É–≥–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏.
              </p>
            </div>

            <button id="qa-close"
                    class="text-gray-500 text-xl leading-none">&times;</button>
          </div>

          <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 text-xs text-amber-800">
            –•–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –µ—â—ë –±—ã—Å—Ç—Ä–µ–µ –∏ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∫—É—Ä–∞—Ç–æ—Ä—É –ª–∏—á–Ω–æ?  
            <a href="/courses/pro.html" target="_blank" class="underline text-amber-700 font-semibold">–¢–∞—Ä–∏—Ñ PRO</a>
            –¥–∞—ë—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –∏ –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –∫ –≤–∞—à–∏–º –≤–æ–ø—Ä–æ—Å–∞–º üíõ
          </div>

          <div class="max-h-64 overflow-y-auto border border-gray-100 rounded-xl p-3 bg-gray-50/70"
               id="qa-list">
            <p class="text-xs text-gray-500">
              –ü–æ–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –±—ã—Ç—å –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –∑–∞–¥–∞—Å—Ç –≤–æ–ø—Ä–æ—Å üôÇ
            </p>
          </div>

          <form id="qa-form" class="space-y-2">
            <label class="block text-xs text-gray-600">
              –í–∞—à –≤–æ–ø—Ä–æ—Å:
            </label>
            <textarea id="qa-text"
                      class="w-full border border-gray-200 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300"
                      rows="3"
                      placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ö–∞–∫ –∑–∞–ø–æ–º–Ω–∏—Ç—å —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –æ—Ç–∫—Ä—ã—Ç—ã–º –∏ –∑–∞–∫—Ä—ã—Ç—ã–º —Å–ª–æ–≥–∞–º–∏?¬ª"></textarea>

            <p class="text-[0.7rem] text-gray-400">
              –ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.  
              –ï—Å–ª–∏ –≤—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
              <a href="/student/" class="underline">–≤—Ö–æ–¥–∞ / —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</a>.
            </p>

            <div class="flex justify-end">
              <button type="submit"
                      id="qa-submit"
                      class="btn-main text-sm px-4 py-1.5">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å ‚Üí
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê –°–õ–û–í–ê–†–Ø -->
    <div id="vocab-modal"
         class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
      <div class="bg-white max-w-lg w-full rounded-2xl shadow-xl relative overflow-hidden">
        <div class="absolute -top-8 -left-8 w-36 h-36 rounded-full bg-[#FFE8B3] blur-xl opacity-70"></div>
        <div class="absolute -bottom-10 -right-10 w-40 h-40 rounded-full bg-[#FFD6C4] blur-xl opacity-70"></div>

        <div class="relative p-6">
          <div class="flex justify-between items-start">
            <h2 class="text-lg font-semibold text-gray-800">
              –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞ –≤ —Å–ª–æ–≤–∞—Ä–∏–∫
            </h2>

            <button id="vocab-close" class="text-gray-500 text-xl leading-none">&times;</button>
          </div>

          <p class="text-sm text-gray-600 mt-1">
            –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–≥–ª–∞—Å–Ω—ã—Ö –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–≤–æ–π —Å–ª–æ–≤–∞—Ä–∏–∫.
          </p>

          <div id="vocab-auth-warning"
               class="hidden mt-4 bg-red-50 text-red-700 border border-red-200 rounded-xl p-3 text-sm">
            –ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ª–æ–≤–∞, –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.
            <br>
            <a href="/student" class="underline font-medium">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí</a>
          </div>

          <div id="vocab-list" class="mt-5 space-y-5 max-h-[330px] overflow-y-auto pr-1">
            <div class="vocab-category" data-category="–°–æ–≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è">
              <h3 class="text-[0.8rem] font-semibold text-gray-700 mb-2 flex items-center gap-1">
                üî§ –°–æ–≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è
              </h3>

              <div id="vocab-consonants" class="grid grid-cols-1 gap-2 pl-1">
              </div>
            </div>
          </div>

          <div class="mt-6 flex justify-between items-center">
            <button id="vocab-select-all"
                    class="px-4 py-2 rounded-xl bg-gray-100 text-sm text-gray-700 border border-gray-300">
              –í—ã–±—Ä–∞—Ç—å –≤—Å—ë
            </button>

            <button id="vocab-save"
                    class="btn-main text-sm px-5 py-2">
              –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- SCRIPT -->
    <script type="module">
      import {
        getAuth,
        onAuthStateChanged
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      import {
        collection,
        addDoc,
        serverTimestamp,
        getDocs,
        query,
        orderBy,
        doc,
        setDoc,
        arrayUnion,
        getDoc
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const auth = window.firebaseAuth;
      const db   = window.firebaseDb;

      // ====== –ö–û–ù–°–¢–ê–ù–¢–´ –£–†–û–ö–ê ======
      let currentUser = null;
      let isProUser   = false;

      const LESSON_ID        = "english-intro-lesson-2";
      const LESSON_SLUG      = "lesson-02-vowels-consonants";
      const COURSE_ID        = "english-intro";
      const LESSON_QA_DOC_ID = LESSON_ID;

      // Firestore: lessonSubmissions / english-intro / {email} / lesson2
      const SUBMISSIONS_ROOT_COLLECTION = "lessonSubmissions";
      const SUBMISSIONS_COURSE_DOC      = "english-intro";
      const SUBMISSIONS_LESSON_DOC      = "lesson2";

      function getUserKey() {
        if (!currentUser) return null;
        if (currentUser.email) return currentUser.email.toLowerCase();
        return currentUser.uid;
      }

      // ====== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ======
console.log("üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –£–†–û–ö–ê 2:");
console.log("feedbackLink —ç–ª–µ–º–µ–Ω—Ç:", feedbackLink);
console.log("feedbackLink classList:", feedbackLink?.classList);
console.log("currentUser:", currentUser);
console.log("isProUser:", isProUser);

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
setInterval(() => {
  console.log("‚è∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:");
  console.log("  currentUser:", currentUser?.email);
  console.log("  isProUser:", isProUser);
  console.log("  feedbackLink.classList:", feedbackLink?.classList.toString());
}, 2000);
      

      // ====== DOM-—ç–ª–µ–º–µ–Ω—Ç—ã ======
      const feedbackLink = document.getElementById("feedback-link");
      const loginBtn     = document.getElementById("login-btn");
      const userStatus   = document.getElementById("user-status");

      if (loginBtn){
        loginBtn.addEventListener("click", () => {
          window.open("/student/","_blank");
        });
      }
                                 
      const stepPanels = document.querySelectorAll(".step-panel");
      const stepDots   = document.querySelectorAll(".step-dot");

      // —Ç—Ä–µ–Ω–∞–∂—ë—Ä
      const trainerQuestion = document.getElementById("trainer-question");
      const trainerOptions  = document.getElementById("trainer-options");
      const trainerFeedback = document.getElementById("trainer-feedback");
      const trainerProgress = document.getElementById("trainer-progress");
      const trainerNextBtn  = document.getElementById("trainer-next");

      // —Ä–∞—Å—Å–∫–∞–∑
      const storyInput    = document.getElementById("task-story-input");
      const storyBtn      = document.getElementById("task-story-submit");
      const storyFeedback = document.getElementById("story-feedback");

      // —Å–ª–æ–≤–∞—Ä–∏–∫
      const openVocabBtn    = document.getElementById("open-vocab-btn");
      const vocabModal      = document.getElementById("vocab-modal");
      const vocabClose      = document.getElementById("vocab-close");
      const vocabListConson = document.getElementById("vocab-consonants");
      const vocabAuthWarn   = document.getElementById("vocab-auth-warning");
      const vocabSaveBtn    = document.getElementById("vocab-save");
      const vocabSelectAll  = document.getElementById("vocab-select-all");

      // Q&A
      const qaModal      = document.getElementById("qa-modal");
      const qaCloseBtn   = document.getElementById("qa-close");
      const qaList       = document.getElementById("qa-list");
      const qaForm       = document.getElementById("qa-form");
      const qaText       = document.getElementById("qa-text");
      const qaSubmitBtn  = document.getElementById("qa-submit");
      const qaOpenBtns   = document.querySelectorAll("[data-open-qa]");

            // ====== –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è / PRO ======
    async function loadUserProfile(user) {
  console.log("üìä loadUserProfile –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è:", user?.email);
  
  isProUser = false;
  if (!user) {
    console.log("‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
    return;
  }

  try {
    const email = user.email || null;
    const uid   = user.uid   || null;
    
    console.log("üîë Email:", email, "UID:", uid);
    
    if (!email && !uid) {
      console.log("‚ùå –ù–µ—Ç –Ω–∏ email, –Ω–∏ uid");
      return;
    }

    const usersCol = collection(db, "users");
    const emailRef = email ? doc(usersCol, email) : null;
    const uidRef   = uid   ? doc(usersCol, uid)   : null;

    console.log("üìÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ Firestore...");

    const [emailSnap, uidSnap] = await Promise.all([
      emailRef ? getDoc(emailRef) : Promise.resolve(null),
      uidRef   ? getDoc(uidRef)   : Promise.resolve(null),
    ]);

    console.log("üì• emailSnap exists:", emailSnap?.exists());
    console.log("üì• uidSnap exists:", uidSnap?.exists());

    const emailData = emailSnap && emailSnap.exists() ? (emailSnap.data() || {}) : null;
    const uidData   = uidSnap   && uidSnap.exists()   ? (uidSnap.data()   || {}) : null;

    console.log("üì¶ emailData:", emailData);
    console.log("üì¶ uidData:", uidData);

    const merged = {
      ...(uidData || {}),
      ...(emailData || {}),
    };

    console.log("üîÄ Merged data:", merged);

    if (!Object.keys(merged).length) {
      console.log("‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Å–ª–∏—è–Ω–∏—è");
      isProUser = false;
      return;
    }

    const proGlobal = merged.proGlobal === true;
    let proValidUntil = merged.proValidUntil || merged.proUntil || null;
    
    console.log("üéØ proGlobal:", proGlobal);
    console.log("üìÖ proValidUntil (raw):", proValidUntil);
    
    if (proValidUntil && typeof proValidUntil.toDate === "function") {
      proValidUntil = proValidUntil.toDate();
      console.log("üìÖ proValidUntil (converted):", proValidUntil);
    }

    const legacyPro =
      merged.proActive ||
      merged.isPro ||
      merged.hasPro ||
      (merged.pro && merged.pro.active);

    console.log("üîß legacyPro:", legacyPro);

    let active = !!(proGlobal || legacyPro);

    if (proValidUntil instanceof Date) {
      const now = new Date();
      console.log("‚è∞ –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–∞—Ç—ã: now =", now, "valid until =", proValidUntil);
      if (proValidUntil <= now) {
        console.log("‚ùå PRO –∏—Å—Ç—ë–∫");
        active = false;
      }
    }

    isProUser = active;
    console.log("‚úÖ –ò–¢–û–ì–û–í–´–ô isProUser:", isProUser);
    
  } catch (e) {
    console.error("üí• –û—à–∏–±–∫–∞ –≤ loadUserProfile:", e);
    isProUser = false;
  }
}

      // ====== –ü–†–û–ì–†–ï–°–° –£–†–û–ö–ê (–±–µ–∑ –±–µ–π–¥–∂–∞) ======
      let currentStep  = 1;
      const totalSteps = 6;

      async function saveLessonProgress() {
        if (!currentUser) return;
        const userKey = getUserKey();
        if (!userKey) return;

        try {
          await setDoc(
            doc(db, "users", userKey),
            {
              progress: {
                [COURSE_ID]: {
                  percent: 50,               // –≤—Ç–æ—Ä–æ–π —É—Ä–æ–∫
                  lastLessonId: LESSON_SLUG
                }
              }
            },
            { merge: true }
          );
        } catch (e) {
          console.error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å:", e);
        }
      }

      function showStep(n) {
        stepPanels.forEach(p => p.classList.remove("step-panel--visible"));
        const panel = document.getElementById(`step-${n}`);
        if (panel) panel.classList.add("step-panel--visible");

        stepDots.forEach(dot => {
          dot.classList.remove("step-dot--active", "step-dot--done");
          const step = Number(dot.dataset.step);
          if (step < n) dot.classList.add("step-dot--done");
          if (step === n) dot.classList.add("step-dot--active");
        });

        if (n === totalSteps) {
          // —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–µ—Å—Å, –±–µ–∑ –±–µ–π–¥–∂–∞
          saveLessonProgress().catch(console.error);
        }

        currentStep = n;
      }

      document.querySelectorAll(".next-step-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const next = Number(btn.dataset.next);
          if (next) showStep(next);
        });
      });

      // ====== LOCAL STORAGE (–¥–ª—è –Ω–µ-PRO) ======
      function saveLocalAnswer(key, value) {
        localStorage.setItem(`lesson2_${key}`, value);
      }
      function loadLocalAnswer(key) {
        return localStorage.getItem(`lesson2_${key}`) || "";
      }

      // ====== Firestore: –¥–æ–∫—É–º–µ–Ω—Ç —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –ø–æ —É—Ä–æ–∫—É 2 ======
      function getLesson2DocRef() {
        if (!currentUser) return null;
        const userKey = getUserKey();
        if (!userKey) return null;

        // lessonSubmissions / english-intro / {userKey} / lesson2
        return doc(
          db,
          SUBMISSIONS_ROOT_COLLECTION,
          SUBMISSIONS_COURSE_DOC,
          userKey,
          SUBMISSIONS_LESSON_DOC
        );
      }

      async function saveProSubmission(partialData) {
        if (!currentUser || !isProUser) return;
        const docRef = getLesson2DocRef();
        if (!docRef) return;

        const baseData = {
          userEmail: currentUser.email || null,
          userUid:   currentUser.uid,
          isPro:     true,
          courseId:  COURSE_ID,
          lessonSlug: LESSON_SLUG,
          updatedAt: serverTimestamp()
        };

        await setDoc(
          docRef,
          { createdAt: serverTimestamp(), ...baseData, ...partialData },
          { merge: true }
        );
      }

      // ====== –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ PRO (–∏—Å—Ç–æ—Ä–∏—è) ======
      async function loadProAnswers() {
        if (!currentUser || !isProUser) return;
        const docRef = getLesson2DocRef();
        if (!docRef) return;

        const snap = await getDoc(docRef);
        if (!snap.exists()) return;

        const data = snap.data();
        if (data.story && storyInput) {
          storyInput.value = data.story;
        }
      }

      // ====== –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: —Ä–∞—Å—Å–∫–∞–∑ –æ —Å–µ–±–µ ======
      storyBtn.addEventListener("click", async () => {
        const text = (storyInput.value || "").trim();
        if (!text) {
          alert("–ù–∞–ø–∏—à–∏—Ç–µ —Ö–æ—Ç—è –±—ã –ø–∞—Ä—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ —Å–µ–±–µ –∏–ª–∏ –æ —á—ë–º-—Ç–æ, —á—Ç–æ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ :)");
          return;
        }

        if (isProUser && currentUser) {
          await saveProSubmission({ story: text }).catch(console.error);
        } else {
          saveLocalAnswer("story", text);
        }

        if (storyFeedback) {
          storyFeedback.classList.remove("hidden");
          setTimeout(() => storyFeedback.classList.add("hidden"), 2000);
        }
      });

      // ====== TRAINER: –û–¢–ö–†–´–¢–´–ï / –ó–ê–ö–†–´–¢–´–ï –ì–õ–ê–°–ù–´–ï ======
      const trainerQuestions = [
        {
          prompt: "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ, –≥–¥–µ –≥–ª–∞—Å–Ω–∞—è —Å—Ç–æ–∏—Ç –≤ –û–¢–ö–†–´–¢–û–ú –ø–æ–ª–æ–∂–µ–Ω–∏–∏:",
          options: [
            { word: "cake",  label: "cake",  correct: true },
            { word: "cat",   label: "cat",   correct: false },
            { word: "hat",   label: "hat",   correct: false }
          ]
        },
        {
          prompt: "–ì–¥–µ –≥–ª–∞—Å–Ω–∞—è –∑–≤—É—á–∏—Ç ¬´–ø–æ-–∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º—É¬ª (–∫–∞–∫ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –±—É–∫–≤—ã)?",
          options: [
            { word: "hope",  label: "hope",  correct: true },
            { word: "hop",   label: "hop",   correct: false },
            { word: "cap",   label: "cap",   correct: false }
          ]
        },
        {
          prompt: "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ —Å –ó–ê–ö–†–´–¢–´–ú —Å–ª–æ–≥–æ–º:",
          options: [
            { word: "ride",  label: "ride",  correct: false },
            { word: "rid",   label: "rid",   correct: true },
            { word: "time",  label: "time",  correct: false }
          ]
        },
         {
          prompt: "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ —Å –û–¢–ö–†–´–¢–´–ú —Å–ª–æ–≥–æ–º:",
          options: [
            { word: "cub",  label: "cub",  correct: false },
            { word: "cube",   label: "cube",   correct: true },
            { word: "tub",  label: "tub",  correct: false }
          ]
        },
        {
          prompt: "–ì–¥–µ —Å–ª–æ–≥ –≤—ã–≥–ª—è–¥–∏—Ç ¬´–∫–æ—Ä–æ—á–µ¬ª –∏ –∑–≤—É–∫ –±–æ–ª–µ–µ —Å–∂–∞—Ç—ã–π?",
          options: [
            { word: "kit",   label: "kit",   correct: true },
            { word: "kite",  label: "kite",  correct: false }
          ]
        }
      ];

      let trainerIndex = 0;
      let trainerLocked = false;

      function renderTrainerQuestion() {
        const q = trainerQuestions[trainerIndex];
        trainerLocked = false;
        trainerFeedback.textContent = "";
        trainerNextBtn.disabled = true;

        trainerQuestion.textContent = q.prompt;
        trainerProgress.textContent = `${trainerIndex + 1} / ${trainerQuestions.length}`;

        trainerOptions.innerHTML = "";
        q.options.forEach((opt) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "btn-ghost text-[0.85rem] w-full flex justify-between items-center";
          btn.textContent = opt.label;

          btn.addEventListener("click", () => {
            if (trainerLocked) return;
            trainerLocked = true;

            if (opt.correct) {
              trainerFeedback.textContent = "–û—Ç–ª–∏—á–Ω–æ! –≠—Ç–æ –ø—Ä–∏–º–µ—Ä –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ–≥–∞ üëè";
              btn.classList.add("border-2");
              btn.style.borderColor = "#16a34a";
            } else {
              trainerFeedback.textContent = "–ó–¥–µ—Å—å —Å–ª–æ–≥ –∑–∞–∫—Ä—ã—Ç—ã–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø–æ–º–Ω–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –ø–æ –¥–ª–∏–Ω–µ –∑–≤—É–∫–∞.";
              btn.classList.add("border-2");
              btn.style.borderColor = "#b91c1c";
            }

            if (trainerIndex < trainerQuestions.length - 1) {
              trainerNextBtn.disabled = false;
            } else {
              trainerNextBtn.disabled = true;
            }
          });

          trainerOptions.appendChild(btn);
        });
      }

      trainerNextBtn.addEventListener("click", () => {
        if (trainerIndex < trainerQuestions.length - 1) {
          trainerIndex += 1;
          renderTrainerQuestion();
        }
      });

      renderTrainerQuestion();

      // ====== Q&A ======
      qaOpenBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          qaModal.classList.remove("hidden");
          qaModal.classList.add("flex");
          loadQuestions().catch(console.error);
        });
      });

      qaForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const text = qaText.value.trim();
        if (!text) {
          alert("–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ üôÇ");
          return;
        }

        if (!currentUser) {
          alert("–ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /student/.");
          return;
        }

        qaSubmitBtn.disabled  = true;
        qaSubmitBtn.textContent = "–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...";

        try {
          const colRef = collection(db, "lessons", LESSON_QA_DOC_ID, "questions");

          await addDoc(colRef, {
            text,
            userId:    currentUser.email || currentUser.uid,
            userEmail: currentUser.email || null,
            createdAt: serverTimestamp(),
            answer:    null
          });

          qaText.value = "";
          await loadQuestions();
        } catch (err) {
          console.error(err);
          alert("–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –ø–æ–∑–∂–µ.");
        } finally {
          qaSubmitBtn.disabled   = false;
          qaSubmitBtn.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å ‚Üí";
        }
      });

      qaCloseBtn.addEventListener("click", () => {
        qaModal.classList.add("hidden");
        qaModal.classList.remove("flex");
      });

      qaModal.addEventListener("click", (e) => {
        if (e.target === qaModal) {
          qaModal.classList.add("hidden");
          qaModal.classList.remove("flex");
        }
      });

      async function loadQuestions() {
        const colRef = collection(db, "lessons", LESSON_QA_DOC_ID, "questions");
        const qRef   = query(colRef, orderBy("createdAt", "desc"));
        const snapshot = await getDocs(qRef);

        qaList.innerHTML = "";

        if (snapshot.empty) {
          qaList.innerHTML = `
            <p class="text-xs text-gray-500">
              –ü–æ–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –±—ã—Ç—å –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –∑–∞–¥–∞—Å—Ç –≤–æ–ø—Ä–æ—Å üôÇ
            </p>
          `;
          return;
        }

        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          const item = document.createElement("div");
          item.className = "mb-3 pb-3 border-b border-gray-200 last:border-b-0";

          const author = data.userEmail || "–£—á–∞—Å—Ç–Ω–∏–∫ –∫—É—Ä—Å–∞";
          const answerHtml = data.answer
            ? `<p class="text-[0.8rem] text-emerald-800 mt-2">
                 <span class="font-semibold">–û—Ç–≤–µ—Ç:</span> ${data.answer}
               </p>`
            : `<p class="text-[0.75rem] text-gray-400 mt-2">
                 –û—Ç–≤–µ—Ç —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è.
               </p>`;

          item.innerHTML = `
            <p class="text-[0.8rem] text-gray-800 font-medium">
              ‚ùì ${data.text}
            </p>
            <p class="text-[0.7rem] text-gray-400 mt-1">
              –æ—Ç ${author}
            </p>
            ${answerHtml}
          `;

          qaList.appendChild(item);
        });
      }

      // ====== –û–∑–≤—É—á–∫–∞ —Å–ª–æ–≤ ======
     let englishVoices = [];

if ("speechSynthesis" in window && window.speechSynthesis) {
  const loadVoices = () => {
       englishVoices = window.speechSynthesis
      .getVoices()
      .filter(v => v.lang && v.lang.toLowerCase().startsWith("en"));
  };
  window.speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();
      }
 

function speakWord(word) {
  if (!("speechSynthesis" in window) || !window.speechSynthesis) return;

  const utter = new SpeechSynthesisUtterance(word);
  utter.lang = "en-US";

  utter.rate = 0.8;
  utter.pitch = 1.0;
  utter.volume = 1.0;
  
  if (englishVoices.length > 0) {
    utter.voice = englishVoices[0];
  }

  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utter);
}
  
// –í–∫–ª—é—á–∞–µ–º –æ–∑–≤—É—á–∫—É –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Å–ª–æ–≤–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
document.querySelectorAll(".word-tip").forEach(tip => {
  tip.addEventListener("click", () => {
    const word = tip.textContent.trim();
    if (word) {
      speakWord(word);
    }
  });
});

      // ====== –°–ª–æ–≤–∞—Ä–∏–∫: –≤—ã—Ç—è–Ω—É—Ç—å —Å–ª–æ–≤–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–≥–ª–∞—Å–Ω—ã—Ö ======
      function extractConsonantEntries() {
        const tips = document.querySelectorAll("#step-3 .word-tip");
        const map  = new Map();

        tips.forEach(tip => {
          const w  = tip.textContent.trim().toLowerCase();
          const ru = (tip.dataset.ru || "").trim();
          if (/^[a-z]+$/.test(w) && !map.has(w)) {
            map.set(w, ru);
          }
        });

        return Array.from(map.entries()).map(([word, translation]) => ({
          word,
          translation
        }));
      }

      function renderConsonantWords() {
        const entries = extractConsonantEntries();
        vocabListConson.innerHTML = "";

        entries.forEach(({ word, translation }) => {
          const label = document.createElement("label");
          label.className = "flex items-center gap-2 text-[0.85rem]";

          const ruPart = translation
            ? `<span class="text-gray-400 text-[0.78rem] ml-1">‚Äî ${translation}</span>`
            : "";

          label.innerHTML = `
            <input type="checkbox"
                   class="vocab-word"
                   data-word="${word}"
                   data-ru="${translation}"
                   data-category="–°–æ–≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è">
            <span>${word}</span>
            ${ruPart}
          `;

          vocabListConson.appendChild(label);
        });
      }

      // ====== –û–∫–Ω–æ —Å–ª–æ–≤–∞—Ä—è ======
      openVocabBtn.addEventListener("click", () => {
        vocabModal.classList.remove("hidden");
        vocabModal.classList.add("flex");

        renderConsonantWords();

        if (!currentUser) {
          vocabAuthWarn.classList.remove("hidden");
          vocabSaveBtn.disabled = true;
        } else {
          vocabAuthWarn.classList.add("hidden");
          vocabSaveBtn.disabled = false;
        }
      });

      vocabClose.addEventListener("click", () => {
        vocabModal.classList.add("hidden");
        vocabModal.classList.remove("flex");
      });

      vocabSelectAll.addEventListener("click", () => {
        const boxes = document.querySelectorAll(".vocab-word");
        const anyUnchecked = Array.from(boxes).some(b => !b.checked);
        boxes.forEach(b => b.checked = anyUnchecked);
      });

      async function saveWordsToFirestore(entries) {
        if (!currentUser) return;
        const userKey = getUserKey();
        if (!userKey) return;

        const colRef = collection(db, `users/${userKey}/vocabulary`);

        for (const { word, translation } of entries) {
          await addDoc(colRef, {
            word,
            translation: translation || "",
            lesson:      LESSON_SLUG,
            courseId:    COURSE_ID,
            category:    "–°–æ–≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è",
            addedAt:     serverTimestamp()
          });
        }
      }

      vocabSaveBtn.addEventListener("click", async () => {
        if (!currentUser) {
          alert("–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ª–æ–≤–∞.");
          return;
        }

        const checked = Array.from(document.querySelectorAll(".vocab-word"))
          .filter(cb => cb.checked)
          .map(cb => ({
            word: cb.dataset.word,
            translation: cb.dataset.ru || ""
          }));

        if (checked.length === 0) {
          alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–≤–æ.");
          return;
        }

        vocabSaveBtn.disabled  = true;
        vocabSaveBtn.textContent = "–°–æ—Ö—Ä–∞–Ω—è–µ–º...";

        await saveWordsToFirestore(checked);

        vocabSaveBtn.textContent = "–ì–æ—Ç–æ–≤–æ!";
        setTimeout(() => {
          vocabModal.classList.add("hidden");
          vocabModal.classList.remove("flex");
          vocabSaveBtn.disabled   = false;
          vocabSaveBtn.textContent = "–î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ ‚Üí";
        }, 700);
      });

    // ====== –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ======
onAuthStateChanged(auth, async (user) => {
  console.log("üîê onAuthStateChanged –≤—ã–∑–≤–∞–Ω–∞, user:", user?.email);
  
  if (user) {
    currentUser = user;
    userStatus.textContent = `–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: ${user.email}`;
    loginBtn.classList.add("hidden");

    console.log("‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å...");
    await loadUserProfile(user);
    console.log("‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω, isProUser:", isProUser);
    
    console.log("‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º PRO –æ—Ç–≤–µ—Ç—ã...");
    await loadProAnswers();

    console.log("üé® –û–±–Ω–æ–≤–ª—è–µ–º feedbackLink...");
    if (isProUser) {
      console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PRO - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º feedbackLink");
      feedbackLink.classList.remove("hidden");
      console.log("feedbackLink classes –ø–æ—Å–ª–µ remove:", feedbackLink.classList.toString());
    } else {
      console.log("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ PRO - —Å–∫—Ä—ã–≤–∞–µ–º feedbackLink");
      feedbackLink.classList.add("hidden");
    }
  } else {
    console.log("üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
    currentUser = null;
    isProUser   = false;
    userStatus.textContent = "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã";
    loginBtn.classList.remove("hidden");
    feedbackLink.classList.add("hidden");
  }

  // –ø–æ–¥—Ç—è–Ω—É—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑ –¥–ª—è –Ω–µ-PRO
  if (!isProUser && storyInput) {
    const saved = loadLocalAnswer("story");
    if (saved) storyInput.value = saved;
  }
});
      // —Å—Ç–∞—Ä—Ç
      showStep(1);
    </script>

  </main>

</body>
</html>
