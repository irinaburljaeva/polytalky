<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>PolyTalky ‚Äî English Intro</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --primary: #cf2c02;
      --primary-light: #ffba08;
      --bg: #0f172a;
      --bg-soft: #111827;
      --text: #f9fafb;
      --muted: #9ca3af;
      --card: #111827;
      --border: #1f2937;
      --success: #22c55e;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }
    .page-wrap {
      max-width: 1200px;
      width: 100%;
      padding: 16px;
      display: flex;
      gap: 16px;
    }
    .sidebar {
      width: 280px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: conic-gradient(from 120deg, var(--primary), var(--primary-light), #e85d04, var(--primary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    .brand-text-main {
      font-weight: 700;
      font-size: 16px;
    }
    .brand-text-sub {
      font-size: 12px;
      color: var(--muted);
    }
    .stats-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 12px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      font-size: 12px;
    }
    .stat {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .stat-label {
      color: var(--muted);
    }
    .stat-value {
      font-weight: 700;
      font-size: 14px;
    }
    .progress-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .progress-bar-outer {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
    }
    .progress-bar-inner {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      transition: width 0.3s ease;
    }
    .progress-label {
      font-size: 12px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
    }
    .lesson-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 60vh;
      overflow: auto;
      padding-right: 4px;
    }
    .module-title {
      margin-top: 8px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--muted);
    }
    .lesson-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer;
      border: 1px solid transparent;
    }
    .lesson-item:hover {
      background: rgba(148, 163, 184, 0.06);
    }
    .lesson-item.active {
      background: rgba(248, 250, 252, 0.08);
      border-color: rgba(248, 250, 252, 0.2);
    }
    .lesson-check {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      flex-shrink: 0;
    }
    .lesson-check.completed {
      background: var(--success);
      border-color: var(--success);
      color: #022c22;
    }
    .lesson-meta {
      margin-left: auto;
      font-size: 11px;
      color: var(--muted);
    }

    .main {
      flex: 1;
      background: rgba(15, 23, 42, 0.96);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 16px 18px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: calc(100vh - 32px);
      overflow: hidden;
    }
    .hero {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
    }
    .hero-left {
      max-width: 500px;
    }
    .hero-kicker {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .hero-kicker span.tag {
      background: rgba(248, 250, 252, 0.08);
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 10px;
      color: var(--primary-light);
    }
    .hero-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .hero-subtitle {
      font-size: 14px;
      color: var(--muted);
      max-width: 440px;
    }
    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .btn {
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 14px;
      border: 1px solid transparent;
      background: #020617;
      color: var(--text);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: #111827;
      font-weight: 600;
      border-color: transparent;
    }
    .btn-ghost {
      background: transparent;
      border-color: rgba(148, 163, 184, 0.5);
      color: var(--muted);
    }
    .hero-right {
      min-width: 220px;
      flex: 1;
      display: flex;
      justify-content: flex-end;
    }
    .streak-card {
      min-width: 220px;
      max-width: 270px;
      border-radius: 18px;
      padding: 12px;
      background: radial-gradient(circle at top left, rgba(251, 191, 36, 0.22), transparent 50%), #020617;
      border: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .streak-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }
    .streak-label {
      color: var(--muted);
    }
    .streak-value {
      font-weight: 700;
    }
    .badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .badge {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }
    .badge.highlight {
      border-color: var(--primary-light);
      color: var(--primary-light);
    }

    .content {
      flex: 1;
      display: flex;
      gap: 12px;
      overflow: hidden;
    }
    .content-main {
      flex: 2;
      background: radial-gradient(circle at top, rgba(248, 250, 252, 0.06), transparent 55%);
      border-radius: 14px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 14px 14px 18px;
      overflow-y: auto;
      max-height: calc(100vh - 190px);
    }
    .content-sidebar {
      flex: 1;
      min-width: 240px;
      max-width: 320px;
      background: #020617;
      border-radius: 14px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 12px;
      overflow-y: auto;
      max-height: calc(100vh - 190px);
      font-size: 13px;
    }
    .content-section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .pill-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    .pill {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: var(--muted);
    }
    .pill.good {
      color: #bbf7d0;
      border-color: #22c55e;
    }
    .pill.grammar {
      color: #bfdbfe;
      border-color: #3b82f6;
    }
    .pill.vocab {
      color: #fef9c3;
      border-color: #eab308;
    }
    .pill.game {
      color: #fecaca;
      border-color: #f97316;
    }

    .text-muted { color: var(--muted); }
    .mb-4 { margin-bottom: 12px; }
    .mb-2 { margin-bottom: 6px; }
    .mb-1 { margin-bottom: 4px; }

    .grammar-block,
    .vocab-block,
    .tips-block {
      margin-bottom: 12px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }
    .grammar-block h3,
    .vocab-block h3,
    .tips-block h3 {
      margin: 0 0 6px;
      font-size: 14px;
    }
    ul {
      padding-left: 18px;
      margin: 4px 0;
    }
    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      background: #020617;
      padding: 1px 4px;
      border-radius: 4px;
    }

    .exercise {
      margin: 10px 0;
      padding: 10px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }
    .exercise-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .exercise-question {
      font-size: 13px;
      margin-bottom: 6px;
    }
    .exercise-options {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 6px;
    }
    .exercise-option {
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 13px;
      cursor: pointer;
      text-align: left;
      background: #020617;
    }
    .exercise-option.selected {
      border-color: var(--primary-light);
      background: rgba(234, 179, 8, 0.08);
    }
    .exercise-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      color: var(--muted);
      gap: 6px;
    }
    .exercise-status.ok { color: #4ade80; }
    .exercise-status.err { color: #f97316; }
    .input-small {
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: #020617;
      color: var(--text);
      font-size: 13px;
      min-width: 140px;
    }

    .xp-toast {
      position: fixed;
      right: 16px;
      bottom: 16px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.96);
      color: #ecfdf5;
      font-size: 13px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.6);
      display: none;
      z-index: 999;
    }

    @media (max-width: 960px) {
      .page-wrap {
        flex-direction: column;
        max-width: 100%;
      }
      .sidebar {
        width: 100%;
        order: 2;
      }
      .main {
        order: 1;
        max-height: none;
      }
      .content {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
<div class="page-wrap">
  <aside class="sidebar">
    <div class="brand">
      <div class="brand-logo">P</div>
      <div>
        <div class="brand-text-main">PolyTalky</div>
        <div class="brand-text-sub">English Intro ¬∑ A1</div>
      </div>
    </div>

    <div class="stats-card">
      <div class="stat">
        <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
        <div class="stat-value" id="stat-level">1</div>
      </div>
      <div class="stat">
        <div class="stat-label">XP</div>
        <div class="stat-value" id="stat-xp">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">–°–µ—Ä–∏—è</div>
        <div class="stat-value" id="stat-streak">0 –¥–Ω–µ–π</div>
      </div>
    </div>

    <div class="progress-wrap">
      <div class="progress-label">
        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –∫—É—Ä—Å–∞</span>
        <span id="progress-text">0 / 0</span>
      </div>
      <div class="progress-bar-outer">
        <div class="progress-bar-inner" id="progress-bar"></div>
      </div>
    </div>

    <div class="lesson-list" id="lesson-list">
      <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –º–æ–¥—É–ª–∏ –∏ —É—Ä–æ–∫–∏ -->
    </div>
  </aside>

  <main class="main">
    <section class="hero">
      <div class="hero-left">
        <div class="hero-kicker">
          üåç ENGLISH INTRO
          <span class="tag">–≥–∞–º–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç</span>
        </div>
        <h1 class="hero-title">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö ‚Äî –±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞, —Å —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–∞–º–∏ üéÆ</h1>
        <p class="hero-subtitle">
          –ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏, –±—ã—Å—Ç—Ä—ã–µ –ø–æ–±–µ–¥—ã, –ø–æ–Ω—è—Ç–Ω–∞—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ –∏ –∂–∏–≤—ã–µ —Å–ª–æ–≤–∞. 
          –í—Å—ë –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ: –∏–Ω—Ç—Ä–æ, —É—Ä–æ–∫–∏, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
        </p>
        <div class="hero-actions">
          <button class="btn btn-primary" id="btn-start">
            ‚ñ∂ –ù–∞—á–∞—Ç—å —Å –£—Ä–æ–∫–∞ 1
          </button>
          <button class="btn btn-ghost" id="btn-continue">
            ‚è± –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
          </button>
        </div>
      </div>
      <div class="hero-right">
        <div class="streak-card">
          <div class="streak-row">
            <span class="streak-label">–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –∑–∞—Ä—è–¥ —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤</span>
            <span class="streak-value" id="streak-today">0%</span>
          </div>
          <div class="text-muted">
            –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —É—Ä–æ–∫, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ¬´–¥–æ–∑—É¬ª —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
          </div>
          <div class="badges" id="badge-row">
            <!-- –±–µ–π–¥–∂–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
        </div>
      </div>
    </section>

    <section class="content">
      <div class="content-main" id="content-main">
        <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –∏–Ω—Ç—Ä–æ/–≤—ã–±—Ä–∞–Ω–Ω—ã–π —É—Ä–æ–∫ -->
      </div>
      <aside class="content-sidebar" id="content-sidebar">
        <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞/–ª–µ–∫—Å–∏–∫–∞/–ø–æ–¥—Å–∫–∞–∑–∫–∏ -->
      </aside>
    </section>
  </main>
</div>

<div class="xp-toast" id="xp-toast">+10 XP ‚Äî –≤—ã –±–ª–∏–∂–µ –∫ —Ü–µ–ª–∏! üéâ</div>

<script>
  /***********************
   * Course definition
   ***********************/
  const englishIntroCourse = {
    id: "english-intro",
    title: "English Intro A1",
    description: "–ü–æ–ª–Ω—ã–π –≤–≤–æ–¥–Ω—ã–π –∫—É—Ä—Å –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö: –±–∞–∑–æ–≤–∞—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞, –∂–∏–≤—ã–µ —Ñ—Ä–∞–∑—ã, —Å–ª–æ–≤–∞—Ä–∏–∫–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.",
    modules: [
      {
        id: "m0",
        title: "Welcome & Mindset",
        lessons: [
          {
            id: "welcome-intro",
            title: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å ¬∑ –ö–∞–∫ –º—ã —É—á–∏–º",
            minutes: 5,
            type: "intro",
            grammarFocus: [],
            vocabFocus: [],
            goals: [
              "–ü–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—É—Ä—Å–∞ –∏ —Å–∏—Å—Ç–µ–º—É –Ω–∞–≥—Ä–∞–¥",
              "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å—Å—è –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ, –Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è",
              "–°–Ω—è—Ç—å —Å—Ç—Ä–∞—Ö –ø–µ—Ä–µ–¥ –æ—à–∏–±–∫–∞–º–∏"
            ],
            contentIntro: [
              "–≠—Ç–æ—Ç –∫—É—Ä—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–µ ¬´–º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ ‚Äî –±–æ–ª—å—à–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª.",
              "–ö–∞–∂–¥—ã–π —É—Ä–æ–∫ —Å–æ—á–µ—Ç–∞–µ—Ç –≥—Ä–∞–º–º–∞—Ç–∏–∫—É, –ª–µ–∫—Å–∏–∫—É –∏ –º–∏–Ω–∏-–∏–≥—Ä—ã. –ó–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Ä–æ–∫–æ–≤ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ XP, –ø–æ–≤—ã—à–∞–µ—Ç–µ —É—Ä–æ–≤–µ–Ω—å –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ –±–µ–π–¥–∂–∏.",
              "–û—à–∏–±–∞—Ç—å—Å—è ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –û—à–∏–±–∫–∞ = —Å–∏–≥–Ω–∞–ª –º–æ–∑–≥—É, —á—Ç–æ –∏–¥—ë—Ç –æ–±—É—á–µ–Ω–∏–µ."
            ],
            exercises: [
              {
                id: "welcome-choice",
                kind: "mcq",
                question: "–ö–∞–∫ –ª—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç—Ç–∏–º –∫—É—Ä—Å–æ–º?",
                options: [
                  "–ü—Ä–æ—Ö–æ–¥–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ 10 —É—Ä–æ–∫–æ–≤ –∑–∞ —Ä–∞–∑ –∏ –¥–µ–ª–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ –ø–∞—É–∑—ã",
                  "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–µ–ª–∞—Ç—å 1‚Äì2 –∫–æ—Ä–æ—Ç–∫–∏—Ö —É—Ä–æ–∫–∞ –∏ —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –º–∞–ª–µ–Ω—å–∫–∏–º –ø–æ–±–µ–¥–∞–º",
                  "–ñ–¥–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è"
                ],
                correctIndex: 1,
                explanation: "–†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å + –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã = —É—Å—Ç–æ–π—á–∏–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —ç–Ω–¥–æ—Ä—Ñ–∏–Ω—ã."
              }
            ]
          }
        ]
      },
      {
        id: "m1",
        title: "First Contact ¬∑ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è",
        lessons: [
          {
            id: "greetings-1",
            title: "–£—Ä–æ–∫ 1 ¬∑ Hello & Goodbye",
            minutes: 10,
            type: "core",
            grammarFocus: ["–§–æ—Ä–º–∞–ª—å–Ω–æ–µ –∏ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"],
            vocabFocus: ["hello, hi, good morning, bye, see you"],
            goals: [
              "–ù–∞—É—á–∏—Ç—å—Å—è –∑–¥–æ—Ä–æ–≤–∞—Ç—å—Å—è –∏ –ø—Ä–æ—â–∞—Ç—å—Å—è –≤ —Ç–∏–ø–∏—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö",
              "–†–∞–∑–ª–∏—á–∞—Ç—å —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –∏ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å",
              "–°–≤—è–∑–∞—Ç—å —Ñ—Ä–∞–∑—ã —Å —Å–∏—Ç—É–∞—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ –º–∏–Ω–∏-–∏–≥—Ä—É"
            ],
            vocabList: [
              { en: "Hello", ru: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ / –ü—Ä–∏–≤–µ—Ç" },
              { en: "Hi", ru: "–ü—Ä–∏–≤–µ—Ç (–Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ)" },
              { en: "Good morning", ru: "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ" },
              { en: "Good afternoon", ru: "–î–æ–±—Ä—ã–π –¥–µ–Ω—å" },
              { en: "Good evening", ru: "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä" },
              { en: "Goodbye", ru: "–î–æ —Å–≤–∏–¥–∞–Ω–∏—è" },
              { en: "See you", ru: "–£–≤–∏–¥–∏–º—Å—è" }
            ],
            grammarNotes: [
              "–í –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ ¬´—Ç—ã/–≤—ã¬ª –≤ —Ñ–æ—Ä–º–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π ‚Äî –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Ç–æ–Ω–æ–º –∏ –≤—ã–±–æ—Ä–æ–º —Å–ª–æ–≤.",
              "Hi ‚Äî –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥—Ä—É–∑–µ–π –∏ –±–ª–∏–∑–∫–∏—Ö –∫–æ–ª–ª–µ–≥.",
              "Good morning/afternoon/evening ‚Äî —á—É—Ç—å –±–æ–ª–µ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã; –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ —Å –Ω–µ–∑–Ω–∞–∫–æ–º—ã–º–∏ –ª—é–¥—å–º–∏."
            ],
            exercises: [
              {
                id: "greetings-mcq-1",
                kind: "mcq",
                question: "–ö–∞–∫ –ª—É—á—à–µ –ø–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∫–æ–ª–ª–µ–≥—É —É—Ç—Ä–æ–º –≤ –æ—Ñ–∏—Å–µ?",
                options: ["Hi!", "Good morning!", "Good night!"],
                correctIndex: 1,
                explanation: "–£—Ç—Ä–æ + —Ä–∞–±–æ—á–∞—è –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚Äî ¬´Good morning!¬ª –∑–≤—É—á–∏—Ç –≤–µ–∂–ª–∏–≤–æ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ."
              },
              {
                id: "greetings-mcq-2",
                kind: "mcq",
                question: "–ö–∞–∫ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–ø—Ä–æ—â–∞—Ç—å—Å—è —Å –¥—Ä—É–≥–æ–º –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏?",
                options: ["See you!", "Good evening!", "Good morning!"],
                correctIndex: 0,
                explanation: "See you! ‚Äî –∂–∏–≤–æ–µ –∏ –¥—Ä—É–∂–µ—Å–∫–æ–µ ¬´–£–≤–∏–¥–∏–º—Å—è!¬ª."
              },
              {
                id: "greetings-input-1",
                kind: "input",
                question: "–ù–∞–ø–∏—à–∏—Ç–µ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏: ¬´–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ¬ª.",
                correctAnswers: ["good morning", "goodmorning"],
                placeholder: "–≤–∞—à –æ—Ç–≤–µ—Ç...",
                explanation: "–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ: good morning ‚Äî –¥–≤–∞ —Å–ª–æ–≤–∞."
              }
            ]
          },
          {
            id: "introduce-1",
            title: "–£—Ä–æ–∫ 2 ¬∑ –ö–∞–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å—Å—è",
            minutes: 12,
            type: "core",
            grammarFocus: ["–ì–ª–∞–≥–æ–ª to be –≤ Present Simple (I am, you are)"],
            vocabFocus: ["name, I am, you are, nice to meet you"],
            goals: [
              "–ù–∞—É—á–∏—Ç—å—Å—è –≥–æ–≤–æ—Ä–∏—Ç—å, –∫–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç",
              "–ü–æ–Ω–∏–º–∞—Ç—å –≤–æ–ø—Ä–æ—Å ¬´–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?¬ª",
              "–°–¥–µ–ª–∞—Ç—å –º–∏–Ω–∏-–¥–∏–∞–ª–æ–≥ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞"
            ],
            vocabList: [
              { en: "My name is...", ru: "–ú–µ–Ω—è –∑–æ–≤—É—Ç..." },
              { en: "I am Irina.", ru: "–Ø –ò—Ä–∏–Ω–∞." },
              { en: "You are...", ru: "–¢—ã / –í—ã ..." },
              { en: "Nice to meet you.", ru: "–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è." }
            ],
            grammarNotes: [
              "I am = —è –µ—Å—Ç—å. –í —Ä—É—Å—Å–∫–æ–º ¬´–µ—Å—Ç—å¬ª –æ–±—ã—á–Ω–æ –Ω–µ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—Å—è, –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.",
              "–°–æ–∫—Ä–∞—â—ë–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞: I‚Äôm, You‚Äôre. –í —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–π —Ä–µ—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—á–µ–Ω—å —á–∞—Å—Ç–æ."
            ],
            exercises: [
              {
                id: "introduce-mcq-1",
                kind: "mcq",
                question: "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ñ—Ä–∞–∑—É:",
                options: ["I am student.", "I am a student.", "I student."],
                correctIndex: 1,
                explanation: "–í –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –æ–±—ã—á–Ω–æ –Ω—É–∂–µ–Ω –∞—Ä—Ç–∏–∫–ª—å –ø–µ—Ä–µ–¥ –∏—Å—á–∏—Å–ª—è–µ–º—ã–º —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º: a student."
              },
              {
                id: "introduce-input-1",
                kind: "input",
                question: "–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—Ä–∞–∑—É ¬´–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è¬ª –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏.",
                correctAnswers: ["nice to meet you", "nice 2 meet u"], // –≤—Ç–æ—Ä–æ–π ‚Äì –Ω–µ–º–Ω–æ–≥–æ —à—É—Ç–æ—á–Ω—ã–π
                placeholder: "nice...",
                explanation: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî Nice to meet you."
              }
            ]
          }
        ]
      },
      {
        id: "m2",
        title: "To Be ¬∑ –ö—Ç–æ —è –∏ –≥–¥–µ —è",
        lessons: [
          {
            id: "tobe-1",
            title: "–£—Ä–æ–∫ 3 ¬∑ I am / You are / We are",
            minutes: 15,
            type: "core",
            grammarFocus: ["to be: —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"],
            vocabFocus: ["student, teacher, from, Russia, Germany"],
            goals: [
              "–ì–æ–≤–æ—Ä–∏—Ç—å –æ —Ç–æ–º, –∫—Ç–æ –≤—ã –∏ –æ—Ç–∫—É–¥–∞",
              "–°–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å to be"
            ],
            exercises: [] // –º–æ–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∑–∂–µ
          },
          {
            id: "tobe-2",
            title: "–£—Ä–æ–∫ 4 ¬∑ –í–æ–ø—Ä–æ—Å—ã –∏ –∫—Ä–∞—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã",
            minutes: 15,
            type: "core",
            grammarFocus: ["to be: –≤–æ–ø—Ä–æ—Å—ã –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã"],
            vocabFocus: ["Are you...? Yes, I am / No, I‚Äôm not"],
            goals: [],
            exercises: []
          }
        ]
      },
      {
        id: "m3",
        title: "Present Simple ¬∑ –ü—Ä–∏–≤—ã—á–∫–∏ –∏ —Ä—É—Ç–∏–Ω–∞",
        lessons: [
          {
            id: "present-1",
            title: "–£—Ä–æ–∫ 5 ¬∑ I work, you play",
            minutes: 15,
            type: "core",
            grammarFocus: ["Present Simple: I/you/we/they"],
            vocabFocus: ["to work, to play, to like"],
            goals: [],
            exercises: []
          },
          {
            id: "present-2",
            title: "–£—Ä–æ–∫ 6 ¬∑ He works, she plays",
            minutes: 18,
            type: "core",
            grammarFocus: ["Present Simple: he/she/it + -s"],
            vocabFocus: [],
            goals: [],
            exercises: []
          }
        ]
      },
      {
        id: "m4",
        title: "Everyday Life ¬∑ –í—Ä–µ–º—è, –¥–æ–º, —Å–µ–º—å—è",
        lessons: [
          { id: "time-1", title: "–£—Ä–æ–∫ 7 ¬∑ –í—Ä–µ–º—è –∏ —Ä–∞—Å–ø–æ—Ä—è–¥–æ–∫ –¥–Ω—è", minutes: 18, type: "core", grammarFocus: [], vocabFocus: [], goals: [], exercises: [] },
          { id: "family-1", title: "–£—Ä–æ–∫ 8 ¬∑ –°–µ–º—å—è –∏ –¥–æ–º", minutes: 18, type: "core", grammarFocus: [], vocabFocus: [], goals: [], exercises: [] }
        ]
      },
      {
        id: "m5",
        title: "Past & Future Lite ¬∑ –í—á–µ—Ä–∞ –∏ –∑–∞–≤—Ç—Ä–∞",
        lessons: [
          { id: "past-1", title: "–£—Ä–æ–∫ 9 ¬∑ –í—á–µ—Ä–∞: was / were", minutes: 18, type: "core", grammarFocus: [], vocabFocus: [], goals: [], exercises: [] },
          { id: "future-1", title: "–£—Ä–æ–∫ 10 ¬∑ –ü–ª–∞–Ω—ã: going to", minutes: 18, type: "core", grammarFocus: [], vocabFocus: [], goals: [], exercises: [] }
        ]
      },
      {
        id: "m6",
        title: "Travel & Small Talk",
        lessons: [
          { id: "travel-1", title: "–£—Ä–æ–∫ 11 ¬∑ –í –∞—ç—Ä–æ–ø–æ—Ä—Ç—É", minutes: 18, type: "core", grammarFocus: [], vocabFocus: [], goals: [], exercises: [] },
          { id: "smalltalk-1", title: "–£—Ä–æ–∫ 12 ¬∑ –ù–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑–≥–æ–≤–æ—Ä", minutes: 18, type: "core", grammarFocus: [], vocabFocus: [], goals: [], exercises: [] }
        ]
      },
      {
        id: "m7",
        title: "Revision & Endorphins",
        lessons: [
          { id: "review-1", title: "–§–∏–Ω–∞–ª—å–Ω—ã–π –∫–≤–µ—Å—Ç ¬∑ –ü–æ–≤—Ç–æ—Ä—è–µ–º –≤—Å—ë", minutes: 25, type: "revision", grammarFocus: [], vocabFocus: [], goals: [], exercises: [] }
        ]
      }
    ]
  };

  /***********************
   * State & persistence
   ***********************/
  const STORAGE_KEY = "englishIntroProgress-v1";

  let state = {
    completedLessons: [],
    xp: 0,
    streakDays: 0,
    lastLessonId: null,
    lastStudyDate: null // 'YYYY-MM-DD'
  };

  function todayStr() {
    const d = new Date();
    return d.toISOString().slice(0, 10);
  }

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const parsed = JSON.parse(raw);
      state = Object.assign(state, parsed);
    } catch (e) {
      console.warn("Cannot load state", e);
    }
  }

  function saveState() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch (e) {
      console.warn("Cannot save state", e);
    }
  }

  function addXp(amount) {
    state.xp += amount;
    const today = todayStr();
    if (!state.lastStudyDate) {
      state.streakDays = 1;
    } else if (state.lastStudyDate !== today) {
      // –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Å—á—ë—Ç —Å–µ—Ä–∏–∏: –Ω–æ–≤—ã–π –¥–µ–Ω—å = +1
      state.streakDays += 1;
    }
    state.lastStudyDate = today;
    saveState();
    updateStats();
    showXpToast(amount);
  }

  function markLessonCompleted(lessonId) {
    if (!state.completedLessons.includes(lessonId)) {
      state.completedLessons.push(lessonId);
      state.lastLessonId = lessonId;
      addXp(10); // 10 XP –∑–∞ —É—Ä–æ–∫
      saveState();
      renderSidebarLessons();
      updateProgress();
      updateStreakCard();
    }
  }

  function getAllLessons() {
    return englishIntroCourse.modules.flatMap(m => m.lessons);
  }

  function findLessonById(id) {
    return getAllLessons().find(l => l.id === id) || null;
  }

  function firstRealLessonId() {
    const all = getAllLessons();
    const firstCore = all.find(l => l.type !== "intro");
    return firstCore ? firstCore.id : (all[0] && all[0].id);
  }

  /***********************
   * UI helpers
   ***********************/
  const els = {
    lessonList: document.getElementById("lesson-list"),
    progressText: document.getElementById("progress-text"),
    progressBar: document.getElementById("progress-bar"),
    statLevel: document.getElementById("stat-level"),
    statXp: document.getElementById("stat-xp"),
    statStreak: document.getElementById("stat-streak"),
    contentMain: document.getElementById("content-main"),
    contentSidebar: document.getElementById("content-sidebar"),
    btnStart: document.getElementById("btn-start"),
    btnContinue: document.getElementById("btn-continue"),
    xpToast: document.getElementById("xp-toast"),
    streakToday: document.getElementById("streak-today"),
    badgeRow: document.getElementById("badge-row")
  };

  function updateStats() {
    const level = 1 + Math.floor(state.xp / 100);
    els.statLevel.textContent = level;
    els.statXp.textContent = state.xp;
    els.statStreak.textContent = state.streakDays + " –¥–Ω–µ–π";
  }

  function updateProgress() {
    const allLessons = getAllLessons().filter(l => l.type !== "intro");
    const total = allLessons.length;
    const done = allLessons.filter(l => state.completedLessons.includes(l.id)).length;
    const percent = total === 0 ? 0 : Math.round((done / total) * 100);
    els.progressText.textContent = done + " / " + total;
    els.progressBar.style.width = percent + "%";
  }

  function updateStreakCard() {
    const today = todayStr();
    const todayDone = state.lastStudyDate === today;
    els.streakToday.textContent = todayDone ? "100%" : "0%";
    renderBadges();
  }

  function renderBadges() {
    const container = els.badgeRow;
    container.innerHTML = "";
    const badges = [];

    if (state.completedLessons.length >= 1) {
      badges.push({ label: "–ü–µ—Ä–≤—ã–π —à–∞–≥ ‚úÖ", highlight: true });
    }
    if (state.completedLessons.length >= 5) {
      badges.push({ label: "5 —É—Ä–æ–∫–æ–≤ ‚Äî –∫—Ä–∞—Å–∞–≤—á–∏–∫", highlight: true });
    }
    if (state.streakDays >= 3) {
      badges.push({ label: "–°–µ—Ä–∏—è 3+ –¥–Ω—è", highlight: true });
    }
    if (state.xp >= 50) {
      badges.push({ label: "50+ XP", highlight: false });
    }
    if (badges.length === 0) {
      badges.push({ label: "–°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫ –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–µ–π–¥–∂ üéñ", highlight: true });
    }

    badges.forEach(b => {
      const span = document.createElement("span");
      span.className = "badge" + (b.highlight ? " highlight" : "");
      span.textContent = b.label;
      container.appendChild(span);
    });
  }

  function showXpToast(amount) {
    const el = els.xpToast;
    el.textContent = "+" + amount + " XP ‚Äî –≤—ã –±–ª–∏–∂–µ –∫ —Ü–µ–ª–∏! üéâ";
    el.style.display = "block";
    setTimeout(() => { el.style.display = "none"; }, 2000);
  }

  /***********************
   * Render functions
   ***********************/
  function renderSidebarLessons(activeLessonId) {
    const container = els.lessonList;
    container.innerHTML = "";

    englishIntroCourse.modules.forEach(module => {
      const mt = document.createElement("div");
      mt.className = "module-title";
      mt.textContent = module.title;
      container.appendChild(mt);

      module.lessons.forEach(lesson => {
        const item = document.createElement("div");
        item.className = "lesson-item";
        if (lesson.id === activeLessonId) {
          item.classList.add("active");
        }

        const check = document.createElement("div");
        check.className = "lesson-check";
        if (state.completedLessons.includes(lesson.id)) {
          check.classList.add("completed");
          check.textContent = "‚úì";
        }

        const titleSpan = document.createElement("span");
        titleSpan.textContent = lesson.title;

        const meta = document.createElement("span");
        meta.className = "lesson-meta";
        meta.textContent = lesson.minutes ? lesson.minutes + " –º–∏–Ω" : "";

        item.appendChild(check);
        item.appendChild(titleSpan);
        item.appendChild(meta);

        item.addEventListener("click", () => {
          openLesson(lesson.id);
        });

        container.appendChild(item);
      });
    });
  }

  function renderIntroScreen() {
    els.contentMain.innerHTML = `
      <div>
        <div class="content-section-title mb-1">–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –∫—É—Ä—Å</div>
        <p class="mb-2 text-muted">
          –ö—É—Ä—Å —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –º–æ–¥—É–ª–µ–π. –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å ‚Äî —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–∏–π ¬´—É—Ä–æ–≤–µ–Ω—å¬ª –∏–≥—Ä—ã, 
          –∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–∫ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —à–∞–≥, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ XP –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–ø–µ—Ä—ë–¥.
        </p>
        <div class="pill-row mb-2">
          <span class="pill grammar">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∞</span>
          <span class="pill vocab">–ñ–∏–≤—ã–µ —Å–ª–æ–≤–∞—Ä–∏–∫–∏</span>
          <span class="pill game">–ú–∏–Ω–∏-–∏–≥—Ä—ã –∏ —Ç—Ä–µ–Ω–∞–∂—ë—Ä—ã</span>
          <span class="pill good">–ú–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</span>
        </div>

        <div class="grammar-block">
          <h3>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º</h3>
          <ul>
            <li><b>1 —É—Ä–æ–∫ = 10‚Äì20 –º–∏–Ω—É—Ç.</b> –°—Ç–æ–ª—å–∫–æ, —Å–∫–æ–ª—å–∫–æ –ª–µ–≥–∫–æ –≤—Å—Ç—Ä–æ–∏—Ç—å –≤ –¥–µ–Ω—å.</li>
            <li><b>–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ</b>, –∑–∞—Ç–µ–º —Å–¥–µ–ª–∞–π—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.</li>
            <li><b>–û—à–∏–±–∫–∏ ‚Äî –æ–∫–µ–π.</b> –≠—Ç–æ –Ω–µ —ç–∫–∑–∞–º–µ–Ω, –∞ —Ç—Ä–µ–Ω–∞–∂—ë—Ä. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∏ –ø–æ—á–µ–º—É –≤–µ—Ä–Ω–æ.</li>
          </ul>
        </div>

        <div class="vocab-block">
          <h3>–ß—Ç–æ –≤—ã –æ—Å–≤–æ–∏—Ç–µ</h3>
          <ul>
            <li>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, small talk.</li>
            <li>–ì–ª–∞–≥–æ–ª <code>to be</code>, Present Simple, –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –∏ –±—É–¥—É—â–µ–≥–æ.</li>
            <li>–ë–∞–∑–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π, –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∏ –æ–±—â–µ–Ω–∏—è.</li>
          </ul>
        </div>

        <div class="tips-block">
          <h3>–ö–∞–∫ –ø–æ–ª—É—á–∞—Ç—å –±–æ–ª—å—à–µ —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤ –æ—Ç —É—á—ë–±—ã</h3>
          <ul>
            <li>–î–µ–ª–∞–π—Ç–µ <b>–º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —É—Ä–æ–∫ –≤ –¥–µ–Ω—å</b> ‚Äî —Ç–∞–∫ —Ä–∞—Å—Ç—ë—Ç —Å–µ—Ä–∏—è –¥–Ω–µ–π –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è.</li>
            <li>–û—Ç–º–µ—á–∞–π—Ç–µ –∫–∞–∂–¥—É—é –º–∞–ª–µ–Ω—å–∫—É—é –ø–æ–±–µ–¥—É: ¬´—è —Å–¥–µ–ª–∞–ª¬ª, –∞ –Ω–µ ¬´—è —Å–¥–µ–ª–∞–ª –º–∞–ª–æ¬ª.</li>
            <li>–í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º —É—Ä–æ–∫–∞–º, –µ—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è –ª—ë–≥–∫–æ–π –ø–æ–±–µ–¥—ã –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.</li>
          </ul>
        </div>
      </div>
    `;

    els.contentSidebar.innerHTML = `
      <div class="content-section-title mb-1">–° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å?</div>
      <p class="text-muted mb-2">
        –ù–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å —Å –£—Ä–æ–∫–∞ 1¬ª, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ —Å—Ä–∞–∑—É –∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º —Ñ—Ä–∞–∑–∞–º. 
        –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —É—Ä–æ–∫ ¬´–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å¬ª, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –º–µ—Ç–æ–¥–∏–∫—É –ø–æ–¥—Ä–æ–±–Ω–æ.
      </p>
      <div class="pill-row">
        <span class="pill">1‚Äì2 —É—Ä–æ–∫–∞ –≤ –¥–µ–Ω—å</span>
        <span class="pill">–ì–∏–±–∫–∏–π —Ç–µ–º–ø</span>
        <span class="pill">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</span>
      </div>
    `;
  }

  function openLesson(lessonId) {
    const lesson = findLessonById(lessonId);
    if (!lesson) return;

    state.lastLessonId = lessonId;
    saveState();
    renderSidebarLessons(lessonId);

    // MAIN CONTENT
    const main = els.contentMain;
    let goalsHtml = "";
    if (lesson.goals && lesson.goals.length) {
      goalsHtml = `
        <div class="tips-block mb-2">
          <h3>–¶–µ–ª–∏ —É—Ä–æ–∫–∞</h3>
          <ul>
            ${lesson.goals.map(g => `<li>${g}</li>`).join("")}
          </ul>
        </div>
      `;
    }

    let vocabHtml = "";
    if (lesson.vocabList && lesson.vocabList.length) {
      vocabHtml = `
        <div class="vocab-block">
          <h3>–°–ª–æ–≤–∞—Ä–∏–∫ —É—Ä–æ–∫–∞</h3>
          <ul>
            ${lesson.vocabList.map(w => `<li><b>${w.en}</b> ‚Äî ${w.ru}</li>`).join("")}
          </ul>
        </div>
      `;
    }

    let introTextHtml = "";
    if (lesson.contentIntro && lesson.contentIntro.length) {
      introTextHtml = `
        <div class="grammar-block mb-2">
          ${lesson.contentIntro.map(p => `<p class="mb-1">${p}</p>`).join("")}
        </div>
      `;
    }

    const headPills = `
      <div class="pill-row mb-2">
        ${(lesson.grammarFocus || []).map(g => `<span class="pill grammar">${g}</span>`).join("")}
        ${(lesson.vocabFocus || []).map(v => `<span class="pill vocab">${v}</span>`).join("")}
      </div>
    `;

    main.innerHTML = `
      <div>
        <div class="content-section-title mb-1">${lesson.title}</div>
        <p class="text-muted mb-2">
          –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è: ${lesson.minutes || 10} –º–∏–Ω—É—Ç. 
          –°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –∏ –∏–≥—Ä–µ, –∞ –Ω–µ –Ω–∞ –∏–¥–µ–∞–ª—å–Ω–æ—Å—Ç–∏.
        </p>
        ${headPills}
        ${introTextHtml}
        ${vocabHtml}
        <div id="exercise-container"></div>
      </div>
    `;

    // SIDEBAR: grammar / tips
    const sidebar = els.contentSidebar;
    let grammarHtml = "";
    if (lesson.grammarNotes && lesson.grammarNotes.length) {
      grammarHtml = `
        <div class="grammar-block">
          <h3>–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ –∫–æ—Ä–æ—Ç–∫–æ</h3>
          <ul>
            ${lesson.grammarNotes.map(n => `<li>${n}</li>`).join("")}
          </ul>
        </div>
      `;
    }

    sidebar.innerHTML = `
      <div class="content-section-title mb-1">–ü–æ–¥—Å–∫–∞–∑–∫–∏ –∫ —É—Ä–æ–∫—É</div>
      ${grammarHtml || "<p class='text-muted'>–î–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏. –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è—Ö.</p>"}
      <div class="tips-block">
        <h3>–°–æ–≤–µ—Ç</h3>
        <p class="text-muted mb-1">
          –ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, —á—Ç–æ —É—Å—Ç–∞–ª–∏, —Å–¥–µ–ª–∞–π—Ç–µ –ø–∞—É–∑—É –ø–æ—Å–ª–µ –æ–¥–Ω–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –ø–æ–∑–∂–µ.
        </p>
        <p class="text-muted">
          –ì–ª–∞–≤–Ω–æ–µ ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—â—É—â–µ–Ω–∏–µ, —á—Ç–æ —É—Ä–æ–∫–∏ –ø—Ä–∏–Ω–æ—Å—è—Ç —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ, –∞ –Ω–µ –≤—ã–∂–∏–º–∞—é—Ç —Å–∏–ª—ã.
        </p>
      </div>
    `;

    renderExercises(lesson);
  }

  function renderExercises(lesson) {
    const container = document.getElementById("exercise-container");
    container.innerHTML = "";

    const exercises = lesson.exercises || [];

    if (!exercises.length) {
      container.innerHTML = `
        <div class="exercise">
          <div class="exercise-title mb-1">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</div>
          <p class="exercise-question text-muted">
            –î–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ —Ç—Ä–µ–Ω–∞–∂—ë—Ä—ã –µ—â—ë –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã. 
            –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å—é–¥–∞ —Å–≤–æ–∏ –∑–∞–¥–∞–Ω–∏—è –≤ –∫–æ–¥–µ (–º–∞—Å—Å–∏–≤ <code>exercises</code>).
          </p>
        </div>
      `;
      return;
    }

    let completedCount = 0;
    const total = exercises.length;

    exercises.forEach(ex => {
      const exEl = document.createElement("div");
      exEl.className = "exercise";

      const title = document.createElement("div");
      title.className = "exercise-title";
      title.textContent = "–ó–∞–¥–∞–Ω–∏–µ";

      const question = document.createElement("div");
      question.className = "exercise-question";
      question.textContent = ex.question;

      const footer = document.createElement("div");
      footer.className = "exercise-footer";

      const status = document.createElement("span");
      status.className = "exercise-status";
      status.textContent = "–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ";

      const btnCheck = document.createElement("button");
      btnCheck.className = "btn btn-ghost";
      btnCheck.style.padding = "4px 10px";
      btnCheck.style.fontSize = "12px";
      btnCheck.textContent = "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å";

      footer.appendChild(status);
      footer.appendChild(btnCheck);

      exEl.appendChild(title);
      exEl.appendChild(question);

      // Different kinds
      if (ex.kind === "mcq") {
        const optionsWrap = document.createElement("div");
        optionsWrap.className = "exercise-options";
        let selectedIndex = null;

        ex.options.forEach((opt, idx) => {
          const btn = document.createElement("button");
          btn.className = "exercise-option";
          btn.textContent = opt;
          btn.addEventListener("click", () => {
            selectedIndex = idx;
            Array.from(optionsWrap.children).forEach(ch => ch.classList.remove("selected"));
            btn.classList.add("selected");
          });
          optionsWrap.appendChild(btn);
        });

        exEl.appendChild(optionsWrap);

        btnCheck.addEventListener("click", () => {
          if (selectedIndex === null) {
            status.textContent = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç.";
            status.className = "exercise-status err";
            return;
          }
          if (selectedIndex === ex.correctIndex) {
            status.textContent = "–í–µ—Ä–Ω–æ! " + (ex.explanation || "");
            status.className = "exercise-status ok";
            btnCheck.disabled = true;
            completedCount++;
            if (completedCount === total) {
              // –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
              markLessonCompleted(lesson.id);
            }
          } else {
            status.textContent = "–ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë. " + (ex.explanation || "");
            status.className = "exercise-status err";
          }
        });

      } else if (ex.kind === "input") {
        const input = document.createElement("input");
        input.className = "input-small";
        input.type = "text";
        if (ex.placeholder) input.placeholder = ex.placeholder;

        exEl.appendChild(input);

        btnCheck.addEventListener("click", () => {
          const value = (input.value || "").trim().toLowerCase();
          if (!value) {
            status.textContent = "–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç.";
            status.className = "exercise-status err";
            return;
          }
          const correct = (ex.correctAnswers || []).some(ans =>
            value === ans.toLowerCase()
          );
          if (correct) {
            status.textContent = "–û—Ç–ª–∏—á–Ω–æ! " + (ex.explanation || "");
            status.className = "exercise-status ok";
            btnCheck.disabled = true;
            input.disabled = true;
            completedCount++;
            if (completedCount === total) {
              markLessonCompleted(lesson.id);
            }
          } else {
            status.textContent = "–ü–æ–∫–∞ –Ω–µ—Ç. –ü–æ–¥—É–º–∞–π—Ç–µ –µ—â—ë. " + (ex.explanation || "");
            status.className = "exercise-status err";
          }
        });
      }

      exEl.appendChild(footer);
      container.appendChild(exEl);
    });
  }

  /***********************
   * Init
   ***********************/
  function init() {
    loadState();
    updateStats();
    updateProgress();
    updateStreakCard();
    renderSidebarLessons(state.lastLessonId);
    renderIntroScreen();

    els.btnStart.addEventListener("click", () => {
      const firstLesson = firstRealLessonId();
      if (firstLesson) openLesson(firstLesson);
    });

    els.btnContinue.addEventListener("click", () => {
      if (state.lastLessonId && findLessonById(state.lastLessonId)) {
        openLesson(state.lastLessonId);
      } else {
        const firstLesson = firstRealLessonId();
        if (firstLesson) openLesson(firstLesson);
      }
    });
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
