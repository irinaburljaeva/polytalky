<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>English Intro ¬∑ –£—Ä–æ–∫ 1 ‚Äî –°—Ç–∞—Ä—Ç –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <base href="/">
  <link rel="icon" type="image/jpg" href="/assets/favicon.jpg">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase init -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBAU_uMTePpKwVNZNhqk2pss2PuSitGfQI",
      authDomain: "polytalky-70999.firebaseapp.com",
      projectId: "polytalky-70999",
      storageBucket: "polytalky-70999.firebasestorage.app",
      messagingSenderId: "62407152289",
      appId: "1:62407152289:web:b0c0efdb2472f12b10d6e0"
    };

    window.firebaseApp  = initializeApp(firebaseConfig);
    window.firebaseAuth = getAuth(window.firebaseApp);
    window.firebaseDb   = getFirestore(window.firebaseApp);
  </script>

  <style>
    :root{
      --bg-cream:#FFF8E5;
      --bg-cream-soft:#FFFDF4;
      --accent-yellow:#FFDE59;
      --accent-yellow-deep:#FFBA08;
      --accent-peach:#FFD4A8;
      --accent-coral:#FF8A5C;
      --accent-mint:#C4F1BE;
      --text-main:#111827;
      --text-muted:#6b7280;
      --border-soft:rgba(148,163,184,.35);
    }

    body{
      margin:0;
      min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text-main);
      background:
        radial-gradient(circle at 0 0, #FFF9D9 0, transparent 55%),
        radial-gradient(circle at 100% 0, #FFE3CC 0, transparent 55%),
        linear-gradient(to bottom,#FFFDF6,#FFF8E5);
      position:relative;
      overflow-x:hidden;
    }

    /* —Ñ–æ–Ω–æ–≤—ã–µ –±—É–∫–≤—ã */
    .bg-letter{
      position:fixed;
      font-weight:900;
      font-size:120px;
      color:rgba(255,255,255,0.55);
      mix-blend-mode:screen;
      pointer-events:none;
      z-index:-1;
    }
    .bg-letter.a{top:5%;left:5%;transform:rotate(-12deg);}
    .bg-letter.e{top:18%;right:2%;transform:rotate(9deg);}
    .bg-letter.i{bottom:18%;left:10%;transform:rotate(5deg);}
    .bg-letter.o{bottom:8%;right:8%;transform:rotate(-7deg);}
    .bg-letter.u{top:45%;left:45%;transform:rotate(15deg);opacity:0.4;}

    .center-gif-block {
  width: 100%;
  display: flex;
  justify-content: center;
  margin: 1.2rem 0;
}
.center-gif-block img {
  max-width: 220px;
  width: 100%;
  border-radius: 12px;
}
    
    /* –í–µ—Ä—Ö–Ω–∏–π –±–∞—Ä */
    .top-bar{
      backdrop-filter:blur(16px);
      background:linear-gradient(to right,rgba(255,255,255,.9),rgba(255,249,219,.9));
      border-bottom:1px solid rgba(0,0,0,.06);
    }

    .lesson-shell{
      max-width:980px;
      margin:0 auto;
      padding:1.5rem 1.25rem 3.2rem;
    }

    /* HERO */
    .hero-card{
      position:relative;
      border-radius:2rem;
      padding:1.6rem 1.7rem 1.7rem;
      background:
        radial-gradient(circle at 0 0,#FFFDF5,transparent 65%),
        radial-gradient(circle at 120% 10%,rgba(255,222,89,.55),transparent 55%),
        #FFFFFFE6;
      border:1px solid rgba(255,255,255,.6);
      box-shadow:0 20px 60px rgba(0,0,0,.16);
      overflow:hidden;
      display:flex;
      gap:1.6rem;
      align-items:stretch;
    }

    .hero-left{
      flex:1.3;
      min-width:0;
    }
    .hero-right{
      flex:1;
      min-width:220px;
      position:relative;
    }

    .hero-badge{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      font-size:.65rem;
      text-transform:uppercase;
      letter-spacing:.16em;
      padding:.35rem .9rem;
      border-radius:999px;
      border:1px solid rgba(156,163,175,.55);
      background:rgba(255,255,255,.85);
      color:var(--text-muted);
    }
    .hero-title{
      font-size:1.95rem;
      line-height:1.1;
      letter-spacing:-0.03em;
    }
    .hero-title .em{
      background:linear-gradient(90deg,#FF8A5C,#FFDE59);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }

    .hero-tagline{
      font-size:.8rem;
      color:var(--text-muted);
    }

    .hero-right-inner{
      position:relative;
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      padding-right:1.4rem;
    }

    .hero-bubbles-cluster{
      position:relative;
      display:flex;
      flex-direction:column;
      gap:.4rem;
      align-items:flex-end;
    }

    .hero-bubble{
      position:relative;
      border-radius:1.1rem;
      padding:.45rem .8rem;
      font-size:.78rem;
      background:#fffdfa;
      border:1px solid rgba(148,163,184,.35);
      box-shadow:0 10px 28px rgba(15,23,42,.18);
    }

    .hero-bubble--hello{
      font-weight:700;
      font-size:.9rem;
      background:linear-gradient(135deg,#FFDE59,#FFB347);
      color:#78350f;
      box-shadow:0 12px 32px rgba(248,181,48,.65);
      transform:translate(8px,-4px);
    }
    .hero-bubble--morning{
      background:#fff7ed;
      transform:translate(-4px,2px);
    }
    .hero-bubble--hi{
      background:#FFFFFF;
      transform:translate(10px,6px);
    }

    .hero-bg-circle{
      position:absolute;
      width:280px;
      height:280px;
      border-radius:999px;
      background:radial-gradient(circle,#FFE9A6,#FFCE8A,#FFB48F);
      opacity:.65;
      right:-80px;
      top:-80px;
      filter:blur(10px);
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å */
    .progress-chip{
      border-radius:1.2rem;
      padding:.4rem .9rem;
      background:rgba(255,255,255,.85);
      border:1px solid rgba(148,163,184,.35);
      font-size:.7rem;
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      color:var(--text-muted);
    }

    .progress-bar-wrap{
      border-radius:999px;
      background:rgba(249,250,251,.9);
      overflow:hidden;
      border:1px solid rgba(226,232,240,.9);
    }

    .progress-bar-fill{
      height:0.3rem;
      border-radius:999px;
      background:linear-gradient(90deg,#FF8A5C,#FFDE59);
      transition:width .2s ease-out;
    }

    /* –ù–ê–í–ò–ì–ê–¶–ò–Ø –®–ê–ì–û–í ‚Äî –º–∞—Ä—à—Ä—É—Ç */
    .step-nav{
      position:relative;
      display:flex;
      justify-content:center;
      gap:1.6rem;
      margin:1.8rem 0 1.4rem;
      flex-wrap:wrap;
    }
    .step-nav::before{
      content:"";
      position:absolute;
      left:8%;
      right:8%;
      top:20px;
      height:2px;
      background:linear-gradient(90deg,#fee2e2,#fde68a,#dcfce7);
      z-index:0;
    }

    .step-dot{
      position:relative;
      z-index:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:.25rem;
      font-size:.65rem;
      color:var(--text-muted);
      max-width:110px;
      text-align:center;
    }

    .step-dot-circle{
      width:32px;height:32px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(148,163,184,.7);
      background:rgba(255,255,255,.95);
      box-shadow:0 8px 18px rgba(0,0,0,.08);
      font-size:.8rem;
    }

    .step-dot-label{
      line-height:1.3;
    }

    .step-dot--active .step-dot-circle{
      background:linear-gradient(145deg,#FFDE59,#FFB347);
      border-color:#f97316;
      color:#78350f;
      box-shadow:0 0 0 2px rgba(255,237,213,.95),0 10px 28px rgba(249,115,22,.35);
      transform:translateY(-1px);
    }

    .step-dot--done .step-dot-circle{
      background:linear-gradient(145deg,#4ade80,#22c55e);
      border-color:#16a34a;
      color:#ecfdf5;
    }

    .step-dot--active .step-dot-label{
      color:#92400e;
      font-weight:600;
    }
    .step-dot--done .step-dot-label{
      color:#166534;
    }

    /* –ü–ê–ù–ï–õ–ò –®–ê–ì–û–í */
    .step-panel{
      display:none;
      border-radius:1.7rem;
      background:rgba(255,255,255,.98);
      border:1px solid rgba(148,163,184,.25);
      box-shadow:0 18px 52px rgba(15,23,42,.18);
      padding:1.25rem 1.4rem 1.4rem;
    }
    .step-panel--visible{
      display:block;
    }

    .step-panel-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:.5rem;
      margin-bottom:.75rem;
    }

    .step-pill{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.26rem .7rem;
      border-radius:999px;
      font-size:.68rem;
      border:1px solid rgba(156,163,175,.65);
      background:#F9FAFB;
      color:var(--text-muted);
    }

    .step-icon{
      font-size:1.4rem;
      opacity:.95;
    }

    .step-body-text{
      font-size:.88rem;
      line-height:1.5;
      color:#1f2937;
    }
    .step-body-text--lead{
      font-size:.96rem;
      font-weight:500;
    }
    .step-body-text--accent{
      font-size:.9rem;
      font-weight:600;
    }

    .highlight{
      background:linear-gradient(to right,rgba(255,222,89,.5),rgba(255,222,89,0));
      padding:0 .15rem;
      border-radius:.4rem;
    }

    .soft-note{
      font-size:.73rem;
      color:var(--text-muted);
    }

    .soft-block{
      border-radius:1.1rem;
      padding:.8rem .9rem;
      border:1px solid rgba(226,232,240,1);
      background:linear-gradient(135deg,#FFFCF7,#FFF8E5);
      font-size:.8rem;
    }

    .soft-block--blue{
      background:linear-gradient(135deg,#ECFEFF,#F0F9FF);
      border-color:#BAE6FD;
    }

    .soft-block--green{
      background:linear-gradient(135deg,#ecfdf5,#f0fdf4);
      border-color:#bbf7d0;
    }

    .soft-block--rose{
      background:linear-gradient(135deg,#fff1f2,#ffe4e6);
      border-color:#fecaca;
    }

    .input-main{
      width:100%;
      border-radius:.95rem;
      border:1px solid rgba(209,213,219,1);
      background:#FFFFFF;
      padding:.5rem .7rem;
      font-size:.84rem;
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }

    .input-main:focus{
      border-color:#f97316;
      box-shadow:0 0 0 1px rgba(249,115,22,.4);
    }

    textarea.input-main{
      resize:vertical;
      min-height:90px;
    }

    .btn-main{
      border-radius:999px;
      border:none;
      padding:.55rem 1.2rem;
      font-size:.8rem;
      font-weight:600;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#fff;
      cursor:pointer;
      box-shadow:0 12px 26px rgba(22,163,74,.35);
      transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease;
    }

    .btn-main:active{
      transform:translateY(1px);
      box-shadow:0 6px 16px rgba(22,163,74,.5);
    }

    .btn-main:disabled{
      opacity:.4;
      box-shadow:none;
      cursor:default;
      transform:none;
    }

    .btn-ghost{
      border-radius:999px;
      padding:.5rem 1rem;
      border:1px solid rgba(148,163,184,.5);
      background:rgba(255,255,255,.9);
      font-size:.78rem;
      color:var(--text-muted);
      cursor:pointer;
    }

    /* –¢–∞–±–ª–∏—Ü—ã –∑–≤—É–∫–æ–≤ */
    .sound-table-wrapper{
      margin-top:.6rem;
      border-radius:1rem;
      border:1px solid rgba(226,232,240,1);
      background:#ffffff;
      box-shadow:0 10px 28px rgba(15,23,42,.06);
      overflow:hidden;
    }

    .sound-table-scroll{
      overflow-x:auto;
    }

    .sound-table{
      width:100%;
      border-collapse:collapse;
      font-size:.8rem;
      min-width:420px;
    }

    .sound-table thead{
      background:linear-gradient(90deg,#FFF8E5,#FFE6B3);
    }

    .sound-table th,
    .sound-table td{
      padding:.45rem .6rem;
      border-bottom:1px solid rgba(229,231,235,1);
      text-align:left;
    }

    .sound-table th{
      font-weight:700;
      font-size:.78rem;
      color:#78350f;
      white-space:nowrap;
    }

    .sound-table td:first-child{
      font-weight:600;
      white-space:nowrap;
    }

    .sound-table td:nth-child(2){
      font-family:"SF Mono",ui-monospace;
      white-space:nowrap;
    }

    .sound-table tr:nth-child(even) td{
      background:#FFFCF7;
    }

    /* tooltip + –æ–∑–≤—É—á–∫–∞ */
    .word-tip{
      position:relative;
      cursor:pointer;
      border-bottom:1px dashed rgba(156,163,175,.8);
    }
    .word-tip::after{
      content:attr(data-ru);
      position:absolute;
      left:50%;
      bottom:120%;
      transform:translateX(-50%) translateY(4px);
      font-size:.72rem;
      color:#111827;
      background:#fffefb;
      border-radius:.55rem;
      padding:.25rem .55rem;
      white-space:nowrap;
      box-shadow:0 10px 25px rgba(15,23,42,.30);
      opacity:0;
      pointer-events:none;
      transition:opacity .15s ease-out, transform .15s ease-out;
      z-index:20;
    }
    .word-tip::before{
      content:"";
      position:absolute;
      left:50%;
      bottom:110%;
      transform:translateX(-50%);
      border-width:6px 6px 0 6px;
      border-style:solid;
      border-color:#fffefb transparent transparent transparent;
      opacity:0;
      transition:opacity .15s ease-out;
      z-index:19;
    }
    .word-tip:hover::after,
    .word-tip:hover::before{
      opacity:1;
    }
    .word-tip:hover::after{
      transform:translateX(-50%) translateY(0);
    }

    .mini-toast{
      font-size:.75rem;
      color:#166534;
      background:#ecfdf5;
      border-radius:.9rem;
      padding:.45rem .7rem;
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      border:1px solid #bbf7d0;
    }

    .hidden{display:none;}
  </style>
</head>
<body>

  <!-- –§–æ–Ω–æ–≤—ã–µ –±—É–∫–≤—ã -->
  <div class="bg-letter a">A</div>
  <div class="bg-letter e">E</div>
  <div class="bg-letter i">I</div>
  <div class="bg-letter o">O</div>
  <div class="bg-letter u">U</div>

  <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <header class="top-bar sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <a href="/" class="flex items-center gap-2 font-semibold text-[0.9rem] text-[#374151]">
        <img src="/assets/logo.png" alt="PolyTalky" class="w-7 h-7">
        PolyTalky
      </a>

      <div class="flex items-center gap-4">
        <div id="user-status" class="text-[0.78rem] text-gray-600"></div>
        <button id="logout-btn"
                class="hidden border border-gray-300 rounded-full px-3 py-1.5 text-[0.75rem] text-gray-600 bg-white">
          –í—ã–π—Ç–∏
        </button>
      </div>
    </div>
  </header>

  <main class="lesson-shell">

    <!-- HERO -->
    <section class="hero-card mb-8">

      <div class="hero-left">
        <div class="hero-badge">English ¬∑ Lesson 1</div>
        <h1 class="hero-title mt-3">
          –í–∞—à–µ –ø–µ—Ä–≤–æ–µ <span class="em">hello</span>
          <br>–≤ –Ω–æ–≤–æ–º —è–∑—ã–∫–æ–≤–æ–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–∏
        </h1>

        <p class="hero-tagline mt-3">
          –ö–æ—Ä–æ—Ç–∫–∏–µ —à–∞–≥–∏, –ª—ë–≥–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏ –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.  
          –î–≤–∏–≥–∞–µ–º—Å—è –≤–º–µ—Å—Ç–µ ‚Äî —Å–ø–æ–∫–æ–π–Ω–æ, —É–≤–µ—Ä–µ–Ω–Ω–æ, —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º.
        </p>
      </div>

      <div class="hero-right">
        <div class="hero-right-inner">
          <div class="hero-bg-circle"></div>

          <div class="hero-bubbles-cluster">
            <div class="hero-bubble hero-bubble--hello">
              Hello! üëã
            </div>
            <div class="hero-bubble hero-bubble--morning">
              Good morning!
            </div>
            <div class="hero-bubble hero-bubble--hi">
              Hi üôÇ
            </div>
          </div>
        </div>
      </div>

    </section>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
    <div class="mb-6">
      <div class="progress-chip mb-1">
        –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–∫–∞: <span id="lesson-progress-text">0%</span>
      </div>

      <div class="progress-bar-wrap w-full h-1.5">
        <div class="progress-bar-fill" id="lesson-progress-bar" style="width:0%;"></div>
      </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è —à–∞–≥–æ–≤ -->
    <nav class="step-nav">

      <div class="step-dot" data-step="1" id="dot-1">
        <div class="step-dot-circle">1</div>
        <div class="step-dot-label">üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</div>
      </div>

      <div class="step-dot" data-step="2" id="dot-2">
        <div class="step-dot-circle">2</div>
        <div class="step-dot-label">üéß –í–∏–¥–µ–æ –æ—Ç –Ω–æ—Å–∏—Ç–µ–ª—è</div>
      </div>

      <div class="step-dot" data-step="3" id="dot-3">
        <div class="step-dot-circle">3</div>
        <div class="step-dot-label">üî§ –ì–ª–∞—Å–Ω—ã–µ</div>
      </div>

      <div class="step-dot" data-step="4" id="dot-4">
        <div class="step-dot-circle">4</div>
        <div class="step-dot-label">üèÅ –§–∏–Ω–∞–ª</div>
      </div>

    </nav>

    <!-- STEP PANELS -->

    <!-- STEP 1 ‚Äî –ü–†–ò–í–ï–¢–°–¢–í–ò–ï -->
    <section class="step-panel step-panel--visible" data-step="1" id="step-1">

      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 1 ¬∑ HELLO</span>
        <span class="step-icon">üëã</span>
      </div>

      <p class="step-body-text step-body-text--lead">
        –£—Ä–∞, —É—Ä–∞, —É—Ä–∞! –í—ã –Ω–∞–∫–æ–Ω–µ—Ü –∑–∞–ø—É—Å—Ç–∏–ª–∏ –∫—É—Ä—Å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –æ—Ç PolyTalky.  
        –í–æ—Ç –æ–Ω ‚Äî –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫. –£—Ä–æ–∫ –ø–æ–ª–Ω—ã–π –Ω–∞–¥–µ–∂–¥, –ª—ë–≥–∫–æ—Å—Ç–∏ –∏ —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞!
      </p>
<div class="center-gif-block">
  <img src="https://media0.giphy.com/media/3PAL5bChWnak0WJ32x/giphy.gif?cid=790b76115d3d766c584a514d595d1389&amp;rid=giphy.gif" style="max-width:250px; width:100%; height:auto; border-radius:12px;">
</div>
      <p class="step-body-text mt-3">
        –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –±—É–¥–µ—Ç –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äî –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –≤–∞—à–µ–º—É –∫—É—Ä–∞—Ç–æ—Ä—É
        –∏–ª–∏ –æ–±—â–∞—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.
      </p>

      <p class="step-body-text step-body-text--accent mt-4">
        –í–∞—à–µ –ø–µ—Ä–≤–æ–µ –º–∏–Ω–∏-–∑–∞–¥–∞–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å—Å—è –Ω–∞ –Ω—É–∂–Ω—É—é –≤–æ–ª–Ω—É, —É–∂–µ –∂–¥—ë—Ç –≤–∞—Å üòä
      </p>

      <p class="step-body-text mt-3 highlight">
        –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∏–∂–µ, –∫–∞–∫ –≤—ã –ø–æ–∑–¥–æ—Ä–æ–≤–∞–ª–∏—Å—å –±—ã –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏.
      </p>

      <textarea class="input-main mt-4" id="task-hello-input"
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Hello! –∏–ª–∏ Hi, my name is Olga"></textarea>

      <p class="soft-note mt-2">
        –ú–æ–∂–Ω–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑—É ‚Äî –≥–ª–∞–≤–Ω–æ–µ, —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π —à–∞–≥.
      </p>

      <div id="hello-feedback" class="mini-toast mt-3 hidden">
        üíö –û—Ç–ª–∏—á–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ.
      </div>

      <button class="btn-main mt-5 next-step-btn" data-next="2" id="task-hello-submit">
        –ì–æ—Ç–æ–≤–æ, –∏–¥—ë–º –¥–∞–ª—å—à–µ ‚Üí
      </button>

    </section>

    <!-- STEP 2 ‚Äî –í–ò–î–ï–û -->
    <section class="step-panel" data-step="2" id="step-2">

      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 2 ¬∑ LISTEN</span>
        <span class="step-icon">üí¨</span>
      </div>

      <p class="step-body-text">
        –ê–Ω–≥–ª–∏–π—Å–∫–æ–µ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ ‚Äî –æ–¥–Ω–æ –∏–∑ –Ω–∞–∏–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –≤ –º–∏—Ä–µ, –∑–∞ —Å—á–µ—Ç —Ç–æ–≥–æ, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–µ—Å—è—Ç–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∑–≤—É–∫–∏. 
        –ù–æ –ø–æ–º–∏–º–æ —ç—Ç–æ–≥–æ, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Å–ª–∞–≤–∏—Ç—Å—è —Ç–µ–º, —á—Ç–æ –Ω–∞ –∫–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≤ –Ω–µ–º –≤—Å–µ–≥–¥–∞ –Ω–∞–π–¥—É—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è! 
        –ê –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø–æ—Ä–æ–π —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Ñ–æ–Ω–µ—Ç–∏–∫–µ —ç—Ç–æ–≥–æ —è–∑—ã–∫–∞ –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –æ—á–µ–Ω—å –∏ –æ—á–µ–Ω—å –∑–∞—Ç—Ä—É–¥–Ω–∏—Ç–µ–ª—å–Ω–æ.
      </p>

      <p class="step-body-text mt-3">
        –î–ª—è –Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º —ç—Ç–æ –≤–∏–¥–µ–æ, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–æ—Å–∏—Ç–µ–ª—å —è–∑—ã–∫–∞ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç –Ω–∞–º –∫–∞–∫–∏–µ –∑–≤—É–∫–∏ –º—ã –º–æ–∂–µ–º –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –∏ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á—Ç–æ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—å. 
        <em>(–í–Ω–∏–º–∞–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–∫–∞ –≤–∞–º —Å–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –≥–æ–≤–æ—Ä—è—Ç –Ω–∞ –≤–∏–¥–µ–æ ‚Äî –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã —Ä–µ—á—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏–ª–∞—Å—å –Ω–∞ —Ä—É—Å—Å–∫–∏–π.)</em>
      </p>

      <div class="mt-5">
        <!-- –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Å–≤–æ–π youtube/vk embed -->
        <iframe width="100%" height="215"
                style="border-radius:1rem;"
                src="https://www.youtube.com/embed/2f32fcQ2An8"
                title="English sounds"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture;"
                allowfullscreen>
        </iframe>
      </div>

      <p class="soft-note mt-3">
        –ï—Å–ª–∏ –ø–æ–∫–∞ —Å–ª–æ–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å —Ä–µ—á—å ‚Äî –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π—Ç–µ, —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π —Å—Ç–∞–Ω–µ—Ç –ª–µ–≥—á–µ.
      </p>

      <button class="btn-main mt-6 next-step-btn" data-next="3">
        –î–∞–ª–µ–µ ‚Üí
      </button>
    </section>

    <!-- STEP 3 ‚Äî –¢–ê–ë–õ–ò–¶–ê –ì–õ–ê–°–ù–´–• + –ê–£–î–ò–û–ó–ê–î–ê–ù–ò–ï -->
    <section class="step-panel" data-step="3" id="step-3">

      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 3 ¬∑ VOWELS & PRACTICE</span>
        <span class="step-icon">üî§</span>
      </div>

      <p class="step-body-text">
        –í –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ –º–Ω–æ–≥–æ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∑–≤—É–∫–∏.  
        –≠—Ç–∞ –º–∏–Ω–∏-–∫–∞—Ä—Ç–∞ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—É—á–∏—Ç—å—Å—è —É–∑–Ω–∞–≤–∞—Ç—å –∏—Ö –≤ —Å–ª–æ–≤–∞—Ö –∏ –ª–µ–≥—á–µ —á–∏—Ç–∞—Ç—å –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏.
      </p>

      <!-- –¢–∞–±–ª–∏—Ü–∞ –≥–ª–∞—Å–Ω—ã—Ö -->
      <div class="soft-block soft-block--green mt-4">
        <p class="text-[0.78rem] mb-2">
          <b>–¢–≤–æ—è —Ç–∞–±–ª–∏—Ü–∞ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–π</b> ‚Äî –∫–∞—Ä—Ç–∞ –≥–ª–∞—Å–Ω—ã—Ö –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä–∞—è –æ–±–ª–µ–≥—á–∞–µ—Ç –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å–ª–æ–≤.
        </p>

        <div class="sound-table-wrapper">
          <div class="sound-table-scroll">
            <table class="sound-table">
              <thead>
                <tr>
                  <th>–ë—É–∫–≤—ã</th>
                  <th>–ó–≤—É–∫</th>
                  <th>–ü—Ä–∏–º–µ—Ä—ã</th>
                </tr>
              </thead>
              <tbody>

                <tr>
                  <td>ai, ay</td>
                  <td>[—ç–π]</td>
                  <td>
                    <span class="word-tip" data-ru="–¥–æ–∂–¥—å">rain</span>,
                    <span class="word-tip" data-ru="–º–∞–π">May</span>
                  </td>
                </tr>

                <tr>
                  <td>ea, ee</td>
                  <td>[–∏Àê]</td>
                  <td>
                    <span class="word-tip" data-ru="–º–æ—Ä–µ">sea</span>,
                    <span class="word-tip" data-ru="–ø—á–µ–ª–∞">bee</span>
                  </td>
                </tr>

                <tr>
                  <td>ew</td>
                  <td>[—éÀê]</td>
                  <td>
                    <span class="word-tip" data-ru="–Ω–æ–≤—ã–π">new</span>
                  </td>
                </tr>

                <tr>
                  <td>oi, oy</td>
                  <td>[–æ–π]</td>
                  <td>
                    <span class="word-tip" data-ru="—Ç–æ—á–∫–∞">point</span>,
                    <span class="word-tip" data-ru="–º–∞–ª—å—á–∏–∫">boy</span>
                  </td>
                </tr>

                <tr>
                  <td>oo + k</td>
                  <td>[—É]</td>
                  <td>
                    <span class="word-tip" data-ru="–∫–Ω–∏–≥–∞">book</span>
                  </td>
                </tr>

                <tr>
                  <td>oo</td>
                  <td>[—ÉÀê]</td>
                  <td>
                    <span class="word-tip" data-ru="—Å–ª–∏—à–∫–æ–º">too</span>
                  </td>
                </tr>

                <tr>
                  <td>ou, ow</td>
                  <td>[–∞—É]</td>
                  <td>
                    <span class="word-tip" data-ru="–Ω–∞—Ä—É–∂—É">out</span>,
                    <span class="word-tip" data-ru="–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π">brown</span>
                  </td>
                </tr>

                <tr>
                  <td>ai + r</td>
                  <td>[—ç–∞]</td>
                  <td>
                    <span class="word-tip" data-ru="—Å—Ç—É–ª">chair</span>
                  </td>
                </tr>

                <tr>
                  <td>ee + r</td>
                  <td>[–∏—ç]</td>
                  <td>
                    <span class="word-tip" data-ru="–∏–Ω–∂–µ–Ω–µ—Ä">engineer</span>
                  </td>
                </tr>

                <tr>
                  <td>ou + r</td>
                  <td>[–∞—É—ç]</td>
                  <td>
                    <span class="word-tip" data-ru="–Ω–∞—à">our</span>
                  </td>
                </tr>

                <tr>
                  <td>oo + r</td>
                  <td>[–æÀê]</td>
                  <td>
                    <span class="word-tip" data-ru="–±–æ–ª–æ—Ç–æ">moor</span>
                  </td>
                </tr>

              </tbody>
            </table>
          </div>
        </div>

        <p class="soft-note mt-2">
          –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ —á–∏—Ç–∞—Ç—å –≤—Å—ë –≤—Å–ª—É—Ö, —á—Ç–æ–±—ã –ª—É—á—à–µ –∑–∞–ø–æ–º–Ω–∏—Ç—å üíõ
        </p>
      </div>

      <!-- –ê–£–î–ò–û–ó–ê–î–ê–ù–ò–ï -->
      <div class="soft-block soft-block--blue mt-5">
        <p class="text-[0.85rem] mb-2">
          –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ —Å–ª–æ–≤–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤—Å–ª—É—Ö.
        </p>

        <p class="soft-note mb-3">
          –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø–∏—Å–∞—Ç—å¬ª, –ø—Ä–æ–∏–∑–Ω–µ—Å–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤, –∑–∞—Ç–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–ø–∏—Å—å.
        </p>

        <div class="mt-2 flex gap-3">
          <button class="btn-main" id="record-btn">‚è∫ –ó–∞–ø–∏—Å–∞—Ç—å</button>
          <button class="btn-ghost" id="stop-btn" disabled>‚èπ –°—Ç–æ–ø</button>
        </div>

        <audio id="audio-playback" class="mt-4 w-full" controls style="display:none;"></audio>

        <p id="audio-feedback" class="mini-toast mt-3 hidden">
          ‚≠ê –û—Ç–ª–∏—á–Ω–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å! –í—ã –º–æ–ª–æ–¥–µ—Ü.
        </p>
      </div>

    </section>

    <!-- STEP 4 ‚Äî –§–ò–ù–ê–õ -->
    <section class="step-panel" data-step="4" id="step-4">

      <div class="step-panel-header">
        <span class="step-pill">–®–∞–≥ 4 ¬∑ DONE</span>
        <span class="step-icon">üåü</span>
      </div>

      <p class="step-body-text">
        –£—Ä–∞! –í—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫ —Ü–µ–ª–∏–∫–æ–º ü§©  
        –° —Ç–∞–∫–∏–º –Ω–∞—Å—Ç—Ä–æ–µ–º –≤—ã –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –∑–∞–≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —Å–≤–æ–±–æ–¥–Ω–æ.
      </p>

      <div class="mt-3 rounded-2xl overflow-hidden border border-yellow-100 bg-white/70">
        <!-- –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ç–≤–æ—è –∑–∞–±–∞–≤–Ω–∞—è GIF -->
        <img src="/assets/gifs/english-lesson1-finish.gif" alt="Finish gif"
             class="w-full max-h-40 object-cover">
      </div>

      <p class="step-body-text mt-3">
        –ú–æ–∂–µ—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ª–æ–≤–∞ –∏–∑ —É—Ä–æ–∫–∞ –≤ —Å–≤–æ–π —Å–ª–æ–≤–∞—Ä–∏–∫,
        –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ–π—Ç–∏ –∫–æ –≤—Ç–æ—Ä–æ–º—É —É—Ä–æ–∫—É.
      </p>

      <div class="soft-block soft-block--rose mt-4 flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-white/85 flex items-center justify-center text-2xl">
          üèÖ
        </div>
        <div class="text-[0.82rem]">
          <b>–í–∞—à –ø–µ—Ä–≤—ã–π –±–µ–π–¥–∂: ¬´–ü–µ—Ä–≤–æ–µ hello¬ª.</b><br>
          –°—á–∏—Ç–∞–π—Ç–µ, —á—Ç–æ –≤—ã –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–∞—á–∞–ª–∏ —Å–≤–æ—ë –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º.
        </div>
      </div>

      <div class="mt-5 flex flex-wrap gap-3">
        <button class="btn-main" id="open-vocab-btn">
          –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞ –≤ —Å–ª–æ–≤–∞—Ä–∏–∫ ‚Üí
        </button>

        <a href="/courses/english-intro/lesson-02.html" class="btn-ghost">
          –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É
        </a>
      </div>

    </section>

    <!-- –í–°–ü–õ–´–í–ê–Æ–©–ï–ï –û–ö–ù–û –°–õ–û–í–ê–†–Ø -->
    <div id="vocab-modal"
         class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50 p-4">

      <div class="bg-white max-w-lg w-full rounded-2xl shadow-xl relative overflow-hidden">

        <!-- –î–µ–∫–æ—Ä -->
        <div class="absolute -top-8 -left-8 w-36 h-36 rounded-full bg-[#FFE8B3] blur-xl opacity-70"></div>
        <div class="absolute -bottom-10 -right-10 w-40 h-40 rounded-full bg-[#FFD6C4] blur-xl opacity-70"></div>

        <div class="relative p-6">
          
          <div class="flex justify-between items-start">
            <h2 class="text-lg font-semibold text-gray-800">
              –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞ –≤ —Å–ª–æ–≤–∞—Ä–∏–∫
            </h2>

            <button id="vocab-close" class="text-gray-500 text-xl leading-none">&times;</button>
          </div>

          <p class="text-sm text-gray-600 mt-1">
            –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –≤–∞—à–µ–º —Å–ª–æ–≤–∞—Ä–∏–∫–µ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ.
          </p>

          <!-- –ë–ª–æ–∫: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω -->
          <div id="vocab-auth-warning"
               class="hidden mt-4 bg-red-50 text-red-700 border border-red-200 rounded-xl p-3 text-sm">
            –ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ª–æ–≤–∞, –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.
            <br>
            <a href="/login" class="underline font-medium">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí</a>
          </div>

          <!-- –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ -->
          <div id="vocab-list" class="mt-5 space-y-5 max-h-[330px] overflow-y-auto pr-1">

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –≥–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è -->
            <div class="vocab-category" data-category="–ì–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è">
              <h3 class="text-[0.8rem] font-semibold text-gray-700 mb-2 flex items-center gap-1">
                üî§ –ì–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è
              </h3>

              <div id="vocab-vowels" class="grid grid-cols-1 gap-2 pl-1">
                <!-- JS –∑–∞–ø–æ–ª–Ω–∏—Ç -->
              </div>
            </div>

          </div>

          <!-- –ö–ù–û–ü–ö–ò -->
          <div class="mt-6 flex justify-between items-center">

            <button id="vocab-select-all"
                    class="px-4 py-2 rounded-xl bg-gray-100 text-sm text-gray-700 border border-gray-300">
              –í—ã–±—Ä–∞—Ç—å –≤—Å—ë
            </button>

            <button id="vocab-save"
                    class="btn-main text-sm px-5 py-2">
              –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ ‚Üí
            </button>

          </div>

        </div>
      </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –°–ö–†–ò–ü–¢ -->
    <script type="module">
      import {
        getAuth,
        onAuthStateChanged,
        signOut
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      import {
        getFirestore,
        collection,
        addDoc,
        serverTimestamp
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const auth = window.firebaseAuth;
      const db   = window.firebaseDb;

      /* UI */
      const stepPanels = document.querySelectorAll(".step-panel");
      const stepDots   = document.querySelectorAll(".step-dot");

      const progressText = document.getElementById("lesson-progress-text");
      const progressBar  = document.getElementById("lesson-progress-bar");

      const userStatus = document.getElementById("user-status");
      const logoutBtn  = document.getElementById("logout-btn");

      const openVocabBtn    = document.getElementById("open-vocab-btn");
      const vocabModal      = document.getElementById("vocab-modal");
      const vocabClose      = document.getElementById("vocab-close");
      const vocabListVowels = document.getElementById("vocab-vowels");
      const vocabAuthWarn   = document.getElementById("vocab-auth-warning");
      const vocabSaveBtn    = document.getElementById("vocab-save");
      const vocabSelectAll  = document.getElementById("vocab-select-all");

      const helloFeedback   = document.getElementById("hello-feedback");
      const audioFeedback   = document.getElementById("audio-feedback");

      let currentUser = null;

      /* –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø */
      onAuthStateChanged(auth, (user) => {
        if (user) {
          currentUser = user;
          userStatus.textContent = `–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: ${user.email}`;
          logoutBtn.classList.remove("hidden");
        } else {
          currentUser = null;
          userStatus.textContent = "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã";
          logoutBtn.classList.add("hidden");
        }
      });

      logoutBtn.addEventListener("click", () => {
        signOut(auth);
      });

      /* –°–ò–°–¢–ï–ú–ê –®–ê–ì–û–í */
      let currentStep = 1;
      const totalSteps = 4;

      function showStep(n){
        stepPanels.forEach(p => p.classList.remove("step-panel--visible"));
        const panel = document.getElementById(`step-${n}`);
        if (panel) panel.classList.add("step-panel--visible");

        stepDots.forEach(dot => {
          dot.classList.remove("step-dot--active","step-dot--done");
          const step = Number(dot.dataset.step);
          if (step < n) dot.classList.add("step-dot--done");
          if (step === n) dot.classList.add("step-dot--active");
        });

        const percent = Math.round(((n - 1) / (totalSteps - 1)) * 100);
        progressText.textContent = `${percent}%`;
        progressBar.style.width = `${percent}%`;

        currentStep = n;
      }

      document.querySelectorAll(".next-step-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          if (btn.id === "task-hello-submit") return; // –æ—Ç–¥–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
          const next = Number(btn.dataset.next);
          if (next) showStep(next);
        });
      });

      /* –ú–ò–ù–ò-–ó–ê–î–ê–ù–ò–ï –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø */
      document.getElementById("task-hello-submit").addEventListener("click", () => {
        const val = document.getElementById("task-hello-input").value.trim();
        if (!val){
          alert("–ù–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ :)");
          return;
        }

        if (helloFeedback){
          helloFeedback.classList.remove("hidden");
        }

        setTimeout(() => {
          if (helloFeedback) helloFeedback.classList.add("hidden");
          showStep(2);
        }, 1100);
      });

      /* –ê–£–î–ò–û–ó–ê–ü–ò–°–¨ */
      let mediaRecorder;
      let audioChunks = [];

      const recordBtn = document.getElementById("record-btn");
      const stopBtn   = document.getElementById("stop-btn");
      const audioPlay = document.getElementById("audio-playback");

      if (recordBtn && stopBtn && audioPlay){
        recordBtn.addEventListener("click", async () => {
          try{
            audioChunks = [];
            const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.start();
            recordBtn.disabled = true;
            stopBtn.disabled = false;
            audioFeedback?.classList.add("hidden");

            mediaRecorder.addEventListener("dataavailable", e => audioChunks.push(e.data));
          }catch(err){
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É :(");
            console.error(err);
          }
        });

        stopBtn.addEventListener("click", () => {
          if (!mediaRecorder) return;
          mediaRecorder.stop();
          recordBtn.disabled = false;
          stopBtn.disabled = true;

          mediaRecorder.addEventListener("stop", () => {
            const audioBlob = new Blob(audioChunks);
            const url = URL.createObjectURL(audioBlob);
            audioPlay.src = url;
            audioPlay.style.display = "block";

            if (audioFeedback){
              audioFeedback.classList.remove("hidden");
            }

            setTimeout(() => {
              if (audioFeedback) audioFeedback.classList.add("hidden");
              showStep(4);
            }, 1800);
          });
        });
      }

      /* –û–ó–í–£–ß–ö–ê –°–õ–û–í (speechSynthesis) */
      if ("speechSynthesis" in window){
        document.querySelectorAll(".word-tip").forEach(el => {
          el.addEventListener("click", () => {
            const text = el.textContent.trim();
            if (!text) return;
            const u = new SpeechSynthesisUtterance(text);
            u.lang = "en-US";
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(u);
          });
        });
      }

      /* –°–õ–û–í–ê–†–¨ ‚Äî —Å–ª–æ–≤–æ + –ø–µ—Ä–µ–≤–æ–¥ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã */
      function extractVowelEntries(){
        const tips = document.querySelectorAll("#step-3 .word-tip");
        const map = new Map(); // word -> ru

        tips.forEach(tip => {
          const w  = tip.textContent.trim().toLowerCase();
          const ru = (tip.dataset.ru || "").trim();
          if (/^[a-z]+$/.test(w) && !map.has(w)){
            map.set(w, ru);
          }
        });

        return Array.from(map.entries()).map(([word, translation]) => ({
          word,
          translation
        }));
      }

      function renderVowelWords(){
        const entries = extractVowelEntries();
        vocabListVowels.innerHTML = "";

        entries.forEach(({ word, translation }) => {
          const label = document.createElement("label");
          label.className = "flex items-center gap-2 text-[0.85rem]";

          const ruPart = translation
            ? `<span class="text-gray-400 text-[0.78rem] ml-1">‚Äî ${translation}</span>`
            : "";

          label.innerHTML = `
            <input type="checkbox"
                   class="vocab-word"
                   data-word="${word}"
                   data-ru="${translation}"
                   data-category="–ì–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è">
            <span>${word}</span>
            ${ruPart}
          `;

          vocabListVowels.appendChild(label);
        });
      }

      /* –û–ö–ù–û –°–õ–û–í–ê–†–ò–ö–ê */
      openVocabBtn.addEventListener("click", () => {
        vocabModal.classList.remove("hidden");
        vocabModal.classList.add("flex");

        renderVowelWords();

        if (!currentUser){
          vocabAuthWarn.classList.remove("hidden");
          vocabSaveBtn.disabled = true;
        } else {
          vocabAuthWarn.classList.add("hidden");
          vocabSaveBtn.disabled = false;
        }
      });

      vocabClose.addEventListener("click", () => {
        vocabModal.classList.add("hidden");
        vocabModal.classList.remove("flex");
      });

      vocabSelectAll.addEventListener("click", () => {
        const boxes = document.querySelectorAll(".vocab-word");
        const anyUnchecked = Array.from(boxes).some(b => !b.checked);
        boxes.forEach(b => b.checked = anyUnchecked);
      });

      async function saveWordsToFirestore(entries){
        if (!currentUser) return;
        const uid = currentUser.uid;
        const colRef = collection(db, `users/${uid}/vocabulary`);

        for (const { word, translation } of entries){
          await addDoc(colRef, {
            word,
            translation: translation || "",
            lesson: "lesson-01-hello",
            category: "–ì–ª–∞—Å–Ω—ã–µ –±—É–∫–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è",
            addedAt: serverTimestamp()
          });
        }
      }

      vocabSaveBtn.addEventListener("click", async () => {
        if (!currentUser){
          alert("–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ª–æ–≤–∞.");
          return;
        }

        const checked = Array.from(document.querySelectorAll(".vocab-word"))
          .filter(cb => cb.checked)
          .map(cb => ({
            word: cb.dataset.word,
            translation: cb.dataset.ru || ""
          }));

        if (checked.length === 0){
          alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–≤–æ.");
          return;
        }

        vocabSaveBtn.disabled = true;
        vocabSaveBtn.textContent = "–°–æ—Ö—Ä–∞–Ω—è–µ–º...";

        await saveWordsToFirestore(checked);

        vocabSaveBtn.textContent = "–ì–æ—Ç–æ–≤–æ!";
        setTimeout(() => {
          vocabModal.classList.add("hidden");
          vocabModal.classList.remove("flex");
          vocabSaveBtn.disabled = false;
          vocabSaveBtn.textContent = "–î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ ‚Üí";
        }, 700);
      });

      /* —Å—Ç–∞—Ä—Ç */
      showStep(1);
    </script>

    <!-- –ü–û–ó–î–†–ê–í–ò–¢–ï–õ–¨–ù–ê–Ø –ú–û–î–ê–õ–ö–ê -->
    <div id="congrats-modal"
         class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50 p-4">

      <div class="bg-white max-w-sm w-full rounded-2xl shadow-xl relative overflow-hidden">

        <div class="absolute -top-10 -left-10 w-36 h-36 rounded-full bg-[#FFE8B3] blur-xl opacity-60"></div>
        <div class="absolute -bottom-10 -right-10 w-40 h-40 rounded-full bg-[#FFD6C4] blur-xl opacity-60"></div>

        <div class="relative p-6">

          <h2 class="text-xl font-bold text-gray-800 mb-2 flex items-center gap-2">
            üéâ –£—Ä–∞!
          </h2>

          <p class="text-[0.9rem] text-gray-700 leading-relaxed">
            –í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—à–ª–∏ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫ ü§©  
            –≠—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å—Ç–∞—Ä—Ç ‚Äî —Å —Ç–∞–∫–∏–º –Ω–∞—Å—Ç—Ä–æ–µ–º –≤—ã –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –∑–∞–≥–æ–≤–æ—Ä–∏—Ç–µ —É–≤–µ—Ä–µ–Ω–Ω–æ!
          </p>

          <p class="text-[0.8rem] text-gray-500 mt-2">
            –ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî —ç—Ç–æ –≤–∫–ª–∞–¥ –≤ –≤–∞—à–µ –±—É–¥—É—â–µ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º ‚úàÔ∏è
          </p>

          <div class="mt-5 flex justify-end gap-3">
            <button id="congrats-add-words" class="btn-ghost">
              –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞ –≤ —Å–ª–æ–≤–∞—Ä–∏–∫
            </button>
            <a href="/courses/english-intro/lesson-02.html" id="congrats-next" class="btn-main">
              –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫ ‚Üí
            </a>
          </div>

        </div>
      </div>
    </div>

    <script type="module">
      const congratsModal   = document.getElementById("congrats-modal");
      const congratsAdd     = document.getElementById("congrats-add-words");
      const step4           = document.getElementById("step-4");
      const openVocabButton = document.getElementById("open-vocab-btn");

      if (step4){
        const observer = new MutationObserver(() => {
          if (step4.classList.contains("step-panel--visible")){
            setTimeout(() => {
              congratsModal.classList.remove("hidden");
              congratsModal.classList.add("flex");
            }, 400);
          }
        });

        observer.observe(step4, { attributes:true, attributeFilter:["class"] });
      }

      congratsAdd.addEventListener("click", () => {
        congratsModal.classList.add("hidden");
        congratsModal.classList.remove("flex");
        openVocabButton?.click();
      });
    </script>

  </main>

</body>
</html>
