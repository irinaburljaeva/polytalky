<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PolyTalky ‚Äî –ú–∞–≥–∞–∑–∏–Ω –∫—É—Ä—Å–æ–≤</title>
  <meta name="description" content="–ú–∞–≥–∞–∑–∏–Ω —è–∑—ã–∫–æ–≤—ã—Ö –∫—É—Ä—Å–æ–≤ PolyTalky: —Å–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã, —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ –∫—É—Ä—Å—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö. –û–ø–ª–∞—Ç–∞ –¥–ª—è –†–§ –∏ –∏–∑-–∑–∞ —Ä—É–±–µ–∂–∞." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--brand-1:#CF2C02;--brand-2:#FFBA08;--brand-3:#E85D04}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0f1115;color:#fff}
    .btn-brand{background:var(--brand-1);padding:.5rem 1rem;border-radius:.75rem;font-weight:700}
    .btn-brand:hover{background:var(--brand-3)}
    .btn-ghost{background:rgba(255,255,255,.08);padding:.5rem 1rem;border-radius:.75rem;font-weight:600}
    .card{transition:transform .25s,box-shadow .25s}
    .card:hover{transform:translateY(-4px)}
    .chip{display:inline-block;background:rgba(255,255,255,.08);padding:2px 6px;border-radius:8px;font-size:12px}
    .price{font-weight:800}
    #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#111;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;pointer-events:none;transition:opacity .2s, transform .2s;z-index:60}
    #toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
    @keyframes bump{0%{transform:scale(1)}30%{transform:scale(1.25)}60%{transform:scale(1)}100%{transform:scale(1)}}
    .bump{animation:bump .4s ease}
    .fly{position:fixed;z-index:70;pointer-events:none;border-radius:12px;box-shadow:0 8px 16px rgba(0,0,0,.18)}
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="sticky top-0 z-30 backdrop-blur bg-black/40 border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
      <a href="/polytalky/" class="flex items-center gap-2 font-semibold text-lg">
        <span class="inline-flex h-8 w-8 rounded-xl bg-[var(--brand-1)] items-center justify-center">üè∑Ô∏è</span>
        <span>PolyTalky</span>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="/polytalky/courses/" class="opacity-80 hover:opacity-100">–ö—É—Ä—Å—ã</a>
        <a href="/polytalky/shop/" class="opacity-100 font-semibold text-[var(--brand-2)]">–ú–∞–≥–∞–∑–∏–Ω</a>
        <a href="/polytalky/student/" class="opacity-80 hover:opacity-100">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      </nav>
      <button id="cartBtn" class="relative btn-ghost">
        üõí –ö–æ—Ä–∑–∏–Ω–∞
        <span id="cartCount" class="absolute -right-2 -top-2 bg-[var(--brand-2)] text-black rounded-full text-xs font-bold px-2 py-0.5">0</span>
      </button>
    </div>
  </header>

  <main class="flex-grow">
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <h1 class="text-3xl font-bold mb-2">–ú–∞–≥–∞–∑–∏–Ω –∫—É—Ä—Å–æ–≤</h1>
      <p class="text-white/70 mb-10">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã, —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ –∫—É—Ä—Å—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö. –ß–µ–∫–∏ –≤—ã–¥–∞—é ‚Äî —É–∫–∞–∂–∏—Ç–µ email –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏.</p>

      <h2 class="text-2xl font-bold mb-4">üí´ –°–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h2>
      <div id="grid-special" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10"></div>

      <h2 class="text-2xl font-bold mb-4">üéì –ö—É—Ä—Å—ã –ø–æ —è–∑—ã–∫–∞–º</h2>
      <div id="grid-langs" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-white/10 py-8 text-sm text-white/70">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
      <p>¬© 2025 PolyTalky. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      <div class="flex flex-wrap gap-4">
        <a href="/polytalky/contact.html" class="opacity-80 hover:opacity-100">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <a href="/polytalky/legal/privacy.html" class="opacity-80 hover:opacity-100">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        <a href="/polytalky/legal/offer.html" class="opacity-80 hover:opacity-100">–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</a>
        <a href="/polytalky/legal/cookies.html" class="opacity-80 hover:opacity-100">Cookies</a>
        <a href="/polytalky/legal/consent.html" class="opacity-80 hover:opacity-100">–°–æ–≥–ª–∞—Å–∏–µ</a>
      </div>
    </div>
  </footer>

  <!-- Toast -->
  <div id="toast">–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É</div>

  <!-- Buy modal -->
  <div id="buyModal" class="hidden fixed inset-0 bg-black/60 items-center justify-center z-50">
    <div class="bg-[#161a22] border border-white/10 rounded-2xl p-6 max-w-lg w-full text-white">
      <h3 class="text-xl font-bold mb-3" id="bm-title">–ö—É—Ä—Å</h3>
      <p class="mb-2 text-white/70">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="bm-price-rub"></span> / <span id="bm-price-eur"></span></p>
      <div class="mb-4">
        <label class="text-sm text-white/60">–í–∞—à email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞</label>
        <input id="bm-email" type="email" class="mt-1 w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2" placeholder="you@example.com">
      </div>
      <div class="grid sm:grid-cols-2 gap-3">
        <button class="btn-brand w-full" onclick="openPayWindow('ru')">–û–ø–ª–∞—Ç–∞ –¥–ª—è –†–§</button>
        <button class="btn-brand w-full" onclick="openPayWindow('int')">–û–ø–ª–∞—Ç–∞ –∏–∑ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω</button>
      </div>
      <div class="mt-4">
        <button class="w-full bg-white/10 hover:bg-white/15 py-2 rounded-lg" onclick="closeBuy()">–û—Ç–º–µ–Ω–∞</button>
      </div>
      <div class="mt-3 flex gap-8">
        <button class="underline text-sm" onclick="addToCart(currentProduct,true)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        <button class="underline text-sm" onclick="openConfirm()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
      </div>
    </div>
  </div>

  <!-- Cart drawer -->
  <div id="cartDrawer" class="fixed top-0 right-0 h-full w-[360px] max-w-[92vw] bg-[#161a22] border-l border-white/10 translate-x-full transition-transform z-50">
    <div class="p-4 border-b border-white/10 flex items-center justify-between">
      <h3 class="text-lg font-bold">–ö–æ—Ä–∑–∏–Ω–∞</h3>
      <button class="text-sm underline" onclick="toggleCart(false)">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="cartList" class="p-4 space-y-3"></div>
    <div class="p-4 border-t border-white/10">
      <div class="mb-3">
        <label class="text-sm text-white/60">–í–∞—à email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞</label>
        <input id="cartEmail" type="email" class="mt-1 w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2" placeholder="you@example.com">
      </div>
      <div class="flex items-center justify-between mb-3">
        <div class="font-semibold">–ò—Ç–æ–≥–æ: <span id="cartTotalRub">0 ‚ÇΩ</span> / <span id="cartTotalEur">‚Ç¨0</span></div>
      </div>
      <div class="flex gap-2">
        <button class="btn-brand w-1/2" onclick="openCartCheckout('ru')">–û–ø–ª–∞—Ç–∞ –†–§</button>
        <button class="btn-brand w-1/2" onclick="openCartCheckout('int')">–û–ø–ª–∞—Ç–∞ –∏–∑-–∑–∞ —Ä—É–±–µ–∂–∞</button>
      </div>
      <button class="w-full mt-3 bg-white/10 hover:bg-white/15 py-2 rounded-lg" onclick="openConfirm('cart')">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
    </div>
  </div>

  <!-- Checkout modal -->
  <div id="payModal" class="hidden fixed inset-0 bg-black/60 items-center justify-center z-50">
    <div class="bg-[#161a22] border border-white/10 rounded-2xl p-6 max-w-2xl w-full text-white">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-bold">–û–ø–ª–∞—Ç–∞</h3>
        <button class="text-sm underline" onclick="closePay()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <p class="text-sm text-white/70 mt-1">–°–Ω–∞—á–∞–ª–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª ‚Äî –º—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∏ –≤—ã—à–ª–µ–º —á–µ–∫.</p>

      <div id="tabRU" class="mt-4 hidden">
        <h4 class="font-semibold mb-2">–†–æ—Å—Å–∏—è</h4>
        <div class="grid sm:grid-cols-2 gap-4">
          <div class="p-3 border border-white/10 rounded-xl bg-black/20">
            <div class="font-semibold mb-2">–ÆMoney</div>
            <img src="/polytalky/assets/pay/yoomoney.jpg" alt="–ÆMoney QR" class="w-full rounded-lg mb-2">
            <a id="ymLink" class="btn-brand inline-block" target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å –ÆMoney</a>
            <p class="text-xs text-white/50 mt-2">–ï—Å–ª–∏ —Å—É–º–º–∞ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∞—Å—å ‚Äî –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é. –°—Å—ã–ª–∫–∞: yoomoney.ru/to/410013183449005</p>
          </div>
          <div class="p-3 border border-white/10 rounded-xl bg-black/20">
            <div class="font-semibold mb-2">–°–ë–ü (QR)</div>
            <img src="/polytalky/assets/pay/sberbank.png" alt="–°–ë–ü QR" class="w-full rounded-lg mb-2 border border-white/10 bg-white">
            <p class="text-xs text-white/50">–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–∞–Ω–∫–∞ ‚Üí –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR ‚Üí –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∑–∞–∫–∞–∑–∞.</p>
          </div>
        </div>
      </div>

      <div id="tabINT" class="mt-4 hidden">
        <h4 class="font-semibold mb-2">–î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã</h4>
        <div class="grid sm:grid-cols-2 gap-4">
          <div class="p-3 border border-white/10 rounded-xl bg-black/20">
            <div class="font-semibold mb-2">PayPal</div>
            <img src="/polytalky/assets/pay/paypal.jpg" alt="PayPal QR" class="w-full rounded-lg mb-2">
            <p class="text-sm">Email: <b>iraburljaeva@gmail.com</b></p>
            <p class="text-xs text-white/50">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—É–º–º—É –∑–∞–∫–∞–∑–∞ –∫–∞–∫ ¬´Goods &amp; Services¬ª.</p>
          </div>
          <div class="p-3 border border-white/10 rounded-xl bg-black/20">
            <div class="font-semibold mb-2">–õ—é–±–∞—è –∫–∞—Ä—Ç–∞</div>
            <div id="stripeLinks" class="space-y-2 text-sm"></div>
            <p class="text-xs text-white/50">–°—É–º–º—ã –ø–æ –ø–æ–∑–∏—Ü–∏—è–º: –æ–ø–ª–∞—Ç–∏—Ç–µ –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫—É—Ä—Å.</p>
          </div>
        </div>
      </div>

      <div class="mt-4 text-right">
        <button class="btn-ghost" onclick="closePay()">–ì–æ—Ç–æ–≤–æ</button>
      </div>
    </div>
  </div>

  <!-- Confirm modal -->
  <div id="confirmModal" class="hidden fixed inset-0 bg-black/60 items-center justify-center z-50">
    <div class="bg-[#161a22] border border-white/10 rounded-2xl p-6 max-w-lg w-full text-white">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-xl font-bold">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã</h3>
        <button class="text-sm underline" onclick="closeConfirm()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <form id="confirmForm" class="space-y-3">
        <div>
          <label class="text-sm text-white/60">Email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞</label>
          <input id="cf-email" name="email" type="email" class="mt-1 w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2" required>
        </div>
        <div>
          <label class="text-sm text-white/60">–û–ø–ª–∞—á–µ–Ω–æ —á–µ—Ä–µ–∑</label>
          <select id="cf-channel" name="channel" class="mt-1 w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2">
            <option value="ru-yoomoney">–†–æ—Å—Å–∏—è ‚Äî –ÆMoney</option>
            <option value="ru-sbp">–†–æ—Å—Å–∏—è ‚Äî –°–ë–ü</option>
            <option value="int-paypal">–î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã ‚Äî PayPal</option>
            <option value="int-card">–î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã ‚Äî –õ—é–±–∞—è –∫–∞—Ä—Ç–∞</option>
          </select>
        </div>
        <div>
          <label class="text-sm text-white/60">–ö—É—Ä—Å—ã</label>
          <textarea id="cf-items" name="items" class="mt-1 w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm" rows="3" readonly></textarea>
        </div>
        <div>
          <label class="text-sm text-white/60">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —Ç.–ø.)</label>
          <input id="cf-note" name="note" type="text" class="mt-1 w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2" placeholder="(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        </div>
        <button class="btn-brand w-full" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</button>
        <p class="text-xs text-white/50 text-center">–î–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, –∞ —á–µ–∫ –ø—Ä–∏–¥—ë—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email.</p>
      </form>
    </div>
  </div>

  <script>
    // ====== CONFIG ======
    const FORMSPREE = 'https://formspree.io/f/XXXXYYYY'; // ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π endpoint
    const IMG_BASE = '/polytalky/assets/courses/';
    const img = n => IMG_BASE + n;

    // ====== DATA ======
    const special = [
      { id:'polyglotpack-mchny', title:'PolyglotPack MCHNY', img:img('mchny.jpg'), tag:'SEASONAL', note:'–°—Ç–∞—Ä—Ç 25 –¥–µ–∫–∞–±—Ä—è', priceRub:1490, priceEur:19 },
      { id:'polyglotpack-starter', title:'Polyglot Pack. Starter', img:img('polyglotpack.jpg'), tag:'PACK', priceRub:1290, priceEur:15 },
      { id:'cook-it', title:'Polyglot Pack. Cook it!', img:img('cookit.jpg'), tag:'PACK', priceRub:1290, priceEur:15 },
      { id:'30days-english', title:'30 Days of English (Challenge)', img:img('30daysofenglish.jpg'), tag:'EN', priceRub:990, priceEur:12 },
      { id:'irregular-verbs', title:'Irregular Verbs (Challenge)', img:img('irregularverbs.jpg'), tag:'EN', priceRub:790, priceEur:10 },
      { id:'english-translators', title:'–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–æ–≤', img:img('englishtranslate.jpg'), tag:'EN', priceRub:1490, priceEur:19 },
    ];
    const langs = [
      { id:'english-with-harry', title:'English with Harry', img:img('englishwithharry.jpg'), tag:'EN', level:'A0‚ÄìA2', priceRub:1490, priceEur:19 },
      { id:'visual-spanish', title:'–í–∏–∑—É–∞–ª—å–Ω—ã–π –∏—Å–ø–∞–Ω—Å–∫–∏–π', img:img('visualspanish.jpg'), tag:'ES', level:'A1‚ÄìA2', priceRub:1290, priceEur:15 },
      { id:'italian-songs', title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –ø–æ –ø–µ—Å–Ω—è–º', img:img('italiansongs.jpg'), tag:'IT', level:'A1‚ÄìA2', priceRub:1290, priceEur:15 },
      { id:'pro-espanol', title:'Pro Espa√±ol (–æ—Ç –Ω–æ—Å–∏—Ç–µ–ª—è)', img:img('proespanol.jpg'), tag:'ES', level:'B1‚ÄìB2', priceRub:1990, priceEur:24 },
      { id:'finnish-travel', title:'–§–∏–Ω—Å–∫–∏–π –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π', img:img('finishtravel.jpg'), tag:'FI', level:'A1', priceRub:1290, priceEur:15 },
      { id:'finnish-a2', title:'–§–∏–Ω—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('finisha2.jpg'), tag:'FI', level:'A2‚ÄìB1', priceRub:1490, priceEur:19 },
      { id:'german-a2', title:'–ù–µ–º–µ—Ü–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('germana2.jpg'), tag:'DE', level:'A2‚ÄìB1', priceRub:1490, priceEur:19 },
      { id:'italian-a2', title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('italiana2.jpg'), tag:'IT', level:'A2‚ÄìB1', priceRub:1490, priceEur:19 },
      { id:'afrikaans-a0', title:'–ê—Ñ—Ä–∏–∫–∞–∞–Ω—Å —Å –Ω—É–ª—è', img:img('afrikaans.jpg'), tag:'AF', level:'A0', priceRub:990, priceEur:12 },
      { id:'dutch-a2', title:'–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('nederlandsa2.jpg'), tag:'NL', level:'A2‚ÄìB1', priceRub:1490, priceEur:19 },
      { id:'swedish-a0', title:'–®–≤–µ–¥—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('swedish.jpg'), tag:'SV', level:'A0', priceRub:990, priceEur:12 },
      { id:'lithuanian-a0', title:'–õ–∏—Ç–æ–≤—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('lithuanian.jpg'), tag:'LT', level:'A0', priceRub:990, priceEur:12 },
      { id:'romanian-a0', title:'–†—É–º—ã–Ω—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('romanian.jpg'), tag:'RO', level:'A0', priceRub:990, priceEur:12 },
    ];
    const stripeByEur = {
      19:'https://buy.stripe.com/00w4gybq66YZ1vkcUWb3q0w',
      15:'https://buy.stripe.com/28E9AS1PwabbfmadZ0b3q0x',
      12:'https://buy.stripe.com/28E00ifGmabb0rg5sub3q0y',
      10:'https://buy.stripe.com/fZu6oGbq64QR0rg9IKb3q0z',
      24:'https://buy.stripe.com/8x214mbq65UVb5UcUWb3q0A'
    };

    // ====== HELPERS ======
    function fmtRub(n){return new Intl.NumberFormat('ru-RU').format(n)+' ‚ÇΩ'}
    function fmtEur(n){return '‚Ç¨'+n}
    const toast = (t)=>{ const el=document.getElementById('toast'); el.textContent=t; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),1400) }
    function bumpCart(){ const b=document.getElementById('cartCount'); b.classList.remove('bump'); void b.offsetWidth; b.classList.add('bump') }
    function flyImgFrom(el){
      try{
        const imgEl = el.closest('.card').querySelector('img');
        const cartBtn = document.getElementById('cartBtn');
        if(!imgEl || !cartBtn) return;
        const r1 = imgEl.getBoundingClientRect();
        const r2 = cartBtn.getBoundingClientRect();
        const clone = imgEl.cloneNode(true);
        clone.classList.add('fly');
        clone.style.left = r1.left+'px';
        clone.style.top = r1.top+'px';
        clone.style.width = r1.width+'px';
        clone.style.height = r1.height+'px';
        document.body.appendChild(clone);
        requestAnimationFrame(()=>{
          clone.style.transition = 'all .6s cubic-bezier(.4,0,.2,1)';
          clone.style.left = (r2.left + r2.width/2 - r1.width*0.25)+'px';
          clone.style.top  = (r2.top  + r2.height/2 - r1.height*0.25)+'px';
          clone.style.opacity = '0.2';
          clone.style.transform = 'scale(.5)';
        });
        setTimeout(()=>clone.remove(),650);
      }catch(e){}
    }

    // ====== RENDER ======
    function cardHTML(c){
      const level = c.level ? `<span class="chip">${c.level}</span>` : '';
      const tag = c.tag ? `<span class="chip">${c.tag}</span>` : '';
      return `
        <div class="card rounded-2xl border border-white/10 bg-white/5 overflow-hidden">
          <img src="${c.img}" alt="${c.title}" class="w-full aspect-[4/3] object-cover">
          <div class="p-4">
            <div class="flex items-center gap-2 mb-1">${tag}${level?` ${level}`:''}</div>
            <h3 class="font-semibold">${c.title}</h3>
            ${c.note ? `<p class="text-xs text-[var(--brand-2)] mt-1">${c.note}</p>` : ''}
            <div class="mt-3 flex items-center justify-between">
              <div class="price">${fmtRub(c.priceRub)} <span class="text-white/50 text-xs">/ ${fmtEur(c.priceEur)}</span></div>
              <div class="flex gap-2">
                <button class="btn-ghost" onclick='addToCart(this, ${JSON.stringify(c)})'>–í –∫–æ—Ä–∑–∏–Ω—É</button>
                <button class="btn-brand" onclick='openBuy(${JSON.stringify(c)})'>–ö—É–ø–∏—Ç—å</button>
              </div>
            </div>
          </div>
        </div>`;
    }
    document.getElementById('grid-special').innerHTML = special.map(cardHTML).join('');
    document.getElementById('grid-langs').innerHTML = langs.map(cardHTML).join('');

    // ====== CART ======
    const CART_KEY='pt_cart';
    const ENROLL_KEY='pt_enrollments';

    function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY)||'[]') }
    function setCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); renderCart() }

    function addToCart(btnOrNull, item, silent){
      const cart = getCart();
      if(!cart.find(x=>x.id===item.id)) cart.push(item);
      setCart(cart);
      bumpCart();
      if(!silent){ toast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É'); if(btnOrNull) flyImgFrom(btnOrNull); }
    }
    function removeFromCart(id){
      setCart(getCart().filter(x=>x.id!==id));
    }

    function renderCart(){
      const cart = getCart();
      document.getElementById('cartCount').textContent = cart.length;
      const list = document.getElementById('cartList');
      if(!list) return;
      if(cart.length===0){ list.innerHTML = `<p class="text-sm text-white/60">–ü—É—Å—Ç–æ. –î–æ–±–∞–≤—å—Ç–µ –∫—É—Ä—Å—ã –≤ –∫–æ—Ä–∑–∏–Ω—É.</p>`; }
      else{
        list.innerHTML = cart.map(c=>`
          <div class="border border-white/10 rounded-xl p-3 bg-white/5">
            <div class="flex gap-3">
              <img src="${c.img}" class="w-16 h-16 object-cover rounded-lg" alt="">
              <div class="grow">
                <div class="font-semibold text-sm">${c.title}</div>
                <div class="text-xs text-white/60">${fmtRub(c.priceRub)} / ${fmtEur(c.priceEur)}</div>
                <button class="text-xs underline mt-1" onclick="removeFromCart('${c.id}')">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            </div>
          </div>`).join('');
      }
      const totalRub = cart.reduce((a,c)=>a+c.priceRub,0);
      const totalEur = cart.reduce((a,c)=>a+c.priceEur,0);
      const tr = document.getElementById('cartTotalRub');
      const te = document.getElementById('cartTotalEur');
      if(tr) tr.textContent = fmtRub(totalRub);
      if(te) te.textContent = '‚Ç¨'+totalEur;
    }

    const drawer = document.getElementById('cartDrawer');
    document.getElementById('cartBtn').onclick = ()=>toggleCart();
    function toggleCart(force){
      const hide = (typeof force==='boolean') ? !force : drawer.classList.contains('translate-x-0');
      drawer.classList.toggle('translate-x-0', !hide);
    }
    renderCart();

    // ====== BUY MODAL ======
    let currentProduct = null;
    function openBuy(c){
      currentProduct = c;
      document.getElementById('bm-title').textContent = c.title;
      document.getElementById('bm-price-rub').textContent = fmtRub(c.priceRub);
      document.getElementById('bm-price-eur').textContent = fmtEur(c.priceEur);
      const m = document.getElementById('buyModal');
      m.classList.remove('hidden'); m.classList.add('flex');
    }
    function closeBuy(){
      const m = document.getElementById('buyModal');
      m.classList.add('hidden'); m.classList.remove('flex');
    }

    // ====== PAY MODAL ======
    function openPayWindow(region){
      const email = (document.getElementById('bm-email').value||'').trim();
      if(!email){ alert('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞.'); return; }
      sessionStorage.setItem('pt_last_email', email);
      const list = [currentProduct];
      openPay(region, list);
    }
    function openCartCheckout(region){
      const email = (document.getElementById('cartEmail').value||'').trim();
      if(!email){ alert('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞.'); return; }
      sessionStorage.setItem('pt_last_email', email);
      const list = getCart();
      if(list.length===0){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
      openPay(region, list);
    }
    function openPay(region, items){
      sessionStorage.setItem('pt_last_items', JSON.stringify(items));
      sessionStorage.setItem('pt_last_region', region);
      const totalRub = items.reduce((a,c)=>a+c.priceRub,0);
      const ym = document.getElementById('ymLink');
      ym.href = `https://yoomoney.ru/to/410013183449005/${encodeURIComponent(totalRub)}`;
      const wrap = document.getElementById('stripeLinks');
      wrap.innerHTML = items.map(c=>{
        const link = (c.priceEur in stripeByEur) ? stripeByEur[c.priceEur] : '#';
        const safeTitle = c.title.replace(/"/g,'&quot;');
        return `<div><a href="${link}" target="_blank" rel="noopener" class="btn-brand inline-block">–û–ø–ª–∞—Ç–∏—Ç—å ¬´${safeTitle}¬ª ‚Äî ‚Ç¨${c.priceEur}</a></div>`;
      }).join('');
      document.getElementById('tabRU').classList.toggle('hidden', region!=='ru');
      document.getElementById('tabINT').classList.toggle('hidden', region!=='int');
      const m = document.getElementById('payModal'); m.classList.remove('hidden'); m.classList.add('flex');
    }
    function closePay(){ const m=document.getElementById('payModal'); m.classList.add('hidden'); m.classList.remove('flex'); }

    // ====== CONFIRM (Formspree) ======
    function openConfirm(mode){
      const email = sessionStorage.getItem('pt_last_email') || document.getElementById('cartEmail')?.value || document.getElementById('bm-email')?.value || '';
      const items = JSON.parse(sessionStorage.getItem('pt_last_items')||'[]');
      const region = sessionStorage.getItem('pt_last_region') || 'ru';
      const lines = (items.length?items:getCart()).map(c=>`${c.title} ‚Äî ${fmtRub(c.priceRub)} / ${fmtEur(c.priceEur)}`).join('\n');
      document.getElementById('cf-email').value = email;
      document.getElementById('cf-items').value = lines || '(–∫—É—Ä—Å—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã)';
      document.getElementById('cf-channel').value = region==='ru' ? 'ru-yoomoney' : 'int-card';
      const m = document.getElementById('confirmModal'); m.classList.remove('hidden'); m.classList.add('flex');
    }
    function closeConfirm(){ const m=document.getElementById('confirmModal'); m.classList.add('hidden'); m.classList.remove('flex'); }

    document.getElementById('confirmForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('cf-email').value.trim();
      if(!email){ alert('–£–∫–∞–∂–∏—Ç–µ email'); return; }

      // –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
      const items = JSON.parse(sessionStorage.getItem('pt_last_items')||'[]');
      const list = items.length ? items : getCart();
      const enroll = JSON.parse(localStorage.getItem(ENROLL_KEY)||'{}');
      list.forEach(c=>{ enroll[c.id] = {access:true, purchasedAt:new Date().toISOString(), channel:document.getElementById('cf-channel').value} })
      localStorage.setItem(ENROLL_KEY, JSON.stringify(enroll));

      // –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
      let ok=false;
      try{
        if(FORMSPREE && /formspree\.io\/f\//.test(FORMSPREE)){
          const payload = {
            email,
            channel: document.getElementById('cf-channel').value,
            items: document.getElementById('cf-items').value,
            note: document.getElementById('cf-note').value || ''
          };
          const res = await fetch(FORMSPREE, {method:'POST', headers:{'Content-Type':'application/json','Accept':'application/json'}, body:JSON.stringify(payload)});
          ok = res.ok;
        }
      }catch(_){}

      toast(ok ? '–°–ø–∞—Å–∏–±–æ! –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ üëç' : '–°–ø–∞—Å–∏–±–æ! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥—ë—Ç –Ω–µ —Ç–∞–∫ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ iraburljaeva@gmail.com');
      closeConfirm(); closeBuy(); closePay(); toggleCart(false);
      setCart([]); // –æ—á–∏—Å—Ç–∏–º –∫–æ—Ä–∑–∏–Ω—É
    });

    // ====== COOKIE (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ ‚Äî –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –∑–¥–µ—Å—å) ======
    // –æ—Å—Ç–∞–≤–ª—è—é –ø—É—Å—Ç—ã–º

  </script>
</body>
</html>
