<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PolyTalky ‚Äî –ú–∞–≥–∞–∑–∏–Ω –∫—É—Ä—Å–æ–≤</title>
  <meta name="description" content="–ú–∞–≥–∞–∑–∏–Ω —è–∑—ã–∫–æ–≤—ã—Ö –∫—É—Ä—Å–æ–≤ PolyTalky. –°–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã, —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ –∫—É—Ä—Å—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö —Å –æ–ø–ª–∞—Ç–æ–π –¥–ª—è –†–§ –∏ –∏–∑-–∑–∞ —Ä—É–±–µ–∂–∞." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--brand-1:#FFBA08;--brand-2:#CF2C02}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#fafafa;color:#111}
    .btn-brand{background:var(--brand-1);padding:8px 14px;border-radius:12px;font-weight:700;color:#111;transition:all .2s}
    .btn-brand:hover{background:var(--brand-2);color:#fff}
    .btn-ghost{background:#eee;padding:8px 14px;border-radius:12px}
    .card{transition:transform .25s,box-shadow .25s}
    .card:hover{transform:translateY(-4px);box-shadow:0 8px 16px rgba(0,0,0,.1)}
    .chip{display:inline-block;background:#eee;padding:2px 6px;border-radius:8px;font-size:12px;color:#333}
    .price{font-weight:800}
    .badge{background:#000;color:#fff;border-radius:999px;padding:0 8px;font-size:12px;line-height:22px;height:22px}
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
      <a href="/polytalky/" class="flex items-center gap-2 font-semibold text-lg">üè∑Ô∏è PolyTalky</a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="/polytalky/courses/" class="opacity-80 hover:opacity-100">–ö—É—Ä—Å—ã</a>
        <a href="/polytalky/shop/" class="opacity-100 font-semibold text-[var(--brand-2)]">–ú–∞–≥–∞–∑–∏–Ω</a>
        <a href="/polytalky/student/" class="opacity-80 hover:opacity-100">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      </nav>

      <!-- Cart button -->
      <button id="cartBtn" class="relative btn-ghost">
        –ö–æ—Ä–∑–∏–Ω–∞
        <span id="cartCount" class="badge absolute -right-2 -top-2">0</span>
      </button>
    </div>
  </header>

  <main class="flex-grow">
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <h1 class="text-3xl font-bold mb-2">–ú–∞–≥–∞–∑–∏–Ω –∫—É—Ä—Å–æ–≤ PolyTalky</h1>
      <p class="text-gray-600 mb-10">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã, —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ –∫—É—Ä—Å—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö. –Ø –≤—ã–¥–∞—é —á–µ–∫–∏ ‚Äî —É–∫–∞–∂–∏—Ç–µ email –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏.</p>

      <h2 class="text-2xl font-bold mb-4">üí´ –°–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h2>
      <div id="grid-special" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10"></div>

      <h2 class="text-2xl font-bold mb-4">üéì –ö—É—Ä—Å—ã –ø–æ —è–∑—ã–∫–∞–º</h2>
      <div id="grid-langs" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-200 py-8 text-sm text-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
      <p>¬© 2025 PolyTalky. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      <div class="flex flex-wrap gap-4">
        <a href="/polytalky/contact.html" class="opacity-80 hover:opacity-100">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <a href="/polytalky/legal/privacy.html" class="opacity-80 hover:opacity-100">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        <a href="/polytalky/legal/offer.html" class="opacity-80 hover:opacity-100">–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</a>
        <a href="/polytalky/legal/cookies.html" class="opacity-80 hover:opacity-100">Cookies</a>
        <a href="/polytalky/legal/consent.html" class="opacity-80 hover:opacity-100">–°–æ–≥–ª–∞—Å–∏–µ</a>
      </div>
    </div>
  </footer>

  <!-- Cookie –±–∞–Ω–Ω–µ—Ä -->
  <div id="cookie-banner" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-900 text-white shadow-md rounded-xl px-4 py-3 text-sm flex items-center gap-3 hidden">
    <span>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookies –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞.</span>
    <button id="cookie-accept" class="bg-[var(--brand-1)] text-black px-3 py-1 rounded-lg text-sm">–ü–æ–Ω—è—Ç–Ω–æ</button>
  </div>

  <!-- Product modal (single buy) -->
  <div id="buyModal" class="hidden fixed inset-0 bg-black/60 items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 max-w-lg w-full text-gray-900">
      <h3 class="text-xl font-bold mb-3" id="bm-title">–ö—É—Ä—Å</h3>
      <p class="mb-2 text-gray-600">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="bm-price-rub"></span> / <span id="bm-price-eur"></span></p>
      <div class="mb-4">
        <label class="text-sm text-gray-600">–í–∞—à email –¥–ª—è —á–µ–∫–∞ –∏ –¥–æ—Å—Ç—É–ø–∞</label>
        <input id="bm-email" type="email" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="you@example.com">
      </div>
      <div class="grid sm:grid-cols-2 gap-3">
        <button class="btn-brand w-full" onclick="openPayWindow('ru')">–û–ø–ª–∞—Ç–∞ –¥–ª—è –†–§</button>
        <button class="btn-brand w-full" onclick="openPayWindow('int')">–û–ø–ª–∞—Ç–∞ –∏–∑ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω</button>
      </div>
      <div class="mt-4">
        <button class="w-full bg-gray-200 hover:bg-gray-300 py-2 rounded-lg" onclick="closeBuy()">–û—Ç–º–µ–Ω–∞</button>
      </div>
      <p class="text-xs text-gray-500 mt-3">–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ ¬´–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)¬ª ‚Äî –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, –∞ –ø–∏—Å—å–º–æ —Å–æ —Å–≤–µ–¥–µ–Ω–∏—è–º–∏ –æ–± –æ–ø–ª–∞—Ç–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –≤–∞—à–µ–π –ø–æ—á—Ç–æ–≤–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ.</p>
      <div class="mt-3 flex gap-8">
        <button class="underline text-sm" onclick="iPaid('single')">–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)</button>
        <button class="underline text-sm" onclick="addToCart(currentProduct)">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
      </div>
    </div>
  </div>

  <!-- Cart drawer -->
  <div id="cartDrawer" class="fixed top-0 right-0 h-full w-[360px] max-w-[92vw] bg-white shadow-2xl translate-x-full transition-transform z-50">
    <div class="p-4 border-b flex items-center justify-between">
      <h3 class="text-lg font-bold">–ö–æ—Ä–∑–∏–Ω–∞</h3>
      <button class="text-sm underline" onclick="toggleCart(false)">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="cartList" class="p-4 space-y-3"></div>
    <div class="p-4 border-t">
      <div class="mb-3">
        <label class="text-sm text-gray-600">–í–∞—à email –¥–ª—è —á–µ–∫–∞ –∏ –¥–æ—Å—Ç—É–ø–∞</label>
        <input id="cartEmail" type="email" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="you@example.com">
      </div>
      <div class="flex items-center justify-between mb-3">
        <div class="font-semibold">–ò—Ç–æ–≥–æ: <span id="cartTotalRub">0 ‚ÇΩ</span> / <span id="cartTotalEur">‚Ç¨0</span></div>
      </div>
      <div class="flex gap-2">
        <button class="btn-brand w-1/2" onclick="openCartCheckout('ru')">–û–ø–ª–∞—Ç–∞ –†–§</button>
        <button class="btn-brand w-1/2" onclick="openCartCheckout('int')">–û–ø–ª–∞—Ç–∞ –∏–∑-–∑–∞ —Ä—É–±–µ–∂–∞</button>
      </div>
      <button class="w-full mt-3 bg-gray-200 hover:bg-gray-300 py-2 rounded-lg" onclick="iPaid('cart')">–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞) –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª(–∞) –ø–∏—Å—å–º–æ</button>
    </div>
  </div>

  <!-- Checkout modal (shows QR & links) -->
  <div id="payModal" class="hidden fixed inset-0 bg-black/60 items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 max-w-2xl w-full text-gray-900">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-bold">–û–ø–ª–∞—Ç–∞</h3>
        <button class="text-sm underline" onclick="closePay()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <p class="text-sm text-gray-600 mt-1">–°–Ω–∞—á–∞–ª–∞ —Å–æ–≤–µ—Ä—à–∏—Ç–µ –æ–ø–ª–∞—Ç—É, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ ¬´–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)¬ª ‚Äî –º—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∏ –æ—Ç–ø—Ä–∞–≤–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.</p>

      <div id="tabRU" class="mt-4 hidden">
        <h4 class="font-semibold mb-2">–†–æ—Å—Å–∏—è</h4>
        <div class="grid sm:grid-cols-2 gap-4">
          <div class="p-3 border rounded-xl">
            <div class="font-semibold mb-2">–ÆMoney</div>
            <img src="/polytalky/assets/pay/yoomoney-qr-black.png" alt="–ÆMoney QR" class="w-full rounded-lg mb-2">
            <a id="ymLink" class="btn-brand inline-block" target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å –ÆMoney</a>
            <p class="text-xs text-gray-500 mt-2">–ï—Å–ª–∏ —Å—É–º–º–∞ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∞—Å—å ‚Äî –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é. –°—Å—ã–ª–∫–∞: yoomoney.ru/to/410013183449005</p>
          </div>
          <div class="p-3 border rounded-xl">
            <div class="font-semibold mb-2">–°–ë–ü (QR)</div>
            <img src="/polytalky/assets/pay/sbp-qr-white.png" alt="–°–ë–ü QR" class="w-full rounded-lg mb-2 border">
            <p class="text-xs text-gray-500">–û—Ç–∫—Ä–æ–π—Ç–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–∞–Ω–∫–∞ ‚Üí –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR ‚Üí –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∑–∞–∫–∞–∑–∞.</p>
          </div>
        </div>
      </div>

      <div id="tabINT" class="mt-4 hidden">
        <h4 class="font-semibold mb-2">–î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã</h4>
        <div class="grid sm:grid-cols-2 gap-4">
          <div class="p-3 border rounded-xl">
            <div class="font-semibold mb-2">PayPal</div>
            <img src="/polytalky/assets/pay/paypal-qr.png" alt="PayPal QR" class="w-full rounded-lg mb-2">
            <p class="text-sm">Email: <b>iraburljaeva@gmail.com</b></p>
            <p class="text-xs text-gray-500">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—É–º–º—É –∑–∞–∫–∞–∑–∞ –∫–∞–∫ ¬´Goods & Services¬ª.</p>
          </div>
          <div class="p-3 border rounded-xl">
            <div class="font-semibold mb-2">–õ—é–±–∞—è –∫–∞—Ä—Ç–∞ (Stripe)</div>
            <div id="stripeLinks" class="space-y-2 text-sm"></div>
            <p class="text-xs text-gray-500">–°—É–º–º—ã –ø–æ –ø–æ–∑–∏—Ü–∏—è–º: –æ–ø–ª–∞—Ç–∏—Ç–µ –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫—É—Ä—Å.</p>
          </div>
        </div>
      </div>

      <div class="mt-4 text-right">
        <button class="btn-ghost" onclick="closePay()">–ì–æ—Ç–æ–≤–æ</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- DATA ----------
    const IMG_BASE = '/polytalky/assets/courses/';
    const img = n => IMG_BASE + n;

    // —Å–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã/—á–µ–ª–ª–µ–Ω–¥–∂–∏
    const special = [
      { id:'polyglotpack-mchny', title:'PolyglotPack MCHNY', img:img('mchny.jpg'),
        tag:'SEASONAL', note:'–°—Ç–∞—Ä—Ç 25 –¥–µ–∫–∞–±—Ä—è', priceRub:1490, priceEur:19 },
      { id:'polyglotpack-starter', title:'Polyglot Pack. Starter', img:img('polyglotpack.jpg'),
        tag:'PACK', priceRub:1290, priceEur:15 },
      { id:'cook-it', title:'Polyglot Pack. Cook it!', img:img('cookit.jpg'),
        tag:'PACK', priceRub:1290, priceEur:15 },
      { id:'30days-english', title:'30 Days of English (Challenge)', img:img('30daysofenglish.jpg'),
        tag:'EN', priceRub:990, priceEur:12 },
      { id:'irregular-verbs', title:'Irregular Verbs (Challenge)', img:img('irregularverbs.jpg'),
        tag:'EN', priceRub:790, priceEur:10 },
      { id:'english-translators', title:'–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–æ–≤', img:img('englishtranslate.jpg'),
        tag:'EN', priceRub:1490, priceEur:19 },
    ];

    // –ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã
    const langs = [
      { id:'english-with-harry', title:'English with Harry', img:img('englishwithharry.jpg'),
        tag:'EN', level:'A0‚ÄìA2', priceRub:1490, priceEur:19 },
      { id:'visual-spanish', title:'–í–∏–∑—É–∞–ª—å–Ω—ã–π –∏—Å–ø–∞–Ω—Å–∫–∏–π', img:img('visualspanish.jpg'),
        tag:'ES', level:'A1‚ÄìA2', priceRub:1290, priceEur:15 },
      { id:'italian-songs', title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –ø–æ –ø–µ—Å–Ω—è–º', img:img('italiansongs.jpg'),
        tag:'IT', level:'A1‚ÄìA2', priceRub:1290, priceEur:15 },
      { id:'pro-espanol', title:'Pro Espa√±ol (–æ—Ç –Ω–æ—Å–∏—Ç–µ–ª—è)', img:img('proespanol.jpg'),
        tag:'ES', level:'B1‚ÄìB2', priceRub:1990, priceEur:24 },
      { id:'finnish-travel', title:'–§–∏–Ω—Å–∫–∏–π –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π', img:img('finishtravel.jpg'),
        tag:'FI', level:'A1', priceRub:1290, priceEur:15 },
      { id:'finnish-a2', title:'–§–∏–Ω—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('finisha2.jpg'),
        tag:'FI', level:'A2‚ÄìB1', priceRub:1490, priceEur:19 },
      { id:'german-a2', title:'–ù–µ–º–µ—Ü–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('germana2.jpg'),
        tag:'DE', level:'A2‚ÄìB1', priceRub:1490, priceEur:19 },
      { id:'italian-a2', title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('italiana2.jpg'),
        tag:'IT', level:'A2‚ÄìB1', priceRub:1490, priceEur:19 },
      { id:'afrikaans-a0', title:'–ê—Ñ—Ä–∏–∫–∞–∞–Ω—Å —Å –Ω—É–ª—è', img:img('afrikaans.jpg'),
        tag:'AF', level:'A0', priceRub:990, priceEur:12 },
      { id:'dutch-a2', title:'–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('nederlandsa2.jpg'),
        tag:'NL', level:'A2‚ÄìB1', priceRub:1490, priceEur:19 },
      { id:'swedish-a0', title:'–®–≤–µ–¥—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('swedish.jpg'),
        tag:'SV', level:'A0', priceRub:990, priceEur:12 },
      { id:'lithuanian-a0', title:'–õ–∏—Ç–æ–≤—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('lithuanian.jpg'),
        tag:'LT', level:'A0', priceRub:990, priceEur:12 },
      { id:'romanian-a0', title:'–†—É–º—ã–Ω—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('romanian.jpg'),
        tag:'RO', level:'A0', priceRub:990, priceEur:12 },
    ];

    // Stripe ¬´–ª—é–±–∞—è –∫–∞—Ä—Ç–∞¬ª —Å—Å—ã–ª–∫–∏ –ø–æ —Å—É–º–º–∞–º (EUR)
    const stripeByEur = {
      19: 'https://buy.stripe.com/00w4gybq66YZ1vkcUWb3q0w',
      15: 'https://buy.stripe.com/28E9AS1PwabbfmadZ0b3q0x',
      12: 'https://buy.stripe.com/28E00ifGmabb0rg5sub3q0y',
      10: 'https://buy.stripe.com/fZu6oGbq64QR0rg9IKb3q0z',
      24: 'https://buy.stripe.com/8x214mbq65UVb5UcUWb3q0A'
    };

    // ---------- RENDER ----------
    function fmtRub(n){return new Intl.NumberFormat('ru-RU').format(n)+' ‚ÇΩ'}
    function fmtEur(n){return '‚Ç¨'+n}

    function cardHTML(c){
      const level = c.level ? `<span class="chip">${c.level}</span>` : '';
      const tag = c.tag ? `<span class="chip">${c.tag}</span>` : '';
      return `
        <div class="card rounded-2xl border border-gray-200 bg-white overflow-hidden">
          <img src="${c.img}" alt="${c.title}" class="w-full aspect-[4/3] object-cover">
          <div class="p-4">
            <div class="flex items-center gap-2 mb-1">${tag}${level?` ${level}`:''}</div>
            <h3 class="font-semibold">${c.title}</h3>
            ${c.note ? `<p class="text-xs text-[var(--brand-2)] mt-1">${c.note}</p>` : ''}
            <div class="mt-3 flex items-center justify-between">
              <div class="price">${fmtRub(c.priceRub)} <span class="text-gray-400 text-xs">/ ${fmtEur(c.priceEur)}</span></div>
              <div class="flex gap-2">
                <button class="btn-ghost" onclick='addToCart(${JSON.stringify(c)})'>–í –∫–æ—Ä–∑–∏–Ω—É</button>
                <button class="btn-brand" onclick='openBuy(${JSON.stringify(c)})'>–ö—É–ø–∏—Ç—å</button>
              </div>
            </div>
          </div>
        </div>`;
    }

    document.getElementById('grid-special').innerHTML = special.map(cardHTML).join('');
    document.getElementById('grid-langs').innerHTML = langs.map(cardHTML).join('');

    // ---------- CART ----------
    const CART_KEY='pt_cart';
    const ENROLL_KEY='pt_enrollments';

    function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY)||'[]') }
    function setCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); renderCart() }

    function addToCart(item){
      const cart = getCart();
      if(!cart.find(x=>x.id===item.id)) cart.push(item);
      setCart(cart);
    }
    function removeFromCart(id){
      setCart(getCart().filter(x=>x.id!==id));
    }

    function renderCart(){
      const cart = getCart();
      document.getElementById('cartCount').textContent = cart.length;
      const list = document.getElementById('cartList');
      if(!list) return;
      if(cart.length===0){ list.innerHTML = `<p class="text-sm text-gray-500">–ü—É—Å—Ç–æ. –î–æ–±–∞–≤—å—Ç–µ –∫—É—Ä—Å—ã –≤ –∫–æ—Ä–∑–∏–Ω—É.</p>`; }
      else{
        list.innerHTML = cart.map(c=>`
          <div class="border rounded-xl p-3">
            <div class="flex gap-3">
              <img src="${c.img}" class="w-16 h-16 object-cover rounded-lg" alt="">
              <div class="grow">
                <div class="font-semibold text-sm">${c.title}</div>
                <div class="text-xs text-gray-600">${fmtRub(c.priceRub)} / ${fmtEur(c.priceEur)}</div>
                <button class="text-xs underline mt-1" onclick="removeFromCart('${c.id}')">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            </div>
          </div>`).join('');
      }
      const totalRub = cart.reduce((a,c)=>a+c.priceRub,0);
      const totalEur = cart.reduce((a,c)=>a+c.priceEur,0);
      const tr = document.getElementById('cartTotalRub');
      const te = document.getElementById('cartTotalEur');
      if(tr) tr.textContent = fmtRub(totalRub);
      if(te) te.textContent = '‚Ç¨'+totalEur;
    }

    // drawer toggle
    const drawer = document.getElementById('cartDrawer');
    document.getElementById('cartBtn').onclick = ()=>toggleCart();
    function toggleCart(force){
      const hide = (typeof force==='boolean') ? !force : drawer.classList.contains('translate-x-0');
      drawer.classList.toggle('translate-x-0', !hide);
    }
    renderCart();

    // ---------- SINGLE BUY MODAL ----------
    let currentProduct = null;
    function openBuy(c){
      currentProduct = c;
      document.getElementById('bm-title').textContent = c.title;
      document.getElementById('bm-price-rub').textContent = fmtRub(c.priceRub);
      document.getElementById('bm-price-eur').textContent = fmtEur(c.priceEur);
      const m = document.getElementById('buyModal');
      m.classList.remove('hidden'); m.classList.add('flex');
    }
    function closeBuy(){
      const m = document.getElementById('buyModal');
      m.classList.add('hidden'); m.classList.remove('flex');
    }

    // open payment window
    function openPayWindow(region){
      const email = (document.getElementById('bm-email').value||'').trim();
      if(!email){ alert('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è —á–µ–∫–∞ –∏ –¥–æ—Å—Ç—É–ø–∞.'); return; }
      // —Å–æ—Ö—Ä–∞–Ω—è–µ–º email –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–≥–∏–æ–Ω –Ω–∞ –≤—Ä–µ–º—è
      sessionStorage.setItem('pt_last_email', email);
      const list = [currentProduct]; // single item
      openPay(region, list);
    }

    // ---------- CART CHECKOUT ----------
    function openCartCheckout(region){
      const email = (document.getElementById('cartEmail').value||'').trim();
      if(!email){ alert('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è —á–µ–∫–∞ –∏ –¥–æ—Å—Ç—É–ø–∞.'); return; }
      sessionStorage.setItem('pt_last_email', email);
      const list = getCart();
      if(list.length===0){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
      openPay(region, list);
    }

    // ---------- PAY MODAL (QR & LINKS) ----------
    function openPay(region, items){
      // –∑–∞–ø–æ–º–Ω–∏–º —Å–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø–∏—Å—å–º–∞/–∞–∫—Ç–∏–≤–∞—Ü–∏–∏
      sessionStorage.setItem('pt_last_items', JSON.stringify(items));
      sessionStorage.setItem('pt_last_region', region);

      // RU tab link
      const totalRub = items.reduce((a,c)=>a+c.priceRub,0);
      const ym = document.getElementById('ymLink');
      // —É –ÆMoney —Å—Å—ã–ª–∫–∞ —Å —Å—É–º–º–æ–π –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –ø–æ–ø—Ä–æ–±—É–µ–º:
      ym.href = `https://yoomoney.ru/to/410013183449005/${encodeURIComponent(totalRub)}`;

      // INT tab: –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞–±–æ—Ä Stripe-—Å—Å—ã–ª–æ–∫ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º
      const wrap = document.getElementById('stripeLinks');
      wrap.innerHTML = items.map(c=>{
        const link = stripeByEur[c.priceEur];
        const safeTitle = c.title.replace(/"/g,'&quot;');
        return `<div>
          <a href="${link}" target="_blank" rel="noopener" class="btn-brand inline-block">–û–ø–ª–∞—Ç–∏—Ç—å ¬´${safeTitle}¬ª ‚Äî ${fmtEur(c.priceEur)}</a>
        </div>`;
      }).join('');

      // –ø–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
      document.getElementById('tabRU').classList.toggle('hidden', region!=='ru');
      document.getElementById('tabINT').classList.toggle('hidden', region!=='int');

      const m = document.getElementById('payModal');
      m.classList.remove('hidden'); m.classList.add('flex');
    }
    function closePay(){
      const m = document.getElementById('payModal');
      m.classList.add('hidden'); m.classList.remove('flex');
    }

    // ---------- CONFIRM PAID -> MAILTO + ACCESS ----------
    function iPaid(mode){
      const email = sessionStorage.getItem('pt_last_email') || '';
      const items = JSON.parse(sessionStorage.getItem('pt_last_items')||'[]');
      const region = sessionStorage.getItem('pt_last_region') || 'unknown';
      if(!email || items.length===0){ alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –æ—Ç–∫—Ä—ã—Ç—å –æ–ø–ª–∞—Ç—É.'); return; }

      // 1) –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø (–¥–µ–º–æ) –ª–æ–∫–∞–ª—å–Ω–æ
      const enroll = JSON.parse(localStorage.getItem(ENROLL_KEY)||'{}');
      items.forEach(c => { enroll[c.id] = { access:true, purchasedAt:new Date().toISOString(), channel:region }; });
      localStorage.setItem(ENROLL_KEY, JSON.stringify(enroll));

      // 2) –≥–æ—Ç–æ–≤–∏–º –ø–∏—Å—å–º–æ —á–µ—Ä–µ–∑ mailto
      const listLines = items.map(c => `‚Ä¢ ${c.title} ‚Äî ${fmtRub(c.priceRub)} / ${fmtEur(c.priceEur)}`).join('%0A');
      const sub = encodeURIComponent('PolyTalky: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã');
      const body = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!%0A%0A–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞) —Å–ª–µ–¥—É—é—â–∏–µ –∫—É—Ä—Å—ã:%0A${listLines}%0A%0A–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã: ${region === 'ru' ? '–†–æ—Å—Å–∏—è (–ÆMoney/–°–ë–ü)' : '–î—Ä—É–≥–∞—è —Å—Ç—Ä–∞–Ω–∞ (PayPal/–õ—é–±–∞—è –∫–∞—Ä—Ç–∞)'}%0A–ú–æ–π email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞: ${email}%0A%0A–°–ø–∞—Å–∏–±–æ!`;
      const mailto = `mailto:iraburljaeva@gmail.com?subject=${sub}&body=${body}`;
      window.location.href = mailto;

      alert('–°–ø–∞—Å–∏–±–æ! –î–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ. –ú—ã —Å–≤—è–∂–µ–º—Å—è –ø–æ email –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã.');
      // –∑–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫–∏/–∫–æ—Ä–∑–∏–Ω—É
      closeBuy(); closePay(); toggleCart(false);
      // –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É, –µ—Å–ª–∏ —ç—Ç–æ –±—ã–ª–∞ –æ–ø–ª–∞—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã
      if(mode==='cart') setCart([]);
    }

    // ---------- COOKIE BANNER ----------
    const banner = document.getElementById('cookie-banner');
    if (!localStorage.getItem('cookieConsent')) banner.classList.remove('hidden');
    document.getElementById('cookie-accept').onclick = () => {
      localStorage.setItem('cookieConsent', 'true');
      banner.classList.add('hidden');
    };
  </script>
</body>
</html>
