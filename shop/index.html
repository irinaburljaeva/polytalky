<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PolyTalky ‚Äî –ú–∞–≥–∞–∑–∏–Ω –∫—É—Ä—Å–æ–≤</title>
  <meta name="description" content="–ú–∞–≥–∞–∑–∏–Ω —è–∑—ã–∫–æ–≤—ã—Ö –∫—É—Ä—Å–æ–≤ PolyTalky: —Å–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã, —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ –∫—É—Ä—Å—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö. –û–ø–ª–∞—Ç–∞ –¥–ª—è –†–§ –∏ –∏–∑-–∑–∞ —Ä—É–±–µ–∂–∞." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --brand:#FFBA08; --ink:#0f172a; --ink-2:#334155; --paper:#fff; --bg:#F9FAFB;
      --pastel-1:#FFF4CC; --pastel-2:#F3F4F6;
    }
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--ink)}
    .wrap{max-width:1280px;margin:0 auto}
    .btn{padding:.6rem 1rem;border-radius:1rem;font-weight:800;transition:.2s}
    .btn-brand{background:var(--brand);color:#111}.btn-brand:hover{filter:brightness(.95)}
    .btn-ghost{background:#fff;border:1px solid rgba(0,0,0,.06);color:var(--ink);box-shadow:0 1px 0 rgba(0,0,0,.03)}
    .btn-ghost:hover{background:#fff;box-shadow:0 6px 16px rgba(0,0,0,.06)}
    .card{background:var(--paper);border:1px solid rgba(0,0,0,.06);border-radius:1.25rem;overflow:hidden;
      box-shadow:0 8px 24px rgba(0,0,0,.04); transition:transform .2s, box-shadow .2s}
    .card:hover{transform:translateY(-4px);box-shadow:0 14px 34px rgba(0,0,0,.08)}
    .chip{display:inline-block;background:var(--pastel-2);padding:2px 8px;border-radius:999px;font-size:12px;color:var(--ink-2);font-weight:600}
    .price{font-weight:900}
    header.nav{backdrop-filter:saturate(140%) blur(6px);background:rgba(255,255,255,.7);border-bottom:1px solid rgba(0,0,0,.06)}
    .badge{background:var(--brand);color:#111;border-radius:.6rem;padding:.25rem .5rem;font-weight:800;font-size:.75rem}
    .soft{background:linear-gradient(180deg, rgba(255,186,8,.15), transparent 40%)}
    #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#111;color:#fff;padding:12px 16px;border-radius:12px;opacity:0;pointer-events:none;transition:opacity .2s, transform .2s;z-index:70}
    #toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
    .fly{position:fixed;z-index:80;pointer-events:none;border-radius:12px;box-shadow:0 8px 16px rgba(0,0,0,.18)}
    .modal{background:var(--paper);border:1px solid rgba(0,0,0,.06);box-shadow:0 18px 40px rgba(0,0,0,.18)}
    .divider{height:1px;background:rgba(0,0,0,.08);margin:.9rem 0}
    .list-dot li{position:relative;padding-left:1rem}
    .list-dot li:before{content:'‚Ä¢';position:absolute;left:0;color:var(--brand)}
    .drawer{background:var(--paper);border-left:1px solid rgba(0,0,0,.06);box-shadow:-12px 0 32px rgba(0,0,0,.08)}
    @keyframes bump{0%{transform:scale(1)}30%{transform:scale(1.18)}60%{transform:scale(1)}100%{transform:scale(1)}}
    .bump{animation:bump .4s ease}
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="nav sticky top-0 z-30">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
      <a href="/polytalky/" class="flex items-center gap-2 font-extrabold text-lg text-[var(--ink)]">
        <span class="inline-flex h-9 w-9 rounded-xl bg-[var(--brand)] items-center justify-center">üè∑Ô∏è</span>
        <span>PolyTalky</span>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="/polytalky/courses/" class="opacity-80 hover:opacity-100 text-[var(--ink-2)]">–ö—É—Ä—Å—ã</a>
        <a href="/polytalky/shop/" class="opacity-100 font-semibold text-[var(--ink)]">–ú–∞–≥–∞–∑–∏–Ω</a>
        <a href="/polytalky/student/" class="opacity-80 hover:opacity-100 text-[var(--ink-2)]">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      </nav>
      <button id="cartBtn" class="relative btn btn-ghost">
        üõí –ö–æ—Ä–∑–∏–Ω–∞
        <span id="cartCount" class="absolute -right-2 -top-2 bg-[var(--brand)] text-black rounded-full text-xs font-extrabold px-2 py-0.5">0</span>
      </button>
    </div>
  </header>

  <main class="flex-grow">
    <section class="soft">
      <div class="wrap px-4 sm:px-6 lg:px-8 py-10">
        <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight text-[var(--ink)]">–ú–∞–≥–∞–∑–∏–Ω –∫—É—Ä—Å–æ–≤</h1>
        <p class="text-[var(--ink-2)] mt-2">–í—ã–±–∏—Ä–∞–π—Ç–µ —Å–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã, —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ –∫—É—Ä—Å—ã –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö. –ß–µ–∫–∏ ‚Äî –Ω–∞ email.</p>
      </div>
    </section>

    <section class="wrap px-4 sm:px-6 lg:px-8 py-10">
      <h2 class="text-2xl font-bold mb-4 text-[var(--ink)]">üí´ –°–ø–µ—Ü–ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h2>
      <div id="grid-special" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10"></div>

      <h2 class="text-2xl font-bold mb-4 text-[var(--ink)]">üéì –ö—É—Ä—Å—ã –ø–æ —è–∑—ã–∫–∞–º</h2>
      <div id="grid-langs" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>
  </main>

  <footer class="border-t border-black/5 py-8 text-sm text-[var(--ink-2)] bg-white">
    <div class="wrap px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
      <p>¬© 2025 PolyTalky. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      <div class="flex flex-wrap gap-4">
        <a href="/polytalky/contact.html" class="opacity-80 hover:opacity-100">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <a href="/polytalky/legal/privacy.html" class="opacity-80 hover:opacity-100">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        <a href="/polytalky/legal/offer.html" class="opacity-80 hover:opacity-100">–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</a>
        <a href="/polytalky/legal/cookies.html" class="opacity-80 hover:opacity-100">Cookies</a>
        <a href="/polytalky/legal/consent.html" class="opacity-80 hover:opacity-100">–°–æ–≥–ª–∞—Å–∏–µ</a>
      </div>
    </div>
  </footer>

  <div id="toast">–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É</div>

  <!-- Detail Modal -->
  <div id="detailModal" class="hidden fixed inset-0 bg-black/40 items-center justify-center z-50">
    <div class="modal rounded-2xl p-0 max-w-3xl w-full overflow-hidden">
      <div class="flex items-center justify-between px-6 py-4 border-b border-black/5">
        <h3 id="dm-title" class="text-xl font-extrabold text-[var(--ink)]">–ö—É—Ä—Å</h3>
        <button class="text-sm underline" id="dm-close">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div class="grid md:grid-cols-2 gap-0">
        <div class="p-6">
          <img id="dm-img" src="" alt="" class="w-full rounded-xl border border-black/10">
          <div id="dm-badge" class="mt-3 badge hidden"></div>
        </div>
        <div class="p-6">
          <p id="dm-desc" class="text-[var(--ink-2)]"></p>
          <div class="divider"></div>
          <div class="grid grid-cols-2 gap-3 text-sm">
            <div><span class="text-[var(--ink-2)]">–£—Ä–æ–∫–æ–≤:</span> <b id="dm-lessons">‚Äî</b></div>
            <div><span class="text-[var(--ink-2)]">–£—Ä–æ–≤–µ–Ω—å:</span> <b id="dm-level">‚Äî</b></div>
          </div>
          <div class="mt-4">
            <h4 class="font-semibold mb-2">–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏</h4>
            <ul id="dm-includes" class="list-dot space-y-1 text-sm"></ul>
          </div>
          <div class="mt-4">
            <h4 class="font-semibold mb-2">–ß–µ–º—É –Ω–∞—É—á–∏—Ç–µ—Å—å</h4>
            <ul id="dm-outcomes" class="list-dot space-y-1 text-sm"></ul>
          </div>
          <div class="divider"></div>
          <div class="flex items-center justify-between">
            <div class="price text-lg"><span id="dm-price-rub"></span> <span class="text-[var(--ink-2)] text-xs">/ <span id="dm-price-eur"></span></span></div>
            <div class="flex gap-2">
              <button class="btn btn-ghost" id="dm-add">–í –∫–æ—Ä–∑–∏–Ω—É</button>
              <button class="btn btn-brand" id="dm-buy">–ö—É–ø–∏—Ç—å</button>
            </div>
          </div>
          <p class="text-xs text-[var(--ink-2)] mt-2">–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É—é –¥–æ—Å—Ç—É–ø –≤—Ä—É—á–Ω—É—é –ø–æ email.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Buy Modal -->
  <div id="buyModal" class="hidden fixed inset-0 bg-black/40 items-center justify-center z-50">
    <div class="modal rounded-2xl p-6 max-w-lg w-full">
      <h3 class="text-xl font-extrabold mb-3" id="bm-title">–ö—É—Ä—Å</h3>
      <p class="mb-2 text-[var(--ink-2)]">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="bm-price-rub"></span> / <span id="bm-price-eur"></span></p>
      <div class="mb-4">
        <label class="text-sm text-[var(--ink-2)]">–í–∞—à email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞</label>
        <input id="bm-email" type="email" class="mt-1 w-full bg-white border border-black/10 rounded-lg px-3 py-2" placeholder="you@example.com">
      </div>
      <div class="grid sm:grid-cols-2 gap-3">
        <button class="btn btn-brand w-full" id="bm-ru">–û–ø–ª–∞—Ç–∞ –¥–ª—è –†–§</button>
        <button class="btn btn-brand w-full" id="bm-int">–û–ø–ª–∞—Ç–∞ –∏–∑ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω</button>
      </div>
      <div class="mt-4">
        <button class="w-full btn btn-ghost" id="bm-cancel">–û—Ç–º–µ–Ω–∞</button>
      </div>
      <div class="mt-3 flex gap-8">
        <button class="underline text-sm" id="bm-to-cart">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        <button class="underline text-sm" id="bm-confirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
      </div>
    </div>
  </div>

  <!-- Cart Drawer -->
  <div id="cartDrawer" class="fixed top-0 right-0 h-full w-[360px] max-w-[92vw] drawer translate-x-full transition-transform z-50">
    <div class="p-4 border-b border-black/5 flex items-center justify-between">
      <h3 class="text-lg font-extrabold">–ö–æ—Ä–∑–∏–Ω–∞</h3>
      <button class="text-sm underline" id="cartClose">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="cartList" class="p-4 space-y-3"></div>
    <div class="p-4 border-t border-black/5">
      <div class="mb-3">
        <label class="text-sm text-[var(--ink-2)]">Email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞</label>
        <input id="cartEmail" type="email" class="mt-1 w-full bg-white border border-black/10 rounded-lg px-3 py-2" placeholder="you@example.com">
      </div>
      <div class="flex items-center justify-between mb-3">
        <div class="font-extrabold">–ò—Ç–æ–≥–æ: <span id="cartTotalRub">0 ‚ÇΩ</span> / <span id="cartTotalEur">‚Ç¨0</span></div>
      </div>
      <div class="flex gap-2">
        <button class="btn btn-brand w-1/2" id="cartPayRU">–û–ø–ª–∞—Ç–∞ –†–§</button>
        <button class="btn btn-brand w-1/2" id="cartPayINT">–û–ø–ª–∞—Ç–∞ –∏–∑-–∑–∞ —Ä—É–±–µ–∂–∞</button>
      </div>
      <button class="w-full mt-3 btn btn-ghost" id="cartConfirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
    </div>
  </div>

  <!-- Pay Modal -->
  <div id="payModal" class="hidden fixed inset-0 bg-black/40 items-center justify-center z-50">
    <div class="modal rounded-2xl p-6 max-w-2xl w-full">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-extrabold">–û–ø–ª–∞—Ç–∞</h3>
        <button class="text-sm underline" id="payClose">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <p class="text-sm text-[var(--ink-2)] mt-1">–°–Ω–∞—á–∞–ª–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∏ –≤—ã—à–ª–µ–º —á–µ–∫.</p>

      <div id="tabRU" class="mt-4 hidden">
        <h4 class="font-semibold mb-2">–†–æ—Å—Å–∏—è</h4>
        <div class="grid sm:grid-cols-2 gap-4">
          <div class="p-3 border border-black/10 rounded-xl bg-white">
            <div class="font-semibold mb-2">–ÆMoney</div>
            <img src="/polytalky/assets/pay/yoomoney.jpg" alt="–ÆMoney QR" class="w-full rounded-lg mb-2 border border-black/10">
            <a id="ymLink" class="btn btn-brand inline-block" target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å –ÆMoney</a>
            <p class="text-xs text-[var(--ink-2)] mt-2">–ï—Å–ª–∏ —Å—É–º–º–∞ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∞—Å—å ‚Äî –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é. –°—Å—ã–ª–∫–∞: yoomoney.ru/to/410013183449005</p>
          </div>
          <div class="p-3 border border-black/10 rounded-xl bg-white">
            <div class="font-semibold mb-2">–°–ë–ü (QR)</div>
            <img src="/polytalky/assets/pay/sberbank.png" alt="–°–ë–ü QR" class="w-full rounded-lg mb-2 border border-black/10 bg-white">
            <p class="text-xs text-[var(--ink-2)]">–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–∞–Ω–∫–∞ ‚Üí –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR ‚Üí –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∑–∞–∫–∞–∑–∞.</p>
          </div>
        </div>
      </div>

      <div id="tabINT" class="mt-4 hidden">
        <h4 class="font-semibold mb-2">–î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã</h4>
        <div class="grid sm:grid-cols-2 gap-4">
          <div class="p-3 border border-black/10 rounded-xl bg-white">
            <div class="font-semibold mb-2">PayPal</div>
            <img src="/polytalky/assets/pay/paypal.jpg" alt="PayPal QR" class="w-full rounded-lg mb-2 border border-black/10">
            <p class="text-sm">Email: <b>iraburljaeva@gmail.com</b></p>
            <p class="text-xs text-[var(--ink-2)]">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—É–º–º—É –∑–∞–∫–∞–∑–∞ –∫–∞–∫ ¬´Goods &amp; Services¬ª.</p>
          </div>
          <div class="p-3 border border-black/10 rounded-xl bg-white">
            <div class="font-semibold mb-2">–õ—é–±–∞—è –∫–∞—Ä—Ç–∞</div>
            <div id="stripeLinks" class="space-y-2 text-sm"></div>
            <!-- ‚Üì –ü–æ—è–≤—è—Ç—Å—è QR –ø–æ–¥ –Ω—É–∂–Ω—ã–µ —Ü–µ–Ω—ã -->
            <div id="stripeQrs" class="grid grid-cols-3 gap-2 mt-3"></div>
            <p class="text-xs text-[var(--ink-2)] mt-2">–û–ø–ª–∞—Ç–∏—Ç–µ –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–æ–π/QR —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫—É—Ä—Å. –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –æ–¥–Ω–æ–π —Ü–µ–Ω—ã ‚Äî –æ–ø–ª–∞—Ç—É –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ–¥–Ω–æ–π —Å—É–º–º–æ–π –∏ —É–∫–∞–∑–∞—Ç—å —ç—Ç–æ –≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏.</p>
          </div>
        </div>
      </div>

      <div class="mt-4 text-right">
        <button class="btn btn-ghost" id="payDone">–ì–æ—Ç–æ–≤–æ</button>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div id="confirmModal" class="hidden fixed inset-0 bg-black/40 items-center justify-center z-50">
    <div class="modal rounded-2xl p-6 max-w-lg w-full">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-xl font-extrabold">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã</h3>
        <button class="text-sm underline" id="cf-close">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <form id="confirmForm" class="space-y-3">
        <div>
          <label class="text-sm text-[var(--ink-2)]">Email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞</label>
          <input id="cf-email" name="email" type="email" class="mt-1 w-full bg-white border border-black/10 rounded-lg px-3 py-2" required>
        </div>
        <div>
          <label class="text-sm text-[var(--ink-2)]">–û–ø–ª–∞—á–µ–Ω–æ —á–µ—Ä–µ–∑</label>
          <select id="cf-channel" name="channel" class="mt-1 w-full bg-white border border-black/10 rounded-lg px-3 py-2">
            <option value="ru-yoomoney">–†–æ—Å—Å–∏—è ‚Äî –ÆMoney</option>
            <option value="ru-sbp">–†–æ—Å—Å–∏—è ‚Äî –°–ë–ü</option>
            <option value="int-paypal">–î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã ‚Äî PayPal</option>
            <option value="int-card">–î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã ‚Äî –õ—é–±–∞—è –∫–∞—Ä—Ç–∞</option>
          </select>
        </div>
        <div>
          <label class="text-sm text-[var(--ink-2)]">–ö—É—Ä—Å—ã</label>
          <textarea id="cf-items" name="items" class="mt-1 w-full bg-white border border-black/10 rounded-lg px-3 py-2 text-sm" rows="3" readonly></textarea>
        </div>
        <div>
          <label class="text-sm text-[var(--ink-2)]">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —Ç.–ø.)</label>
          <input id="cf-note" name="note" type="text" class="mt-1 w-full bg-white border border-black/10 rounded-lg px-3 py-2" placeholder="(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        </div>
        <button class="btn btn-brand w-full" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</button>
        <p class="text-xs text-[var(--ink-2)] text-center">–î–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º, —á–µ–∫ –ø—Ä–∏–¥—ë—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email.</p>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ---------- CONFIG ----------
      const FORMSPREE = 'https://formspree.io/f/XXXXYYYY'; // ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π endpoint
      const IMG_BASE = '/polytalky/assets/courses/';
      const img = n => IMG_BASE + n;

      // Stripe —Å—Å—ã–ª–∫–∏ –ø–æ —Ñ–∏–∫—Å. —Ü–µ–Ω–∞–º
      const stripeByEur = {
        19:'https://buy.stripe.com/00w4gybq66YZ1vkcUWb3q0w',
        15:'https://buy.stripe.com/28E9AS1PwabbfmadZ0b3q0x',
        12:'https://buy.stripe.com/28E00ifGmabb0rg5sub3q0y',
        10:'https://buy.stripe.com/fZu6oGbq64QR0rg9IKb3q0z',
        24:'https://buy.stripe.com/8x214mbq65UVb5UcUWb3q0A'
      };
      // Stripe QR –ø–æ —Ñ–∏–∫—Å. —Ü–µ–Ω–∞–º
      const stripeQrByEur = {
        10:'/polytalky/assets/pay/qr10.jpg',
        12:'/polytalky/assets/pay/qr12.jpg',
        15:'/polytalky/assets/pay/qr15.jpg',
        19:'/polytalky/assets/pay/qr19.jpg',
        24:'/polytalky/assets/pay/qr24.jpg'
      };

      // ---------- DATA ----------
      const special = [
        { id:'polyglotpack-mchny', title:'PolyglotPack MCHNY', img:img('mchny.jpg'), tag:'SEASONAL', note:'–°—Ç–∞—Ä—Ç 25 –¥–µ–∫–∞–±—Ä—è', priceRub:1490, priceEur:19,
          lessons:18, level:'A1‚ÄìB1',
          desc:'–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π –Ω–∞–±–æ—Ä: 18 –∫–æ—Ä–æ—Ç–∫–∏—Ö —É—Ä–æ–∫–æ–≤, —Ñ—Ä–∞–∑—ã –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤, –æ—Ç–∫—Ä—ã—Ç–æ–∫, —Ç–æ—Å—Ç–æ–≤ –∏ –ø–ª–∞–Ω–æ–≤ –Ω–∞ –≥–æ–¥.',
          includes:['18 –≤–∏–¥–µ–æ-—É—Ä–æ–∫–æ–≤ –ø–æ 7‚Äì10 –º–∏–Ω—É—Ç','PDF-—Ñ—Ä–∞–∑—ã –∏ –∫–∞—Ä—Ç–æ—á–∫–∏','–ê—É–¥–∏–æ –¥–ª—è –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è','–ú–∏–Ω–∏-–∫–≤–∏–∑—ã'],
          outcomes:['–ì–æ–≤–æ—Ä–∏—Ç—å –æ –ø–ª–∞–Ω–∞—Ö/–∂–µ–ª–∞–Ω–∏—è—Ö','–ü–æ–∑–¥—Ä–∞–≤–ª—è—Ç—å –∏ –æ—Ç–≤–µ—á–∞—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ','–û–±—â–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–µ']
        },
        { id:'polyglotpack-starter', title:'Polyglot Pack. Starter', img:img('polyglotpack.jpg'), tag:'PACK', priceRub:1290, priceEur:15,
          lessons:20, level:'A0‚ÄìA1',
          desc:'–°—Ç–∞—Ä—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä: —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ —Ñ—Ä–∞–∑—ã –∏ —Å–∏—Ç—É–∞—Ü–∏–∏.',
          includes:['20 –º–∏–Ω–∏-—É—Ä–æ–∫–æ–≤','–ö–∞—Ä—Ç–æ—á–∫–∏, –∞—É–¥–∏–æ','PDF-—à–ø–∞—Ä–≥–∞–ª–∫–∏'], outcomes:['–ë—ã—Ç–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏','–£–≤–µ—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞']
        },
        { id:'cook-it', title:'Polyglot Pack. Cook it!', img:img('cookit.jpg'), tag:'PACK', priceRub:1290, priceEur:15,
          lessons:16, level:'A1',
          desc:'–Ø–∑—ã–∫ —á–µ—Ä–µ–∑ —Ä–µ—Ü–µ–ø—Ç—ã: –æ—Ç —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫ –¥–æ —Å–µ—Ä–≤–∏—Ä–æ–≤–∫–∏.',
          includes:['16 –≤–∏–¥–µ–æ','PDF-—Ä–µ—Ü–µ–ø—Ç—ã','–ö–∞—Ä—Ç–æ—á–∫–∏'], outcomes:['–õ–µ–∫—Å–∏–∫–∞ –∫—É—Ö–Ω–∏','–ü—Ä–æ—Å—å–±—ã –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏']
        },
        { id:'30days-english', title:'30 Days of English (Challenge)', img:img('30daysofenglish.jpg'), tag:'EN', priceRub:990, priceEur:12,
          lessons:30, level:'A1‚ÄìA2',
          desc:'30 –¥–Ω–µ–π –∫–æ—Ä–æ—Ç–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.',
          includes:['30 –∑–∞–¥–∞–Ω–∏–π','–ö–∞—Ä—Ç–æ—á–∫–∏/–∞—É–¥–∏–æ','–ö–≤–∏–∑—ã'], outcomes:['–°–∏—Å—Ç–µ–º–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞','–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö —Ñ—Ä–∞–∑']
        },
        { id:'irregular-verbs', title:'Irregular Verbs (Challenge)', img:img('irregularverbs.jpg'), tag:'EN', priceRub:790, priceEur:10,
          lessons:12, level:'A2',
          desc:'–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã —á–µ—Ä–µ–∑ –≥—Ä—É–ø–ø—ã –∏ –º–Ω–µ–º–æ—Ç–µ—Ö–Ω–∏–∫—É.',
          includes:['12 –º–æ–¥—É–ª–µ–π','PDF-—Ç–∞–±–ª–∏—Ü—ã','–¢—Ä–µ–Ω–∞–∂—ë—Ä—ã'], outcomes:['–ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ñ–æ—Ä–º','–£–≤–µ—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ']
        },
        { id:'english-translators', title:'–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–æ–≤', img:img('englishtranslate.jpg'), tag:'EN', priceRub:1490, priceEur:19,
          lessons:14, level:'B1‚ÄìB2',
          desc:'–ü—Ä–∞–∫—Ç–∏–∫—É–º –ø–æ —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–µ, ¬´–ª–æ–∂–Ω—ã–º –¥—Ä—É–∑—å—è–º¬ª –∏ —á–µ–∫-–ª–∏—Å—Ç–∞–º –∫–∞—á–µ—Å—Ç–≤–∞.',
          includes:['14 —É—Ä–æ–∫–æ–≤','–ß–µ–∫-–ª–∏—Å—Ç—ã','–†–∞–∑–±–æ—Ä—ã'], outcomes:['–ß–∏—â–µ –∏ —Ç–æ—á–Ω–µ–µ –ø–µ—Ä–µ–≤–æ–¥—ã','–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–¥–∞—á–µ —Ä–∞–±–æ—Ç']
        },
      ];

      const langs = [
        { id:'english-with-harry', title:'English with Harry', img:img('englishwithharry.jpg'), tag:'EN', level:'A0‚ÄìA2', priceRub:1490, priceEur:19,
          lessons:28, desc:'–ò–≥—Ä–æ–≤–æ–π –∫—É—Ä—Å –ø–æ –º–æ—Ç–∏–≤–∞–º –ª—é–±–∏–º–æ–π –∏—Å—Ç–æ—Ä–∏–∏.',
          includes:['28 —É—Ä–æ–∫–æ–≤','–ö–∞—Ä—Ç–æ—á–∫–∏, –∞—É–¥–∏–æ','PDF-—à–ø–∞—Ä–≥–∞–ª–∫–∏'], outcomes:['–ë—ã—Ç–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏','–ë–∞–∑–∞ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏']
        },
        { id:'visual-spanish', title:'–í–∏–∑—É–∞–ª—å–Ω—ã–π –∏—Å–ø–∞–Ω—Å–∫–∏–π', img:img('visualspanish.jpg'), tag:'ES', level:'A1‚ÄìA2', priceRub:1290, priceEur:15,
          lessons:24, desc:'–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω—ã –¥–ª—è –ª—ë–≥–∫–æ–≥–æ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è.',
          includes:['24 —É—Ä–æ–∫–∞','–ö–∞—Ä—Ç–æ—á–∫–∏/–∞—É–¥–∏–æ'], outcomes:['–õ–µ–∫—Å–∏–∫–∞','–ü—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ –∏ —Ä–∏—Ç–º']
        },
        { id:'italian-songs', title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –ø–æ –ø–µ—Å–Ω—è–º', img:img('italiansongs.jpg'), tag:'IT', level:'A1‚ÄìA2', priceRub:1290, priceEur:15,
          lessons:18, desc:'–•–∏—Ç—ã, –ª–µ–∫—Å–∏–∫–∞, –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞, –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ.',
          includes:['–†–∞–∑–±–æ—Ä—ã –ø–µ—Å–µ–Ω','PDF-—Ç–µ–∫—Å—Ç—ã','–ê—É–¥–∏–æ'], outcomes:['–ü–æ–Ω–∏–º–∞—Ç—å —Ç–µ–∫—Å—Ç—ã','–ì–æ–≤–æ—Ä–∏—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ']
        },
        { id:'pro-espanol', title:'Pro Espa√±ol (–æ—Ç –Ω–æ—Å–∏—Ç–µ–ª—è)', img:img('proespanol.jpg'), tag:'ES', level:'B1‚ÄìB2', priceRub:1990, priceEur:24,
          lessons:20, desc:'–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–µ –æ–±–æ—Ä–æ—Ç—ã.',
          includes:['20 —É—Ä–æ–∫–æ–≤','–ê—É–¥–∏–æ','–î–æ–º–∞—à–Ω–∏–µ'], outcomes:['–°–≤–æ–±–æ–¥–Ω–µ–µ —Ä–µ—á—å','–ù—é–∞–Ω—Å—ã —è–∑—ã–∫–∞']
        },
        { id:'finnish-travel', title:'–§–∏–Ω—Å–∫–∏–π –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π', img:img('finishtravel.jpg'), tag:'FI', level:'A1', priceRub:1290, priceEur:15,
          lessons:16, desc:'–°—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–µ–∑–¥–∫–∏: –∞—ç—Ä–æ–ø–æ—Ä—Ç, –º–∞–≥–∞–∑–∏–Ω, –∫–∞—Ñ–µ.',
          includes:['–ö–∞—Ä—Ç–æ—á–∫–∏ —Ñ—Ä–∞–∑','–î–∏–∞–ª–æ–≥–∏'], outcomes:['–°–ø—Ä–æ—Å–∏—Ç—å/—É—Ç–æ—á–Ω–∏—Ç—å','–ü–æ–Ω–∏–º–∞—Ç—å –æ—Ç–≤–µ—Ç—ã']
        },
        { id:'finnish-a2', title:'–§–∏–Ω—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('finisha2.jpg'), tag:'FI', level:'A2‚ÄìB1', priceRub:1490, priceEur:19,
          lessons:18, desc:'–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ + —Å–ª–æ–≤–∞—Ä—å = –±–æ–ª—å—à–µ –≥–æ–≤–æ—Ä–µ–Ω–∏—è.',
          includes:['18 —É—Ä–æ–∫–æ–≤','–ü—Ä–∞–∫—Ç–∏–∫–∞ —Ä–µ—á–∏'], outcomes:['–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ—Ä–∞–∑','–ê–∫—Ç–∏–≤–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞']
        },
        { id:'german-a2', title:'–ù–µ–º–µ—Ü–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('germana2.jpg'), tag:'DE', level:'A2‚ÄìB1', priceRub:1490, priceEur:19,
          lessons:18, desc:'–ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤, –ø–∞–¥–µ–∂–∏, —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏.',
          includes:['18 —É—Ä–æ–∫–æ–≤','–ö–∞—Ä—Ç–æ—á–∫–∏/–∞—É–¥–∏–æ'], outcomes:['–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –ø–æ—Ä—è–¥–∫–µ —Å–ª–æ–≤','–ë–æ–ª—å—à–µ —Ä–µ—á–∏']
        },
        { id:'italian-a2', title:'–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('italiana2.jpg'), tag:'IT', level:'A2‚ÄìB1', priceRub:1490, priceEur:19,
          lessons:18, desc:'–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ä–µ—á–∏.',
          includes:['18 —É—Ä–æ–∫–æ–≤','–î–∏–∞–ª–æ–≥–∏'], outcomes:['–ì–æ–≤–æ—Ä–∏—Ç—å –±–µ–∑ —Å—Ç—É–ø–æ—Ä–∞','–ü–æ–Ω–∏–º–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ']
        },
        { id:'afrikaans-a0', title:'–ê—Ñ—Ä–∏–∫–∞–∞–Ω—Å —Å –Ω—É–ª—è', img:img('afrikaans.jpg'), tag:'AF', level:'A0', priceRub:990, priceEur:12,
          lessons:12, desc:'–ú—è–≥–∫–∏–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ä–µ–¥–∫–æ–≥–æ —è–∑—ã–∫–∞.',
          includes:['12 —É—Ä–æ–∫–æ–≤','PDF+–∫–∞—Ä—Ç–æ—á–∫–∏'], outcomes:['–ë–∞–∑–∞ —á—Ç–µ–Ω–∏—è','–ú–∏–Ω–∏-–¥–∏–∞–ª–æ–≥–∏']
        },
        { id:'dutch-a2', title:'–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—Å–∫–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö', img:img('nederlandsa2.jpg'), tag:'NL', level:'A2‚ÄìB1', priceRub:1490, priceEur:19,
          lessons:16, desc:'–†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å–∫–∞—á–æ–∫ –¥–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.',
          includes:['16 —É—Ä–æ–∫–æ–≤'], outcomes:['–ë—ã—Ç–æ–≤–∞—è —Ä–µ—á—å','–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π']
        },
        { id:'swedish-a0', title:'–®–≤–µ–¥—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('swedish.jpg'), tag:'SV', level:'A0', priceRub:990, priceEur:12,
          lessons:12, desc:'–§–æ–Ω–µ—Ç–∏–∫–∞, –æ—Å–Ω–æ–≤—ã –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏, –±—ã—Ç–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã.',
          includes:['12 —É—Ä–æ–∫–æ–≤'], outcomes:['–ß–∏—Ç–∞—Ç—å –æ—Å–Ω–æ–≤—ã','–°–ø—Ä–∞—à–∏–≤–∞—Ç—å/–æ—Ç–≤–µ—á–∞—Ç—å']
        },
        { id:'lithuanian-a0', title:'–õ–∏—Ç–æ–≤—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('lithuanian.jpg'), tag:'LT', level:'A0', priceRub:990, priceEur:12,
          lessons:12, desc:'–ó–≤—É–∫ ‚Üí –±—É–∫–≤–∞ ‚Üí —Ñ—Ä–∞–∑–∞.',
          includes:['12 —É—Ä–æ–∫–æ–≤'], outcomes:['–ë–∞–∑–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã','–ú–∏–Ω–∏-–¥–∏–∞–ª–æ–≥–∏']
        },
        { id:'romanian-a0', title:'–†—É–º—ã–Ω—Å–∫–∏–π —Å –Ω—É–ª—è', img:img('romanian.jpg'), tag:'RO', level:'A0', priceRub:990, priceEur:12,
          lessons:12, desc:'–†–æ–º–∞–Ω—Å–∫–∏–π —è–∑—ã–∫ —Å –ø–æ–Ω—è—Ç–Ω–æ–π —Ñ–æ–Ω–µ—Ç–∏–∫–æ–π.',
          includes:['12 —É—Ä–æ–∫–æ–≤'], outcomes:['–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è','–ü—Ä–æ—Å–∏—Ç—å/—Å–ø—Ä–∞—à–∏–≤–∞—Ç—å']
        },
      ];

      // ---------- STATE ----------
      const CART_KEY='pt_cart';
      const ENROLL_KEY='pt_enrollments';
      let currentProduct = null;

      // ---------- HELPERS ----------
      const $special = document.getElementById('grid-special');
      const $langs = document.getElementById('grid-langs');
      function fmtRub(n){return new Intl.NumberFormat('ru-RU').format(n)+' ‚ÇΩ'}
      const toast = (t)=>{ const el=document.getElementById('toast'); el.textContent=t; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),1400) }

      // ---------- RENDER CARDS ----------
      function cardTemplate(c, idx, group){
        const tags = [c.tag && `<span class="chip">${c.tag}</span>`, c.level && `<span class="chip">${c.level}</span>`].filter(Boolean).join(' ');
        const badge = c.note ? `<span class="absolute top-3 right-3 badge">${c.note}</span>` : '';
        return `
          <div class="card relative" data-group="${group}" data-index="${idx}">
            ${badge}
            <button class="w-full text-left js-open-detail" aria-label="–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫—É—Ä—Å–µ">
              <img src="${c.img}" alt="${c.title}" class="w-full aspect-[4/3] object-cover">
              <div class="p-4">
                <div class="flex items-center gap-2 mb-1">${tags}</div>
                <h3 class="font-extrabold">${c.title}</h3>
                <p class="text-[var(--ink-2)] text-sm mt-1 line-clamp-2">${c.desc||''}</p>
              </div>
            </button>
            <div class="px-4 pb-4 -mt-2">
              <div class="flex items-center justify-between">
                <div class="price">${fmtRub(c.priceRub)} <span class="text-[var(--ink-2)] text-xs">/ ‚Ç¨${c.priceEur}</span></div>
                <div class="flex gap-2">
                  <button class="btn btn-ghost js-add">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                  <button class="btn btn-brand js-buy">–ö—É–ø–∏—Ç—å</button>
                </div>
              </div>
            </div>
          </div>`;
      }
      function renderGrids(){
        $special.innerHTML = special.map((c,i)=>cardTemplate(c,i,'special')).join('');
        $langs.innerHTML = langs.map((c,i)=>cardTemplate(c,i,'langs')).join('');
        wireCardEvents();
      }
      function getItemByDataset(el){
        const card = el.closest('.card');
        const group = card.getAttribute('data-group');
        const index = +card.getAttribute('data-index');
        const data = group==='special' ? special : langs;
        return data[index];
      }
      function wireCardEvents(){
        document.querySelectorAll('.js-open-detail').forEach(btn=>{
          btn.addEventListener('click', (e)=>openDetail(getItemByDataset(e.target)));
        });
        document.querySelectorAll('.js-add').forEach(btn=>{
          btn.addEventListener('click', (e)=>addToCart(btn, getItemByDataset(e.target)));
        });
        document.querySelectorAll('.js-buy').forEach(btn=>{
          btn.addEventListener('click', (e)=>openBuy(getItemByDataset(e.target)));
        });
      }
      renderGrids();

      // ---------- CART ----------
      function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY)||'[]') }
      function setCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); renderCart() }
      function bumpCart(){ const b=document.getElementById('cartCount'); b.classList.remove('bump'); void b.offsetWidth; b.classList.add('bump') }
      function flyImgFrom(el){
        try{
          const card = el.closest('.card') || el.closest('button')?.parentElement;
          const imgEl = card?.querySelector('img');
          const cartBtn = document.getElementById('cartBtn');
          if(!imgEl || !cartBtn) return;
          const r1 = imgEl.getBoundingClientRect();
          const r2 = cartBtn.getBoundingClientRect();
          const clone = imgEl.cloneNode(true);
          clone.classList.add('fly');
          clone.style.left = r1.left+'px';
          clone.style.top = r1.top+'px';
          clone.style.width = r1.width+'px';
          clone.style.height = r1.height+'px';
          document.body.appendChild(clone);
          requestAnimationFrame(()=>{
            clone.style.transition = 'all .6s cubic-bezier(.4,0,.2,1)';
            clone.style.left = (r2.left + r2.width/2 - r1.width*0.25)+'px';
            clone.style.top  = (r2.top  + r2.height/2 - r1.height*0.25)+'px';
            clone.style.opacity = '0.2';
            clone.style.transform = 'scale(.5)';
          });
          setTimeout(()=>clone.remove(),650);
        }catch(e){}
      }
      function addToCart(btn, item){
        const cart = getCart();
        if(!cart.find(x=>x.id===item.id)) cart.push(item);
        setCart(cart);
        bumpCart(); toast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É'); if(btn) flyImgFrom(btn);
      }
      function removeFromCart(id){ setCart(getCart().filter(x=>x.id!==id)); }
      function renderCart(){
        const cart = getCart();
        document.getElementById('cartCount').textContent = cart.length;
        const list = document.getElementById('cartList');
        if(!list) return;
        if(cart.length===0){ list.innerHTML = `<p class="text-sm text-[var(--ink-2)]">–ü—É—Å—Ç–æ. –î–æ–±–∞–≤—å—Ç–µ –∫—É—Ä—Å—ã –≤ –∫–æ—Ä–∑–∏–Ω—É.</p>`; }
        else{
          list.innerHTML = cart.map(c=>`
            <div class="border border-black/10 rounded-xl p-3 bg-white">
              <div class="flex gap-3">
                <img src="${c.img}" class="w-16 h-16 object-cover rounded-lg border border-black/10" alt="">
                <div class="grow">
                  <div class="font-extrabold text-sm">${c.title}</div>
                  <div class="text-xs text-[var(--ink-2)]">${fmtRub(c.priceRub)} / ‚Ç¨${c.priceEur}</div>
                  <button class="text-xs underline mt-1" data-rm="${c.id}">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
              </div>
            </div>`).join('');
          list.querySelectorAll('[data-rm]').forEach(b=>b.addEventListener('click', e=>removeFromCart(e.target.getAttribute('data-rm'))));
        }
        const totalRub = cart.reduce((a,c)=>a+c.priceRub,0);
        const totalEur = cart.reduce((a,c)=>a+c.priceEur,0);
        document.getElementById('cartTotalRub')?.textContent = fmtRub(totalRub);
        document.getElementById('cartTotalEur')?.textContent = '‚Ç¨'+totalEur;
      }
      renderCart();

      const drawer = document.getElementById('cartDrawer');
      document.getElementById('cartBtn').addEventListener('click', ()=>toggleCart());
      document.getElementById('cartClose').addEventListener('click', ()=>toggleCart(false));
      function toggleCart(force){
        const hide = (typeof force==='boolean') ? !force : drawer.classList.contains('translate-x-0');
        drawer.classList.toggle('translate-x-0', !hide);
      }

      // ---------- DETAIL ----------
      const $detail = document.getElementById('detailModal');
      const $dmClose = document.getElementById('dm-close');
      const $dmAdd = document.getElementById('dm-add');
      const $dmBuy = document.getElementById('dm-buy');

      let detailProduct = null;
      function openDetail(c){
        detailProduct = c;
        document.getElementById('dm-title').textContent = c.title;
        document.getElementById('dm-img').src = c.img;
        document.getElementById('dm-img').alt = c.title;
        document.getElementById('dm-desc').textContent = c.desc || '–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç.';
        document.getElementById('dm-lessons').textContent = c.lessons ? c.lessons : '‚Äî';
        document.getElementById('dm-level').textContent = c.level || '‚Äî';
        document.getElementById('dm-price-rub').textContent = fmtRub(c.priceRub);
        document.getElementById('dm-price-eur').textContent = '‚Ç¨'+c.priceEur;
        const b = document.getElementById('dm-badge');
        if(c.note){ b.textContent = c.note; b.classList.remove('hidden'); } else { b.classList.add('hidden'); }
        const inc = document.getElementById('dm-includes'); inc.innerHTML = (c.includes||[]).map(s=>`<li>${s}</li>`).join('') || '<li>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∫—É—Ä—Å–∞</li>';
        const out = document.getElementById('dm-outcomes'); out.innerHTML = (c.outcomes||[]).map(s=>`<li>${s}</li>`).join('') || '<li>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</li>';
        $detail.classList.remove('hidden'); $detail.classList.add('flex');
      }
      function closeDetail(){ $detail.classList.add('hidden'); $detail.classList.remove('flex'); }
      $dmClose.addEventListener('click', closeDetail);
      $dmAdd.addEventListener('click', ()=>{ if(!detailProduct) return; addToCart(null, detailProduct); toast('–ö—É—Ä—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É'); });
      $dmBuy.addEventListener('click', ()=>{ if(!detailProduct) return; openBuy(detailProduct); });

      // ---------- BUY/PAY ----------
      const $buy = document.getElementById('buyModal');
      document.getElementById('bm-cancel').addEventListener('click', ()=>{$buy.classList.add('hidden'); $buy.classList.remove('flex');});
      document.getElementById('bm-to-cart').addEventListener('click', ()=>{ if(currentProduct){ addToCart(null,currentProduct); toast('–ö—É—Ä—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É'); } });
      document.getElementById('bm-confirm').addEventListener('click', ()=>openConfirm());

      function openBuy(c){
        currentProduct = c;
        document.getElementById('bm-title').textContent = c.title;
        document.getElementById('bm-price-rub').textContent = fmtRub(c.priceRub);
        document.getElementById('bm-price-eur').textContent = '‚Ç¨'+c.priceEur;
        $buy.classList.remove('hidden'); $buy.classList.add('flex');
      }

      document.getElementById('bm-ru').addEventListener('click', ()=>openPayWindow('ru'));
      document.getElementById('bm-int').addEventListener('click', ()=>openPayWindow('int'));

      function openPayWindow(region){
        const email = (document.getElementById('bm-email').value||'').trim();
        if(!email){ alert('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞.'); return; }
        sessionStorage.setItem('pt_last_email', email);
        const list = [currentProduct];
        openPay(region, list);
      }

      document.getElementById('cartPayRU').addEventListener('click', ()=>openCartCheckout('ru'));
      document.getElementById('cartPayINT').addEventListener('click', ()=>openCartCheckout('int'));

      function openCartCheckout(region){
        const email = (document.getElementById('cartEmail').value||'').trim();
        if(!email){ alert('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏ —á–µ–∫–∞.'); return; }
        sessionStorage.setItem('pt_last_email', email);
        const list = getCart();
        if(list.length===0){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
        openPay(region, list);
      }

      const $pay = document.getElementById('payModal');
      document.getElementById('payClose').addEventListener('click', closePay);
      document.getElementById('payDone').addEventListener('click', closePay);

      function openPay(region, items){
        sessionStorage.setItem('pt_last_items', JSON.stringify(items));
        sessionStorage.setItem('pt_last_region', region);

        // –ÆMoney ‚Äî —Å—É–º–º–∞ –≤—Å–µ—Ö –∫—É—Ä—Å–æ–≤ (–≤ —Ä—É–±.)
        const totalRub = items.reduce((a,c)=>a+c.priceRub,0);
        const ym = document.getElementById('ymLink');
        ym.href = `https://yoomoney.ru/to/410013183449005/${encodeURIComponent(totalRub)}`;

        // Stripe: –∫–Ω–æ–ø–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–æ–≤–∞—Ä—É
        const wrap = document.getElementById('stripeLinks');
        wrap.innerHTML = items.map(c=>{
          const link = (c.priceEur in stripeByEur) ? stripeByEur[c.priceEur] : '#';
          const safeTitle = c.title.replace(/"/g,'&quot;');
          return `<div><a href="${link}" target="_blank" rel="noopener" class="btn btn-brand inline-block">–û–ø–ª–∞—Ç–∏—Ç—å ¬´${safeTitle}¬ª ‚Äî ‚Ç¨${c.priceEur}</a></div>`;
        }).join('');

        // Stripe-QR: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        const qrs = document.getElementById('stripeQrs');
        const uniqPrices = [...new Set(items.map(i=>i.priceEur))];
        qrs.innerHTML = uniqPrices
          .filter(p => stripeQrByEur[p])
          .map(p=>`
            <div class="text-center">
              <img src="${stripeQrByEur[p]}" alt="QR –¥–ª—è ‚Ç¨${p}" class="w-full rounded-lg border border-black/10">
              <div class="text-xs mt-1">‚Ç¨${p}</div>
            </div>
          `).join('');

        document.getElementById('tabRU').classList.toggle('hidden', region!=='ru');
        document.getElementById('tabINT').classList.toggle('hidden', region!=='int');
        $pay.classList.remove('hidden'); $pay.classList.add('flex');
      }
      function closePay(){ $pay.classList.add('hidden'); $pay.classList.remove('flex'); }

      // ---------- CONFIRM ----------
      const $confirm = document.getElementById('confirmModal');
      document.getElementById('cf-close').addEventListener('click', closeConfirm);

      function openConfirm(){
        const email = sessionStorage.getItem('pt_last_email') || document.getElementById('cartEmail')?.value || document.getElementById('bm-email')?.value || '';
        const items = JSON.parse(sessionStorage.getItem('pt_last_items')||'[]');
        const region = sessionStorage.getItem('pt_last_region') || 'ru';
        const cartBack = getCart();
        const list = items.length ? items : cartBack;
        const lines = list.map(c=>`${c.title} ‚Äî ${fmtRub(c.priceRub)} / ‚Ç¨${c.priceEur}`).join('\n');
        document.getElementById('cf-email').value = email;
        document.getElementById('cf-items').value = lines || '(–∫—É—Ä—Å—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã)';
        document.getElementById('cf-channel').value = region==='ru' ? 'ru-yoomoney' : 'int-card';
        $confirm.classList.remove('hidden'); $confirm.classList.add('flex');
      }
      function closeConfirm(){ $confirm.classList.add('hidden'); $confirm.classList.remove('flex'); }

      document.getElementById('confirmForm').addEventListener('submit', async (e)=>{
        e.preventDefault();
        const email = document.getElementById('cf-email').value.trim();
        if(!email){ alert('–£–∫–∞–∂–∏—Ç–µ email'); return; }

        const items = JSON.parse(sessionStorage.getItem('pt_last_items')||'[]');
        const list = items.length ? items : getCart();

        // –õ–æ–∫–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫—É—Ä—Å–æ–≤
        const enroll = JSON.parse(localStorage.getItem(ENROLL_KEY)||'{}');
        list.forEach(c=>{ enroll[c.id] = {access:true, purchasedAt:new Date().toISOString(), channel:document.getElementById('cf-channel').value} })
        localStorage.setItem(ENROLL_KEY, JSON.stringify(enroll));

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
        let ok=false;
        try{
          if(FORMSPREE && /formspree\.io\/f\//.test(FORMSPREE)){
            const payload = {
              email,
              channel: document.getElementById('cf-channel').value,
              items: document.getElementById('cf-items').value,
              note: document.getElementById('cf-note').value || ''
            };
            const res = await fetch(FORMSPREE, {method:'POST', headers:{'Content-Type':'application/json','Accept':'application/json'}, body:JSON.stringify(payload)});
            ok = res.ok;
          }
        }catch(_){}

        toast(ok ? '–°–ø–∞—Å–∏–±–æ! –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ üëç' : '–°–ø–∞—Å–∏–±–æ! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥—ë—Ç –Ω–µ —Ç–∞–∫ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ iraburljaeva@gmail.com');
        closeConfirm(); closePay(); toggleCart(false);
        setCart([]);
      });

      // –∫–Ω–æ–ø–∫–∏ –≤ —à–∞–ø–∫–µ –∫–æ—Ä–∑–∏–Ω—ã
      document.getElementById('cartConfirm').addEventListener('click', ()=>openConfirm());
    });
  </script>
</body>
</html>
