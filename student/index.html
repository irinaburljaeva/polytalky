<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PolyTalky ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <meta name="description" content="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç PolyTalky: –≤–∞—à–∏ –∫—É—Ä—Å—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- —Ñ–∞–≤–∏–∫–æ–Ω -->
  <link rel="icon" type="image/jpg" href="/assets/favicon.jpg">
  <link rel="apple-touch-icon" href="/favicon.png">
  <style>
    :root{
      --brand-1:#FFBA08;
      --brand-2:#F97316;
      --brand-3:#10B981;

      --ink-1:#0F172A;
      --ink-2:#4B5563;
      --ink-soft:#9CA3AF;
      --bg-soft:#F9FAFB;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(circle at top left,#FEF9C3 0,#FEFCE8 40%,#F9FAFB 100%);
      color:#0f172a;
    }
    .wrap{max-width:1040px;margin:0 auto;}
    .card{
      border-radius:1.25rem;
      border:1px solid rgba(15,23,42,.08);
      background-color:rgba(255,255,255,.96);
      box-shadow:0 18px 45px rgba(15,23,42,.08);
    }
    .soft-card{
      border-radius:1rem;
      border:1px solid rgba(148,163,184,.18);
      background:rgba(255,255,255,.9);
    }
    .badge{
      border-radius:.6rem;
      padding:.25rem .45rem;
      font-size:.7rem;
      border: none !important;
      background:rgba(248,250,252,.7);
    }
    .btn{
      border-radius:999px;
      padding:.55rem 1.2rem;
      font-size:.88rem;
      font-weight:600;
      border:1px solid transparent;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.4rem;
      white-space:nowrap;
    }
    .btn-main{
      background:linear-gradient(135deg,var(--brand-2),var(--brand-1));
      color:#111827;
      -color:rgba(251,191,36,0.9);
      box-shadow:0 12px 30px rgba(234,179,8,.45);
    }
    .btn-main:hover{filter:brightness(1.03);}
    .btn-ghost{
      background:rgba(255,255,255,.7);
      border-color:rgba(148,163,184,.5);
      color:#374151;
    }
    .btn-ghost:hover{background:white;}
    .pill-label{
      border-radius:999px;
      padding:.18rem .6rem;
      font-size:.7rem;
      text-transform:uppercase;
      letter-spacing:.06em;
      border:1px solid rgba(148,163,184,.5);
      background:rgba(249,250,251,.9);
      color:#4b5563;
    }
    .hp-field{
      position:absolute;
      left:-9999px;
      opacity:0;
      pointer-events:none;
      height:0;width:0;
    }

    /* PRO-banners */
    .pro-banner{
      max-width:1040px;
      margin:0 auto 0;
      padding:10px 14px;
      border-radius:14px;
      display:none;
      align-items:flex-start;
      gap:10px;
      font-size:13px;
    }
    .pro-banner__icon{
      flex:0 0 28px;
      height:28px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      font-weight:600;
    }
    .pro-banner__body h2{
      margin:0 0 2px;
      font-size:14px;
      font-weight:600;
    }
    .pro-banner__body p{
      margin:0;
      font-size:13px;
    }
    .pro-banner--success{
      :1px solid rgba(16,185,129,.4);
      background:linear-gradient(135deg,#ecfdf5,#f0fdf4,#ffffff);
      color:#065f46;
    }
    .pro-banner--success .pro-banner__icon{
      background:#22c55e;
      color:#ecfdf5;
      box-shadow:0 0 0 2px #bbf7d0;
    }
    .pro-banner--error{
      :1px solid rgba(248,113,113,.4);
      background:linear-gradient(135deg,#fef2f2,#fee2e2,#ffffff);
      color:#b91c1c;
    }
    .pro-banner--error .pro-banner__icon{
      background:#ef4444;
      color:#fef2f2;
      box-shadow:0 0 0 2px #fecaca;
    }
    .pro-banner--cancel{
      :1px solid rgba(148,163,184,.4);
      background:linear-gradient(135deg,#f9fafb,#e5e7eb,#ffffff);
      color:#374151;
    }
    .pro-banner--cancel .pro-banner__icon{
      background:#6b7280;
      color:#f9fafb;
      box-shadow:0 0 0 2px #e5e7eb;
    }
    .pro-banner__btn{
      margin-left:auto;
      -radius:999px;
      padding:6px 14px;
      :none;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
      background:#0f172a;
      color:#f9fafb;
      white-space:nowrap;
    }
    .pro-banner__btn:hover{background:#111827;}
    @media (max-width:640px){
      .pro-banner{
        margin:0 1rem;
        flex-direction:column;
        align-items:flex-start;
      }
      .pro-banner__btn{
        margin-left:0;
        margin-top:6px;
      }
     /* --- –ú–æ–±–∏–ª—å–Ω–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–∞ --- */
    @media (max-width: 640px) {
      /* —á—É—Ç—å –º–µ–Ω—å—à–µ —Ç–µ–Ω–∏ –∏ –∑–∞–∫—Ä—É–≥–ª–µ–Ω–∏—è —É –∫–∞—Ä—Ç –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ */
      .card{
        border-radius: 1rem;
        box-shadow: 0 10px 24px rgba(15,23,42,0.14);
      }

      /* –æ–±—â–∏–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä–∏—Ç–º –ø–æ–º–µ–Ω—å—à–µ */
      .page-stack-mobile{
        padding-top: 1rem;
        padding-bottom: 2.5rem;
        row-gap: 1.25rem;
      }

      /* –¥–ª–∏–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä—è—á–µ–º –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ */
      .mobile-desc{
        display: none;
      }
    }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- HEADER -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 -b border-slate-200/60">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between gap-4">
      <a href="/" class="flex items-center gap-2">
        <div class="h-9 w-9 rounded-2xl overflow-hidden bg-white shadow-md flex items-center justify-center">
          <img src="/assets/logo.png" alt="PolyTalky" class="h-full w-full object-cover">
        </div>
        <span class="font-semibold text-slate-900 text-lg">PolyTalky</span>
      </a>
      <nav class="hidden sm:flex items-center gap-5 text-sm text-slate-700">
        <a href="/courses/" class="hover:text-slate-900">–ö—É—Ä—Å—ã</a>
        <a href="/shop/" class="hover:text-slate-900">–ú–∞–≥–∞–∑–∏–Ω</a>
        <span class="font-semibold text-slate-900">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span>
      </nav>
    </div>
  </header>

  <main class="flex-1">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-6 sm:py-10 space-y-6 page-stack-mobile">

      <!-- PRO STATUS BANNERS -->
      <section id="pro-banner-success" class="pro-banner pro-banner--success">
        <div class="pro-banner__icon">‚úì</div>
        <div class="pro-banner__body">
          <h2>–ü–æ–¥–ø–∏—Å–∫–∞ PRO –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</h2>
          <p>–¢–µ–ø–µ—Ä—å –≤–∞—à–∏ –∑–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –∫—É—Ä–∞—Ç–æ—Ä–∞–º–∏, –∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –æ—Ç–≤–µ—Ç–∞—Ö –∏ –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –ø—Ä–æ–≥—Ä–µ—Å—Å—É.</p>
        </div>
      </section>

      <section id="pro-banner-error" class="pro-banner pro-banner--error">
        <div class="pro-banner__icon">!</div>
        <div class="pro-banner__body">
          <h2>–û–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞</h2>
          <p>–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ PRO. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã.</p>
        </div>
      </section>

      <section id="pro-banner-cancel" class="pro-banner pro-banner--cancel">
        <div class="pro-banner__icon">‚èπ</div>
        <div class="pro-banner__body">
          <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ</h2>
          <p>–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –µ—ë –∑–∞–≤–µ—Ä—à–∏—Ç—å, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –æ—Ç–º–µ–Ω—É.</p>
        </div>
        <button type="button" id="pro-cancel-button" class="pro-banner__btn">
          –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
        </button>
      </section>

      <!-- HERO / AUTH CARD -->
      <section class="card p-5 sm:p-7 space-y-5">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-5">
          <div class="space-y-2 max-w-xl">
            <p class="text-xs font-semibold tracking-[.2em] uppercase text-amber-700">
              –í–∞—à —É–≥–æ–ª–æ–∫ –≤ PolyTalky
            </p>
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">
              –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç <span class="text-amber-600">—è–∑—ã–∫–æ–≤–æ–≥–æ –≥–µ—Ä–æ—è</span>
            </h1>
            <p class="text-sm sm:text-base text-slate-600 mobile-desc">
              –ó–¥–µ—Å—å –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ –∫—É—Ä—Å—ã, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ—é –ª–∏—á–Ω—É—é –∫–∞—Ä—Ç—É –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ –º–∏—Ä–µ —è–∑—ã–∫–æ–≤.
            </p>
          </div>
          <div class="w-full max-w-sm mx-auto">
            <div id="auth-when-logged-out" class="space-y-4">
              <div class="soft-card p-4 space-y-3">
                <p class="text-xs font-semibold text-slate-700 uppercase tracking-[.18em]">
                  –í–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç
                </p>
                <p class="text-sm text-slate-600">
                  –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—Ç –∂–µ email, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∑—ã–≤–∞–ª–∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫—É—Ä—Å–æ–≤ –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ PolyTalky.
                </p>
                <p class="text-xs text-slate-500">
                  –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –º—ã –ø–æ–∫–∞–∂–µ–º –≤—Å–µ –≤–∞—à–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
                </p>
              </div>
              <form id="auth-form" class="space-y-3">
                <div>
                  <label for="auth-email" class="block text-xs font-medium text-slate-600 mb-1">
                    Email
                  </label>
                  <input
                    id="auth-email"
                    type="email"
                    autocomplete="email"
                    required
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                    placeholder="you@example.com"
                  />
                </div>
                <div>
                  <label for="auth-pass" class="block text-xs font-medium text-slate-600 mb-1">
                    –ü–∞—Ä–æ–ª—å
                  </label>
                  <input
                    id="auth-pass"
                    type="password"
                    autocomplete="current-password"
                    required
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                    placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤"
                  />
                </div>

                <!-- honeypot -->
                <input id="auth-website" type="text" class="hp-field" autocomplete="off" />

                <div id="auth-extra" class="space-y-3 hidden">
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                      <label for="auth-first" class="block text-xs font-medium text-slate-600 mb-1">
                        –ò–º—è
                      </label>
                      <input
                        id="auth-first"
                        type="text"
                        class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ê–Ω–Ω–∞"
                      />
                    </div>
                    <div>
                      <label for="auth-last" class="block text-xs font-medium text-slate-600 mb-1">
                        –§–∞–º–∏–ª–∏—è
                      </label>
                      <input
                        id="auth-last"
                        type="text"
                        class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                        placeholder="–§–∞–º–∏–ª–∏—è (–∏–ª–∏ –Ω–∏–∫)"
                      />
                    </div>
                  </div>
                  <p class="text-[1–æ—Ç–æ1px] text-slate-500">
                    –ó–∞–ø–æ–ª–Ω–∏—Ç–µ, —á—Ç–æ–±—ã –º—ã –∑–Ω–∞–ª–∏, –∫–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è
                  </p>
                </div>
<div class="space-y-2 text-[11px] text-slate-500">
                  <label class="flex items-start gap-2">
                    <input
                      id="auth-accept-terms"
                      type="checkbox"
                      class="mt-0.5 h-3 w-3 flex-shrink-0"
                      required
                    >
                    <span>
                      –°–æ–∑–¥–∞–≤–∞—è –∞–∫–∫–∞—É–Ω—Ç, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ –æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å –∏
                      —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å
                      <a href="/legal/terms.html" class="underline">–£—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>,
                      <a href="/legal/privacy.html" class="underline">–ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>,
                      <a href="/legal/cookies.html" class="underline">–ü–æ–ª–∏—Ç–∏–∫–æ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cookies</a>
                      –∏
                      <a href="/legal/consent.html" class="underline">–°–æ–≥–ª–∞—Å–∏–µ–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a>.
                    </span>
                  </label>
                </div>

                <p id="auth-error" class="text-xs text-red-500 min-h-[1rem]"></p>
                <p id="auth-error" class="text-xs text-red-500 min-h-[1rem]"></p>

                <div class="flex flex-col sm:flex-row gap-2 pt-1">
                  <button id="btn-login" type="submit" class="btn btn-main flex-1 justify-center text-sm">
                    –í–æ–π—Ç–∏
                  </button>
                  <button id="auth-register" type="button" class="btn btn-ghost flex-1 justify-center text-sm">
                    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                  </button>
                </div>
              </form>
            </div>

            <div id="auth-when-logged-in" class="hidden space-y-4">
              <div class="soft-card p-4 space-y-3">
                <p class="text-xs font-semibold text-slate-700 uppercase tracking-[.18em]">
                  –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
                </p>
                <div class="flex items-center gap-3">
                  <div class="h-10 w-10 rounded-full overflow-hidden bg-slate-200 flex-shrink-0 cursor-pointer" id="profile-avatar-wrapper">
                    <!-- –î–ï–§–û–õ–¢: –¥–µ–≤–æ—á–∫–∞ -->
                    <img id="profile-avatar-img" src="/assets/avatarf.png" alt="Avatar" class="h-full w-full object-cover">
                  </div>
                  <div class="min-w-0">
                    <p id="profile-name" class="text-sm font-semibold text-slate-900 truncate">
                      ...
                    </p>
                    <p id="auth-user-email" class="text-xs text-slate-500 truncate">
                      ...
                    </p>
                  </div>
                </div>
                <p class="text-xs text-slate-500">
                  –≠—Ç–æ –≤–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç PolyTalky. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫—É—Ä—Å–∞–º–∏, –≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å–æ–±–∏—Ä–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
                </p>
              </div>

              <div class="flex flex-col sm:flex-row gap-2">
                <button id="btn-open-profile" class="btn btn-ghost flex-1 text-xs sm:text-sm">
                  –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
                </button>
                <button id="auth-logout" class="btn btn-main flex-1 text-xs sm:text-sm">
                  –í—ã–π—Ç–∏
                </button>
              </div>

              <!-- –ö–û–ò–ù–´ (–ø–æ—Å–ª–µ –∫–Ω–æ–ø–æ–∫) -->
              <div id="coins-card" class="soft-card p-3 sm:p-4 space-y-2 hidden">
                <div class="flex items-center justify-between gap-2">
                  <div class="flex items-center gap-2">
                    <div class="h-7 w-7 rounded-full bg-amber-50 border border-amber-200 flex items-center justify-center overflow-hidden">
                      <img
                        src="/assets/coin.png"
                        alt="–ö–æ–∏–Ω PolyTalky"
                        class="h-6 w-6 object-contain"
                      />
                    </div>
                    <div>
                      <p class="text-xs font-semibold text-slate-700 uppercase tracking-[.18em]">
                        –í–∞—à–∏ –∫–æ–∏–Ω—ã
                      </p>
                      <p class="text-sm text-slate-900">
                        –ë–∞–ª–∞–Ω—Å: <span id="coins-balance">0</span>
                      </p>
                    </div>
                  </div>
                </div>
                <p id="coins-text" class="text-[11px] text-slate-600">
                  –ó–∞—Ö–æ–¥–∏—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –±–æ–ª—å—à–µ –∫–æ–∏–Ω–æ–≤ –∏ –º–µ–Ω—è—Ç—å –∏—Ö –Ω–∞ –±–æ–Ω—É—Å—ã.
                </p>
                <button id="coins-claim-btn" class="btn btn-main w-full text-xs sm:text-sm">
                  –ó–∞–±—Ä–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- –ö–£–†–°–´ + –î–û–°–¢–ò–ñ–ï–ù–ò–Ø: –î–í–ï –ö–û–õ–û–ù–ö–ò –ù–ê –î–ï–°–ö–¢–û–ü–ï -->
      <section class="grid gap-6 lg:grid-cols-[minmax(0,3fr)_minmax(0,2fr)] items-start">
        <!-- –ö–£–†–°–´ (–õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê) -->
        <div class="space-y-3">
          <div class="flex items-center justify-between gap-3">
            <div class="space-y-1">
              <p class="pill-label">–í–∞—à–∏ –∫—É—Ä—Å—ã</p>
              <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
                –í—Å–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –∫—É—Ä—Å—ã
              </h2>
              <p class="text-xs sm:text-sm text-slate-600 mobile-desc">
                –ó–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω—ã –∫—É—Ä—Å—ã, –∫—É–ø–ª–µ–Ω–Ω—ã–µ –≤ <a href="/shop/" class="underline">–º–∞–≥–∞–∑–∏–Ω–µ</a>, –∞ —Ç–∞–∫–∂–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã –ø—Ä–æ—à–ª–∏ —Ö–æ—Ç—è –±—ã –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫.
              </p>
            </div>
          </div>

          <div id="courses-need-auth" class="soft-card p-4 text-xs sm:text-sm text-slate-600">
            –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –∫—É—Ä—Å–æ–≤ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å.
          </div>

          <div id="courses-empty" class="soft-card p-4 text-xs sm:text-sm text-slate-600 hidden">
            –ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ. –ó–∞–≥–ª—è–Ω–∏—Ç–µ –≤
            <a href="/shop/" class="underline">–º–∞–≥–∞–∑–∏–Ω</a>, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å, –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö
            <a href="/courses/" class="underline">–º–∏–Ω–∏-–∫—É—Ä—Å–æ–≤</a>.
          </div>

          <div id="courses-list" class="grid gap-3 sm:gap-4 md:grid-cols-2">
            <!-- –∫–∞—Ä—Ç–æ—á–∫–∏ –∫—É—Ä—Å–æ–≤ -->
          </div>
        </div>

        <!-- –î–û–°–¢–ò–ñ–ï–ù–ò–Ø (–ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê) -->
        <div class="space-y-3">
          <div class="space-y-1">
            <p class="pill-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</p>
            <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
              –ë–µ–π–¥–∂–∏, –º–µ–¥–∞–ª–∏ –∏ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã
            </h2>
            <p class="text-xs sm:text-sm text-slate-600 mobile-desc">
           –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–∞—à–∏ –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –æ—Å–æ–±—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –°–º–æ–∂–µ—Ç–µ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ?
            </p>
          </div>
          <div id="achievements-list" class="grid gap-3 sm:gap-4">
            <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –º–µ–¥–∞–ª–∏ (–∏–∫–æ–Ω–∫–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö) -->
          </div>
        </div>
      </section>

      <!-- –ú–û–î–ê–õ–ö–ê –ö–û–õ–õ–ï–ö–¶–ò–ò –ú–ï–î–ê–õ–ï–ô -->
      <div
        id="badges-modal"
        class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden items-center justify-center z-40"
      >
        <div class="card max-w-2xl w-full mx-4 p-4 sm:p-6 space-y-4">
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-xs font-semibold tracking-[.18em] uppercase text-amber-700">
                –ö–æ–ª–ª–µ–∫—Ü–∏—è –º–µ–¥–∞–ª–µ–π
              </p>
      
              <p class="text-xs sm:text-sm text-slate-600">
              –í—Å–µ –≤–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ PolyTalky
              </p>
            </div>
            <button
              id="badges-modal-close"
              class="text-slate-400 hover:text-slate-600 text-xl leading-none"
            >
              √ó
            </button>
          </div>

          <div class="grid gap-3 sm:grid-cols-[minmax(0,2fr)_minmax(0,1.6fr)] items-start">
            <div
              id="badges-modal-grid"
              class="grid grid-cols-4 sm:grid-cols-5 gap-2 sm:gap-3 text-center text-[10px] sm:text-xs"
            >
              <!-- –≤—Å–µ –º–µ–¥–∞–ª–∏ (–ø–æ–ª–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è) -->
            </div>
            <div
              id="badges-modal-detail"
              class="soft-card p-3 sm:p-4 text-xs sm:text-sm text-slate-700"
            >
              <p class="font-semibold mb-1">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–¥–∞–ª—å</p>
              <p>
                –ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –Ω–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –ª—é–±—É—é –º–µ–¥–∞–ª—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∑–∞ —á—Ç–æ –æ–Ω–∞ –¥–∞—ë—Ç—Å—è.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- –ù–ê–°–¢–†–û–ô–ö–ò –ü–†–û–§–ò–õ–Ø (–º–æ–¥–∞–ª–∫–∞) -->
      <div id="profile-settings" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden items-center justify-center z-40">
        <div class="card max-w-md w-full mx-4 p-5 sm:p-6 space-y-4">
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-xs font-semibold tracking-[.18em] uppercase text-amber-700">
                –ü—Ä–æ—Ñ–∏–ª—å
              </p>
              <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
              </h2>
              <p class="text-xs sm:text-sm text-slate-600">
                –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à –æ–ø—ã—Ç –∏, –≤ –±—É–¥—É—â–µ–º, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±–æ–ª–µ–µ –Ω–∞–≥–ª—è–¥–Ω–æ.
              </p>
            </div>
            <button id="btn-close-profile" class="text-slate-400 hover:text-slate-600 text-xl leading-none">
              √ó
            </button>
          </div>

          <form id="profile-form" class="space-y-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label for="profile-first" class="block text-xs font-medium text-slate-600 mb-1">
                  –ò–º—è
                </label>
                <input
                  id="profile-first"
                  name="firstName"
                  type="text"
                  class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ê–Ω–Ω–∞"
                />
              </div>
              <div>
                <label for="profile-last" class="block text-xs font-medium text-slate-600 mb-1">
                  –§–∞–º–∏–ª–∏—è
                </label>
                <input
                  id="profile-last"
                  name="lastName"
                  type="text"
                  class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                  placeholder="–§–∞–º–∏–ª–∏—è (–∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º)"
                />
              </div>
            </div>

            <div>
              <label class="block text-xs font-medium text-slate-600 mb-1">
                –ê–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ–∏–ª—è
              </label>
              <p class="text-[11px] text-slate-500 mb-2">
                –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤ PolyTalky.
              </p>
              <div class="flex gap-2">
                <!-- –î–µ–≤–æ—á–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
                <button
                  type="button"
                  class="avatar-choice rounded-xl overflow-hidden border border-slate-200 bg-white p-1 ring-2 ring-amber-400"
                  data-avatar-type="girl"
                >
                  <img src="/assets/avatarf.png" alt="–ê–≤–∞—Ç–∞—Ä –¥–µ–≤–æ—á–∫–∞" class="h-10 w-10 object-cover rounded-lg">
                </button>
                <button
                  type="button"
                  class="avatar-choice rounded-xl overflow-hidden border border-slate-200 bg-white p-1"
                  data-avatar-type="boy"
                >
                  <img src="/assets/avatar.png" alt="–ê–≤–∞—Ç–∞—Ä –º–∞–ª—å—á–∏–∫" class="h-10 w-10 object-cover rounded-lg">
                </button>
              </div>
              <!-- —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ -->
              <input type="hidden" id="profile-avatar-type" value="girl">
            </div>

            <p id="profile-msg" class="text-xs text-slate-500 min-h-[1rem]"></p>

            <div class="flex items-center justify-end gap-2 pt-2">
              <button type="button" id="btn-cancel-profile" class="btn btn-ghost text-xs sm:text-sm">
                –û—Ç–º–µ–Ω–∞
              </button>
              <button type="submit" class="btn btn-main text-xs sm:text-sm">
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤ -->
      <div
        id="avatar-preview-modal"
        class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden items-center justify-center z-50"
      >
        <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 max-w-xs w-full mx-4 text-center">
          <img
            id="avatar-preview-img"
            src="/assets/avatarf.png"
            alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∞"
            class="mx-auto h-32 w-32 sm:h-40 sm:w-40 rounded-2xl object-contain mb-3"
          />
          <button
            type="button"
            id="avatar-preview-close"
            class="btn btn-ghost text-xs sm:text-sm"
          >
            –ó–∞–∫—Ä—ã—Ç—å
          </button>
        </div>
      </div>

      <!-- COIN MODAL -->
      <div id="coin-modal" class="hidden fixed inset-0 bg-black/40 items-center justify-center z-40">
        <div class="card max-w-xs w-full mx-6 p-6 text-center space-y-3">
          <img
            src="/assets/coin.png"
            alt="PolyTalky-–∫–æ–∏–Ω"
            class="mx-auto mb-2 w-24 h-24"
          >
          <h3 class="text-lg font-extrabold mb-1">PolyTalky-–∫–æ–∏–Ω—ã</h3>
          <p class="text-sm text-[var(--ink-2)]">
            –ó–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞—Ö–æ–¥—ã –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–∏–Ω—ã. –°–∫–æ—Ä–æ –∏—Ö –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ–±–º–µ–Ω—è—Ç—å –Ω–∞ –ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.
          </p>
          <p class="text-xs text-slate-500 mt-1">
            –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: <span id="coin-modal-balance">0</span> –∫–æ–∏–Ω–æ–≤.
          </p>
          <button
            id="coin-modal-close"
            type="button"
            class="btn btn-ghost px-4 py-2 mt-2"
          >
            –ü–æ–Ω—è—Ç–Ω–æ
          </button>
        </div>
      </div>

      <!-- COOKIE-BANNER -->
      <div id="cookie-banner" class="fixed bottom-3 inset-x-0 flex justify-center z-50 hidden">
        <div class="soft-card px-4 py-3 flex flex-col sm:flex-row items-start sm:items-center gap-2 text-xs sm:text-sm text-slate-700 max-w-xl mx-4">
          <p class="flex-1">
            –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—É–∫–∏, —á—Ç–æ–±—ã –≤–∞—à–∏ –ª–æ–≥–∏–Ω—ã –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å–∞–º —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è. –ü—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∞–π—Ç–æ–º, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å
            <a href="/privacy/" class="underline">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.
          </p>
          <button id="cookie-accept" class="btn btn-main text-xs sm:text-sm">
            –•–æ—Ä–æ—à–æ
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer class="border-t border-slate-200/70 bg-white/80">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row items-center justify-between gap-3 text-[11px] sm:text-xs text-slate-500">
      <p>¬© PolyTalky. –ö—É—Ä—Å—ã –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–æ–ª–∏–≥–ª–æ—Ç–æ–≤.</p>
      <p class="flex items-center gap-3">
        <a href="/contact/" class="hover:text-slate-700">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <span class="hidden sm:inline text-slate-400">‚Ä¢</span>
        <a href="/legal/" class="hover:text-slate-700">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</a>
      </p>
    </div>
  </footer>

  <!-- Firebase + –ª–æ–≥–∏–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–∞ -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBAU_uMTePpKwVNZNhqk2pss2PuSitGfQI",
      authDomain: "polytalky-70999.firebaseapp.com",
      projectId: "polytalky-70999",
      storageBucket: "polytalky-70999.firebasestorage.app",
      messagingSenderId: "62407152289",
      appId: "1:62407152289:web:b0c0efdb2472f12b10d6e0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();

    const COURSE_META = {
      'spanish-a1-basics': {
        title: '–ò—Å–ø–∞–Ω—Å–∫–∏–π A1: –ë–∞–∑–æ–≤—ã–π —Å—Ç–∞—Ä—Ç',
        href: '/courses/spanish-a1-basics/',
        cover: '/assets/courses/spanish-a1.jpg'
      },
      'spanish-verbs-mini': {
        title: '–ú–∏–Ω–∏-–∫—É—Ä—Å: –ò—Å–ø–∞–Ω—Å–∫–∏–µ –≥–ª–∞–≥–æ–ª—ã',
        href: '/courses/spanish-verbs-mini/',
        cover: '/assets/courses/spanish-verbs.jpg'
      },
      'english-intro': {
        title: '–ò–Ω—Ç–µ–Ω—Å–∏–≤ –ø–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É',
        href: '/courses/english-intro/',
        cover: '/assets/courses/english.jpg'
      }
    };
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const authBoxOut      = document.getElementById('auth-when-logged-out');
      const authBoxIn       = document.getElementById('auth-when-logged-in');
      const authEmailEl     = document.getElementById('auth-email');
      const authPassEl      = document.getElementById('auth-pass');
      const authFirstEl     = document.getElementById('auth-first');
      const authLastEl      = document.getElementById('auth-last');
      const honeypotEl      = document.getElementById('auth-website');
      const authForm        = document.getElementById('auth-form');
      const authRegister    = document.getElementById('auth-register');
      const btnLogin        = document.getElementById('btn-login');
      const authError       = document.getElementById('auth-error');
      const authLogout      = document.getElementById('auth-logout');
      const authUserEmail   = document.getElementById('auth-user-email');
      const authExtra       = document.getElementById('auth-extra');
      const authAcceptTerms = document.getElementById('auth-accept-terms');

      const profileAvatarWrapper = document.getElementById('profile-avatar-wrapper');
      const profileAvatarImg= document.getElementById('profile-avatar-img');
      const profileName     = document.getElementById('profile-name');
      const profileSettings = document.getElementById('profile-settings');
      const profileForm     = document.getElementById('profile-form');
      const profileFirst    = document.getElementById('profile-first');
      const profileLast     = document.getElementById('profile-last');
      const profileMsg      = document.getElementById('profile-msg');
      const profileAvatarType = document.getElementById('profile-avatar-type');
      const avatarChoiceButtons = document.querySelectorAll('.avatar-choice');

      const avatarPreviewModal = document.getElementById('avatar-preview-modal');
      const avatarPreviewImg   = document.getElementById('avatar-preview-img');
      const avatarPreviewClose = document.getElementById('avatar-preview-close');
      
      const coursesNeedAuth = document.getElementById('courses-need-auth');
      const coursesList     = document.getElementById('courses-list');
      const coursesEmpty    = document.getElementById('courses-empty');
      const achievementsList= document.getElementById('achievements-list');

      const badgesModal       = document.getElementById('badges-modal');
      const badgesModalClose  = document.getElementById('badges-modal-close');
      const badgesModalGrid   = document.getElementById('badges-modal-grid');
      const badgesModalDetail = document.getElementById('badges-modal-detail');

      const cookieBanner    = document.getElementById('cookie-banner');
      const cookieAccept    = document.getElementById('cookie-accept');

      const proBannerSuccess = document.getElementById('pro-banner-success');
      const proBannerError   = document.getElementById('pro-banner-error');
      const proBannerCancel  = document.getElementById('pro-banner-cancel');
      const proCancelButton  = document.getElementById('pro-cancel-button');

      // –ö–û–ò–ù–´: —ç–ª–µ–º–µ–Ω—Ç—ã
      const coinsCard       = document.getElementById('coins-card');
      const coinsBalanceEl  = document.getElementById('coins-balance');
      const coinsTextEl     = document.getElementById('coins-text');
      const coinsClaimBtn   = document.getElementById('coins-claim-btn');

      // –ú–æ–¥–∞–ª–∫–∞ –∫–æ–∏–Ω–æ–≤
      const coinModal       = document.getElementById('coin-modal');
      const coinModalClose  = document.getElementById('coin-modal-close');
      const coinModalBalance= document.getElementById('coin-modal-balance');

      // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–∏–Ω–æ–≤ –≤ –ø–∞–º—è—Ç–∏
      let coinsState = {
        balance: 0,
        streak: 0,
        lastDate: null,
        alreadyClaimedToday: false,
        mode: null,       // 'daily' | 'wheel'
        nextReward: 0
      };

      // –ö—ç—à –≤—Å–µ—Ö –º–µ–¥–∞–ª–µ–π
      let allBadgesCache = [];

      function todayStr() {
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${y}-${m}-${day}`;
      }

      function pluralizeCoin(n) {
        n = Math.abs(n) % 100;
        const n1 = n % 10;
        if (n > 10 && n < 20) return "–∫–æ–∏–Ω–æ–≤";
        if (n1 === 1) return "–∫–æ–∏–Ω";
        if (n1 >= 2 && n1 <= 4) return "–∫–æ–∏–Ω–∞";
        return "–∫–æ–∏–Ω–æ–≤";
      }

      /* PRO –ø–∞—Ä–∞–º–µ—Ç—Ä */
      (function handleProParam() {
        const params = new URLSearchParams(window.location.search);
        const pro = params.get('pro');
        if (!pro) return;

        if (pro === 'success' && proBannerSuccess) {
          proBannerSuccess.style.display = 'flex';
        } else if (pro === 'error' && proBannerError) {
          proBannerError.style.display = 'flex';
        } else if (pro === 'cancel' && proBannerCancel) {
          proBannerCancel.style.display = 'flex';
        }

        params.delete('pro');
        const newSearch = params.toString();
        const newUrl = window.location.pathname + (newSearch ? '?' + newSearch : '') + window.location.hash;
        window.history.replaceState({}, '', newUrl);
      })();

      if (proCancelButton) {
        proCancelButton.addEventListener('click', () => {
          alert('–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É PRO, –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞ –ø–æ—á—Ç—É hello@polytalky.ru ‚Äî –º—ã –ø–æ–º–æ–∂–µ–º –≤—Å—ë –æ—Ñ–æ—Ä–º–∏—Ç—å.');
        });
      }

      /* cookie */
      if (!localStorage.getItem('cookieConsent')) {
        cookieBanner.classList.remove('hidden');
      }
      cookieAccept.addEventListener('click', () => {
        localStorage.setItem('cookieConsent', 'true');
        cookieBanner.classList.add('hidden');
      });

      /* –º–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
      function openProfileModal(){
        profileSettings.classList.remove('hidden');
        profileSettings.classList.add('flex');
      }
      function closeProfileModal(){
        profileSettings.classList.add('hidden');
        profileSettings.classList.remove('flex');
      }
      document.getElementById('btn-open-profile')?.addEventListener('click', openProfileModal);
      document.getElementById('btn-close-profile')?.addEventListener('click', closeProfileModal);
      document.getElementById('btn-cancel-profile')?.addEventListener('click', (e)=>{
        e.preventDefault();
        closeProfileModal();
      });
      profileSettings.addEventListener('click', (e)=>{
        if (e.target === profileSettings) closeProfileModal();
      });

      /* –≤—ã–±–æ—Ä –±–∞–∑–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ */
      function setAvatarChoice(type) {
        if (!profileAvatarType) return;
        const t = type || 'girl';
        profileAvatarType.value = t;

        avatarChoiceButtons.forEach((btn) => {
          const bt = btn.getAttribute('data-avatar-type');
          if (bt === t) {
            btn.classList.add('ring-2','ring-amber-400');
          } else {
            btn.classList.remove('ring-2','ring-amber-400');
          }
        });

        // –æ–±–Ω–æ–≤–ª—è–µ–º –º–∞–ª–µ–Ω—å–∫–∏–π –∞–≤–∞—Ç–∞—Ä –≤ –∫–∞–±–∏–Ω–µ—Ç–µ
        if (profileAvatarImg) {
          profileAvatarImg.src = t === 'girl'
            ? '/assets/avatarf.png'
            : '/assets/avatar.png';
        }
      }

      // –ö–ª–∏–∫ –ø–æ –≤—ã–±–æ—Ä—É –∞–≤–∞—Ç–∞—Ä–∞ –≤–Ω—É—Ç—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
      avatarChoiceButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const t = btn.getAttribute('data-avatar-type') || 'girl';
          setAvatarChoice(t);

          const src = t === 'girl'
            ? '/assets/avatarf.png'
            : '/assets/avatar.png';

          // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º
          if (avatarPreviewModal && avatarPreviewImg) {
            avatarPreviewImg.src = src;
            avatarPreviewModal.classList.remove('hidden');
            avatarPreviewModal.classList.add('flex');
          }
        });
      });

      // –ö–ª–∏–∫ –ø–æ –∞–≤–∞—Ç–∞—Ä—É –≤ –±–ª–æ–∫–µ "–í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã"
      if (profileAvatarWrapper && avatarPreviewModal && avatarPreviewImg) {
        profileAvatarWrapper.addEventListener('click', () => {
          const t = profileAvatarType ? (profileAvatarType.value || 'girl') : 'girl';
          const src = t === 'girl'
            ? '/assets/avatarf.png'
            : '/assets/avatar.png';
          avatarPreviewImg.src = src;
          avatarPreviewModal.classList.remove('hidden');
          avatarPreviewModal.classList.add('flex');
        });
      }

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞
      if (avatarPreviewModal) {
        avatarPreviewModal.addEventListener('click', (e) => {
          if (e.target === avatarPreviewModal) {
            avatarPreviewModal.classList.add('hidden');
            avatarPreviewModal.classList.remove('flex');
          }
        });
      }
      if (avatarPreviewClose && avatarPreviewModal) {
        avatarPreviewClose.addEventListener('click', () => {
          avatarPreviewModal.classList.add('hidden');
          avatarPreviewModal.classList.remove('flex');
        });
      }

      /* –ö–û–ò–ù–´: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
      function updateCoinsUI(userData) {
        if (!coinsCard || !coinsBalanceEl || !coinsTextEl || !coinsClaimBtn) return;

        const balance = typeof userData.coinsBalance === 'number' ? userData.coinsBalance : 0;
        const streak  = typeof userData.coinStreak   === 'number' ? userData.coinStreak   : 0;
        const last    = userData.lastCoinDate || null;
        const today   = todayStr();
        const already = (last === today);

        coinsState.balance = balance;
        coinsState.streak  = streak;
        coinsState.lastDate= last;
        coinsState.alreadyClaimedToday = already;
        coinsState.mode = null;
        coinsState.nextReward = 0;

        coinsCard.classList.remove('hidden');
        coinsBalanceEl.textContent = balance;
        if (coinModalBalance) {
          coinModalBalance.textContent = balance;
        }

        coinsClaimBtn.disabled = false;
        coinsClaimBtn.classList.remove('opacity-60','cursor-default');

        if (already) {
          coinsTextEl.textContent = '–ë–æ–Ω—É—Å –∑–∞ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ –ø–æ–ª—É—á–µ–Ω, –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞ üíõ';
          coinsClaimBtn.textContent = '–ë–æ–Ω—É—Å —É–∂–µ –∑–∞–±—Ä–∞–Ω';
          coinsClaimBtn.disabled = true;
          coinsClaimBtn.classList.add('opacity-60','cursor-default');
          coinsState.mode = null;
          return;
        }

        // –ï—â—ë –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ –±–æ–Ω—É—Å —Å–µ–≥–æ–¥–Ω—è
        if (streak >= 6) {
          // 7-–π –¥–µ–Ω—å: –∫–æ–ª–µ—Å–æ —É–¥–∞—á–∏
          coinsTextEl.textContent = '–°–µ–≥–æ–¥–Ω—è 7-–π –¥–µ–Ω—å –ø–æ–¥—Ä—è–¥! –†–∞—Å–∫—Ä—É—Ç–∏—Ç–µ –∫–æ–ª–µ—Å–æ —É–¥–∞—á–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –µ—â—ë –±–æ–ª—å—à–µ –∫–æ–∏–Ω–æ–≤.';
          coinsClaimBtn.textContent = '–ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ üé°';
          coinsState.mode = 'wheel';
          coinsState.nextReward = 0;
        } else {
          // –û–±—ã—á–Ω—ã–π –¥–µ–Ω—å: 1‚Äì6 –∫–æ–∏–Ω–æ–≤
          const reward = Math.min(streak + 1, 6);
          coinsState.mode = 'daily';
          coinsState.nextReward = reward;

          if (streak === 0 && balance === 0) {
            coinsTextEl.textContent = '–°–µ–≥–æ–¥–Ω—è –ø–æ–ª—É—á–∏—Ç–µ 1 –∫–æ–∏–Ω –∑–∞ –≤—Ö–æ–¥. –ö–æ–∏–Ω—ã ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≤–∞–ª—é—Ç–∞ PolyTalky. –°–∫–æ—Ä–æ –∏—Ö –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ–±–º–µ–Ω—è—Ç—å –Ω–∞ –ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã, –∞–≤–∞—Ç–∞—Ä—ã –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.';
          } else {
            coinsTextEl.textContent = `–°–µ–≥–æ–¥–Ω—è –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å ${reward} ${pluralizeCoin(reward)} –∑–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤—Ö–æ–¥. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∑–∞—Ö–æ–¥–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –¥–æ–π—Ç–∏ –¥–æ –∫–æ–ª–µ—Å–∞ —É–¥–∞—á–∏!`;
          }
          coinsClaimBtn.textContent = `–ó–∞–±—Ä–∞—Ç—å ${reward} ${pluralizeCoin(reward)}`;
        }
      }

      // –ö–û–ò–ù–´: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ ¬´–∑–∞–±—Ä–∞—Ç—å¬ª
      if (coinsClaimBtn) {
        coinsClaimBtn.addEventListener('click', async () => {
          const user = auth.currentUser;
          if (!user) {
            alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∫–æ–∏–Ω—ã.');
            return;
          }
          if (coinsState.alreadyClaimedToday) {
            return;
          }
          if (!coinsState.mode) {
            return;
          }

          const email = user.email;
          if (!email) {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.');
            return;
          }

          const docRef = db.collection('users').doc(email);
          const today  = todayStr();

          coinsClaimBtn.disabled = true;
          coinsClaimBtn.textContent = '–ü–æ–¥–æ–∂–¥–∏—Ç–µ...';
          coinsClaimBtn.classList.add('opacity-60','cursor-default');

          try {
            if (coinsState.mode === 'daily') {
              const reward = coinsState.nextReward || 1;
              const newBalance = coinsState.balance + reward;
              const newStreak  = Math.min(coinsState.streak + 1, 6);

              await docRef.set({
                coinsBalance: newBalance,
                coinStreak: newStreak,
                lastCoinDate: today
              }, { merge: true });

              coinsState.balance = newBalance;
              coinsState.streak  = newStreak;
              coinsState.lastDate= today;
              coinsState.alreadyClaimedToday = true;

              updateCoinsUI({
                coinsBalance: newBalance,
                coinStreak: newStreak,
                lastCoinDate: today
              });
              coinsTextEl.textContent = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${reward} ${pluralizeCoin(reward)} –∑–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –≤—Ö–æ–¥. –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –∑–∞—Ö–æ–¥–∏—Ç–µ! üíõ`;
            } else if (coinsState.mode === 'wheel') {
              const wheelPrizes = [
                { label: '5 –∫–æ–∏–Ω–æ–≤',  coins: 5 },
                { label: '10 –∫–æ–∏–Ω–æ–≤', coins: 10 },
                { label: '15 –∫–æ–∏–Ω–æ–≤', coins: 15 },
                { label: '20 –∫–æ–∏–Ω–æ–≤', coins: 20 }
              ];
              const i = Math.floor(Math.random() * wheelPrizes.length);
              const prize = wheelPrizes[i];
              const newBalance = coinsState.balance + prize.coins;

              await docRef.set({
                coinsBalance: newBalance,
                coinStreak: 0, // –Ω–æ–≤—ã–π —Ü–∏–∫–ª
                lastCoinDate: today
              }, { merge: true });

              coinsState.balance = newBalance;
              coinsState.streak  = 0;
              coinsState.lastDate= today;
              coinsState.alreadyClaimedToday = true;

              updateCoinsUI({
                coinsBalance: newBalance,
                coinStreak: 0,
                lastCoinDate: today
              });
              coinsTextEl.textContent = `–ö–æ–ª–µ—Å–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –Ω–∞: ${prize.label}! –≠—Ç–∏ –∫–æ–∏–Ω—ã —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à —Å—á—ë—Ç ü™ô`;
            }
          } catch (err) {
            console.error('coins error', err);
            coinsTextEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–¥–∞—Ç—å –±–æ–Ω—É—Å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
            coinsClaimBtn.disabled = false;
            coinsClaimBtn.classList.remove('opacity-60','cursor-default');
            coinsClaimBtn.textContent = '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å';
          }
        });
      }

      // –ö–ª–∏–∫ –ø–æ –º–∞–ª–µ–Ω—å–∫–æ–º—É –∫–æ–∏–Ω—É ‚Üí –º–æ–¥–∞–ª–∫–∞ —Å –±–æ–ª—å—à–∏–º
      (function setupCoinModal() {
        const coinImgSmall =
          document.querySelector('#coins-card img[src="/assets/coin.png"]') ||
          document.querySelector('#coins-card img');

        if (!coinImgSmall || !coinModal || !coinModalClose) return;

        coinImgSmall.classList.add('transition-transform','duration-200','cursor-pointer');

        const openCoinModal = () => {
          if (coinModalBalance) {
            coinModalBalance.textContent = coinsBalanceEl ? coinsBalanceEl.textContent : coinsState.balance;
          }
          coinModal.classList.remove('hidden');
          coinModal.classList.add('flex');

          // –ª—ë–≥–∫–∏–π ¬´–±–∞–º–ø¬ª –º–∞–ª–µ–Ω—å–∫–æ–π –∏–∫–æ–Ω–∫–∏
          coinImgSmall.classList.add('scale-110');
          setTimeout(() => {
            coinImgSmall.classList.remove('scale-110');
          }, 180);
        };

        const closeCoinModal = () => {
          coinModal.classList.add('hidden');
          coinModal.classList.remove('flex');
        };

        coinImgSmall.addEventListener('click', openCoinModal);
        coinModalClose.addEventListener('click', closeCoinModal);
        coinModal.addEventListener('click', (e) => {
          if (e.target === coinModal) closeCoinModal();
        });
      })();

      /* –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
      function showAuthError(code){
        let msg = '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
        if (code === 'auth/user-not-found') {
          msg = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è.';
        } else if (code === 'auth/wrong-password') {
          msg = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Å–±—Ä–æ—Å–æ–º –ø–∞—Ä–æ–ª—è.';
        } else if (code === 'auth/email-already-in-use') {
          msg = '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏.';
        } else if (code === 'auth/weak-password') {
          msg = '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π. –î–æ–±–∞–≤—å—Ç–µ –µ—â—ë —Å–∏–º–≤–æ–ª–æ–≤.';
        }
        authError.textContent = msg;
      }

      let registerMode = false;

      /* –≤—Ö–æ–¥ */
      authForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        authError.textContent = '';

        if (honeypotEl.value && honeypotEl.value.trim() !== '') {
          authError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
          return;
        }

        try {
          const email = authEmailEl.value.trim();
          const pass  = authPassEl.value.trim();
          await auth.signInWithEmailAndPassword(email, pass);
        } catch (err) {
          console.error(err);
          showAuthError(err.code);
        }
      });

      /* —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è */
      authRegister.addEventListener('click', async () => {
        authError.textContent = '';

        if (honeypotEl.value && honeypotEl.value.trim() !== '') {
          authError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
          return;
        }
if (!authAcceptTerms.checked) {
          authError.textContent =
            '–ß—Ç–æ–±—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É –æ —Å–æ–≥–ª–∞—Å–∏–∏ —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏ –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.';
          return;
        }
        if (!registerMode) {
          registerMode = true;
          authExtra.classList.remove('hidden');
          authError.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª.';
          return;
        }

        try {
          const email = authEmailEl.value.trim();
          const pass  = authPassEl.value.trim();
          const first = authFirstEl.value.trim();
          const last  = authLastEl.value.trim();

          if (!email || !pass){
            authError.textContent = '–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å.';
            return;
          }

          const cred = await auth.createUserWithEmailAndPassword(email, pass);
          const user = cred.user;
          if (user) {
            await db.collection('users').doc(email).set({
              email,
              firstName:first || null,
              lastName:last || null,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge:true });
          }
        } catch (err) {
          console.error(err);
          showAuthError(err.code);
        }
      });

      /* –≤—ã—Ö–æ–¥ */
      authLogout?.addEventListener('click', async () => {
        await auth.signOut();
      });

      /* –ê—á–∏–≤–∫–∏: –ø–æ–º–æ—â—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ */

      function openBadgesModal(initialBadgeId) {
        if (!badgesModal || !badgesModalGrid) return;
        badgesModal.classList.remove('hidden');
        badgesModal.classList.add('flex');

        if (initialBadgeId && allBadgesCache.length) {
          const b = allBadgesCache.find(x => x.id === initialBadgeId);
          if (b) {
            showBadgeDetail(b);
            highlightSelectedBadge(b.id);
          }
        }
      }

      function closeBadgesModal() {
        if (!badgesModal) return;
        badgesModal.classList.add('hidden');
        badgesModal.classList.remove('flex');
      }

      if (badgesModalClose) {
        badgesModalClose.addEventListener('click', closeBadgesModal);
      }
      if (badgesModal) {
        badgesModal.addEventListener('click', (e) => {
          if (e.target === badgesModal) {
            closeBadgesModal();
          }
        });
      }

      function highlightSelectedBadge(badgeId) {
        if (!badgesModalGrid) return;
        const buttons = badgesModalGrid.querySelectorAll('button[data-badge-id]');
        buttons.forEach(btn => {
          if (btn.dataset.badgeId === badgeId) {
            btn.classList.add('ring-2','ring-amber-400');
          } else {
            btn.classList.remove('ring-2','ring-amber-400');
          }
        });
      }

      function showBadgeDetail(badge) {
        if (!badgesModalDetail) return;
        const earnedText = badge.earned
          ? `<span class="inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-50 border border-emerald-200 text-[10px] text-emerald-700 font-semibold">–ü–æ–ª—É—á–µ–Ω–æ</span>`
          : `<span class="inline-flex items-center px-2 py-0.5 rounded-full bg-slate-50 border border-slate-200 text-[10px] text-slate-500 font-semibold">–ï—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ</span>`;

        const desc = badge.earned
          ? (badge.desc || '–í—ã —É–∂–µ –ø–æ–ª—É—á–∏–ª–∏ —ç—Ç—É –º–µ–¥–∞–ª—å.')
          : '???';

        const imgSrc = badge.earned
          ? `/assets/badges/${badge.id}.png`
          : '/assets/badges/medalunknown.png';

        badgesModalDetail.innerHTML = `
          <div class="flex items-center gap-3 mb-2">
            <div class="h-10 w-10 sm:h-12 sm:w-12 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center">
              <img src="${imgSrc}" alt="${badge.title}" class="h-full w-full object-contain" />
            </div>
            <div class="min-w-0">
              <p class="text-sm sm:text-base font-semibold text-slate-900 mb-0.5">
                ${badge.earned ? badge.title : '–≠—Ç–∞ –º–µ–¥–∞–ª—å –µ—â—ë –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞'}
              </p>
              ${earnedText}
            </div>
          </div>
          <p class="text-xs sm:text-sm text-slate-700">
            ${desc}
          </p>
        `;
      }

      function renderBadgesModalGrid(badges) {
        if (!badgesModalGrid) return;
        badgesModalGrid.innerHTML = '';

        badges.forEach(badge => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.dataset.badgeId = badge.id;
          btn.className =
            'flex flex-col items-center gap-1 p-1 rounded-lg border border-slate-200 bg-white/80 hover:shadow-sm transition ' +
            (badge.earned ? '' : 'opacity-70');

          const imgSrc = badge.earned
            ? `/assets/badges/${badge.id}.png`
            : '/assets/badges/medalunknown.png';

          btn.innerHTML = `
            <div class="h-10 w-10 sm:h-12 sm:w-12 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center">
              <img src="${imgSrc}" alt="${badge.title}" class="h-full w-full object-contain" />
            </div>
            <span class="block text-[10px] sm:text-[11px] text-slate-700 truncate max-w-[72px]">
              ${badge.earned ? badge.title : '???'}
            </span>
          `;

          const select = () => {
            highlightSelectedBadge(badge.id);
            showBadgeDetail(badge);
          };

          btn.addEventListener('click', select);
          btn.addEventListener('mouseenter', select);

          badgesModalGrid.appendChild(btn);
        });

        // –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—É—é –ø–æ–ª—É—á–µ–Ω–Ω—É—é –º–µ–¥–∞–ª—å
        const firstEarned = badges.find(b => b.earned);
        if (firstEarned) {
          showBadgeDetail(firstEarned);
          highlightSelectedBadge(firstEarned.id);
        }
      }

      function renderEarnedBadgesStrip(badges) {
  if (!achievementsList) return;

  const earned = badges.filter(b => b.earned);

  achievementsList.innerHTML = `
    <div class="soft-card p-3 sm:p-4 space-y-2">
      <div class="flex flex-wrap items-center gap-2">
        <!-- —Å–∞–º–∏ –±–µ–π–¥–∂–∏ -->
        <div id="earned-badges-grid" class="flex flex-wrap gap-2 flex-1"></div>

        <!-- –∫–Ω–æ–ø–∫–∞: —Å–ø—Ä–∞–≤–∞ –æ—Ç –±–µ–π–¥–∂–µ–π, –∞ –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –º–µ—Å—Ç–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –≤–Ω–∏–∑ -->
        <button
          type="button"
          id="open-badges-modal-desktop"
          class="hidden sm:inline-flex btn btn-ghost text-[11px] sm:text-xs px-3 py-1 ml-auto"
        >
          –û—Ç–∫—Ä—ã—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é
        </button>
      </div>

      <!-- –º–æ–±–∏–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞, –∫–∞–∫ –∏ –±—ã–ª–∞ -->
      <button
        type="button"
        id="open-badges-modal-mobile"
        class="sm:hidden w-full btn btn-ghost text-xs mt-1"
      >
        –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é
      </button>
    </div>
  `;

  const grid = document.getElementById('earned-badges-grid');
  const openDesktop = document.getElementById('open-badges-modal-desktop');
  const openMobile  = document.getElementById('open-badges-modal-mobile');

  if (!earned.length) {
    grid.innerHTML = `
      <p class="text-xs sm:text-sm text-slate-500">
        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –º–µ–¥–∞–ª–µ–π. –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —É—Ä–æ–∫–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è ‚Äî –ø–µ—Ä–≤—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –ø–æ—è–≤—è—Ç—Å—è –æ—á–µ–Ω—å —Å–∫–æ—Ä–æ.
      </p>
    `;
  } else {
    earned.forEach(badge => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.dataset.badgeId = badge.id;
      btn.className =
        'relative h-12 w-12 sm:h-14 sm:w-14 rounded-xl overflow-hidden bg-slate-100 border border-slate-200 flex items-center justify-center hover:shadow-md transition';

      btn.innerHTML = `
        <img src="/assets/badges/${badge.id}.png" alt="${badge.title}" class="h-full w-full object-contain" />
      `;

      btn.addEventListener('click', () => openBadgesModal(badge.id));
      grid.appendChild(btn);
    });
  }

  if (openDesktop) {
    openDesktop.addEventListener('click', () => openBadgesModal());
  }
  if (openMobile) {
    openMobile.addEventListener('click', () => openBadgesModal());
  }
}
 
      async function loadAndRenderBadges(userBadgeIds) {
        try {
          const earnedIds = Array.isArray(userBadgeIds) ? userBadgeIds : [];

          const snap = await db.collection('badges').get();
          const badges = [];
          snap.forEach(doc => {
            const data = doc.data() || {};
            const id = doc.id;
            badges.push({
              id,
              title: data.title || data.name || '–ú–µ–¥–∞–ª—å',
              desc: data.description || data.desc || '',
              earned: earnedIds.includes(id)
            });
          });

          allBadgesCache = badges;

          if (!badges.length) {
            achievementsList.innerHTML = `
              <div class="soft-card p-4 text-xs sm:text-sm text-slate-600">
                –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã –Ω–∞—á–Ω—ë—Ç–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—Ä–æ–∫–∏, –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –ø–µ—Ä–≤—ã–µ –±–µ–π–¥–∂–∏ –∏ –º–µ–¥–∞–ª–∏ –∑–∞ –≤–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ —è–∑—ã–∫–∞—Ö.
              </div>
            `;
            return;
          }

          renderEarnedBadgesStrip(badges);
          renderBadgesModalGrid(badges);
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –º–µ–¥–∞–ª–µ–π:', err);
          achievementsList.innerHTML = `
            <div class="soft-card p-4 text-xs sm:text-sm text-slate-600">
              –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é –º–µ–¥–∞–ª–µ–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.
            </div>
          `;
        }
      }

      /* —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
      async function setAuthState(user) {
        if (user) {
          localStorage.setItem('pt_uid', user.uid || '');
          if (user.email) localStorage.setItem('pt_email', user.email);

          authBoxOut.classList.add('hidden');
          authBoxIn.classList.remove('hidden');
          coursesNeedAuth.classList.add('hidden');
          authUserEmail.textContent = user.email || '';

          await loadUserProfile(user);
          await loadUserEnrollments(user);
        } else {
          localStorage.removeItem('pt_uid');
          localStorage.removeItem('pt_email');

          authBoxOut.classList.remove('hidden');
          authBoxIn.classList.add('hidden');
          coursesNeedAuth.classList.remove('hidden');
          authUserEmail.textContent = '';
          profileName.textContent = '';
          profileAvatarImg.src = '/assets/avatarf.png';
          if (profileAvatarType) profileAvatarType.value = 'girl';
          setAvatarChoice('girl');
          coursesList.innerHTML = '';
          coursesEmpty.classList.add('hidden');
          achievementsList.innerHTML = `
            <div class="soft-card p-4 text-xs sm:text-sm text-slate-600">
              –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –º–µ–¥–∞–ª–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
            </div>
          `;
          if (coinsCard) {
            coinsCard.classList.add('hidden');
          }
        }
      }

      /* –ø—Ä–æ—Ñ–∏–ª—å: —á—Ç–µ–Ω–∏–µ (email + uid, —Å–ª–∏—è–Ω–∏–µ) */
      async function loadUserProfile(user) {
        try {
          const email = user.email || null;
          const uid   = user.uid   || null;
          if (!email && !uid) return;

          const usersCol = db.collection('users');
          const emailRef = email ? usersCol.doc(email) : null;
          const uidRef   = uid   ? usersCol.doc(uid)   : null;

          const [emailSnap, uidSnap] = await Promise.all([
            emailRef ? emailRef.get() : Promise.resolve(null),
            uidRef   ? uidRef.get()   : Promise.resolve(null)
          ]);

          const emailData = emailSnap && emailSnap.exists ? (emailSnap.data() || {}) : null;
          const uidData   = uidSnap   && uidSnap.exists   ? (uidSnap.data()   || {}) : null;

          let data = {
            ...(uidData || {}),
            ...(emailData || {}),
          };

          if (email) data.email = data.email || email;

          const first = data.firstName || '';
          const last  = data.lastName || '';
          const avatarType = data.avatarType || 'girl';
          const displayEmail = data.email || email || '';

          const displayName = (first || last)
            ? (first + ' ' + (last || '')).trim()
            : displayEmail || '–ë–µ–∑ –∏–º–µ–Ω–∏';

          profileName.textContent = displayName;
          authUserEmail.textContent = displayEmail;

          profileFirst.value = first;
          profileLast.value  = last;

          setAvatarChoice(avatarType);

          profileMsg.textContent = '';

          // –ö–û–ò–ù–´: –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ –¥–∞–Ω–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª—è
          updateCoinsUI(data);

          if (emailRef) {
            try {
              await emailRef.set(
                { ...data, email: displayEmail },
                { merge: true }
              );
            } catch (e) {
              console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å uid‚Üíemail:', e);
            }
          }
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è:', err);
        }
      }

      /* —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è */
      profileForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        profileMsg.textContent = '';

        const user = auth.currentUser;
        if (!user) {
          profileMsg.textContent = '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.';
          return;
        }

        try {
          const email = user.email;
          const first = profileFirst.value.trim();
          const last  = profileLast.value.trim();
          const avatarType = profileAvatarType ? (profileAvatarType.value || 'girl') : 'girl';

          const payload = {
            firstName: first,
            lastName:  last,
            avatarType: avatarType
          };

          // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –ª–æ–∫–∞–ª—å–Ω–æ
          profileAvatarImg.src = avatarType === 'girl'
            ? '/assets/avatarf.png'
            : '/assets/avatar.png';

          // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –≤ Firestore
          await db.collection('users').doc(email).set(payload, { merge: true });

          profileMsg.textContent = '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω ‚úîÔ∏è';

          const again = auth.currentUser;
          if (again) {
            await loadUserProfile(again);
          }

          closeProfileModal();
        } catch (err) {
          console.error('profile save error', err);
          profileMsg.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
        }
      });

      /* –∫—É—Ä—Å—ã + –º–µ–¥–∞–ª–∏: —á—Ç–µ–Ω–∏–µ –∏ —Å–ª–∏—è–Ω–∏–µ email+uid */
      async function loadUserEnrollments(user) {
        coursesList.innerHTML = '';
        coursesEmpty.classList.add('hidden');

        try {
          const email = user.email || null;
          const uid   = user.uid   || null;

          if (!email && !uid) {
            coursesEmpty.classList.remove('hidden');
            await loadAndRenderBadges([]);
            return;
          }

          const usersCol = db.collection('users');
          const emailRef = email ? usersCol.doc(email) : null;
          const uidRef   = uid   ? usersCol.doc(uid)   : null;

          const [emailSnap, uidSnap] = await Promise.all([
            emailRef ? emailRef.get() : Promise.resolve(null),
            uidRef   ? uidRef.get()   : Promise.resolve(null)
          ]);

          const emailData = emailSnap && emailSnap.exists ? (emailSnap.data() || {}) : null;
          const uidData   = uidSnap   && uidSnap.exists   ? (uidSnap.data()   || {}) : null;

          if (!emailData && !uidData) {
            coursesEmpty.classList.remove('hidden');
            await loadAndRenderBadges([]);
            return;
          }

          const paidFromEmail = Array.isArray(emailData?.courses)     ? emailData.courses     : [];
          const paidFromUid   = Array.isArray(uidData?.courses)       ? uidData.courses       : [];
          const freeFromEmail = Array.isArray(emailData?.freeCourses) ? emailData.freeCourses : [];
          const freeFromUid   = Array.isArray(uidData?.freeCourses)   ? uidData.freeCourses   : [];
          const badgesEmail   = Array.isArray(emailData?.badges)      ? emailData.badges      : [];
          const badgesUid     = Array.isArray(uidData?.badges)        ? uidData.badges        : [];

          const progressEmail = emailData?.progress || {};
          const progressUid   = uidData?.progress   || {};
          const mergedProgress = {
            ...(progressUid || {}),
            ...(progressEmail || {}),
          };

          const progressCourseIds = Object.keys(mergedProgress || {});

          let mergedPaid = Array.from(new Set([...paidFromUid, ...paidFromEmail]));
          let mergedFree = Array.from(new Set([
            ...freeFromUid,
            ...freeFromEmail,
            ...progressCourseIds.filter(id => !mergedPaid.includes(id))
          ]));

          const mergedBadges = Array.from(new Set([...badgesUid, ...badgesEmail]));
          const courses = [];

          for (const id of mergedPaid) {
            courses.push({
              id,
              isPaid: true,
              isFree: false,
              progress: mergedProgress[id] || null
            });
          }

          for (const id of mergedFree) {
            if (mergedPaid.includes(id)) continue;
            courses.push({
              id,
              isPaid: false,
              isFree: true,
              progress: mergedProgress[id] || null
            });
          }

          renderCourses(courses);
          await loadAndRenderBadges(mergedBadges);

          if (emailRef) {
            try {
              await emailRef.set(
                {
                  email: emailData?.email || email || null,
                  courses: mergedPaid,
                  freeCourses: mergedFree,
                  badges: mergedBadges,
                  progress: mergedProgress
                },
                { merge: true }
              );
            } catch (e) {
              console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å—ã uid‚Üíemail:', e);
            }
          }
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤:', err);
          renderCourses([]);
          await loadAndRenderBadges([]);
        }
      }

      function renderCourses(courses) {
        coursesList.innerHTML = '';
        if (!courses || courses.length === 0) {
          coursesEmpty.classList.remove('hidden');
          return;
        }
        coursesEmpty.classList.add('hidden');

        courses.forEach(c => {
          const meta = COURSE_META[c.id] || {
            title: c.id,
            href: '/courses/',
            cover: '/assets/courses/default.jpg'
          };

          const progressData = c.progress || {};
          const percent = typeof progressData.percent === 'number'
            ? Math.max(0, Math.min(100, progressData.percent))
            : 0;
          const lastLessonId = progressData.lastLessonId || null;

          const isFree = !!c.isFree;
          const isPaid = !!c.isPaid;

          const badgeLabel = isFree ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å' : '–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –∫—É—Ä—Å';
          const badgeClass = isFree
            ? 'border-emerald-300 bg-emerald-50 text-emerald-700'
            : 'border-amber-300 bg-amber-50 text-amber-700';

          let statusLabel;
          if (percent > 0 && lastLessonId) {
            statusLabel = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percent}% ¬∑ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫: ${lastLessonId}`;
          } else if (percent > 0) {
            statusLabel = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percent}%`;
          } else if (isPaid) {
            statusLabel = '–ö—É—Ä—Å –æ–ø–ª–∞—á–µ–Ω, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.';
          } else {
            statusLabel = '–ö—É—Ä—Å –æ—Ç–∫—Ä—ã—Ç, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫.';
          }

          const card = document.createElement('a');
          card.href = meta.href;
          card.className = 'soft-card p-3 sm:p-4 flex flex-col gap-2 hover:shadow-md transition-shadow group';

          card.innerHTML = `
            <div class="flex gap-3 items-center">
              <div class="h-14 w-14 rounded-xl bg-slate-100 overflow-hidden flex-shrink-0">
                <img src="${meta.cover}" alt="" class="h-full w-full object-cover group-hover:scale-105 transition-transform" />
              </div>
              <div class="flex-1 min-w-0 space-y-1">
                <div class="flex items-center gap-2">
                  <span class="badge text-[10px] ${badgeClass}">${badgeLabel}</span>
                </div>
                <p class="text-sm font-semibold text-slate-900 truncate">${meta.title}</p>
                <p class="text-[11px] text-slate-500">${statusLabel}</p>
              </div>
            </div>
            <div class="mt-2 h-1.5 rounded-full bg-slate-100 overflow-hidden">
              <div class="h-full bg-gradient-to-r from-emerald-400 to-emerald-500" style="width:${percent}%;"></div>
            </div>
          `;

          coursesList.appendChild(card);
        });
      }

      auth.onAuthStateChanged((user) => {
        setAuthState(user || null);
      });
    });
  </script>
</body>
</html>
