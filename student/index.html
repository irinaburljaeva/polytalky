<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PolyTalky ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <meta name="description" content="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç PolyTalky: –≤–∞—à–∏ –∫—É—Ä—Å—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö." />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- —Ñ–∞–≤–∏–∫–æ–Ω -->
  <link rel="icon" type="image/jpg" href="/assets/favicon.jpg">
  <link rel="apple-touch-icon" href="/favicon.png">
  <style>
    :root{
      --brand-1:#FFBA08; /* –∂—ë–ª—Ç—ã–π */
      --brand-2:#F97316; /* –º—è–≥–∫–∏–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --brand-3:#10B981; /* –∑–µ–ª—ë–Ω—ã–π –¥–ª—è —É—Å–ø–µ—Ö–∞ */
      --brand-bg:#FEF9C3;

      --ink-1:#0f172a;
      --ink-2:#475569;
      --ink-3:#94a3b8;
      --card-bg:#ffffff;
    }
    body{
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(circle at top left,#FEF9C3 0,#FEFCE8 40%,#F9FAFB 100%);
      color:#0f172a;
    }
    .wrap{max-width:1040px;margin:0 auto;}
    .card{
      border-radius:1.25rem;
      border:1px solid rgba(15,23,42,.08);
      background-color:rgba(255,255,255,.96);
      box-shadow:0 18px 45px rgba(15,23,42,.08);
    }
    .soft-card{
      border-radius:1rem;
      border:1px solid rgba(148,163,184,.25);
      background-color:rgba(255,255,255,.9);
    }
    .btn{
      border-radius:999px;
      padding:.55rem 1.1rem;
      font-weight:600;
      font-size:.85rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.4rem;
      transition:.15s;
      border:1px solid transparent;
      cursor:pointer;
      text-decoration:none;
      white-space:nowrap;
    }
    .btn-brand{
      background:var(--brand-1);
      color:#111827;
      border-color:#FDE68A;
    }
    .btn-brand:hover{
      background:#FACC15;
    }
    .btn-ghost{
      background:transparent;
      color:#111827;
      border-color:rgba(148,163,184,.6);
    }
    .btn-ghost:hover{
      background:rgba(148,163,184,.08);
    }
    .badge{
      border-radius:999px;
      font-size:.65rem;
      padding:.15rem .55rem;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:.06em;
      border:1px solid rgba(148,163,184,.5);
      background:rgba(249,250,251,.9);
      color:#4b5563;
    }
    .pill-label{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      border-radius:999px;
      padding:.15rem .7rem;
      font-size:.65rem;
      font-weight:600;
      letter-spacing:.14em;
      text-transform:uppercase;
      background:rgba(251,191,36,.12);
      color:#92400e;
      border:1px solid rgba(251,191,36,.35);
    }

    /* honeypot */
    .hp-field{
      position:absolute;
      left:-9999px;
      opacity:0;
      pointer-events:none;
      height:0;width:0;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- HEADER -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 border-b border-slate-200/60">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between gap-4">
      <a href="/" class="flex items-center gap-2">
        <img src="/assets/logo-polytalky.png" alt="PolyTalky" class="h-9 w-9 rounded-2xl shadow-md object-cover bg-[var(--brand-1)]">
        <span class="font-semibold text-slate-900 text-lg">PolyTalky</span>
      </a>
      <nav class="hidden sm:flex items-center gap-5 text-sm text-slate-700">
        <a href="/courses/" class="hover:text-slate-900">–ö—É—Ä—Å—ã</a>
        <a href="/shop/" class="hover:text-slate-900">–ú–∞–≥–∞–∑–∏–Ω</a>
        <span class="font-semibold text-slate-900">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span>
      </nav>
    </div>
  </header>

  <main class="flex-1">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-6 sm:py-10 space-y-6">

      <!-- HERO / AUTH CARD -->
      <section class="card p-5 sm:p-7 space-y-5">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-5">
          <div class="space-y-2 max-w-xl">
            <p class="text-xs font-semibold tracking-[.2em] uppercase text-amber-700">
              –í–∞—à —É–≥–æ–ª–æ–∫ –≤ PolyTalky
            </p>
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">
              –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç <span class="text-amber-600">—è–∑—ã–∫–æ–≤–æ–≥–æ –≥–µ—Ä–æ—è</span>
            </h1>
            <p class="text-sm sm:text-base text-slate-600">
              –ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–∞—à–∏ –∫—É—Ä—Å—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å.
              –í–æ–π–¥–∏—Ç–µ –ø–æ email, —á—Ç–æ–±—ã –≤—Å—ë —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å –º–µ–∂–¥—É —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –ø–ª–∞–Ω—à–µ—Ç–æ–º –∏ –Ω–æ—É—Ç–±—É–∫–æ–º.
            </p>
          </div>

          <!-- –±–ª–æ–∫ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–≤–æ—à—ë–ª" -->
          <div id="auth-when-logged-in" class="hidden soft-card px-4 py-3 sm:px-5 sm:py-4 flex items-center gap-3 min-w-[260px]">
            <div id="profile-avatar" class="h-12 w-12 rounded-full bg-[var(--brand-1)]/60 flex items-center justify-center text-xl font-bold text-slate-900 shadow-inner overflow-hidden">
              <img id="profile-avatar-img" src="/assets/avatarf.png" alt="Avatar" class="h-full w-full object-cover hidden">
              <span id="profile-avatar-emoji">üòä</span>
            </div>
            <div class="flex-1">
              <div class="text-xs uppercase tracking-wide text-slate-500">–í—ã –≤–æ—à–ª–∏ –∫–∞–∫</div>
              <div id="profile-name" class="font-semibold text-slate-900 text-sm"></div>
              <div id="auth-user-email" class="text-xs text-slate-500"></div>
            </div>
            <button id="auth-logout" class="btn btn-ghost text-xs px-3 py-1">–í—ã–π—Ç–∏</button>
          </div>
        </div>

        <!-- –±–ª–æ–∫ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–ù–ï –≤–æ—à—ë–ª" -->
        <div id="auth-when-logged-out" class="soft-card p-4 sm:p-5 text-sm text-slate-700 space-y-3">
          <p class="font-semibold text-slate-900">–í–æ–π–¥–∏—Ç–µ –≤ PolyTalky</p>
          <p class="text-xs sm:text-sm text-slate-600">
            –ê–∫–∫–∞—É–Ω—Ç –ø–æ email —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤–∞—à–∏ –∫—É—Ä—Å—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è. –ï—Å–ª–∏ –µ—â—ë –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞ ‚Äî –Ω–∞–∂–º–∏—Ç–µ ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª.
          </p>

          <form id="auth-form" class="space-y-3 text-sm">
            <!-- honeypot -->
            <input id="auth-website" type="text" autocomplete="off" class="hp-field" aria-hidden="true" />

            <div class="grid sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1.5fr)_minmax(0,1.2fr)] gap-3">
              <input id="auth-email" type="email" required
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                     placeholder="email@example.com" />
              <input id="auth-pass" type="password" required
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                     placeholder="–ü–∞—Ä–æ–ª—å" />
              <div class="flex gap-2">
                <button type="submit" id="btn-login" class="btn btn-brand flex-1">–í–æ–π—Ç–∏</button>
                <button type="button" id="auth-register" class="btn btn-ghost flex-1">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
              </div>
            </div>

            <!-- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div class="grid sm:grid-cols-2 gap-3 hidden" id="auth-extra">
              <input id="auth-first" type="text"
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                     placeholder="–ò–º—è (–¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)" />
              <input id="auth-last" type="text"
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                     placeholder="–§–∞–º–∏–ª–∏—è (–¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)" />
            </div>
          </form>

          <p id="auth-error" class="mt-1 text-xs text-red-500 min-h-[1.25rem]"></p>
          <p class="mt-1 text-[11px] text-slate-500 leading-relaxed">
            –ù–∞–∂–∏–º–∞—è ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å
            <a class="underline" href="/legal/offer.html" target="_blank">–ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç–æ–π</a>
            –∏
            <a class="underline" href="/legal/privacy.html" target="_blank">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.
          </p>
        </div>

        <!-- –ú–∏–Ω–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è (—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤–æ—à–ª–∏) -->
        <div id="profile-settings" class="hidden pt-4 border-t border-dashed border-amber-200 mt-2">
          <p class="text-xs font-semibold uppercase tracking-[.18em] text-amber-700 mb-2">–ü—Ä–æ—Ñ–∏–ª—å</p>
          <form id="profile-form" class="grid gap-3 text-xs sm:text-sm sm:grid-cols-[minmax(0,1.1fr)_minmax(0,1.1fr)_minmax(0,1.4fr)_auto_auto] items-end">
            <input id="profile-first" type="text"
                   class="rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                   placeholder="–ò–º—è" />
            <input id="profile-last" type="text"
                   class="rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                   placeholder="–§–∞–º–∏–ª–∏—è" />
            <select id="profile-avatar-type"
                    class="rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]">
              <option value="girl">–ê–≤–∞—Ç–∞—Ä: –¥–µ–≤—É—à–∫–∞</option>
              <option value="boy">–ê–≤–∞—Ç–∞—Ä: –º–∞–ª—å—á–∏–∫</option>
              <option value="custom">–°–≤–æ—è –∫–∞—Ä—Ç–∏–Ω–∫–∞</option>
            </select>
            <input id="profile-avatar-url" type="url"
                   class="rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                   placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (–¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ ¬´–°–≤–æ—è –∫–∞—Ä—Ç–∏–Ω–∫–∞¬ª)" />
            <button type="submit" class="btn btn-ghost text-xs px-3 py-2">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
          </form>
          <p id="profile-msg" class="mt-1 text-[11px] text-slate-500"></p>
        </div>

        <!-- –í—ã–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–∞ (–∏–∫–æ–Ω–∫–∏) -->
        <div id="avatar-choices" class="hidden pt-4 border-t border-dashed border-amber-200 mt-3">
          <p class="text-xs font-semibold uppercase tracking-[.18em] text-amber-700 mb-2">
            –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–∞
          </p>
          <div class="flex flex-wrap gap-3 text-xs">
            <button type="button" data-avatar="girl" class="avatar-choice inline-flex items-center gap-2 px-3 py-2 rounded-full border border-slate-200 bg-white hover:border-amber-300 hover:bg-amber-50">
              <img src="/assets/avatarf.png" alt="–î–µ–≤—É—à–∫–∞" class="h-6 w-6 rounded-full object-cover">
              <span>–î–µ–≤—É—à–∫–∞</span>
            </button>
            <button type="button" data-avatar="boy" class="avatar-choice inline-flex items-center gap-2 px-3 py-2 rounded-full border border-slate-200 bg-white hover:border-amber-300 hover:bg-amber-50">
              <img src="/assets/avatarm.png" alt="–ú–∞–ª—å—á–∏–∫" class="h-6 w-6 rounded-full object-cover">
              <span>–ú–∞–ª—å—á–∏–∫</span>
            </button>
            <button type="button" data-avatar="custom" class="avatar-choice inline-flex items-center gap-2 px-3 py-2 rounded-full border border-slate-200 bg-white hover:border-amber-300 hover:bg-amber-50">
              <span class="text-lg">‚ú®</span>
              <span>–°–≤–æ—è –∫–∞—Ä—Ç–∏–Ω–∫–∞</span>
            </button>
          </div>
        </div>
      </section>

      <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢: –ö–£–†–°–´ + –î–û–°–¢–ò–ñ–ï–ù–ò–Ø + –ö–û–ò–ù–´ -->
      <section class="grid gap-6 lg:grid-cols-[minmax(0,1.4fr)_minmax(0,1.1fr)]">
        <!-- –ö–£–†–°–´ -->
        <div class="space-y-3">
          <div class="flex items-center justify-between gap-3">
            <div>
              <h2 class="text-lg sm:text-xl font-bold text-slate-900">–í–∞—à–∏ –∫—É—Ä—Å—ã</h2>
              <p class="text-xs text-slate-500">
                –ü–æ–∫—É–ø–∫–∏ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
              </p>
            </div>
            <a href="/courses/" class="text-xs sm:text-sm text-amber-700 hover:text-amber-900 font-medium">
              –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥ ‚Üí
            </a>
          </div>

          <div id="courses-need-auth" class="soft-card p-4 text-sm text-slate-600">
            –ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –∫—É—Ä—Å—ã, <span class="font-semibold text-slate-900">–≤–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span> –≤—ã—à–µ.
          </div>

          <div id="courses-list" class="grid gap-4 sm:grid-cols-2"></div>

          <p id="courses-empty" class="hidden text-sm text-slate-500">
            –ü–æ–∫–∞ —É –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤. –ó–∞–≥–ª—è–Ω–∏—Ç–µ –≤
            <a href="/shop/" class="underline">–º–∞–≥–∞–∑–∏–Ω</a> –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ
            <a href="/courses/" class="underline">–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å</a>.
          </p>
        </div>

        <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –î–û–°–¢–ò–ñ–ï–ù–ò–Ø + –ö–û–ò–ù–´ -->
        <div class="space-y-4">
          <!-- –î–û–°–¢–ò–ñ–ï–ù–ò–Ø (–ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê) -->
          <div class="space-y-3">
            <div class="space-y-1">
              <p class="pill-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</p>
              <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
                –ë–µ–π–¥–∂–∏, –º–µ–¥–∞–ª–∏ –∏ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã
              </h2>
              <p class="text-xs sm:text-sm text-slate-600">
                –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–∞—à–∏ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–µ–¥–∞–ª–∏. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é, –∫–∞–∫ –≤ Pok√©mon Go.
              </p>
            </div>

            <div id="achievements-empty" class="soft-card p-4 text-xs sm:text-sm text-slate-600">
              –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä–≤—É—é –º–µ–¥–∞–ª—å, –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.
            </div>

            <div id="achievements-earned" class="flex flex-wrap gap-2">
              <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–µ–¥–∞–ª–∏ -->
            </div>

            <button
              id="achievements-open-modal"
              type="button"
              class="btn btn-ghost text-xs sm:text-sm mt-1 hidden"
            >
              –û—Ç–∫—Ä—ã—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é –º–µ–¥–∞–ª–µ–π
            </button>
          </div>

          <!-- –ö–û–ò–ù–´ -->
          <aside id="coins-card" class="soft-card p-4 sm:p-5 space-y-3 hidden">
            <div class="flex items-center justify-between gap-3">
              <div class="space-y-1">
                <p class="pill-label">PolyTalky Coins</p>
                <h2 class="text-base sm:text-lg font-semibold text-slate-900">
                  –í–∞—à–∏ –±–æ–Ω—É—Å—ã –∑–∞ –æ–±—É—á–µ–Ω–∏–µ
                </h2>
              </div>
              <div class="flex flex-col items-end">
                <div class="inline-flex items-center gap-1 rounded-full bg-slate-900 text-amber-300 px-2 py-1 text-xs font-semibold shadow-sm">
                  <img src="/assets/coin.png" alt="Coin" class="h-4 w-4">
                  <span><span id="coins-balance">0</span> –∫–æ–∏–Ω–æ–≤</span>
                </div>
                <button id="open-coins-modal"
                        class="mt-1 text-[11px] text-amber-700 hover:text-amber-900 underline decoration-dotted">
                  –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫–æ–∏–Ω–∞—Ö
                </button>
              </div>
            </div>
            <p id="coins-text" class="text-xs sm:text-sm text-slate-600">
              –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã –∏ –∫–æ–ª–µ—Å–∞ —É–¥–∞—á–∏.
            </p>
            <button id="coins-claim-btn"
                    class="btn btn-brand w-full justify-center text-xs sm:text-sm">
              –ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å
            </button>
          </aside>
        </div>
      </section>
    </div>
  </main>

  <!-- –ú–û–î–ê–õ–ö–ê –ü–†–û –ö–û–ò–ù–´ -->
  <div id="coin-modal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden items-center justify-center z-40">
    <div class="card max-w-md w-full mx-4 p-5 sm:p-6 space-y-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <p class="text-xs font-semibold tracking-[.18em] uppercase text-amber-700">
            PolyTalky Coins
          </p>
          <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
            –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–∏–Ω—ã
          </h2>
        </div>
        <button type="button" id="coin-modal-close" class="text-slate-400 hover:text-slate-600 text-xl leading-none">
          √ó
        </button>
      </div>

      <div class="flex items-center gap-3">
        <img src="/assets/coin.png" alt="Coin" class="h-10 w-10">
        <div class="text-sm text-slate-700">
          <div>–°–µ–π—á–∞—Å —É –≤–∞—Å <span id="coin-modal-balance" class="font-semibold">0</span> –∫–æ–∏–Ω–æ–≤.</div>
          <div class="text-xs text-slate-500 mt-1">
            –ö–æ–∏–Ω—ã –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ–±–º–µ–Ω—è—Ç—å –Ω–∞ –ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã, –∞–≤–∞—Ç–∞—Ä—ã –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.
          </div>
        </div>
      </div>

      <ul class="text-xs sm:text-sm text-slate-700 space-y-2">
        <li>‚Ä¢ –ó–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤—Ö–æ–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –Ω–µ–±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–∏–Ω–æ–≤.</li>
        <li>‚Ä¢ –ï—Å–ª–∏ –∑–∞—Ö–æ–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥, –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫—Ä—É—Ç–∞–Ω—É—Ç—å ¬´–∫–æ–ª–µ—Å–æ —É–¥–∞—á–∏¬ª –∏ –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª—å—à–µ –∫–æ–∏–Ω–æ–≤.</li>
        <li>‚Ä¢ –ß–µ–º –¥–æ–ª—å—à–µ –≤–∞—à–∞ —Å–µ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π, —Ç–µ–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ –Ω–∞–≥—Ä–∞–¥—ã.</li>
      </ul>

      <p class="text-[11px] text-slate-500">
        –ù–∞ —ç—Ç–∞–ø–µ –±–µ—Ç—ã –º—ã –º–æ–∂–µ–º –º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è. –ù–æ –≤—Å–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤–∞–º–∏ –∫–æ–∏–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.
      </p>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–ö–ê –ö–û–õ–õ–ï–ö–¶–ò–ò –ú–ï–î–ê–õ–ï–ô -->
  <div
    id="achievements-modal"
    class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden items-center justify-center z-40"
  >
    <div class="card max-w-2xl w-full mx-4 p-5 sm:p-6 space-y-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <p class="text-xs font-semibold tracking-[.18em] uppercase text-amber-700">
            –ö–æ–ª–ª–µ–∫—Ü–∏—è –º–µ–¥–∞–ª–µ–π
          </p>
          <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
            –í—Å–µ –≤–∞—à–∏ –Ω–∞–≥—Ä–∞–¥—ã –∏ —Ç–µ, —á—Ç–æ –µ—â—ë –≤–ø–µ—Ä–µ–¥–∏
          </h2>
          <p class="text-xs sm:text-sm text-slate-600">
            –ó–æ–ª–æ—Ç—ã–µ –∏–∫–æ–Ω–∫–∏ ‚Äî —É–∂–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –º–µ–¥–∞–ª–∏. –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ü–µ–ª–∏, –∫ –∫–æ—Ç–æ—Ä—ã–º –≤—ã –µ—â—ë –∏–¥—ë—Ç–µ.
          </p>
        </div>
        <button
          type="button"
          id="achievements-modal-close"
          class="text-slate-400 hover:text-slate-600 text-xl leading-none"
        >
          √ó
        </button>
      </div>

      <div
        id="achievements-modal-grid"
        class="grid grid-cols-4 sm:grid-cols-5 gap-3 text-center text-xs sm:text-sm"
      >
        <!-- –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ–¥–∞–ª–µ–π -->
      </div>

      <div
        id="achievements-modal-detail"
        class="soft-card p-3 sm:p-4 text-xs sm:text-sm text-slate-700"
      >
        <p class="font-semibold mb-1" id="achievements-modal-title">
          –í—ã–±–µ—Ä–∏—Ç–µ –º–µ–¥–∞–ª—å, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
        </p>
        <p id="achievements-modal-desc">
          –ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∏–∫–æ–Ω–∫—É –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.
        </p>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="border-t border-slate-200/70 bg-white/80 backdrop-blur py-6 text-sm text-slate-600 mt-8">
    <div class="wrap px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
      <p>¬© 2025 PolyTalky. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      <div class="flex flex-wrap gap-4">
        <a href="/contact.html" class="hover:text-slate-900">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <a href="/legal/privacy.html" class="hover:text-slate-900">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        <a href="/legal/offer.html" class="hover:text-slate-900">–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</a>
        <a href="/legal/cookies.html" class="hover:text-slate-900">Cookies</a>
        <a href="/legal/consent.html" class="hover:text-slate-900">–°–æ–≥–ª–∞—Å–∏–µ</a>
      </div>
    </div>
  </footer>

  <!-- COOKIE –ë–ê–ù–ù–ï–† -->
  <div id="cookie-banner" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-900 text-white shadow-lg rounded-xl px-4 py-3 text-xs sm:text-sm flex items-center gap-3 hidden">
    <span>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookies –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞. –ü—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∞–π—Ç–æ–º, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —ç—Ç–∏–º.</span>
    <button id="cookie-accept" class="btn btn-brand text-xs px-3 py-1">–ü–æ–Ω—è—Ç–Ω–æ</button>
  </div>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBAU_uMTePpKwVNZNhqk2pss2PuSitGfQI",
      authDomain: "polytalky-70999.firebaseapp.com",
      projectId: "polytalky-70999",
      storageBucket: "polytalky-70999.firebasestorage.app",
      messagingSenderId: "62407152289",
      appId: "1:62407152289:web:b0c0efdb2472f12b10d6e0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã ---
      const authBoxOut      = document.getElementById('auth-when-logged-out');
      const authBoxIn       = document.getElementById('auth-when-logged-in');
      const authEmailEl     = document.getElementById('auth-email');
      const authPassEl      = document.getElementById('auth-pass');
      const authFirstEl     = document.getElementById('auth-first');
      const authLastEl      = document.getElementById('auth-last');
      const honeypotEl      = document.getElementById('auth-website');
      const authForm        = document.getElementById('auth-form');
      const authRegister    = document.getElementById('auth-register');
      const btnLogin        = document.getElementById('btn-login');
      const authError       = document.getElementById('auth-error');
      const authLogout      = document.getElementById('auth-logout');
      const authUserEmail   = document.getElementById('auth-user-email');
      const authExtra       = document.getElementById('auth-extra');

      const profileAvatar   = document.getElementById('profile-avatar');
      const profileAvatarImg= document.getElementById('profile-avatar-img');
      const profileAvatarEmoji = document.getElementById('profile-avatar-emoji');
      const profileName     = document.getElementById('profile-name');
      const profileSettings = document.getElementById('profile-settings');
      const profileForm     = document.getElementById('profile-form');
      const profileFirst    = document.getElementById('profile-first');
      const profileLast     = document.getElementById('profile-last');
      const profileAvatarType = document.getElementById('profile-avatar-type');
      const profileAvatarUrl= document.getElementById('profile-avatar-url');
      const profileMsg      = document.getElementById('profile-msg');
      const avatarChoiceButtons = document.querySelectorAll('.avatar-choice');

      const coursesNeedAuth = document.getElementById('courses-need-auth');
      const coursesList     = document.getElementById('courses-list');
      const coursesEmpty    = document.getElementById('courses-empty');

      const achievementsEarned = document.getElementById('achievements-earned');
      const achievementsEmpty  = document.getElementById('achievements-empty');
      const achievementsOpenModalBtn = document.getElementById('achievements-open-modal');
      const achievementsModal  = document.getElementById('achievements-modal');
      const achievementsModalClose = document.getElementById('achievements-modal-close');
      const achievementsModalGrid  = document.getElementById('achievements-modal-grid');
      const achievementsModalTitle = document.getElementById('achievements-modal-title');
      const achievementsModalDesc  = document.getElementById('achievements-modal-desc');

      // –ö–û–ò–ù–´: —ç–ª–µ–º–µ–Ω—Ç—ã
      const coinsCard       = document.getElementById('coins-card');
      const coinsBalanceEl  = document.getElementById('coins-balance');
      const coinsTextEl     = document.getElementById('coins-text');
      const coinsClaimBtn   = document.getElementById('coins-claim-btn');

      // –ú–æ–¥–∞–ª–∫–∞ –∫–æ–∏–Ω–æ–≤
      const coinModal       = document.getElementById('coin-modal');
      const coinModalClose  = document.getElementById('coin-modal-close');
      const coinModalBalance= document.getElementById('coin-modal-balance');

      // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–∏–Ω–æ–≤ –≤ –ø–∞–º—è—Ç–∏
      let coinsState = {
        balance: 0,
        streak: 0,
        lastDate: null,
        alreadyClaimedToday: false,
        mode: null,       // 'daily' | 'wheel'
        nextReward: 0
      };

      // –ö–æ–ª–ª–µ–∫—Ü–∏—è –º–µ–¥–∞–ª–µ–π, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –∏–∑ Firestore
      let currentMedals = [];

      function todayStr() {
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${y}-${m}-${day}`;
      }

      function loadCookieBanner() {
        const banner    = document.getElementById('cookie-banner');
        const btnCookie = document.getElementById('cookie-accept');
        if (!banner || !btnCookie) return;
        if (!localStorage.getItem('cookieConsent')) {
          banner.classList.remove('hidden');
        }
        btnCookie.addEventListener('click', () => {
          localStorage.setItem('cookieConsent', 'true');
          banner.classList.add('hidden');
        });
      }
      loadCookieBanner();

      // –ê–≤–∞—Ç–∞—Ä: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ + –≤–∏–∑—É–∞–ª
      function setAvatarChoice(type) {
        avatarChoiceButtons.forEach(btn => {
          if (btn.dataset.avatar === type) {
            btn.classList.add('border-amber-400','bg-amber-50');
          } else {
            btn.classList.remove('border-amber-400','bg-amber-50');
          }
        });
      }

      avatarChoiceButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const type = btn.dataset.avatar;
          if (!type) return;
          if (profileAvatarType) {
            profileAvatarType.value = type;
          }
          if (type === 'girl') {
            profileAvatarImg.src = '/assets/avatarf.png';
            profileAvatarImg.classList.remove('hidden');
            profileAvatarEmoji.classList.add('hidden');
          } else if (type === 'boy') {
            profileAvatarImg.src = '/assets/avatarm.png';
            profileAvatarImg.classList.remove('hidden');
            profileAvatarEmoji.classList.add('hidden');
          } else {
            profileAvatarImg.classList.add('hidden');
            profileAvatarEmoji.classList.remove('hidden');
            profileAvatarEmoji.textContent = '‚ú®';
          }
          setAvatarChoice(type);
        });
      });

      // –ö–û–ò–ù–´: –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ Firestore
      async function loadCoins(user) {
        if (!user) {
          if (coinsCard) coinsCard.classList.add('hidden');
          return;
        }
        try {
          const email = user.email || null;
          const uid   = user.uid   || null;
          if (!email && !uid) return;

          const usersCol = db.collection('users');
          const docRef   = usersCol.doc(email || uid);
          const snap     = await docRef.get();
          const data     = snap.exists ? (snap.data() || {}) : {};

          const balance  = typeof data.coinsBalance === 'number' ? data.coinsBalance : 0;
          const streak   = typeof data.coinStreak   === 'number' ? data.coinStreak   : 0;
          const lastDate = data.lastCoinDate || null;

          coinsState.balance  = balance;
          coinsState.streak   = streak;
          coinsState.lastDate = lastDate;
          coinsState.alreadyClaimedToday = false;
          coinsState.mode     = null;
          coinsState.nextReward = 0;

          updateCoinsUI({
            coinsBalance: balance,
            coinStreak: streak,
            lastCoinDate: lastDate
          });

          if (coinsCard) coinsCard.classList.remove('hidden');
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–∏–Ω–æ–≤:', err);
        }
      }

      function updateCoinsUI({ coinsBalance, coinStreak, lastCoinDate }) {
        const balance = typeof coinsBalance === 'number' ? coinsBalance : 0;
        const streak  = typeof coinStreak   === 'number' ? coinStreak   : 0;
        const last    = lastCoinDate || null;

        if (coinsBalanceEl) {
          coinsBalanceEl.textContent = balance;
        }
        if (coinModalBalance) {
          coinModalBalance.textContent = balance;
        }

        function pluralizeCoin(n) {
          n = Math.abs(n) % 100;
          const n1 = n % 10;
          if (n > 10 && n < 20) return "–∫–æ–∏–Ω–æ–≤";
          if (n1 === 1) return "–∫–æ–∏–Ω";
          if (n1 >= 2 && n1 <= 4) return "–∫–æ–∏–Ω–∞";
          return "–∫–æ–∏–Ω–æ–≤";
        }

        if (!coinsTextEl || !coinsClaimBtn) return;

        coinsClaimBtn.disabled = false;
        coinsClaimBtn.classList.remove('opacity-60','cursor-default');

        const today = todayStr();
        if (last === today) {
          coinsState.alreadyClaimedToday = true;
          coinsState.mode = null;
          coinsState.nextReward = 0;
          coinsTextEl.textContent = '–ù–∞ —Å–µ–≥–æ–¥–Ω—è –±–æ–Ω—É—Å —É–∂–µ –∑–∞–±—Ä–∞–Ω. –ó–∞–≥–ª—è–Ω–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–µ—Ä–∏—é –∏ –ø—Ä–∏–±–ª–∏–∑–∏—Ç—å—Å—è –∫ –∫–æ–ª–µ—Å—É —É–¥–∞—á–∏!';
          coinsClaimBtn.disabled = true;
          coinsClaimBtn.classList.add('opacity-60','cursor-default');
          coinsClaimBtn.textContent = '–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω';
          return;
        }

        if (last) {
          const lastDateObj = new Date(last);
          const todayObj    = new Date(today);
          const diffMs      = todayObj - lastDateObj;
          const diffDays    = Math.floor(diffMs / (1000*60*60*24));
          if (diffDays === 1) {
            coinsState.streak = streak;
          } else if (diffDays > 1) {
            coinsState.streak = 0;
          }
        }

        const currentStreak = coinsState.streak || 0;

        if (currentStreak < 6) {
          const reward = 3 + currentStreak;
          coinsState.mode = 'daily';
          coinsState.nextReward = reward;

          if (streak === 0 && balance === 0) {
            coinsTextEl.textContent = '–°–µ–≥–æ–¥–Ω—è –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–∏ –ø–µ—Ä–≤—ã–µ –∫–æ–∏–Ω—ã –∑–∞ –≤—Ö–æ–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç. –°–æ–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–∏—é –∏–∑ 7 –¥–Ω–µ–π, –∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∫—Ä—É—Ç–∞–Ω—É—Ç—å –∫–æ–ª–µ—Å–æ —É–¥–∞—á–∏!';
          } else {
            coinsTextEl.textContent = `–°–µ–≥–æ–¥–Ω—è –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å ${reward} ${pluralizeCoin(reward)} –∑–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤—Ö–æ–¥. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∑–∞—Ö–æ–¥–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –¥–æ–π—Ç–∏ –¥–æ –∫–æ–ª–µ—Å–∞ —É–¥–∞—á–∏!`;
          }
          coinsClaimBtn.textContent = `–ó–∞–±—Ä–∞—Ç—å ${reward} ${pluralizeCoin(reward)}`;
        } else {
          coinsState.mode = 'wheel';
          coinsState.nextReward = 0;
          coinsTextEl.textContent = '–í—ã –¥–æ–±—Ä–∞–ª–∏—Å—å –¥–æ –∫–æ–ª–µ—Å–∞ —É–¥–∞—á–∏! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–∏–Ω–æ–≤.';
          coinsClaimBtn.textContent = '–ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ';
        }
      }

      // –ö–û–ò–ù–´: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ ¬´–∑–∞–±—Ä–∞—Ç—å¬ª
      if (coinsClaimBtn) {
        coinsClaimBtn.addEventListener('click', async () => {
          const user = auth.currentUser;
          if (!user) {
            alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∫–æ–∏–Ω—ã.');
            return;
          }
          if (coinsState.alreadyClaimedToday) {
            return;
          }
          if (!coinsState.mode) {
            return;
          }

          coinsClaimBtn.disabled = true;
          coinsClaimBtn.classList.add('opacity-60','cursor-default');

          try {
            const email = user.email || null;
            const uid   = user.uid   || null;
            const usersCol = db.collection('users');
            const docRef   = usersCol.doc(email || uid);
            const snap     = await docRef.get();
            const data     = snap.exists ? (snap.data() || {}) : {};

            const balance  = typeof data.coinsBalance === 'number' ? data.coinsBalance : 0;
            const streak   = typeof data.coinStreak   === 'number' ? data.coinStreak   : 0;
            const today    = todayStr();

            if (coinsState.mode === 'daily') {
              const reward = coinsState.nextReward || 3;
              const newBalance = balance + reward;
              const newStreak  = streak + 1;

              await docRef.set({
                coinsBalance: newBalance,
                coinStreak: newStreak,
                lastCoinDate: today
              }, { merge: true });

              coinsState.balance = newBalance;
              coinsState.streak  = newStreak;
              coinsState.lastDate= today;
              coinsState.alreadyClaimedToday = true;

              updateCoinsUI({
                coinsBalance: newBalance,
                coinStreak: newStreak,
                lastCoinDate: today
              });
              coinsTextEl.textContent = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${reward} –∫–æ–∏–Ω–æ–≤ –∑–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –≤—Ö–æ–¥. –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –∑–∞—Ö–æ–¥–∏—Ç–µ! üíõ`;
            } else if (coinsState.mode === 'wheel') {
              const wheelPrizes = [
                { label: '5 –∫–æ–∏–Ω–æ–≤',  coins: 5 },
                { label: '10 –∫–æ–∏–Ω–æ–≤', coins: 10 },
                { label: '15 –∫–æ–∏–Ω–æ–≤', coins: 15 },
                { label: '20 –∫–æ–∏–Ω–æ–≤', coins: 20 }
              ];
              const i = Math.floor(Math.random() * wheelPrizes.length);
              const prize = wheelPrizes[i];
              const newBalance = coinsState.balance + prize.coins;

              await docRef.set({
                coinsBalance: newBalance,
                coinStreak: 0,
                lastCoinDate: today
              }, { merge: true });

              coinsState.balance = newBalance;
              coinsState.streak  = 0;
              coinsState.lastDate= today;
              coinsState.alreadyClaimedToday = true;

              updateCoinsUI({
                coinsBalance: newBalance,
                coinStreak: 0,
                lastCoinDate: today
              });
              coinsTextEl.textContent = `–ö–æ–ª–µ—Å–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –Ω–∞: ${prize.label}! –≠—Ç–∏ –∫–æ–∏–Ω—ã —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à —Å—á—ë—Ç ü™ô`;
            }
          } catch (err) {
            console.error('coins error', err);
            coinsTextEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–¥–∞—Ç—å –±–æ–Ω—É—Å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
            coinsClaimBtn.disabled = false;
            coinsClaimBtn.classList.remove('opacity-60','cursor-default');
            coinsClaimBtn.textContent = '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å';
          }
        });
      }

      // –ö–ª–∏–∫ –ø–æ –º–∞–ª–µ–Ω—å–∫–æ–º—É –∫–æ–∏–Ω—É ‚Üí –º–æ–¥–∞–ª–∫–∞ —Å –±–æ–ª—å—à–∏–º
      (function setupCoinModal() {
        const coinImgSmall =
          document.querySelector('#coins-card img[src="/assets/coin.png"]') ||
          document.querySelector('#coins-card img');

        if (!coinImgSmall || !coinModal || !coinModalClose) return;

        coinImgSmall.classList.add('transition-transform','duration-200','cursor-pointer');

        const openCoinModal = () => {
          if (coinModalBalance) {
            coinModalBalance.textContent = coinsBalanceEl ? coinsBalanceEl.textContent : coinsState.balance;
          }
          coinModal.classList.remove('hidden');
          coinModal.classList.add('flex');
          setTimeout(() => {
            coinImgSmall.classList.add('scale-110');
          }, 10);
        };

        const closeCoinModal = () => {
          coinModal.classList.add('hidden');
          coinModal.classList.remove('flex');
          coinImgSmall.classList.remove('scale-110');
        };

        coinImgSmall.addEventListener('click', openCoinModal);
        const openBtn = document.getElementById('open-coins-modal');
        if (openBtn) openBtn.addEventListener('click', openCoinModal);

        coinModalClose.addEventListener('click', closeCoinModal);
        coinModal.addEventListener('click', (e) => {
          if (e.target === coinModal) closeCoinModal();
        });
      })();

      // –ü–µ—Ä–µ–≤–æ–¥ –æ—à–∏–±–æ–∫ Firebase –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      function translateAuthError(code) {
        let msg = '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
        if (code === 'auth/user-not-found') {
          msg = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è.';
        } else if (code === 'auth/wrong-password') {
          msg = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Å–±—Ä–æ—Å–æ–º –ø–∞—Ä–æ–ª—è.';
        } else if (code === 'auth/email-already-in-use') {
          msg = '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏.';
        } else if (code === 'auth/weak-password') {
          msg = '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π. –î–æ–±–∞–≤—å—Ç–µ –µ—â—ë —Å–∏–º–≤–æ–ª–æ–≤.';
        }
        authError.textContent = msg;
      }

      let registerMode = false;

      // –í—Ö–æ–¥
      authForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        authError.textContent = '';

        if (honeypotEl.value && honeypotEl.value.trim() !== '') {
          authError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
          return;
        }

        try {
          const email = authEmailEl.value.trim();
          const pass  = authPassEl.value.trim();
          await auth.signInWithEmailAndPassword(email, pass);
        } catch (err) {
          console.error(err);
          translateAuthError(err.code);
        }
      });

      // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–¥–≤—É—Ö—à–∞–≥–æ–≤–∞—è)
      authRegister.addEventListener('click', async () => {
        authError.textContent = '';

        if (honeypotEl.value && honeypotEl.value.trim() !== '') {
          authError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
          return;
        }

        if (!registerMode) {
          registerMode = true;
          authExtra.classList.remove('hidden');
          authError.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª.';
          return;
        }

        try {
          const email = authEmailEl.value.trim();
          const pass  = authPassEl.value.trim();
          const first = authFirstEl.value.trim();
          const last  = authLastEl.value.trim();

          if (!email || !pass) {
            authError.textContent = '–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å.';
            return;
          }
          if (!first || !last) {
            authError.textContent = '–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é.';
            return;
          }

          const cred = await auth.createUserWithEmailAndPassword(email, pass);
          const user = cred.user;
          if (user) {
            const uid = user.uid;
            const usersCol = db.collection('users');
            const docRef   = usersCol.doc(email);

            await docRef.set({
              email,
              firstName: first,
              lastName: last,
              uid: uid || null,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });

            authError.textContent = '';
            registerMode = false;
            authExtra.classList.add('hidden');
          }
        } catch (err) {
          console.error(err);
          translateAuthError(err.code);
        }
      });

      // –í—ã—Ö–æ–¥
      if (authLogout) {
        authLogout.addEventListener('click', async () => {
          await auth.signOut();
        });
      }

      /* —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
      async function setAuthState(user) {
        if (user) {
          localStorage.setItem('pt_uid', user.uid || '');
          if (user.email) localStorage.setItem('pt_email', user.email);

          authBoxOut.classList.add('hidden');
          authBoxIn.classList.remove('hidden');
          coursesNeedAuth.classList.add('hidden');
          authUserEmail.textContent = user.email || '';

          await loadUserProfile(user);
          await loadUserEnrollments(user);
          await loadAchievementsFromFirestore(user);
          await loadCoins(user);
        } else {
          localStorage.removeItem('pt_uid');
          localStorage.removeItem('pt_email');

          authBoxOut.classList.remove('hidden');
          authBoxIn.classList.add('hidden');
          coursesNeedAuth.classList.remove('hidden');
          authUserEmail.textContent = '';
          profileName.textContent = '';
          profileAvatarImg.src = '/assets/avatarf.png';
          if (profileAvatarType) profileAvatarType.value = 'girl';
          setAvatarChoice('girl');
          coursesList.innerHTML = '';
          coursesEmpty.classList.add('hidden');
          if (achievementsEarned) achievementsEarned.innerHTML = '';
          if (achievementsEmpty) achievementsEmpty.classList.remove('hidden');
          if (achievementsOpenModalBtn) achievementsOpenModalBtn.classList.add('hidden');
          currentMedals = [];
          if (coinsCard) {
            coinsCard.classList.add('hidden');
          }
        }
      }

      /* –ø—Ä–æ—Ñ–∏–ª—å: —á—Ç–µ–Ω–∏–µ (email + uid, —Å–ª–∏—è–Ω–∏–µ) */
      async function loadUserProfile(user) {
        try {
          const email = user.email || null;
          const uid   = user.uid   || null;
          if (!email && !uid) return;

          const usersCol = db.collection('users');
          const emailRef = email ? usersCol.doc(email) : null;
          const uidRef   = uid   ? usersCol.doc(uid)   : null;

          const [emailSnap, uidSnap] = await Promise.all([
            emailRef ? emailRef.get() : Promise.resolve(null),
            uidRef   ? uidRef.get()   : Promise.resolve(null)
          ]);

          const emailData = emailSnap && emailSnap.exists ? (emailSnap.data() || {}) : null;
          const uidData   = uidSnap   && uidSnap.exists   ? (uidSnap.data()   || {}) : null;

          let data = {
            ...(uidData || {}),
            ...(emailData || {}),
          };

          if (email) data.email = data.email || email;

          const first = data.firstName || '';
          const last  = data.lastName || '';
          profileFirst.value = first;
          profileLast.value  = last;
          profileName.textContent = [first,last].filter(Boolean).join(' ') || (data.email || '');

          const avatarType = data.avatarType || 'girl';
          const avatarUrl  = data.avatarUrl  || '';
          if (profileAvatarType) profileAvatarType.value = avatarType;
          profileAvatarUrl.value = avatarUrl || '';

          if (avatarType === 'girl') {
            profileAvatarImg.src = '/assets/avatarf.png';
            profileAvatarImg.classList.remove('hidden');
            profileAvatarEmoji.classList.add('hidden');
          } else if (avatarType === 'boy') {
            profileAvatarImg.src = '/assets/avatarm.png';
            profileAvatarImg.classList.remove('hidden');
            profileAvatarEmoji.classList.add('hidden');
          } else if (avatarType === 'custom' && avatarUrl) {
            profileAvatarImg.src = avatarUrl;
            profileAvatarImg.classList.remove('hidden');
            profileAvatarEmoji.classList.add('hidden');
          } else {
            profileAvatarImg.classList.add('hidden');
            profileAvatarEmoji.classList.remove('hidden');
            profileAvatarEmoji.textContent = 'üòä';
          }

          setAvatarChoice(avatarType);
          profileSettings.classList.remove('hidden');
          const avatarChoices = document.getElementById('avatar-choices');
          if (avatarChoices) avatarChoices.classList.remove('hidden');
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', err);
        }
      }

      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
      profileForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        profileMsg.textContent = '';

        const user = auth.currentUser;
        if (!user) {
          profileMsg.textContent = '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.';
          return;
        }

        try {
          const email = user.email || null;
          const uid   = user.uid   || null;
          if (!email && !uid) {
            profileMsg.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.';
            return;
          }

          const first = profileFirst.value.trim();
          const last  = profileLast.value.trim();
          const avatarType = profileAvatarType ? profileAvatarType.value : 'girl';
          const avatarUrl  = profileAvatarUrl.value.trim();

          const usersCol = db.collection('users');
          const docRef   = usersCol.doc(email || uid);

          await docRef.set({
            email: email || null,
            uid: uid || null,
            firstName: first || null,
            lastName: last || null,
            avatarType: avatarType || 'girl',
            avatarUrl: avatarUrl || null,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          }, { merge: true });

          profileMsg.textContent = '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω.';
          profileName.textContent = [first,last].filter(Boolean).join(' ') || (email || '');

          if (avatarType === 'girl') {
            profileAvatarImg.src = '/assets/avatarf.png';
            profileAvatarImg.classList.remove('hidden');
            profileAvatarEmoji.classList.add('hidden');
          } else if (avatarType === 'boy') {
            profileAvatarImg.src = '/assets/avatarm.png';
            profileAvatarImg.classList.remove('hidden');
            profileAvatarEmoji.classList.add('hidden');
          } else if (avatarType === 'custom' && avatarUrl) {
            profileAvatarImg.src = avatarUrl;
            profileAvatarImg.classList.remove('hidden');
            profileAvatarEmoji.classList.add('hidden');
          } else {
            profileAvatarImg.classList.add('hidden');
            profileAvatarEmoji.classList.remove('hidden');
            profileAvatarEmoji.textContent = 'üòä';
          }
          setAvatarChoice(avatarType);
        } catch (err) {
          console.error(err);
          profileMsg.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
        }
      });

      /* –∫—É—Ä—Å—ã: —á—Ç–µ–Ω–∏–µ –∏ —Å–ª–∏—è–Ω–∏–µ email+uid, –ø–ª—é—Å –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –∫—É—Ä—Å—ã –∏–∑ progress */
      async function loadUserEnrollments(user) {
        coursesList.innerHTML = '';
        coursesEmpty.classList.add('hidden');

        try {
          const email = user.email || null;
          const uid   = user.uid   || null;

          if (!email && !uid) {
            coursesEmpty.classList.remove('hidden');
            return;
          }

          const usersCol = db.collection('users');
          const emailRef = email ? usersCol.doc(email) : null;
          const uidRef   = uid   ? usersCol.doc(uid)   : null;

          const [emailSnap, uidSnap] = await Promise.all([
            emailRef ? emailRef.get() : Promise.resolve(null),
            uidRef   ? uidRef.get()   : Promise.resolve(null)
          ]);

          const emailData = emailSnap && emailSnap.exists ? (emailSnap.data() || {}) : null;
          const uidData   = uidSnap   && uidSnap.exists   ? (uidSnap.data()   || {}) : null;

          const paidFromEmail = Array.isArray(emailData?.courses)     ? emailData.courses     : [];
          const paidFromUid   = Array.isArray(uidData?.courses)       ? uidData.courses       : [];
          const freeFromEmail = Array.isArray(emailData?.freeCourses) ? emailData.freeCourses : [];
          const freeFromUid   = Array.isArray(uidData?.freeCourses)   ? uidData.freeCourses   : [];

          const progressEmail = emailData?.progress || {};
          const progressUid   = uidData?.progress   || {};
          const mergedProgress = {
            ...(progressUid || {}),
            ...(progressEmail || {}),
          };

          const progressCourseIds = Object.keys(mergedProgress || {});

          let mergedPaid = Array.from(new Set([...paidFromUid, ...paidFromEmail]));
          let mergedFree = Array.from(new Set([
            ...freeFromUid,
            ...freeFromEmail,
            ...progressCourseIds.filter(id => !mergedPaid.includes(id))
          ]));

          const courses = [];

          for (const id of mergedPaid) {
            courses.push({
              id,
              isPaid:true,
              isFree:false,
              progress: mergedProgress[id] || null
            });
          }
          for (const id of mergedFree) {
            if (!mergedPaid.includes(id)) {
              courses.push({
                id,
                isPaid:false,
                isFree:true,
                progress: mergedProgress[id] || null
              });
            }
          }

          courses.sort((a,b) => (a.id || '').localeCompare(b.id || ''));

          renderCourses(courses);

          if (emailRef) {
            try {
              await emailRef.set(
                {
                  email: emailData?.email || email || null,
                  courses: mergedPaid,
                  freeCourses: mergedFree,
                  progress: mergedProgress
                },
                { merge: true }
              );
            } catch (e) {
              console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å—ã uid‚Üíemail:', e);
            }
          }
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤:', err);
          renderCourses([]);
        }
      }

      /* –ú–ï–î–ê–õ–ò: –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Firestore –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ */
      async function loadAchievementsFromFirestore(user) {
        if (!user) return;
        const email = user.email || null;
        if (!email) return;

        try {
          const usersCol = db.collection('users');
          const userRef  = usersCol.doc(email);
          const userSnap = await userRef.get();
          const userData = userSnap.exists ? (userSnap.data() || {}) : {};

          const earnedIds = Array.isArray(userData.earnedMedals)
            ? userData.earnedMedals
            : [];

          const catalogRef = db.collection('medals_catalog');
          let catalogSnap;
          try {
            catalogSnap = await catalogRef.orderBy('order', 'asc').get();
          } catch (orderErr) {
            console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–∞–ª–∏ –ø–æ –ø–æ–ª—é order, –ø—Ä–æ–±—É–µ–º –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:', orderErr);
            catalogSnap = await catalogRef.get();
          }

          const allMedals = catalogSnap.docs.map((doc) => {
            const data = doc.data() || {};
            return {
              id: doc.id,
              icon: data.icon || 'üèÖ',
              title: data.title || '–ú–µ–¥–∞–ª—å',
              desc: data.description || '',
              earned: earnedIds.includes(doc.id)
            };
          });

          currentMedals = allMedals;
          renderAchievementsPreview();
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∞–ª–µ–π –∏–∑ Firestore:', err);
        }
      }

      function renderAchievementsPreview() {
        if (!achievementsEarned || !achievementsEmpty) return;

        achievementsEarned.innerHTML = '';

        const earned = currentMedals.filter((m) => m.earned);

        if (!earned.length) {
          achievementsEmpty.classList.remove('hidden');
          if (achievementsOpenModalBtn) achievementsOpenModalBtn.classList.add('hidden');
          return;
        }

        achievementsEmpty.classList.add('hidden');
        if (achievementsOpenModalBtn) achievementsOpenModalBtn.classList.remove('hidden');

        earned.forEach((m) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className =
            'h-10 w-10 rounded-xl bg-amber-50 border border-amber-200 flex items-center justify-center text-lg shadow-sm hover:-translate-y-0.5 hover:shadow-md transition';
          btn.innerHTML = m.icon || 'üèÖ';
          if (m.title) btn.title = m.title;
          btn.addEventListener('click', () => {
            openAchievementsModal(m.id);
          });
          achievementsEarned.appendChild(btn);
        });
      }

      function openAchievementsModal(focusId) {
        if (!achievementsModal || !achievementsModalGrid) return;
        achievementsModal.classList.remove('hidden');
        achievementsModal.classList.add('flex');
        renderAchievementsModalGrid(focusId);
      }

      function closeAchievementsModal() {
        if (!achievementsModal) return;
        achievementsModal.classList.add('hidden');
        achievementsModal.classList.remove('flex');
      }

      function renderAchievementsModalGrid(focusId) {
        if (!achievementsModalGrid) return;

        achievementsModalGrid.innerHTML = '';

        if (!currentMedals.length) {
          achievementsModalGrid.innerHTML = '<p class="col-span-4 sm:col-span-5 text-xs text-slate-500">–ü–æ–∫–∞ —á—Ç–æ –≤ —Å–∏—Å—Ç–µ–º–µ –µ—â—ë –Ω–µ—Ç –º–µ–¥–∞–ª–µ–π. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã –Ω–∞—á–Ω—ë—Ç–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∫—É—Ä—Å—ã.</p>';
          if (achievementsModalTitle) achievementsModalTitle.textContent = '–ü–æ–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è –ø—É—Å—Ç–∞';
          if (achievementsModalDesc) achievementsModalDesc.textContent = '–ö–∞–∫ —Ç–æ–ª—å–∫–æ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–≤—ã–µ –º–µ–¥–∞–ª–∏, –≤—ã —É–≤–∏–¥–∏—Ç–µ –∏—Ö –∑–¥–µ—Å—å.';
          return;
        }

        let focused = null;

        currentMedals.forEach((m) => {
          const isEarned = !!m.earned;

          const card = document.createElement('button');
          card.type = 'button';
          card.className =
            'flex flex-col items-center gap-1 p-2 rounded-xl border text-[11px] sm:text-xs transition ' +
            (isEarned
              ? 'bg-amber-50 border-amber-200 text-slate-900'
              : 'bg-slate-50 border-slate-200 text-slate-400 opacity-70');

          card.innerHTML = `
            <div class="h-9 w-9 rounded-lg flex items-center justify-center text-lg ${isEarned ? 'bg-amber-100' : 'bg-slate-100'}">
              ${m.icon || 'üèÖ'}
            </div>
            <span class="truncate max-w-[5rem]">${m.title || '–ú–µ–¥–∞–ª—å'}</span>
          `;

          const activate = () => {
            focused = m;
            if (achievementsModalTitle) {
              achievementsModalTitle.textContent = m.title || '–ú–µ–¥–∞–ª—å';
            }
            if (achievementsModalDesc) {
              if (isEarned) {
                achievementsModalDesc.textContent =
                  m.desc || '–í—ã —É–∂–µ –ø–æ–ª—É—á–∏–ª–∏ —ç—Ç—É –º–µ–¥–∞–ª—å. –°–ø–∞—Å–∏–±–æ, —á—Ç–æ —É—á–∏—Ç–µ—Å—å!';
              } else {
                achievementsModalDesc.textContent = '–≠—Ç–∞ –º–µ–¥–∞–ª—å –µ—â—ë –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞. ???';
              }
            }
          };

          card.addEventListener('click', activate);
          card.addEventListener('mouseenter', activate);

          achievementsModalGrid.appendChild(card);

          if (!focused && focusId && m.id === focusId) {
            focused = m;
            setTimeout(activate, 0);
          }
        });

        if (!focused) {
          if (achievementsModalTitle) achievementsModalTitle.textContent =
            '–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–¥–∞–ª—å, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏';
          if (achievementsModalDesc) achievementsModalDesc.textContent =
            '–ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∏–∫–æ–Ω–∫—É –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.';
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
      if (achievementsOpenModalBtn) {
        achievementsOpenModalBtn.addEventListener('click', () => openAchievementsModal());
      }
      if (achievementsModalClose) {
        achievementsModalClose.addEventListener('click', closeAchievementsModal);
      }
      if (achievementsModal) {
        achievementsModal.addEventListener('click', (e) => {
          if (e.target === achievementsModal) {
            closeAchievementsModal();
          }
        });
      }

      function renderCourses(courses) {
        coursesList.innerHTML = '';
        if (!courses || courses.length === 0) {
          coursesEmpty.classList.remove('hidden');
          return;
        }
        coursesEmpty.classList.add('hidden');

        courses.forEach(c => {
          const meta = COURSE_META[c.id] || {
            title: c.id,
            short: '–ö—É—Ä—Å –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è',
            lang: '–Ø–∑—ã–∫',
            level: ''
          };

          const progressData = c.progress || {};
          const percent = typeof progressData.percent === 'number'
            ? Math.max(0, Math.min(100, progressData.percent))
            : 0;
          const lastLessonId = progressData.lastLessonId || null;

          const isFree = !!c.isFree;
          const isPaid = !!c.isPaid;

          const badgeLabel = isFree ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å' : '–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –∫—É—Ä—Å';
          const badgeClass = isFree
            ? 'border-emerald-300 bg-emerald-50 text-emerald-700'
            : 'border-amber-300 bg-amber-50 text-amber-700';

          let statusLabel;
          if (percent > 0 && lastLessonId) {
            statusLabel = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percent}% ¬∑ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫: ${lastLessonId}`;
          } else if (percent > 0) {
            statusLabel = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percent}%`;
          } else if (isPaid) {
            statusLabel = '–ö—É—Ä—Å –æ–ø–ª–∞—á–µ–Ω, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.';
          } else if (isFree) {
            statusLabel = '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å, –∂–¥—ë—Ç –≤–∞—à–µ–≥–æ —Å—Ç–∞—Ä—Ç–∞.';
          } else {
            statusLabel = '';
          }

          const href = meta.href || `/courses/${c.id}/`;

          const card = document.createElement('article');
          card.className = 'soft-card p-4 sm:p-5 space-y-3 flex flex-col justify-between';
          card.innerHTML = `
            <div class="flex items-start justify-between gap-3">
              <div class="space-y-1">
                <h3 class="text-sm sm:text-base font-semibold text-slate-900">${meta.title}</h3>
                <p class="text-xs sm:text-sm text-slate-600">${meta.short}</p>
                <p class="text-[11px] text-slate-400 uppercase tracking-[.18em] mt-1">
                  ${meta.lang || ''}${meta.level ? ' ¬∑ ' + meta.level : ''}
                </p>
              </div>
              <span class="badge ${badgeClass} text-[10px]">${badgeLabel}</span>
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between text-xs text-slate-500">
                <span>${statusLabel}</span>
                <span>${percent}%</span>
              </div>
              <div class="mt-1 h-1.5 rounded-full bg-slate-100 overflow-hidden">
                <div class="h-full bg-gradient-to-r from-emerald-400 to-emerald-500" style="width:${percent}%;"></div>
              </div>
            </div>
            <div class="pt-1">
              <a href="${href}" class="btn btn-brand w-full justify-center text-xs sm:text-sm">
                –û—Ç–∫—Ä—ã—Ç—å –∫—É—Ä—Å
              </a>
            </div>
          `;

          coursesList.appendChild(card);
        });
      }

      // –ü—Ä–∏–º–µ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ –∫—É—Ä—Å–∞–º (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ —É —Ç–µ–±—è)
      const COURSE_META = {
        'english-starter': {
          title: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —Å –Ω—É–ª—è',
          short: '–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞ –∏ –∑–∞–∂–∏–º–æ–≤.',
          lang: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π',
          level: 'A0‚ÄìA1',
          href: '/courses/english-starter/'
        }
        // —Å—é–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
      };

      auth.onAuthStateChanged((user) => {
        setAuthState(user || null);
      });
    });
  </script>
</body>
</html>
