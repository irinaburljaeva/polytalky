<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PolyTalky ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <meta name="description" content="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç PolyTalky: –≤–∞—à–∏ –∫—É—Ä—Å—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö." />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- —Ñ–∞–≤–∏–∫–æ–Ω -->
  <link rel="icon" type="image/jpg" href="/assets/favicon.jpg">
  <link rel="apple-touch-icon" href="/favicon.png">
  <style>
    :root{
      --brand-1:#FFBA08; /* –∂—ë–ª—Ç—ã–π */
      --brand-2:#F97316; /* –º—è–≥–∫–∏–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --brand-3:#10B981; /* –∑–µ–ª—ë–Ω—ã–π –¥–ª—è —É—Å–ø–µ—Ö–∞ */
      --brand-bg:#FEF9C3;
    }
    body{
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(circle at top left,#FEF9C3 0,#FEFCE8 40%,#F9FAFB 100%);
      color:#0f172a;
    }
    .wrap{max-width:1040px;margin:0 auto;}
    .card{
      border-radius:1.25rem;
      border:1px solid rgba(15,23,42,.08);
      background-color:rgba(255,255,255,.96);
      box-shadow:0 18px 45px rgba(15,23,42,.08);
    }
    .soft-card{
      border-radius:1rem;
      border:1px solid rgba(148,163,184,.25);
      background-color:rgba(255,255,255,.9);
    }
    .btn{
      border-radius:999px;
      padding:.55rem 1.1rem;
      font-weight:600;
      font-size:.85rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.4rem;
      transition:.15s;
      border:1px solid transparent;
      cursor:pointer;
      text-decoration:none;
      white-space:nowrap;
    }
    .btn-brand{
      background:var(--brand-1);
      color:#111827;
      border-color:#FDE68A;
    }
    .btn-brand:hover{
      background:#FACC15;
    }
    .btn-ghost{
      background:transparent;
      color:#111827;
      border-color:rgba(148,163,184,.6);
    }
    .btn-ghost:hover{
      background:rgba(148,163,184,.08);
    }
    .badge{
      border-radius:999px;
      font-size:.65rem;
      padding:.15rem .55rem;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:.06em;
      border:1px solid rgba(148,163,184,.5);
      background:rgba(249,250,251,.9);
      color:#4b5563;
    }
    /* honeypot */
    .hp-field{
      position:absolute;
      left:-9999px;
      opacity:0;
      pointer-events:none;
      height:0;width:0;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- HEADER -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 border-b border-slate-200/60">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between gap-4">
      <a href="/" class="flex items-center gap-2">
        <span class="inline-flex h-9 w-9 rounded-2xl bg-[var(--brand-1)] items-center justify-center text-xl shadow-md">üè∑Ô∏è</span>
        <span class="font-semibold text-slate-900 text-lg">PolyTalky</span>
      </a>
      <nav class="hidden sm:flex items-center gap-5 text-sm text-slate-700">
        <a href="/courses/" class="hover:text-slate-900">–ö—É—Ä—Å—ã</a>
        <a href="/shop/" class="hover:text-slate-900">–ú–∞–≥–∞–∑–∏–Ω</a>
        <span class="font-semibold text-slate-900">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span>
      </nav>
    </div>
  </header>

  <main class="flex-1">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-6 sm:py-10 space-y-6">

      <!-- HERO / AUTH CARD -->
      <section class="card p-5 sm:p-7 space-y-5">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-5">
          <div class="space-y-2 max-w-xl">
            <p class="text-xs font-semibold tracking-[.2em] uppercase text-amber-700">
              –í–∞—à —É–≥–æ–ª–æ–∫ –≤ PolyTalky
            </p>
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">
              –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç <span class="text-amber-600">—è–∑—ã–∫–æ–≤–æ–≥–æ –≥–µ—Ä–æ—è</span>
            </h1>
            <p class="text-sm sm:text-base text-slate-600">
              –ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–∞—à–∏ –∫—É—Ä—Å—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å.
              –í–æ–π–¥–∏—Ç–µ –ø–æ email, —á—Ç–æ–±—ã –≤—Å—ë —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å –º–µ–∂–¥—É —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º, –ø–ª–∞–Ω—à–µ—Ç–æ–º –∏ –Ω–æ—É—Ç–±—É–∫–æ–º.
            </p>
          </div>

          <!-- –±–ª–æ–∫ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–≤–æ—à—ë–ª" -->
          <div id="auth-when-logged-in" class="hidden soft-card px-4 py-3 sm:px-5 sm:py-4 flex items-center gap-3 min-w-[260px]">
            <div id="profile-avatar" class="h-12 w-12 rounded-full bg-[var(--brand-1)]/60 flex items-center justify-center text-xl font-bold text-slate-900 shadow-inner">
              üòä
            </div>
            <div class="flex-1">
              <div class="text-xs uppercase tracking-wide text-slate-500">–í—ã –≤–æ—à–ª–∏ –∫–∞–∫</div>
              <div id="profile-name" class="font-semibold text-slate-900 text-sm"></div>
              <div id="auth-user-email" class="text-xs text-slate-500"></div>
            </div>
            <button id="auth-logout" class="btn btn-ghost text-xs px-3 py-1">–í—ã–π—Ç–∏</button>
          </div>
        </div>

        <!-- –±–ª–æ–∫ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–ù–ï –≤–æ—à—ë–ª" -->
        <div id="auth-when-logged-out" class="soft-card p-4 sm:p-5 text-sm text-slate-700 space-y-3">
          <p class="font-semibold text-slate-900">–í–æ–π–¥–∏—Ç–µ –≤ PolyTalky</p>
          <p class="text-xs sm:text-sm text-slate-600">
            –ê–∫–∫–∞—É–Ω—Ç –ø–æ email —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤–∞—à–∏ –∫—É—Ä—Å—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è. –ï—Å–ª–∏ –µ—â—ë –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞ ‚Äî –Ω–∞–∂–º–∏—Ç–µ ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª.
          </p>

          <form id="auth-form" class="space-y-3 text-sm">
            <!-- honeypot -->
            <input id="auth-website" type="text" autocomplete="off" class="hp-field" aria-hidden="true" />

            <div class="grid sm:grid-cols-[minmax(0,1.5fr)_minmax(0,1.5fr)_minmax(0,1.2fr)] gap-3">
              <input id="auth-email" type="email" required
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                     placeholder="email@example.com" />
              <input id="auth-pass" type="password" required
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                     placeholder="–ü–∞—Ä–æ–ª—å" />
              <div class="flex gap-2">
                <button type="submit" id="btn-login" class="btn btn-brand flex-1">–í–æ–π—Ç–∏</button>
                <button type="button" id="auth-register" class="btn btn-ghost flex-1">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
              </div>
            </div>

            <!-- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div class="grid sm:grid-cols-2 gap-3 hidden" id="auth-extra">
              <input id="auth-first" type="text"
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                     placeholder="–ò–º—è (–¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)" />
              <input id="auth-last" type="text"
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                     placeholder="–§–∞–º–∏–ª–∏—è (–¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)" />
            </div>
          </form>

          <p id="auth-error" class="mt-1 text-xs text-red-500 min-h-[1.25rem]"></p>
          <p class="mt-1 text-[11px] text-slate-500 leading-relaxed">
            –ù–∞–∂–∏–º–∞—è ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å
            <a class="underline" href="/legal/offer.html" target="_blank">–ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç–æ–π</a>
            –∏
            <a class="underline" href="/legal/privacy.html" target="_blank">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.
          </p>
        </div>

        <!-- –ú–∏–Ω–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è (—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤–æ—à–ª–∏) -->
        <div id="profile-settings" class="hidden pt-4 border-t border-dashed border-amber-200 mt-2">
          <p class="text-xs font-semibold uppercase tracking-[.18em] text-amber-700 mb-2">–ü—Ä–æ—Ñ–∏–ª—å</p>
          <form id="profile-form" class="grid gap-3 text-xs sm:text-sm sm:grid-cols-[minmax(0,1.1fr)_minmax(0,1.1fr)_minmax(0,1.4fr)_auto] items-end">
            <input id="profile-first" type="text"
                   class="rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                   placeholder="–ò–º—è" />
            <input id="profile-last" type="text"
                   class="rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                   placeholder="–§–∞–º–∏–ª–∏—è" />
            <input id="profile-avatar-url" type="url"
                   class="rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)] focus:border-[var(--brand-1)]"
                   placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
            <button type="submit" class="btn btn-ghost text-xs px-3 py-2">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
          </form>
          <p id="profile-msg" class="mt-1 text-[11px] text-slate-500"></p>
        </div>
      </section>

      <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢: –ö–£–†–°–´ + –î–û–°–¢–ò–ñ–ï–ù–ò–Ø -->
      <section class="grid gap-6 lg:grid-cols-[minmax(0,1.4fr)_minmax(0,1.1fr)]">
        <!-- –ö–£–†–°–´ -->
        <div class="space-y-3">
          <div class="flex items-center justify-between gap-3">
            <div>
              <h2 class="text-lg sm:text-xl font-bold text-slate-900">–í–∞—à–∏ –∫—É—Ä—Å—ã</h2>
              <p class="text-xs text-slate-500">
                –ü–æ–∫—É–ø–∫–∏ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
              </p>
            </div>
            <a href="/courses/" class="text-xs sm:text-sm text-amber-700 hover:text-amber-900 font-medium">
              –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥ ‚Üí
            </a>
          </div>

          <div id="courses-need-auth" class="soft-card p-4 text-sm text-slate-600">
            –ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –∫—É—Ä—Å—ã, <span class="font-semibold text-slate-900">–≤–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span> –≤—ã—à–µ.
          </div>

          <div id="courses-list" class="grid gap-4 sm:grid-cols-2"></div>

          <p id="courses-empty" class="hidden text-sm text-slate-500">
            –ü–æ–∫–∞ —É –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤. –ó–∞–≥–ª—è–Ω–∏—Ç–µ –≤
            <a href="/shop/" class="underline">–º–∞–≥–∞–∑–∏–Ω</a> –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ
            <a href="/courses/" class="underline">–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å</a>.
          </p>
        </div>

        <!-- –î–û–°–¢–ò–ñ–ï–ù–ò–Ø -->
        <aside class="space-y-3">
          <div class="flex items-center justify-between gap-3">
            <h2 class="text-lg sm:text-xl font-bold text-slate-900">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
            <span class="badge bg-amber-50 border-amber-200 text-amber-700">–ë–µ—Ç–∞</span>
          </div>
          <p class="text-xs sm:text-sm text-slate-600">
            –ú–µ–¥–∞–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–æ–≥–¥–∞ –≤—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç–µ –∫—É—Ä—Å—ã –∏ —É—á–∏—Ç–µ—Å—å. –≠—Ç–æ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–≤–æ–¥—ã –≥–æ—Ä–¥–∏—Ç—å—Å—è —Å–æ–±–æ–π.
          </p>

          <div id="achievements-list" class="grid gap-3">
            <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –º–µ–¥–∞–ª–∏ -->
          </div>
        </aside>
      </section>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-slate-200/70 bg-white/80 backdrop-blur py-6 text-sm text-slate-600 mt-8">
    <div class="wrap px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
      <p>¬© 2025 PolyTalky. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      <div class="flex flex-wrap gap-4">
        <a href="/contact.html" class="hover:text-slate-900">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <a href="/legal/privacy.html" class="hover:text-slate-900">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        <a href="/legal/offer.html" class="hover:text-slate-900">–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</a>
        <a href="/legal/cookies.html" class="hover:text-slate-900">Cookies</a>
        <a href="/legal/consent.html" class="hover:text-slate-900">–°–æ–≥–ª–∞—Å–∏–µ</a>
      </div>
    </div>
  </footer>

  <!-- COOKIE –ë–ê–ù–ù–ï–† -->
  <div id="cookie-banner" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-900 text-white shadow-lg rounded-xl px-4 py-3 text-xs sm:text-sm flex items-center gap-3 hidden">
    <span>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookies –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞. –ü—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∞–π—Ç–æ–º, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —ç—Ç–∏–º.</span>
    <button id="cookie-accept" class="btn btn-brand text-xs px-3 py-1">–ü–æ–Ω—è—Ç–Ω–æ</button>
  </div>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBAU_uMTePpKwVNZNhqk2pss2PuSitGfQI",
      authDomain: "polytalky-70999.firebaseapp.com",
      projectId: "polytalky-70999",
      storageBucket: "polytalky-70999.firebasestorage.app",
      messagingSenderId: "62407152289",
      appId: "1:62407152289:web:b0c0efdb2472f12b10d6e0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();

    // –ö–∞—Ä—Ç–∞ –∫—É—Ä—Å–æ–≤: id –∏–∑ Firestore ‚Üí –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
    // –ó–¥–µ—Å—å –ø–æ–¥—Å—Ç–∞–≤–∏—à—å —Å–≤–æ–∏ —Ä–µ–∞–ª—å–Ω—ã–µ id –∏ –ø—É—Ç–∏
    const COURSE_META = {
      'spanish-a1-basics': {
        title: '–ò—Å–ø–∞–Ω—Å–∫–∏–π A1: –ë–∞–∑–æ–≤—ã–π —Å—Ç–∞—Ä—Ç',
        href: '/courses/spanish-a1-basics/',
        cover: '/assets/courses/spanish-a1.jpg'
      },
      'spanish-verbs-mini': {
        title: '–ú–∏–Ω–∏-–∫—É—Ä—Å: –ò—Å–ø–∞–Ω—Å–∫–∏–µ –≥–ª–∞–≥–æ–ª—ã',
        href: '/courses/spanish-verbs-mini/',
        cover: '/assets/courses/spanish-verbs.jpg'
      }
      // –¥–æ–±–∞–≤–∏—à—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    };
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã ---
      const authBoxOut      = document.getElementById('auth-when-logged-out');
      const authBoxIn       = document.getElementById('auth-when-logged-in');
      const authEmailEl     = document.getElementById('auth-email');
      const authPassEl      = document.getElementById('auth-pass');
      const authFirstEl     = document.getElementById('auth-first');
      const authLastEl      = document.getElementById('auth-last');
      const honeypotEl      = document.getElementById('auth-website');
      const authForm        = document.getElementById('auth-form');
      const authRegister    = document.getElementById('auth-register');
      const btnLogin        = document.getElementById('btn-login');
      const authError       = document.getElementById('auth-error');
      const authLogout      = document.getElementById('auth-logout');
      const authUserEmail   = document.getElementById('auth-user-email');
      const authExtra       = document.getElementById('auth-extra');

      const profileAvatar   = document.getElementById('profile-avatar');
      const profileName     = document.getElementById('profile-name');
      const profileSettings = document.getElementById('profile-settings');
      const profileForm     = document.getElementById('profile-form');
      const profileFirst    = document.getElementById('profile-first');
      const profileLast     = document.getElementById('profile-last');
      const profileAvatarUrl= document.getElementById('profile-avatar-url');
      const profileMsg      = document.getElementById('profile-msg');

      const coursesNeedAuth = document.getElementById('courses-need-auth');
      const coursesList     = document.getElementById('courses-list');
      const coursesEmpty    = document.getElementById('courses-empty');

      const achievementsList= document.getElementById('achievements-list');

      // cookie
      const banner       = document.getElementById('cookie-banner');
      const btnCookie    = document.getElementById('cookie-accept');
      if (!localStorage.getItem('cookieConsent')) {
        banner.classList.remove('hidden');
      }
      btnCookie.addEventListener('click', () => {
        localStorage.setItem('cookieConsent', 'true');
        banner.classList.add('hidden');
      });

      // —Ä–µ–∂–∏–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      let registerMode = false;

      // --- –ü–µ—Ä–µ–≤–æ–¥ –æ—à–∏–±–æ–∫ Firebase ---
      function showAuthError(code, mode) {
        let msg = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';

        switch (code) {
          case 'auth/user-not-found':
            msg = '–ê–∫–∫–∞—É–Ω—Ç —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.';
            break;
          case 'auth/wrong-password':
            msg = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–∫–ª–∞–¥–∫—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
            break;
          case 'auth/invalid-email':
            msg = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, name@example.com).';
            break;
          case 'auth/too-many-requests':
            msg = '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –ø–∞—Ä—É –º–∏–Ω—É—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
            break;
          case 'auth/email-already-in-use':
            msg = '–ê–∫–∫–∞—É–Ω—Ç —Å —Ç–∞–∫–∏–º email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ¬´–í–æ–π—Ç–∏¬ª.';
            break;
          case 'auth/weak-password':
            msg = '–°–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –Ω–µ –∫–æ—Ä–æ—á–µ 6 —Å–∏–º–≤–æ–ª–æ–≤.';
            break;
          case 'auth/operation-not-allowed':
            msg = '–í—Ö–æ–¥ –ø–æ email –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏.';
            break;
        }
        if (mode === 'login' && code === 'auth/invalid-credential') {
          msg = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.';
        }
        authError.textContent = msg;
      }

      // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ ---
      async function setAuthState(user) {
        if (user) {
          authBoxOut.classList.add('hidden');
          authBoxIn.classList.remove('hidden');
          coursesNeedAuth.classList.add('hidden');
          authUserEmail.textContent = user.email || '';

          registerMode = false;
          authExtra.classList.add('hidden');
          authFirstEl.value = '';
          authLastEl.value  = '';

          await loadUserProfile(user);
          await loadUserEnrollments(user);
        } else {
          authBoxOut.classList.remove('hidden');
          authBoxIn.classList.add('hidden');
          coursesNeedAuth.classList.remove('hidden');
          authUserEmail.textContent = '';
          profileSettings.classList.add('hidden');
          profileName.textContent = '';
          profileAvatar.textContent = 'üòä';
          profileAvatar.style.backgroundImage = '';
          profileAvatar.classList.remove('overflow-hidden');

          coursesList.innerHTML = '';
          coursesEmpty.classList.add('hidden');
          achievementsList.innerHTML = renderAchievements([]);
        }
      }

      // --- –í—Ö–æ–¥ ---
      authForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        authError.textContent = '';

        if (honeypotEl.value && honeypotEl.value.trim() !== '') {
          authError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
          return;
        }

        try {
          const email = authEmailEl.value.trim();
          const pass  = authPassEl.value.trim();
          await auth.signInWithEmailAndPassword(email, pass);
        } catch (err) {
          console.error(err);
          showAuthError(err.code, 'login');
        }
      });

      // --- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–¥–≤—É—Ö—à–∞–≥–æ–≤–∞—è) ---
      authRegister.addEventListener('click', async () => {
        authError.textContent = '';

        if (honeypotEl.value && honeypotEl.value.trim() !== '') {
          authError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
          return;
        }

        // –ø–µ—Ä–≤—ã–π –∫–ª–∏–∫ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –¥–æ–ø. –ø–æ–ª—è
        if (!registerMode) {
          registerMode = true;
          authExtra.classList.remove('hidden');
          authError.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª.';
          return;
        }

        try {
          const email = authEmailEl.value.trim();
          const pass  = authPassEl.value.trim();
          const first = authFirstEl.value.trim();
          const last  = authLastEl.value.trim();

          if (!email || !pass) {
            authError.textContent = '–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å.';
            return;
          }
          if (!first || !last) {
            authError.textContent = '–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é.';
            return;
          }

          const cred = await auth.createUserWithEmailAndPassword(email, pass);
          // –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email, —á—Ç–æ–±—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å backend (Stripe webhook)
          await db.collection('users').doc(email).set({
            email: email,
            firstName: first,
            lastName: last,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            avatarUrl: ''
          }, { merge: true });
        } catch (err) {
          console.error(err);
          showAuthError(err.code, 'register');
        }
      });

      // --- –í—ã—Ö–æ–¥ ---
      if (authLogout) {
        authLogout.addEventListener('click', async () => {
          await auth.signOut();
        });
      }

      // --- –ü—Ä–æ—Ñ–∏–ª—å (–¥–∞–Ω–Ω—ã–µ –∏ –∞–≤–∞—Ç–∞—Ä) ---
      async function loadUserProfile(user) {
        try {
          const email = user.email;
          if (!email) return;

          const doc = await db.collection('users').doc(email).get();
          let data = doc.exists ? doc.data() : null;

          const first = data?.firstName || '';
          const last  = data?.lastName || '';
          const avatarUrl = data?.avatarUrl || '';

          const displayName = (first || last)
            ? (first + ' ' + (last || '')).trim()
            : email;

          profileName.textContent = displayName;
          authUserEmail.textContent = email;

          profileFirst.value = first;
          profileLast.value  = last;
          profileAvatarUrl.value = avatarUrl || '';

          // –∞–≤–∞—Ç–∞—Ä
          if (avatarUrl) {
            profileAvatar.style.backgroundImage = `url('${avatarUrl}')`;
            profileAvatar.style.backgroundSize = 'cover';
            profileAvatar.style.backgroundPosition = 'center';
            profileAvatar.textContent = '';
            profileAvatar.classList.add('overflow-hidden');
          } else {
            profileAvatar.style.backgroundImage = '';
            profileAvatar.classList.remove('overflow-hidden');
            const base = displayName || email || 'üôÇ';
            const letter = base.trim().charAt(0).toUpperCase();
            profileAvatar.textContent = letter || 'üôÇ';
          }

          profileSettings.classList.remove('hidden');
          profileMsg.textContent = '';
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è:', err);
        }
      }

      profileForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        profileMsg.textContent = '';

        const user = auth.currentUser;
        if (!user || !user.email) return;

        try {
          const first = profileFirst.value.trim();
          const last  = profileLast.value.trim();
          const avatarUrl = profileAvatarUrl.value.trim();

          await db.collection('users').doc(user.email).set({
            firstName:first,
            lastName:last,
            avatarUrl:avatarUrl
          }, { merge:true });

          await loadUserProfile(user);
          profileMsg.textContent = '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω ‚úî';
        } catch (err) {
          console.error(err);
          profileMsg.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
        }
      });

      // --- –ö—É—Ä—Å—ã: –ø–ª–∞—Ç–Ω—ã–µ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ---
      async function loadUserEnrollments(user) {
        coursesList.innerHTML = '';
        coursesEmpty.classList.add('hidden');

        try {
          const email = user.email;
          if (!email) {
            coursesEmpty.classList.remove('hidden');
            achievementsList.innerHTML = renderAchievements([]);
            return;
          }

          const doc = await db.collection('users').doc(email).get();

          if (!doc.exists) {
            coursesEmpty.classList.remove('hidden');
            achievementsList.innerHTML = renderAchievements([]);
            return;
          }

          const data = doc.data() || {};
          const paidIds  = Array.isArray(data.courses)     ? data.courses     : [];
          const freeIds  = Array.isArray(data.freeCourses) ? data.freeCourses : [];
          const progress = data.progress || {}; // { [courseId]: {percent: 0‚Äì100, ...} }

          const courses = [];

          // –û–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞
          for (const id of paidIds) {
            courses.push({
              id,
              isPaid: true,
              isFree: false,
              progress: progress[id] || null
            });
          }

          // –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (–∫–æ–≥–¥–∞ id –∑–∞–Ω–µ—Å—ë–Ω –≤ freeCourses)
          for (const id of freeIds) {
            if (paidIds.includes(id)) continue; // –Ω–µ –¥—É–±–ª–∏—Ä—É–µ–º
            courses.push({
              id,
              isPaid: false,
              isFree: true,
              progress: progress[id] || null
            });
          }

          renderCourses(courses);
          achievementsList.innerHTML = renderAchievements(courses);
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤:', err);
          renderCourses([]);
          achievementsList.innerHTML = renderAchievements([]);
        }
      }

      function renderCourses(courses) {
        coursesList.innerHTML = '';

        if (!courses || courses.length === 0) {
          coursesEmpty.classList.remove('hidden');
          return;
        }
        coursesEmpty.classList.add('hidden');

        courses.forEach(c => {
          const meta = COURSE_META[c.id] || {
            title: c.id,
            href: '#',
            cover: '/assets/courses/default.jpg'
          };

          const progressData = c.progress;
          const percent = progressData && typeof progressData.percent === 'number'
            ? Math.max(0, Math.min(100, progressData.percent))
            : 0;

          const isFree = !!c.isFree;
          const isPaid = !!c.isPaid;

          const badgeLabel = isFree ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å' : '–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –∫—É—Ä—Å';
          const badgeClass = isFree
            ? 'border-emerald-300 bg-emerald-50 text-emerald-700'
            : 'border-amber-300 bg-amber-50 text-amber-700';

          let statusLabel;
          if (percent > 0) {
            statusLabel = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percent}%`;
          } else if (isPaid) {
            statusLabel = '–ö—É—Ä—Å –æ–ø–ª–∞—á–µ–Ω, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.';
          } else {
            statusLabel = '–ö—É—Ä—Å –æ—Ç–∫—Ä—ã—Ç, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫.';
          }

          const card = document.createElement('a');
          card.href = meta.href;
          card.className = 'soft-card p-3 sm:p-4 flex flex-col gap-2 hover:shadow-md transition-shadow group';

          card.innerHTML = `
            <div class="flex gap-3 items-center">
              <div class="h-14 w-14 rounded-xl bg-slate-100 overflow-hidden flex-shrink-0">
                <img src="${meta.cover}" alt="${meta.title}"
                     class="h-full w-full object-cover group-hover:scale-[1.03] transition-transform">
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-0.5">
                  <span class="badge ${badgeClass}">
                    ${badgeLabel}
                  </span>
                </div>
                <p class="font-semibold text-sm text-slate-900 truncate">
                  ${meta.title}
                </p>
                <p class="text-[11px] text-slate-500 truncate">
                  ${statusLabel}
                </p>
              </div>
            </div>
            <div class="mt-1">
              <div class="h-1.5 w-full rounded-full bg-slate-100 overflow-hidden">
                <div class="h-full bg-[var(--brand-2)]" style="width:${percent}%;"></div>
              </div>
            </div>
          `;

          coursesList.appendChild(card);
        });
      }

      // --- –ú–µ–¥–∞–ª–∏ / –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è ---
      function renderAchievements(courses){
        const total = Array.isArray(courses) ? courses.length : 0;
        const paid  = courses.filter(c => c.isPaid).length;
        const free  = courses.filter(c => c.isFree).length;

        const medals = [
          {
            id:'first-course',
            icon:'ü•á',
            title:'–ü–µ—Ä–≤—ã–π —à–∞–≥',
            desc:'–í—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å. –û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ!',
            earned: total >= 1
          },
          {
            id:'three-courses',
            icon:'üéì',
            title:'–ú–∏–Ω–∏-–ø–æ–ª–∏–≥–ª–æ—Ç',
            desc:'–¢—Ä–∏ –∏ –±–æ–ª—å—à–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤.',
            earned: total >= 3
          },
          {
            id:'five-courses',
            icon:'üåç',
            title:'–ë—É–¥—É—â–∏–π –ø–æ–ª–∏–≥–ª–æ—Ç',
            desc:'–ü—è—Ç—å –∏ –±–æ–ª—å—à–µ –∫—É—Ä—Å–æ–≤ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ.',
            earned: total >= 5
          },
          {
            id:'free-lover',
            icon:'üéÅ',
            title:'–õ—é–±–∏—Ç–µ–ª—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤',
            desc:'–î–≤–∞ –∏ –±–æ–ª–µ–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–∞.',
            earned: free >= 2
          },
          {
            id:'investor',
            icon:'üí≥',
            title:'–ò–Ω–≤–µ—Å—Ç–æ—Ä –≤ –∑–Ω–∞–Ω–∏—è',
            desc:'–î–≤–∞ –∏ –±–æ–ª–µ–µ –ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤.',
            earned: paid >= 2
          }
        ];

        if (!medals.some(m => m.earned)) {
          return `
            <div class="soft-card p-4 text-xs sm:text-sm text-slate-600">
              –ü–µ—Ä–≤—ã–µ –º–µ–¥–∞–ª–∏ –ø–æ—è–≤—è—Ç—Å—è, –∫–æ–≥–¥–∞ –≤—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç–µ –∫—É—Ä—Å –≤
              <a href="/shop/" class="underline">–º–∞–≥–∞–∑–∏–Ω–µ</a> –∏–ª–∏ –Ω–∞—á–Ω—ë—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É.
            </div>`;
        }

        return medals.map(m => {
          const opacity = m.earned ? '' : 'opacity-50';
          const label   = m.earned ? '–ü–æ–ª—É—á–µ–Ω–æ' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ';
          const badgeCl = m.earned ? 'bg-emerald-50 border-emerald-200 text-emerald-700'
                                   : 'bg-slate-50 border-slate-200 text-slate-400';
          return `
            <article class="soft-card p-3 sm:p-4 flex items-start gap-3 ${opacity}">
              <div class="h-10 w-10 rounded-full bg-amber-50 flex items-center justify-center text-lg sm:text-xl">
                ${m.icon}
              </div>
              <div class="flex-1">
                <div class="flex items-center justify-between gap-2 mb-1">
                  <h3 class="font-semibold text-slate-900 text-sm sm:text-base">${m.title}</h3>
                  <span class="badge ${badgeCl}">${label}</span>
                </div>
                <p class="text-xs sm:text-sm text-slate-600">${m.desc}</p>
              </div>
            </article>`;
        }).join('');
      }

      // --- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ---
      auth.onAuthStateChanged((user) => {
        setAuthState(user || null);
      });
    });
  </script>
</body>
</html>
