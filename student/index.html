<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PolyTalky ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <meta name="description" content="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç PolyTalky: –≤–∞—à–∏ –∫—É—Ä—Å—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö." />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- —Ñ–∞–≤–∏–∫–æ–Ω -->
  <link rel="icon" type="image/jpg" href="/assets/favicon.jpg">
  <link rel="apple-touch-icon" href="/favicon.png">
  <style>
    :root{
      --brand-1:#FFBA08;
      --brand-2:#F97316;
      --brand-3:#10B981;

      --ink-1:#0F172A;
      --ink-2:#4B5563;
      --ink-soft:#9CA3AF;
      --bg-soft:#F9FAFB;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(circle at top left,#FEF9C3 0,#FEFCE8 40%,#F9FAFB 100%);
      color:#0f172a;
    }
    .wrap{max-width:1040px;margin:0 auto;}
    .card{
      border-radius:1.25rem;
      border:1px solid rgba(15,23,42,.08);
      background-color:rgba(255,255,255,.96);
      box-shadow:0 18px 45px rgba(15,23,42,.08);
    }
    .soft-card{
      border-radius:1rem;
      border:1px solid rgba(148,163,184,.18);
      background:rgba(255,255,255,.9);
    }
    .badge{
      border-radius:.6rem;
      padding:.25rem .45rem;
      font-size:.7rem;
      border:1px solid rgba(148,163,184,.3);
      background:rgba(248,250,252,.7);
    }
    .btn{
      border-radius:999px;
      padding:.55rem 1.2rem;
      font-size:.88rem;
      font-weight:600;
      border:1px solid transparent;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.4rem;
      white-space:nowrap;
    }
    .btn-main{
      background:linear-gradient(135deg,var(--brand-2),var(--brand-1));
      color:#111827;
      border-color:rgba(251,191,36,0.9);
      box-shadow:0 12px 30px rgba(234,179,8,.45);
    }
    .btn-main:hover{filter:brightness(1.03);}
    .btn-ghost{
      background:rgba(255,255,255,.7);
      border-color:rgba(148,163,184,.5);
      color:#374151;
    }
    .btn-ghost:hover{background:white;}
    .pill-label{
      border-radius:999px;
      padding:.18rem .6rem;
      font-size:.7rem;
      text-transform:uppercase;
      letter-spacing:.06em;
      border:1px solid rgba(148,163,184,.5);
      background:rgba(249,250,251,.9);
      color:#4b5563;
    }
    .hp-field{
      position:absolute;
      left:-9999px;
      opacity:0;
      pointer-events:none;
      height:0;width:0;
    }

    /* PRO-banners */
    .pro-banner{
      max-width:1040px;
      margin:0 auto 0;
      padding:10px 14px;
      border-radius:14px;
      display:none;
      align-items:flex-start;
      gap:10px;
      font-size:13px;
    }
    .pro-banner__icon{
      flex:0 0 28px;
      height:28px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      font-weight:600;
    }
    .pro-banner__body h2{
      margin:0 0 2px;
      font-size:14px;
      font-weight:600;
    }
    .pro-banner__body p{
      margin:0;
      font-size:13px;
    }
    .pro-banner--success{
      border:1px solid rgba(16,185,129,.4);
      background:linear-gradient(135deg,#ecfdf5,#f0fdf4,#ffffff);
      color:#065f46;
    }
    .pro-banner--success .pro-banner__icon{
      background:#22c55e;
      color:#ecfdf5;
      box-shadow:0 0 0 2px #bbf7d0;
    }
    .pro-banner--error{
      border:1px solid rgba(248,113,113,.4);
      background:linear-gradient(135deg,#fef2f2,#fee2e2,#ffffff);
      color:#b91c1c;
    }
    .pro-banner--error .pro-banner__icon{
      background:#ef4444;
      color:#fef2f2;
      box-shadow:0 0 0 2px #fecaca;
    }
    .pro-banner--cancel{
      border:1px solid rgba(148,163,184,.4);
      background:linear-gradient(135deg,#f9fafb,#e5e7eb,#ffffff);
      color:#374151;
    }
    .pro-banner--cancel .pro-banner__icon{
      background:#6b7280;
      color:#f9fafb;
      box-shadow:0 0 0 2px #e5e7eb;
    }
    .pro-banner__btn{
      margin-left:auto;
      border-radius:999px;
      padding:6px 14px;
      border:none;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
      background:#0f172a;
      color:#f9fafb;
      white-space:nowrap;
    }
    .pro-banner__btn:hover{background:#111827;}
    @media (max-width:640px){
      .pro-banner{
        margin:0 1rem;
        flex-direction:column;
        align-items:flex-start;
      }
      .pro-banner__btn{
        margin-left:0;
        margin-top:6px;
      }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- HEADER -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 border-b border-slate-200/60">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between gap-4">
      <a href="/" class="flex items-center gap-2">
        <div class="h-9 w-9 rounded-2xl overflow-hidden bg-white shadow-md flex items-center justify-center">
          <img src="/assets/logo.png" alt="PolyTalky" class="h-full w-full object-cover">
        </div>
        <span class="font-semibold text-slate-900 text-lg">PolyTalky</span>
      </a>
      <nav class="hidden sm:flex items-center gap-5 text-sm text-slate-700">
        <a href="/courses/" class="hover:text-slate-900">–ö—É—Ä—Å—ã</a>
        <a href="/shop/" class="hover:text-slate-900">–ú–∞–≥–∞–∑–∏–Ω</a>
        <span class="font-semibold text-slate-900">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span>
      </nav>
    </div>
  </header>

  <main class="flex-1">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-6 sm:py-10 space-y-6">

      <!-- PRO STATUS BANNERS -->
      <section id="pro-banner-success" class="pro-banner pro-banner--success">
        <div class="pro-banner__icon">‚úì</div>
        <div class="pro-banner__body">
          <h2>–ü–æ–¥–ø–∏—Å–∫–∞ PRO –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</h2>
          <p>–¢–µ–ø–µ—Ä—å –≤–∞—à–∏ –∑–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –∫—É—Ä–∞—Ç–æ—Ä–∞–º–∏, –∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –æ—Ç–≤–µ—Ç–∞—Ö –∏ –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –ø—Ä–æ–≥—Ä–µ—Å—Å—É.</p>
        </div>
      </section>

      <section id="pro-banner-error" class="pro-banner pro-banner--error">
        <div class="pro-banner__icon">!</div>
        <div class="pro-banner__body">
          <h2>–û–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞</h2>
          <p>–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ PRO. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã.</p>
        </div>
      </section>

      <section id="pro-banner-cancel" class="pro-banner pro-banner--cancel">
        <div class="pro-banner__icon">‚èπ</div>
        <div class="pro-banner__body">
          <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω–æ</h2>
          <p>–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –µ—ë –∑–∞–≤–µ—Ä—à–∏—Ç—å, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –æ—Ç–º–µ–Ω—É.</p>
        </div>
        <button type="button" id="pro-cancel-button" class="pro-banner__btn">
          –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
        </button>
      </section>

      <!-- HERO / AUTH CARD -->
      <section class="card p-5 sm:p-7 space-y-5">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-5">
          <div class="space-y-2 max-w-xl">
            <p class="text-xs font-semibold tracking-[.2em] uppercase text-amber-700">
              –í–∞—à —É–≥–æ–ª–æ–∫ –≤ PolyTalky
            </p>
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">
              –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç <span class="text-amber-600">—è–∑—ã–∫–æ–≤–æ–≥–æ –≥–µ—Ä–æ—è</span>
            </h1>
            <p class="text-sm sm:text-base text-slate-600">
              –ó–¥–µ—Å—å –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ –∫—É—Ä—Å—ã, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ—é –ª–∏—á–Ω—É—é –∫–∞—Ä—Ç—É –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ –º–∏—Ä–µ —è–∑—ã–∫–æ–≤.
            </p>
          </div>
          <div class="w-full max-w-sm mx-auto">
            <div id="auth-when-logged-out" class="space-y-4">
              <div class="soft-card p-4 space-y-3">
                <p class="text-xs font-semibold text-slate-700 uppercase tracking-[.18em]">
                  –í–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç
                </p>
                <p class="text-sm text-slate-600">
                  –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—Ç –∂–µ email, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∑—ã–≤–∞–ª–∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫—É—Ä—Å–æ–≤ –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ PolyTalky.
                </p>
                <p class="text-xs text-slate-500">
                  –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –º—ã –ø–æ–¥–±–µ—Ä—ë–º –¥–ª—è –≤–∞—Å –≤—Å–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
                </p>
              </div>
              <form id="auth-form" class="space-y-3">
                <div>
                  <label for="auth-email" class="block text-xs font-medium text-slate-600 mb-1">
                    Email
                  </label>
                  <input
                    id="auth-email"
                    type="email"
                    autocomplete="email"
                    required
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                    placeholder="you@example.com"
                  />
                </div>
                <div>
                  <label for="auth-pass" class="block text-xs font-medium text-slate-600 mb-1">
                    –ü–∞—Ä–æ–ª—å
                  </label>
                  <input
                    id="auth-pass"
                    type="password"
                    autocomplete="current-password"
                    required
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                    placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤"
                  />
                </div>

                <!-- honeypot -->
                <input id="auth-website" type="text" class="hp-field" autocomplete="off" />

                <div id="auth-extra" class="space-y-3 hidden">
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                      <label for="auth-first" class="block text-xs font-medium text-slate-600 mb-1">
                        –ò–º—è
                      </label>
                      <input
                        id="auth-first"
                        type="text"
                        class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, Anna"
                      />
                    </div>
                    <div>
                      <label for="auth-last" class="block text-xs font-medium text-slate-600 mb-1">
                        –§–∞–º–∏–ª–∏—è
                      </label>
                      <input
                        id="auth-last"
                        type="text"
                        class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                        placeholder="–§–∞–º–∏–ª–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                      />
                    </div>
                  </div>
                  <p class="text-[11px] text-slate-500">
                    –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ –¥–ª—è –±–æ–ª–µ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–∏—Å–µ–º.
                  </p>
                </div>

                <p id="auth-error" class="text-xs text-red-500 min-h-[1rem]"></p>

                <div class="flex flex-col sm:flex-row gap-2 pt-1">
                  <button id="btn-login" type="submit" class="btn btn-main flex-1 justify-center text-sm">
                    –í–æ–π—Ç–∏
                  </button>
                  <button id="auth-register" type="button" class="btn btn-ghost flex-1 justify-center text-sm">
                    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                  </button>
                </div>
              </form>
            </div>

            <div id="auth-when-logged-in" class="hidden space-y-4">
              <div class="soft-card p-4 space-y-3">
                <p class="text-xs font-semibold text-slate-700 uppercase tracking-[.18em]">
                  –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
                </p>
                <div class="flex items-center gap-3">
                  <div class="h-10 w-10 rounded-full overflow-hidden bg-slate-200 flex-shrink-0">
                    <img id="profile-avatar-img" src="/assets/avatar.jpg" alt="Avatar" class="h-full w-full object-cover">
                  </div>
                  <div class="min-w-0">
                    <p id="profile-name" class="text-sm font-semibold text-slate-900 truncate">
                      ...
                    </p>
                    <p id="auth-user-email" class="text-xs text-slate-500 truncate">
                      ...
                    </p>
                  </div>
                </div>
                <p class="text-xs text-slate-500">
                  –≠—Ç–æ –≤–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç PolyTalky. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫—É—Ä—Å–∞–º–∏, –≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å–æ–±–∏—Ä–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
                </p>
              </div>
              <div class="flex flex-col sm:flex-row gap-2">
                <button id="btn-open-profile" class="btn btn-ghost flex-1 text-xs sm:text-sm">
                  –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
                </button>
                <button id="auth-logout" class="btn btn-main flex-1 text-xs sm:text-sm">
                  –í—ã–π—Ç–∏
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- –ö–£–†–°–´ + –î–û–°–¢–ò–ñ–ï–ù–ò–Ø: –î–í–ï –ö–û–õ–û–ù–ö–ò –ù–ê –î–ï–°–ö–¢–û–ü–ï -->
      <section class="grid gap-6 lg:grid-cols-[minmax(0,3fr)_minmax(0,2fr)] items-start">
        <!-- –ö–£–†–°–´ (–õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê) -->
        <div class="space-y-3">
          <div class="flex items-center justify-between gap-3">
            <div class="space-y-1">
              <p class="pill-label">–í–∞—à–∏ –∫—É—Ä—Å—ã</p>
              <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
                –í—Å–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –º–∏–Ω–∏-–∫—É—Ä—Å—ã
              </h2>
              <p class="text-xs sm:text-sm text-slate-600">
                –ó–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω—ã –∫—É—Ä—Å—ã, –∫—É–ø–ª–µ–Ω–Ω—ã–µ –≤ <a href="/shop/" class="underline">–º–∞–≥–∞–∑–∏–Ω–µ</a>, –∞ —Ç–∞–∫–∂–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã –ø—Ä–æ—à–ª–∏ —Ö–æ—Ç—è –±—ã –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫.
              </p>
            </div>
            <a href="/shop/" class="hidden lg:inline-flex btn btn-ghost text-xs">
              üõí –í –º–∞–≥–∞–∑–∏–Ω
            </a>
          </div>

          <div id="courses-need-auth" class="soft-card p-4 text-xs sm:text-sm text-slate-600">
            –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –∫—É—Ä—Å–æ–≤ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å.
          </div>

          <div id="courses-empty" class="soft-card p-4 text-xs sm:text-sm text-slate-600 hidden">
            –ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ. –ó–∞–≥–ª—è–Ω–∏—Ç–µ –≤
            <a href="/shop/" class="underline">–º–∞–≥–∞–∑–∏–Ω</a>, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å, –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö
            <a href="/courses/" class="underline">–º–∏–Ω–∏-–∫—É—Ä—Å–æ–≤</a>.
          </div>

          <div id="courses-list" class="grid gap-3 sm:gap-4 md:grid-cols-2">
            <!-- –∫–∞—Ä—Ç–æ—á–∫–∏ –∫—É—Ä—Å–æ–≤ -->
          </div>
        </div>

        <!-- –î–û–°–¢–ò–ñ–ï–ù–ò–Ø (–ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê) -->
        <div class="space-y-3">
          <div class="space-y-1">
            <p class="pill-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</p>
            <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
              –ë–µ–π–¥–∂–∏, –º–µ–¥–∞–ª–∏ –∏ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã
            </h2>
            <p class="text-xs sm:text-sm text-slate-600">
              –ú—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫—É—Ä—Å—ã –±–µ–π–¥–∂–∏ –∏ –º–µ–¥–∞–ª–∏. –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–∞—à–∏ –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –æ—Å–æ–±—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
            </p>
          </div>
          <div id="achievements-list" class="grid gap-3 sm:gap-4">
            <!-- –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
          </div>
        </div>
      </section>

      <!-- –ù–ê–°–¢–†–û–ô–ö–ò –ü–†–û–§–ò–õ–Ø (–º–æ–¥–∞–ª–∫–∞) -->
      <div id="profile-settings" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden items-center justify-center z-40">
        <div class="card max-w-md w-full mx-4 p-5 sm:p-6 space-y-4">
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-xs font-semibold tracking-[.18em] uppercase text-amber-700">
                –ü—Ä–æ—Ñ–∏–ª—å
              </p>
              <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
              </h2>
              <p class="text-xs sm:text-sm text-slate-600">
                –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à –æ–ø—ã—Ç –∏, –≤ –±—É–¥—É—â–µ–º, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±–æ–ª–µ–µ –Ω–∞–≥–ª—è–¥–Ω–æ.
              </p>
            </div>
            <button id="btn-close-profile" class="text-slate-400 hover:text-slate-600 text-xl leading-none">
              √ó
            </button>
          </div>

          <form id="profile-form" class="space-y-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label for="profile-first" class="block text-xs font-medium text-slate-600 mb-1">
                  –ò–º—è
                </label>
                <input
                  id="profile-first"
                  name="firstName"
                  type="text"
                  class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, Anna"
                />
              </div>
              <div>
                <label for="profile-last" class="block text-xs font-medium text-slate-600 mb-1">
                  –§–∞–º–∏–ª–∏—è
                </label>
                <input
                  id="profile-last"
                  name="lastName"
                  type="text"
                  class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400"
                  placeholder="–§–∞–º–∏–ª–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                />
              </div>
            </div>

            <div>
              <label for="profile-avatar-file" class="block text-xs font-medium text-slate-600 mb-1">
                –§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è
              </label>
              <input
                id="profile-avatar-file"
                type="file"
                accept="image/*"
                class="w-full text-xs text-slate-600"
              />
              <p class="text-[11px] text-slate-500 mt-1">
                –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –º—ã —Å–æ—Ö—Ä–∞–Ω–∏–º –µ–≥–æ –∫–∞–∫ –≤–∞—à –∞–≤–∞—Ç–∞—Ä.
              </p>
            </div>

            <p id="profile-msg" class="text-xs text-slate-500 min-h-[1rem]"></p>

            <div class="flex items-center justify-end gap-2 pt-2">
              <button type="button" id="btn-cancel-profile" class="btn btn-ghost text-xs sm:text-sm">
                –û—Ç–º–µ–Ω–∞
              </button>
              <button type="submit" class="btn btn-main text-xs sm:text-sm">
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- COOKIE-BANNER -->
      <div id="cookie-banner" class="fixed bottom-3 inset-x-0 flex justify-center z-50 hidden">
        <div class="soft-card px-4 py-3 flex flex-col sm:flex-row items-start sm:items-center gap-2 text-xs sm:text-sm text-slate-700 max-w-xl mx-4">
          <p class="flex-1">
            –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—É–∫–∏, —á—Ç–æ–±—ã –ø–æ–º–Ω–∏—Ç—å –≤–∞—à–∏ –ª–æ–≥–∏–Ω—ã –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫—É—Ä—Å–∞–º. –ü—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∞–π—Ç–æ–º, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å
            <a href="/privacy/" class="underline">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.
          </p>
          <button id="cookie-accept" class="btn btn-main text-xs sm:text-sm">
            –•–æ—Ä–æ—à–æ
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer class="border-t border-slate-200/70 bg-white/80">
    <div class="wrap px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row items-center justify-between gap-3 text-[11px] sm:text-xs text-slate-500">
      <p>¬© PolyTalky. –Ø–∑—ã–∫–∏ –∫–∞–∫ —Å—Ç–∏–ª—å –∂–∏–∑–Ω–∏.</p>
      <p class="flex items-center gap-3">
        <a href="/privacy/" class="hover:text-slate-700">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        <span class="hidden sm:inline text-slate-400">‚Ä¢</span>
        <a href="/oferta/" class="hover:text-slate-700">–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</a>
      </p>
    </div>
  </footer>

  <!-- Firebase + –ª–æ–≥–∏–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–∞ -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBAU_uMTePpKwVNZNhqk2pss2PuSitGfQI",
      authDomain: "polytalky-70999.firebaseapp.com",
      projectId: "polytalky-70999",
      storageBucket: "polytalky-70999.firebasestorage.app",
      messagingSenderId: "62407152289",
      appId: "1:62407152289:web:b0c0efdb2472f12b10d6e0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();
    const storage = firebase.storage();

    const COURSE_META = {
      'spanish-a1-basics': {
        title: '–ò—Å–ø–∞–Ω—Å–∫–∏–π A1: –ë–∞–∑–æ–≤—ã–π —Å—Ç–∞—Ä—Ç',
        href: '/courses/spanish-a1-basics/',
        cover: '/assets/courses/spanish-a1.jpg'
      },
      'spanish-verbs-mini': {
        title: '–ú–∏–Ω–∏-–∫—É—Ä—Å: –ò—Å–ø–∞–Ω—Å–∫–∏–µ –≥–ª–∞–≥–æ–ª—ã',
        href: '/courses/spanish-verbs-mini/',
        cover: '/assets/courses/spanish-verbs.jpg'
      },
      'english-intro': {
        title: 'English Intro: –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –±–∞–∑–æ–≤—ã–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π',
        href: '/courses/english-intro/',
        cover: '/assets/courses/english-intro.jpg'
      }
    };

    const BADGE_META = {
      'english-intro-lesson-1': {
        icon: 'üåü',
        title: '–ü–µ—Ä–≤—ã–π —É—Ä–æ–∫ English Intro',
        desc: '–í—ã –ø—Ä–æ—à–ª–∏ –ø–µ—Ä–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ, –∏ —ç—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å—Ç–∞—Ä—Ç!'
      },
      'english-intro-lesson-2': {
        icon: 'üöÄ',
        title: '–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ',
        desc: '–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤—Ç–æ—Ä–æ–π —É—Ä–æ–∫ English Intro.'
      }
    };
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const authBoxOut      = document.getElementById('auth-when-logged-out');
      const authBoxIn       = document.getElementById('auth-when-logged-in');
      const authEmailEl     = document.getElementById('auth-email');
      const authPassEl      = document.getElementById('auth-pass');
      const authFirstEl     = document.getElementById('auth-first');
      const authLastEl      = document.getElementById('auth-last');
      const honeypotEl      = document.getElementById('auth-website');
      const authForm        = document.getElementById('auth-form');
      const authRegister    = document.getElementById('auth-register');
      const btnLogin        = document.getElementById('btn-login');
      const authError       = document.getElementById('auth-error');
      const authLogout      = document.getElementById('auth-logout');
      const authUserEmail   = document.getElementById('auth-user-email');
      const authExtra       = document.getElementById('auth-extra');

      const profileAvatarImg= document.getElementById('profile-avatar-img');
      const profileName     = document.getElementById('profile-name');
      const profileSettings = document.getElementById('profile-settings');
      const profileForm     = document.getElementById('profile-form');
      const profileFirst    = document.getElementById('profile-first');
      const profileLast     = document.getElementById('profile-last');
      const profileAvatarFile = document.getElementById('profile-avatar-file');
      const profileMsg      = document.getElementById('profile-msg');

      const coursesNeedAuth = document.getElementById('courses-need-auth');
      const coursesList     = document.getElementById('courses-list');
      const coursesEmpty    = document.getElementById('courses-empty');
      const achievementsList= document.getElementById('achievements-list');

      const cookieBanner    = document.getElementById('cookie-banner');
      const cookieAccept    = document.getElementById('cookie-accept');

      const proBannerSuccess = document.getElementById('pro-banner-success');
      const proBannerError   = document.getElementById('pro-banner-error');
      const proBannerCancel  = document.getElementById('pro-banner-cancel');
      const proCancelButton  = document.getElementById('pro-cancel-button');

      /* PRO –ø–∞—Ä–∞–º–µ—Ç—Ä */
      (function handleProParam() {
        const params = new URLSearchParams(window.location.search);
        const pro = params.get('pro');
        if (!pro) return;

        if (pro === 'success' && proBannerSuccess) {
          proBannerSuccess.style.display = 'flex';
        } else if (pro === 'error' && proBannerError) {
          proBannerError.style.display = 'flex';
        } else if (pro === 'cancel' && proBannerCancel) {
          proBannerCancel.style.display = 'flex';
        }

        params.delete('pro');
        const newSearch = params.toString();
        const newUrl = window.location.pathname + (newSearch ? '?' + newSearch : '') + window.location.hash;
        window.history.replaceState({}, '', newUrl);
      })();

      if (proCancelButton) {
        proCancelButton.addEventListener('click', () => {
          alert('–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É PRO, –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞ –ø–æ—á—Ç—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚Äî –º—ã –ø–æ–º–æ–∂–µ–º –≤—Å—ë –æ—Ñ–æ—Ä–º–∏—Ç—å.');
        });
      }

      /* cookie */
      if (!localStorage.getItem('cookieConsent')) {
        cookieBanner.classList.remove('hidden');
      }
      cookieAccept.addEventListener('click', () => {
        localStorage.setItem('cookieConsent', 'true');
        cookieBanner.classList.add('hidden');
      });

      /* –º–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
      function openProfileModal(){
        profileSettings.classList.remove('hidden');
        profileSettings.classList.add('flex');
      }
      function closeProfileModal(){
        profileSettings.classList.add('hidden');
        profileSettings.classList.remove('flex');
      }
      document.getElementById('btn-open-profile')?.addEventListener('click', openProfileModal);
      document.getElementById('btn-close-profile')?.addEventListener('click', closeProfileModal);
      document.getElementById('btn-cancel-profile')?.addEventListener('click', (e)=>{
        e.preventDefault();
        closeProfileModal();
      });
      profileSettings.addEventListener('click', (e)=>{
        if (e.target === profileSettings) closeProfileModal();
      });

      /* –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
      function showAuthError(code){
        let msg = '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
        if (code === 'auth/user-not-found') {
          msg = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è.';
        } else if (code === 'auth/wrong-password') {
          msg = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Å–±—Ä–æ—Å–æ–º –ø–∞—Ä–æ–ª—è.';
        } else if (code === 'auth/email-already-in-use') {
          msg = '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏.';
        } else if (code === 'auth/weak-password') {
          msg = '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π. –î–æ–±–∞–≤—å—Ç–µ –µ—â—ë —Å–∏–º–≤–æ–ª–æ–≤.';
        }
        authError.textContent = msg;
      }

      let registerMode = false;

      /* –≤—Ö–æ–¥ */
      authForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        authError.textContent = '';

        if (honeypotEl.value && honeypotEl.value.trim() !== '') {
          authError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
          return;
        }

        try {
          const email = authEmailEl.value.trim();
          const pass  = authPassEl.value.trim();
          await auth.signInWithEmailAndPassword(email, pass);
        } catch (err) {
          console.error(err);
          showAuthError(err.code);
        }
      });

      /* —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è */
      authRegister.addEventListener('click', async () => {
        authError.textContent = '';

        if (honeypotEl.value && honeypotEl.value.trim() !== '') {
          authError.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
          return;
        }

        if (!registerMode) {
          registerMode = true;
          authExtra.classList.remove('hidden');
          authError.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª.';
          return;
        }

        try {
          const email = authEmailEl.value.trim();
          const pass  = authPassEl.value.trim();
          const first = authFirstEl.value.trim();
          const last  = authLastEl.value.trim();

          if (!email || !pass){
            authError.textContent = '–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å.';
            return;
          }

          const cred = await auth.createUserWithEmailAndPassword(email, pass);
          const user = cred.user;
          if (user) {
            await db.collection('users').doc(email).set({
              email,
              firstName:first || null,
              lastName:last || null,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge:true });
          }
        } catch (err) {
          console.error(err);
          showAuthError(err.code);
        }
      });

      /* –≤—ã—Ö–æ–¥ */
      authLogout?.addEventListener('click', async () => {
        await auth.signOut();
      });

      /* —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
      async function setAuthState(user) {
        if (user) {
          localStorage.setItem('pt_uid', user.uid || '');
          if (user.email) localStorage.setItem('pt_email', user.email);

          authBoxOut.classList.add('hidden');
          authBoxIn.classList.remove('hidden');
          coursesNeedAuth.classList.add('hidden');
          authUserEmail.textContent = user.email || '';

          await loadUserProfile(user);
          await loadUserEnrollments(user);
        } else {
          localStorage.removeItem('pt_uid');
          localStorage.removeItem('pt_email');

          authBoxOut.classList.remove('hidden');
          authBoxIn.classList.add('hidden');
          coursesNeedAuth.classList.remove('hidden');
          authUserEmail.textContent = '';
          profileName.textContent = '';
          profileAvatarImg.src = '/assets/avatar.jpg';
          coursesList.innerHTML = '';
          coursesEmpty.classList.add('hidden');
          achievementsList.innerHTML = '';
        }
      }

      /* –ø—Ä–æ—Ñ–∏–ª—å: —á—Ç–µ–Ω–∏–µ (email + uid, —Å–ª–∏—è–Ω–∏–µ) */
      async function loadUserProfile(user) {
        try {
          const email = user.email || null;
          const uid   = user.uid   || null;
          if (!email && !uid) return;

          const usersCol = db.collection('users');
          const emailRef = email ? usersCol.doc(email) : null;
          const uidRef   = uid   ? usersCol.doc(uid)   : null;

          const [emailSnap, uidSnap] = await Promise.all([
            emailRef ? emailRef.get() : Promise.resolve(null),
            uidRef   ? uidRef.get()   : Promise.resolve(null)
          ]);

          const emailData = emailSnap && emailSnap.exists ? (emailSnap.data() || {}) : null;
          const uidData   = uidSnap   && uidSnap.exists   ? (uidSnap.data()   || {}) : null;

          let data = {
            ...(uidData || {}),
            ...(emailData || {}),
          };

          if (email) data.email = data.email || email;

          const first = data.firstName || '';
          const last  = data.lastName || '';
          const avatarUrl = data.avatarUrl || '';
          const displayEmail = data.email || email || '';

          const displayName = (first || last)
            ? (first + ' ' + (last || '')).trim()
            : displayEmail || '–ë–µ–∑ –∏–º–µ–Ω–∏';

          profileName.textContent = displayName;
          authUserEmail.textContent = displayEmail;

          profileFirst.value = first;
          profileLast.value  = last;

          if (avatarUrl) {
            profileAvatarImg.src = avatarUrl;
          } else {
            profileAvatarImg.src = '/assets/avatar.jpg';
          }

          profileMsg.textContent = '';

          if (emailRef) {
            try {
              await emailRef.set(
                { ...data, email: displayEmail },
                { merge: true }
              );
            } catch (e) {
              console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å uid‚Üíemail:', e);
            }
          }
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è:', err);
        }
      }

     profileForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        profileMsg.textContent = '';

        const user = auth.currentUser;
        if (!user) {
          profileMsg.textContent = '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.';
          return;
        }

        try {
          const email = user.email;
          const first = profileFirst.value.trim();
          const last  = profileLast.value.trim();
          const file  = profileAvatarFile.files[0] || null;

          const payload = {
            firstName: first,
            lastName:  last
          };

          // –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ –Ω–æ–≤—ã–π —Ñ–∞–π–ª ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º –≤ Storage
          if (file) {
            profileMsg.textContent = '–ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ...';

            const ext = (file.name.split('.').pop() || 'jpg').toLowerCase();
            const avatarRef = storage.ref().child(avatars/${user.uid}_${Date.now()}.${ext});

            const snap = await avatarRef.put(file);
            const url  = await snap.ref.getDownloadURL();

            payload.avatarUrl = url;
            profileAvatarImg.src = url;     // —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ —à–∞–ø–∫–µ
          }

          // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –≤ Firestore
          await db.collection('users').doc(email).set(payload, { merge: true });

          profileMsg.textContent = '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω ‚úîÔ∏è';
          profileAvatarFile.value = '';     // –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ —Ñ–∞–π–ª–∞

          // –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ –±–∞–∑—ã (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
          const again = auth.currentUser;
          if (again) {
            await loadUserProfile(again);
          }

          // –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
          closeProfileModal();
        } catch (err) {
          console.error('profile save error', err);
          profileMsg.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
        }
      });

      /* –∫—É—Ä—Å—ã: —á—Ç–µ–Ω–∏–µ –∏ —Å–ª–∏—è–Ω–∏–µ email+uid */
      async function loadUserEnrollments(user) {
        coursesList.innerHTML = '';
        coursesEmpty.classList.add('hidden');

        try {
          const email = user.email || null;
          const uid   = user.uid   || null;

          if (!email && !uid) {
            coursesEmpty.classList.remove('hidden');
            achievementsList.innerHTML = renderAchievements([], []);
            return;
          }

          const usersCol = db.collection('users');
          const emailRef = email ? usersCol.doc(email) : null;
          const uidRef   = uid   ? usersCol.doc(uid)   : null;

          const [emailSnap, uidSnap] = await Promise.all([
            emailRef ? emailRef.get() : Promise.resolve(null),
            uidRef   ? uidRef.get()   : Promise.resolve(null)
          ]);

          const emailData = emailSnap && emailSnap.exists ? (emailSnap.data() || {}) : null;
          const uidData   = uidSnap   && uidSnap.exists   ? (uidSnap.data()   || {}) : null;

          if (!emailData && !uidData) {
            coursesEmpty.classList.remove('hidden');
            achievementsList.innerHTML = renderAchievements([], []);
            return;
          }

          const paidFromEmail = Array.isArray(emailData?.courses)     ? emailData.courses     : [];
          const paidFromUid   = Array.isArray(uidData?.courses)       ? uidData.courses       : [];
          const freeFromEmail = Array.isArray(emailData?.freeCourses) ? emailData.freeCourses : [];
          const freeFromUid   = Array.isArray(uidData?.freeCourses)   ? uidData.freeCourses   : [];
          const badgesEmail   = Array.isArray(emailData?.badges)      ? emailData.badges      : [];
          const badgesUid     = Array.isArray(uidData?.badges)        ? uidData.badges        : [];

          const mergedPaid   = Array.from(new Set([...paidFromUid,  ...paidFromEmail]));
          const mergedFree   = Array.from(new Set([...freeFromUid,  ...freeFromEmail]));
          const mergedBadges = Array.from(new Set([...badgesUid,     ...badgesEmail]));

          const progressEmail = emailData?.progress || {};
          const progressUid   = uidData?.progress   || {};
          const mergedProgress = {
            ...(progressUid || {}),
            ...(progressEmail || {}),
          };

          const courses = [];

          for (const id of mergedPaid) {
            courses.push({
              id,
              isPaid: true,
              isFree: false,
              progress: mergedProgress[id] || null
            });
          }

          for (const id of mergedFree) {
            if (mergedPaid.includes(id)) continue;
            courses.push({
              id,
              isPaid: false,
              isFree: true,
              progress: mergedProgress[id] || null
            });
          }

          renderCourses(courses);
          achievementsList.innerHTML = renderAchievements(courses, mergedBadges);

          if (emailRef) {
            try {
              await emailRef.set(
                {
                  email: emailData?.email || email || null,
                  courses: mergedPaid,
                  freeCourses: mergedFree,
                  badges: mergedBadges,
                  progress: mergedProgress
                },
                { merge: true }
              );
            } catch (e) {
              console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å—ã uid‚Üíemail:', e);
            }
          }
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤:', err);
          renderCourses([]);
          achievementsList.innerHTML = renderAchievements([], []);
        }
      }

      function renderCourses(courses) {
        coursesList.innerHTML = '';
        if (!courses || courses.length === 0) {
          coursesEmpty.classList.remove('hidden');
          return;
        }
        coursesEmpty.classList.add('hidden');

        courses.forEach(c => {
          const meta = COURSE_META[c.id] || {
            title: c.id,
            href: '/courses/',
            cover: '/assets/courses/default.jpg'
          };

          const progressData = c.progress || {};
          const percent = typeof progressData.percent === 'number'
            ? Math.max(0, Math.min(100, progressData.percent))
            : 0;
          const lastLessonId = progressData.lastLessonId || null;

          const isFree = !!c.isFree;
          const isPaid = !!c.isPaid;

          const badgeLabel = isFree ? '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å' : '–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –∫—É—Ä—Å';
          const badgeClass = isFree
            ? 'border-emerald-300 bg-emerald-50 text-emerald-700'
            : 'border-amber-300 bg-amber-50 text-amber-700';

          let statusLabel;
          if (percent > 0 && lastLessonId) {
            statusLabel = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percent}% ¬∑ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫: ${lastLessonId}`;
          } else if (percent > 0) {
            statusLabel = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percent}%`;
          } else if (isPaid) {
            statusLabel = '–ö—É—Ä—Å –æ–ø–ª–∞—á–µ–Ω, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.';
          } else {
            statusLabel = '–ö—É—Ä—Å –æ—Ç–∫—Ä—ã—Ç, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫.';
          }

          const card = document.createElement('a');
          card.href = meta.href;
          card.className = 'soft-card p-3 sm:p-4 flex flex-col gap-2 hover:shadow-md transition-shadow group';

          card.innerHTML = `
            <div class="flex gap-3 items-center">
              <div class="h-14 w-14 rounded-xl bg-slate-100 overflow-hidden flex-shrink-0">
                <img src="${meta.cover}" alt="" class="h-full w-full object-cover group-hover:scale-105 transition-transform" />
              </div>
              <div class="flex-1 min-w-0 space-y-1">
                <div class="flex items-center gap-2">
                  <span class="badge text-[10px] ${badgeClass}">${badgeLabel}</span>
                </div>
                <p class="text-sm font-semibold text-slate-900 truncate">${meta.title}</p>
                <p class="text-[11px] text-slate-500">${statusLabel}</p>
              </div>
            </div>
            <div class="mt-2 h-1.5 rounded-full bg-slate-100 overflow-hidden">
              <div class="h-full bg-gradient-to-r from-emerald-400 to-emerald-500" style="width:${percent}%;"></div>
            </div>
          `;

          coursesList.appendChild(card);
        });
      }

      function renderAchievements(courses, badgeIds){
        const total = Array.isArray(courses) ? courses.length : 0;
        const paid  = courses.filter(c => c.isPaid).length;
        const free  = courses.filter(c => c.isFree).length;

        const medals = [];

        medals.push({
          id:'first-course',
          icon:'ü•á',
          title:'–ü–µ—Ä–≤—ã–π —à–∞–≥',
          desc:'–í—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å. –û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ!',
          earned: total >= 1
        });
        medals.push({
          id:'three-courses',
          icon:'üéì',
          title:'–ú–∏–Ω–∏-–ø–æ–ª–∏–≥–ª–æ—Ç',
          desc:'–¢—Ä–∏ –∏ –±–æ–ª—å—à–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤.',
          earned: total >= 3
        });
        medals.push({
          id:'five-courses',
          icon:'üåç',
          title:'–ë—É–¥—É—â–∏–π –ø–æ–ª–∏–≥–ª–æ—Ç',
          desc:'–ü—è—Ç—å –∏ –±–æ–ª—å—à–µ –∫—É—Ä—Å–æ–≤ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ.',
          earned: total >= 5
        });
        medals.push({
          id:'free-lover',
          icon:'üéÅ',
          title:'–õ—é–±–∏—Ç–µ–ª—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤',
          desc:'–î–≤–∞ –∏ –±–æ–ª–µ–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–∞.',
          earned: free >= 2
        });
        medals.push({
          id:'investor',
          icon:'üí≥',
          title:'–ò–Ω–≤–µ—Å—Ç–æ—Ä –≤ –∑–Ω–∞–Ω–∏—è',
          desc:'–î–≤–∞ –∏ –±–æ–ª–µ–µ –ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤.',
          earned: paid >= 2
        });

        if (Array.isArray(badgeIds)) {
          badgeIds.forEach(bid => {
            const meta = BADGE_META[bid] || {};
            medals.push({
              id: 'badge-' + bid,
              icon: meta.icon || 'üèÖ',
              title: meta.title || '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ',
              desc: meta.desc || bid,
              earned: true
            });
          });
        }

        if (!medals.length) {
          return `
            <div class="soft-card p-4 text-xs sm:text-sm text-slate-600">
              –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã –Ω–∞—á–Ω—ë—Ç–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—Ä–æ–∫–∏, –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –ø–µ—Ä–≤—ã–µ –±–µ–π–¥–∂–∏ –∏ –º–µ–¥–∞–ª–∏ –∑–∞ –≤–∞—à–∏ —à–∞–≥–∏ –≤ —è–∑—ã–∫–∞—Ö.
            </div>`;
        }

        if (!medals.some(m => m.earned)) {
          return `
            <div class="soft-card p-4 text-xs sm:text-sm text-slate-600">
              –ü–µ—Ä–≤—ã–µ –º–µ–¥–∞–ª–∏ –ø–æ—è–≤—è—Ç—Å—è, –∫–æ–≥–¥–∞ –≤—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç–µ –∫—É—Ä—Å –≤
              <a href="/shop/" class="underline">–º–∞–≥–∞–∑–∏–Ω–µ</a> –∏–ª–∏ –Ω–∞—á–Ω—ë—Ç–µ
              <a href="/courses/" class="underline">–±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É</a>.
            </div>`;
        }

        return medals.map(m => {
          const opacity = m.earned ? '' : 'opacity-50';
          const label   = m.earned ? '–ü–æ–ª—É—á–µ–Ω–æ' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ';
          const badgeCl = m.earned ? 'bg-emerald-50 border-emerald-200 text-emerald-700'
                                   : 'bg-slate-50 border-slate-200 text-slate-400';
          return `
            <article class="soft-card p-3 sm:p-4 flex items-start gap-3 ${opacity}">
              <div class="h-9 w-9 rounded-lg bg-slate-900/90 text-white flex items-center justify-center text-lg">
                ${m.icon}
              </div>
              <div class="space-y-1">
                <div class="flex items-center gap-2">
                  <h3 class="text-sm font-semibold text-slate-900">${m.title}</h3>
                  <span class="badge text-[10px] ${badgeCl}">${label}</span>
                </div>
                <p class="text-xs sm:text-sm text-slate-600">${m.desc}</p>
              </div>
            </article>`;
        }).join('');
      }

      auth.onAuthStateChanged((user) => {
        setAuthState(user || null);
      });
    });
  </script>
</body>
</html>
